(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"01nW":function(e,t,s){"use strict";s.r(t),s.d(t,"SecretModule",function(){return Ia});var i=s("ofXK"),o=s("3Pt+"),n=s("OFbc"),r=s("FpXt"),c=s("tyNb"),a=s("NJqk"),l=s("d91t"),d=s("ayeB"),h=s("SxV6"),u=s("lJxs"),p=s("CLA2"),b=s("fXoL"),m=s("Ljv0"),g=s("EGBR"),f=s("ceUb"),v=s("M8FM");const y=["pageDialog"];function S(e,t){if(1&e){const e=b.Vb();b.Ub(0,"ss-splash-empty-state",3),b.bc("splashContinue",function(){return b.Ec(e),b.fc().splashContinue()}),b.Ub(1,"ul"),b.Pb(2,"li",4),b.Tb(),b.Tb()}}function w(e,t){1&e&&b.Pb(0,"ss-secret-grid",5),2&e&&b.nc("showSubfolderSearchOption",!1)}let C=(()=>{class e{constructor(e,t,s,i){this._localizationService=e,this.stateService=t,this._preferenceService=s,this._secretService=i,this.selectedSecrets=[],this.showMultiple=!1,this.showSingle=!1,this.pageName="secretgrid",this.PageDialogLayout=p.b,this.isLoading=!0}ngOnInit(){this._localizationService.loadResourcePage(this.pageName),this._preferenceService.getPreference(d.l.SPLASH_DISMISSED,"all-secrets").pipe(Object(h.a)()).subscribe(e=>{this.stateService.splash.showSecretSplash="true"!==(null==e?void 0:e.settingValue),this.stateService.splash.showSecretSplash?this._secretsExist().pipe(Object(h.a)()).subscribe(e=>{e&&this.splashContinue(),this.isLoading=!1}):this.isLoading=!1})}splashContinue(){this.stateService.splash.showSecretSplash=!1,this._preferenceService.setPreference(d.l.SPLASH_DISMISSED,"all-secrets",!0).pipe(Object(h.a)()).subscribe()}_secretsExist(){return this._secretService.getSecretsCount(null,null,1,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null).pipe(Object(u.a)(e=>e>0))}}return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.F),b.Ob(a.cb),b.Ob(a.M),b.Ob(a.V))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-all-secrets-list"]],viewQuery:function(e,t){if(1&e&&b.Uc(y,1),2&e){let e;b.zc(e=b.cc())&&(t.pageDialog=e.first)}},decls:3,vars:2,consts:[["layout","grid"],["localeTitle","secretgrid.splash-secret","localePrimaryButton","common.continue","splashImageUrl","assets/images/splash/secrets.png",3,"splashContinue",4,"ngIf"],[3,"showSubfolderSearchOption",4,"ngIf"],["localeTitle","secretgrid.splash-secret","localePrimaryButton","common.continue","splashImageUrl","assets/images/splash/secrets.png",3,"splashContinue"],["ss-page-name","secretgrid","ss-locale","splash-secret-description"],[3,"showSubfolderSearchOption"]],template:function(e,t){1&e&&(b.Ub(0,"thy-page-detail",0),b.Mc(1,S,3,0,"ss-splash-empty-state",1),b.Mc(2,w,1,1,"ss-secret-grid",2),b.Tb()),2&e&&(b.Cb(1),b.nc("ngIf",!t.isLoading&&t.stateService.splash.showSecretSplash),b.Cb(1),b.nc("ngIf",!t.isLoading&&!t.stateService.splash.showSecretSplash))},directives:[m.j,i.o,g.a,f.a,v.a],styles:[""]}),e})();var T=s("yhEF");let O=(()=>{class e{constructor(e,t){this._stateService=e,this._route=t,this.folderId=-1}ngOnInit(){const e=+this._route.snapshot.queryParamMap.get("folderid");this.folderId=e>0?e:this._stateService.activeFolderId?this._stateService.activeFolderId:-1}}return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.cb),b.Ob(c.a))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-new-secret-page"]],decls:2,vars:2,consts:[[3,"isFullPage","folderId"]],template:function(e,t){1&e&&(b.Ub(0,"thy-page-detail"),b.Pb(1,"ss-new-secret",0),b.Tb()),2&e&&(b.Cb(1),b.nc("isFullPage",!0)("folderId",t.folderId))},directives:[m.j,T.a],styles:[""]}),e})();function I(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",1),b.Ub(1,"div",2),b.Oc(2,"\xa0"),b.Tb(),b.Ub(3,"div",3),b.Ub(4,"div"),b.Pb(5,"svg-icon",4),b.Tb(),b.Ub(6,"div",5),b.Oc(7),b.Tb(),b.Ub(8,"div",6),b.Oc(9," This Secret needs to be undeleted before it can be viewed. "),b.Tb(),b.Ub(10,"div",7),b.Ub(11,"button",8),b.bc("click",function(){return b.Ec(e),b.fc().undelete()}),b.Oc(12,"Undelete"),b.Tb(),b.Tb(),b.Tb(),b.Ub(13,"div",2),b.Oc(14,"\xa0"),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.Cb(7),b.Pc(e.secret.value)}}let _=(()=>{class e{constructor(e,t,s,i){this._secretService=e,this._activatedRoute=t,this._router=s,this._stateService=i,this.secretId=null,this.secret=null}ngOnInit(){this.secretId=this._activatedRoute.snapshot.params.id,this._secretService.lookUpSecretById(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this.secret=e,this._setCrumbs()})}undelete(){this._secretService.undelete(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this._router.navigate(["/secret",this.secretId,"general"])})}_setCrumbs(){this._stateService.events.navigationEvents.crumbsChanged.next([{name:this.secret.value}])}}return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.V),b.Ob(c.a),b.Ob(c.e),b.Ob(a.cb))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-requires-undelete"]],decls:1,vars:1,consts:[["class","ui three column grid delete-notification",4,"ngIf"],[1,"ui","three","column","grid","delete-notification"],[1,"column"],[1,"column",2,"text-align","center"],["name","delete",1,"icon-48"],[1,"no-result-title"],[1,"no-result-text"],[1,"button-row"],[1,"thy","primary","button","nohoverlink",3,"click"]],template:function(e,t){1&e&&b.Mc(0,I,15,1,"div",0),2&e&&b.nc("ngIf",t.secret)},directives:[i.o,n.b],styles:[".delete-notification[_ngcontent-%COMP%]{margin-top:48px}.button-row[_ngcontent-%COMP%]{margin-top:36px}"]}),e})();var P=s("mrSG"),M=s("VfN6"),k=s("CiM1"),x=s("MV21"),D=s("bnEz"),F=s("7fGM"),U=s("vkgz"),A=s("vHvj"),E=s("0IaG"),R=s("Qu3c"),N=s("ihPA"),L=s("Ld1c"),V=s("W9D4"),q=s("Uz6v"),G=s("yiS+"),z=s("Q3F2"),B=s("o18S"),j=s("taKe"),W=s("6FV5"),H=s("0Qt/");const K=["viewHistoryModal"];function Q(e,t){if(1&e&&(b.Ub(0,"div",20),b.Oc(1),b.Tb()),2&e){const e=b.fc(2);b.Cb(1),b.Pc(e.bannerMessage)}}function $(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",46),b.Ub(1,"div",23),b.Oc(2),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("showActions",!1),b.Cb(2),b.Qc(" ",e.form.value.ticketNumber," ")}}function Z(e,t){if(1&e&&(b.Ub(0,"div"),b.Pb(1,"ss-date",30),b.Oc(2," \xa0"),b.Pb(3,"span",47),b.Oc(4,"\xa0 "),b.Pb(5,"ss-date",30),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.nc("value",e.form.value.startDate)("format",e.DisplayDateFormat.DateTime),b.Cb(4),b.nc("value",e.form.value.expirationDate)("format",e.DisplayDateFormat.DateTime)}}function Y(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",48),b.Ub(1,"div",23),b.Oc(2),b.gc(3,"ssDate"),b.Pb(4,"span",47),b.Oc(5),b.gc(6,"ssDate"),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("showActions",!1)("labelLocalized",e.serverTimeZoneName),b.Cb(2),b.Qc(" ",b.jc(3,4,e.form.value.startDate,"datetime",e.dateFormatZone.Server)," \xa0"),b.Cb(3),b.Qc("\xa0 ",b.jc(6,8,e.form.value.expirationDate,"datetime",e.dateFormatZone.Server)," ")}}function J(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",48),b.Ub(1,"div",23),b.Oc(2),b.gc(3,"ssDate"),b.Pb(4,"span",47),b.Oc(5),b.gc(6,"ssDate"),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("showActions",!1)("labelLocalized",e.localTimeZoneName),b.Cb(2),b.Qc(" ",b.jc(3,4,e.form.value.startDate,"datetime",e.dateFormatZone.Local)," \xa0"),b.Cb(3),b.Qc("\xa0 ",b.jc(6,8,e.form.value.expirationDate,"datetime",e.dateFormatZone.Local)," ")}}function X(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",49),b.Ub(1,"div",32),b.Pb(2,"ss-form-input",50),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("showActions",!1),b.Cb(2),b.nc("type",e.formInputType.DropDown)("options",e.timzoneOptions)("inputWidth",244)}}function ee(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",51),b.Ub(1,"div",32),b.Pb(2,"thy-form-date",52),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("showActions",!1),b.Cb(2),b.nc("editMode",e.ies.isEditMode(null))("timezone",e.dateTimeInputTimezone)("offset",e.dateTimeInputOffset)}}function te(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",53),b.Ub(1,"div",32),b.Pb(2,"thy-form-date",54),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("showActions",!1),b.Cb(2),b.nc("editMode",e.ies.isEditMode(null))("timezone",e.dateTimeInputTimezone)("offset",e.dateTimeInputOffset)}}function se(e,t){1&e&&(b.Ub(0,"span",55),b.Oc(1,"(Visible to Requester)"),b.Tb())}function ie(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"div",56),b.Ub(2,"button",57),b.bc("click",function(){return b.Ec(e),b.fc(3).cancelRequest()}),b.Oc(3," Cancel Request "),b.Tb(),b.Tb(),b.Tb()}}function oe(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",62),b.bc("click",function(){return b.Ec(e),b.fc(4).deny()}),b.Oc(1," Revoke "),b.Tb()}if(2&e){const e=b.fc(4);b.nc("disabled",e.ies.isSaveDisabled(null))}}function ne(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",63),b.bc("click",function(){return b.Ec(e),b.fc(4).deny()}),b.Oc(1," Deny "),b.Tb()}if(2&e){const e=b.fc(4);b.nc("disabled",e.ies.isSaveDisabled(null))}}function re(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",64),b.bc("click",function(){return b.Ec(e),b.fc(4).approve()}),b.Oc(1," Approve "),b.Tb()}if(2&e){const e=b.fc(4);b.nc("disabled",e.ies.isSaveDisabled(null))}}function ce(e,t){if(1&e&&(b.Ub(0,"div",58),b.Mc(1,oe,2,1,"button",59),b.Mc(2,ne,2,1,"button",60),b.Ub(3,"div",5),b.Mc(4,re,2,1,"button",61),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.nc("ngIf",!e.isError&&e.canRevoke),b.Cb(1),b.nc("ngIf",!e.isError&&!e.canRevoke),b.Cb(1),b.nc("matTooltip",e.ies.okButtonTooltip),b.Cb(1),b.nc("ngIf",!e.isError&&!e.canRevoke)}}const ae=function(e){return["/secret",e,"general"]};function le(e,t){if(1&e&&(b.Ub(0,"ss-layout-form",21),b.Ub(1,"ss-layout-form-row",22),b.Ub(2,"div",23),b.Ub(3,"a",24),b.Oc(4),b.Tb(),b.Tb(),b.Tb(),b.Ub(5,"ss-layout-form-row",25),b.Ub(6,"div",23),b.Oc(7),b.Tb(),b.Tb(),b.Ub(8,"ss-layout-form-row",26),b.Ub(9,"div",23),b.Oc(10),b.Tb(),b.Tb(),b.Mc(11,$,3,2,"ss-layout-form-row",27),b.Ub(12,"ss-layout-form-row",28),b.Ub(13,"div",23),b.Oc(14),b.Tb(),b.Tb(),b.Ub(15,"ss-layout-form-row",29),b.Ub(16,"div",23),b.Pb(17,"ss-date",30),b.Tb(),b.Tb(),b.Ub(18,"ss-layout-form-row",31),b.Ub(19,"div",32),b.Ub(20,"div"),b.Pb(21,"ss-form-input",33),b.Tb(),b.Mc(22,Z,6,4,"div",34),b.Tb(),b.Tb(),b.Mc(23,Y,7,12,"ss-layout-form-row",35),b.Mc(24,J,7,12,"ss-layout-form-row",35),b.Mc(25,X,3,4,"ss-layout-form-row",36),b.Mc(26,ee,3,4,"ss-layout-form-row",37),b.Mc(27,te,3,4,"ss-layout-form-row",38),b.Ub(28,"ss-layout-form-row",39),b.Ub(29,"div",40),b.Ub(30,"label",41),b.Ub(31,"span",42),b.Oc(32,"Reason"),b.Tb(),b.Oc(33,"\xa0"),b.Mc(34,se,2,0,"span",43),b.Tb(),b.Tb(),b.Pb(35,"ss-form-input",44),b.Tb(),b.Mc(36,ie,4,0,"div",34),b.Mc(37,ce,5,4,"div",45),b.Tb()),2&e){const e=b.fc(2);b.nc("showBorder",!0),b.Cb(1),b.nc("showActions",!1),b.Cb(2),b.nc("routerLink",b.sc(35,ae,e.form.value.secretId)),b.Cb(1),b.Pc(e.form.value.secretName),b.Cb(1),b.nc("showActions",!1),b.Cb(2),b.Qc(" ",e.form.value.requestUsername," "),b.Cb(1),b.nc("showActions",!1),b.Cb(2),b.Qc(" ",e.form.value.requestComment," "),b.Cb(1),b.nc("ngIf",e.form.value.ticketNumber),b.Cb(1),b.nc("showActions",!1),b.Cb(2),b.Qc(" ",e.getApprovalStatus(e.form.value.status,e.form.value.statusDescription)," "),b.Cb(1),b.nc("showActions",!1),b.Cb(2),b.nc("value",e.form.value.requestDate)("format",e.DisplayDateFormat.Duration),b.Cb(1),b.nc("showActions",!1)("forceRequiredMarker",e.ies.isEditMode(null)),b.Cb(2),b.Gb("text-block",!e.localTimeDifferentThanServer&&"custom"!==e.form.value.duration),b.Cb(1),b.nc("type",e.formInputType.DropDown)("options",e.durationOptions)("inputWidthPercent",100),b.Cb(1),b.nc("ngIf",!e.localTimeDifferentThanServer&&"custom"!==e.form.value.duration),b.Cb(1),b.nc("ngIf",e.localTimeDifferentThanServer&&"custom"!==e.form.value.duration),b.Cb(1),b.nc("ngIf",e.localTimeDifferentThanServer&&"custom"!==e.form.value.duration),b.Cb(1),b.nc("ngIf",e.localTimeDifferentThanServer&&"custom"===e.form.value.duration),b.Cb(1),b.nc("ngIf","custom"===e.form.value.duration),b.Cb(1),b.nc("ngIf","custom"===e.form.value.duration),b.Cb(1),b.nc("showActions",!1),b.Cb(2),b.Gb("required-field",e.ies.isEditMode(null)),b.Cb(4),b.nc("ngIf",!e.isMyRequest),b.Cb(1),b.nc("type",e.formInputType.MultilineString)("maxlength",600),b.Cb(1),b.nc("ngIf",(e.isMyRequest||e.canEdit)&&e.canCancel),b.Cb(1),b.nc("ngIf",e.canEdit&&!e.isMyRequest)}}function de(e,t){if(1&e&&(b.Ub(0,"form",16),b.Mc(1,Q,2,1,"div",17),b.Pb(2,"ss-validation-summary",18),b.Mc(3,le,38,37,"ss-layout-form",19),b.Tb()),2&e){const e=b.fc();b.nc("formGroup",e.form),b.Cb(1),b.nc("ngIf",e.bannerMessage),b.Cb(1),b.nc("ssForm",e.form)("editSection",null),b.Cb(1),b.nc("ngIf",e.requestAccessId)}}const he=function(){return{propertyName:"dateRecorded",displayName:"Date Recorded",displayNameLocale:"date-recorded",columnOrder:1,columnType:"datetimesince",columnWidth:150}},ue=function(){return{propertyName:"fullName",displayName:"Full Name",displayNameLocale:"full-name",columnOrder:2}},pe=function(){return{propertyName:"action",displayName:"Action",displayNameLocale:"action",columnOrder:3}},be=function(){return{propertyName:"details",displayName:"Details",displayNameLocale:"details",columnOrder:4}},me=function(e,t,s,i){return[e,t,s,i]};let ge=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l,h,u,b){this._secretAccessService=e,this._ies=t,this._activatedRoute=s,this._router=i,this._log=n,this._dateService=r,this._stateService=c,this._errorService=a,this._localizationService=l,this._dialogService=h,this._preferenceService=u,this._breadcrumbService=b,this.isLoading=!0,this.formInputType=A.a,this.canEdit=!0,this.isError=!1,this.selectedPage="request",this.requestAccessId=null,this.allRequests=[],this.history=null,this.dateFormatZone=d.f,this.stateService=null,this.serverTimeZoneName=null,this.localTimeZoneName=null,this.localTimeDifferentThanServer=!1,this.paging={},this.bannerMessage=null,this.isMyRequest=!1,this.canCancel=!1,this.canRevoke=!1,this.DisplayDateFormat=x.a,this.durationOptions=null,this.timzoneOptions=null,this.viewHistoryTooltip=null,this.dateTimeInputTimezone="local",this.totalRecords=0,this._pageName="secretactions",this.form=new o.k({secretId:new o.h,secretName:new o.h,requestDate:new o.h,requestUsername:new o.h,requestingUserId:new o.h,requestComment:new o.h,ticketNumber:new o.h,serverTime:new o.h,status:new o.h,statusDescription:new o.h,startDate:new o.h(null,o.C.required),expirationDate:new o.h(null,o.C.required),responseComment:new o.h("",k.a.requiredNotEmpty),duration:new o.h("requested"),timeZone:new o.h("server")}),this.PageDialogLayout=p.b,this.ies=t,this.isLoading=!1,this.stateService=c}ngOnInit(){this.localTimeDifferentThanServer=this._dateService.isLocalTimeZoneDifferentThanServer(),this.serverTimeZoneName=this._stateService.userConfiguration.timeZoneId,this.localTimeZoneName=this._dateService.getLocalTimeZoneName(),this.viewHistoryTooltip=this._localizationService.getCachedMessage("view-history-description"),this._localizationService.getMessage("secret-approval").pipe(Object(h.a)()).subscribe(e=>this._breadcrumbService.setCrumbs(e)),this._initializeOptions(),this._activatedRoute.params.pipe(Object(M.b)(this)).subscribe(e=>{const t=+e.id;isNaN(t)&&this._router.navigate(["/home"]),t&&(this.requestAccessId=t,this._load())}),this.form.controls.timeZone.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{e&&("server"===e?(this.dateTimeInputTimezone=this._stateService.dateTimeServerTimezone,this.dateTimeInputOffset=this._stateService.dateTimeServerOffset):(this.dateTimeInputTimezone="local",this.dateTimeInputOffset=void 0),this._preferenceService.setPreference(d.l.PREFERRED_TIMEZONE,null,e).pipe(Object(h.a)()).subscribe())}),this.form.controls.startDate.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this._setCustomDurationTime(this.form.controls.startDate.value,this.form.controls.expirationDate.value,1,"common.custom")}),this.form.controls.expirationDate.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this._setCustomDurationTime(this.form.controls.startDate.value,this.form.controls.expirationDate.value,1,"common.custom")}),this.form.controls.duration.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{if("requested"===e&&(this.form.controls.startDate.setValue(this.secretAccess.startDate),this.form.controls.expirationDate.setValue(this.secretAccess.expirationDate)),"custom"!==e&&"requested"!==e){let t=d.g.Minutes,s=1;switch(e){case"30m":t=d.g.Minutes,s=30;break;case"60m":t=d.g.Hours,s=1;break;case"4h":t=d.g.Hours,s=4;break;case"8h":t=d.g.Hours,s=8;break;case"eod":t=d.g.EndOfDay;break;case"24h":t=d.g.Hours,s=24;break;case"eod+1":t=d.g.EndOfTomorrow,s=30;break;case"1w":t=d.g.Weeks,s=1;break;case"1M":t=d.g.Months,s=1;break;case"eod-local":t=d.g.EndOfTodayLocal,s=1;break;case"eod+1-local":t=d.g.EndOfTomorrowLocal,s=1}this.form.controls.startDate.setValue((new Date).toISOString(),{emitEvent:!1}),this.form.controls.startDate.markAsDirty();const i=this._dateService.getDateRange(t,s);this.form.controls.expirationDate.setValue(i.endDate.toISOString()),this.form.controls.expirationDate.markAsDirty()}})}isStartDateBeforeExpirationDate(){return this.form.controls.expirationDate.value>this.form.controls.startDate.value}showRequest(){this.selectedPage="request"}approve(){this.expirationDateValid()&&(this.ies.isSaving=!0,this._secretAccessService.updatedSecretRequest(this.requestAccessId,D.V.Approved,this.form.value.startDate,this.form.value.expirationDate,this.form.value.responseComment).pipe(Object(h.a)()).subscribe({next:e=>{e.actionResultMessage?(this._log.Warning(e.actionResultMessage),this.ies.disableEditMode(null,!1),this.bannerMessage=e.actionResultMessage):this._router.navigate(["/secret/all-requests"])},error:e=>{this.ies.isSaving=!1;const t=this._errorService.getErrorMessage(e);t.errorCode&&t.errorCode.indexOf("Email Failed")>=0?(this._log.Error("Error sending request approved email to user",this.requestAccessId,e),this._router.navigate(["/secret/all-requests"])):(this._log.Error("Error approving request",this.requestAccessId,e),this._ies.assignErrorToFormGroup(this.form,e))}}))}getApprovalStatus(e,t){if(t)return t;switch(e){case 1:return this._localizationService.getCachedPageMessage("common","pending");case 2:return this._localizationService.getCachedPageMessage("common","approved");case 3:return this._localizationService.getCachedPageMessage("common","denied");case 4:return this._localizationService.getCachedPageMessage("common","canceled");default:return this.form.value.statusDescription?this.form.value.statusDescription:this.form.value.status}}deny(){this.ies.isSaving=!0,this._secretAccessService.updatedSecretRequest(this.requestAccessId,D.V.Denied,this.form.value.startDate,this.form.value.expirationDate,this.form.value.responseComment?this.form.value.responseComment:"").pipe(Object(h.a)()).subscribe({next:e=>{this.ies.isSaving=!1,e.actionResultMessage&&this._log.Warning(e.actionResultMessage),this._router.navigate(["/secret/all-requests"])},error:e=>{this.ies.isSaving=!1;const t=this._errorService.getErrorMessage(e);t.errorCode&&t.errorCode.indexOf("Email Failed")>=0?(this._log.Error("Error sending request denied email to user",this.requestAccessId,e),this._router.navigate(["/secret/all-requests"])):(this._log.Error("Error denying request",this.requestAccessId,e),this._ies.assignErrorToFormGroup(this.form,e))}})}isSaveDisabled(){return!this.ies.showValidationMessages&&(!this.ies.isEditMode(null)||this.form&&(this.form.invalid||this.form.pristine))}_initializeOptions(){this.durationOptions=[],this.durationOptions.push({value:"requested",text:this._localizationService.getCachedPageMessage("common","custom")}),this.durationOptions.push({value:"custom",text:this._localizationService.getCachedPageMessage("common","custom")}),this.durationOptions.push({value:"30m",text:this._localizationService.getCachedPageMessage("secretactions","minutes-30")}),this.durationOptions.push({value:"60m",text:this._localizationService.getCachedPageMessage("secretactions","one-hour")}),this.durationOptions.push({value:"4h",text:this._localizationService.getCachedPageMessage("secretactions","four-hours")}),this.durationOptions.push({value:"8h",text:this._localizationService.getCachedPageMessage("secretactions","eight-hours")}),this.durationOptions.push({value:"eod",text:this._localizationService.getCachedPageMessage("secretactions","end-of-day")}),this.durationOptions.push({value:"24h",text:this._localizationService.getCachedPageMessage("secretactions","hours-24")}),this.durationOptions.push({value:"eod+1",text:this._localizationService.getCachedPageMessage("secretactions","end-of-next-day")}),this.durationOptions.push({value:"1w",text:this._localizationService.getCachedPageMessage("secretactions","one-week")}),this.durationOptions.push({value:"1M",text:this._localizationService.getCachedPageMessage("secretactions","one-month")}),this.localTimeDifferentThanServer&&(this.durationOptions.push({value:"eod-local",text:this._localizationService.getCachedPageMessage("secretactions","end-of-day-local")}),this.durationOptions.push({value:"eod+1-local",text:this._localizationService.getCachedPageMessage("secretactions","end-of-next-day-local")}),this.timzoneOptions=[],this.timzoneOptions.push({value:"server",text:`${this._localizationService.getCachedPageMessage("common","server")} (${this.serverTimeZoneName})`}),this.timzoneOptions.push({value:"local",text:`${this._localizationService.getCachedPageMessage("common","local")} (${this.localTimeZoneName})`})),this.form.controls.duration.meta={label:this._localizationService.getCachedPageMessage("secretactions","duration")},this.form.controls.responseComment.meta={label:this._localizationService.getCachedMessage("reason")},this.form.controls.startDate.meta={label:this._localizationService.getCachedMessage("start-date")},this.form.controls.expirationDate.meta={label:this._localizationService.getCachedMessage("expiration-date")}}_setCustomDurationTime(e,t,s,i){const o=this._dateService.getDifference(e,t),n=this._dateService.getFormattedDuration(o,null,!1);this.durationOptions[s].text=this._localizationService.getCachedMessage(i)+" - "+n,this.durationOptions=this.durationOptions.slice(0)}_load(){this._secretAccessService.getSecretAccessRequestById(this.requestAccessId).pipe(Object(h.a)()).subscribe({next:e=>{this.canRevoke=!e.hasWorkflow&&e.status===D.V.Approved,this.canEdit=!((e.requestingUserId===this.stateService.currentUser.id||e.completed||e.currentUserRestrictedFromReviewing)&&!this.canRevoke),this.bannerMessage=e.reviewStatusMessage,this.isError=!1,e.startDate=e.startDate,e.expirationDate=e.expirationDate,this.secretAccess=e,this.isMyRequest=this.secretAccess.requestingUserId===this._stateService.currentUser.id,this.isMyRequest&&(this.canEdit=!1,this.ies.disableEditMode(null),this.canCancel=this.secretAccess.status===D.V.Pending),this._setCrumbs(),this.ies.patchViewModel(this.form,this.secretAccess),this.canEdit&&(this.secretAccess.status===D.V.Pending||this.canRevoke?this.ies.enableEditMode(null,this.form):this.ies.disableEditMode(null)),this.form.controls.duration.setValue("requested"),this.form.controls.timeZone.setValue("server",{emitEvent:!1}),this._preferenceService.getPreference(d.l.PREFERRED_TIMEZONE,null).pipe(Object(h.a)()).subscribe({next:e=>{"server"===(null==e?void 0:e.settingValue)?(this.form.controls.timeZone.setValue("server",{emitEvent:!1}),this.dateTimeInputTimezone=this._stateService.dateTimeServerTimezone,this.dateTimeInputOffset=this._stateService.dateTimeServerOffset):(this.form.controls.timeZone.setValue("local",{emitEvent:!1}),this.dateTimeInputTimezone="local",this.dateTimeInputOffset=void 0)}}),this._setCustomDurationTime(e.startDate,e.expirationDate,0,"as-requested-duration"),this.secretAccess.status===D.V.Pending&&this.expirationDateValid()},error:e=>{const t=this._errorService.getErrorMessage(e);this.canEdit=!1,this.isError=!0,this.bannerMessage=t.message}}),this.form.controls.startDate.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{if(!this.isStartDateBeforeExpirationDate()){const e=new Date(this._dateService.addTimezoneIfMissing(this.form.controls.startDate.value));e.setHours(e.getHours()+1),this.form.controls.expirationDate.setValue(e.toISOString()),this.form.controls.expirationDate.markAsDirty()}}),this.form.controls.expirationDate.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this.validateDates("expirationDate",this._localizationService.getCachedPageMessage(this._pageName,"expiration-must-be-after-start"))})}expirationDateValid(){const e=new Date,t=new Date(this._dateService.addTimezoneIfMissing(this.form.controls.expirationDate.value)),s=this._dateService.getDifference(e,t);if(s.asMinutes()<0)this.form.controls.duration.markAsDirty(),this.form.controls.duration.setErrors({serverValidationError:{valid:!1,message:this._localizationService.getCachedPageMessage(this._pageName,"expiration-has-expired")}});else if(s.asSeconds()<120)return this.form.controls.expirationDate.markAsDirty(),this.form.controls.expirationDate.setErrors({serverValidationError:{valid:!1,message:this._localizationService.getCachedPageMessage(this._pageName,"expiration-two-minutes-from-now")}}),this.form.controls.duration.markAsDirty(),this.form.controls.duration.setErrors({serverValidationError:{valid:!1,message:this._localizationService.getCachedPageMessage(this._pageName,"expiration-two-minutes-from-now")}}),this.ies.showValidationMessages=!0,!1;return!0}validateDates(e,t){this.isStartDateBeforeExpirationDate()?(this.form.controls.startDate.setErrors(null),this.form.controls.expirationDate.setErrors(null)):this.form.controls[e].setErrors({serverValidationError:{valid:!1,message:t}})}viewHistory(){this.getHistory=this.getPagedData.bind(this),this.viewHistoryModal.show()}getPagedData(e){return this._secretAccessService.getSecretAccessRequestsHistory(this.requestAccessId,e).pipe(Object(U.a)(e=>this.totalRecords=e.total))}cancelRequest(){this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage(this._pageName,"cancel-request"),body:this._localizationService.getCachedPageMessage(this._pageName,"cancel-request-body")}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{e&&this._secretAccessService.changeRequestStatus(this.secretAccess.secretAccessRequestId,D.V.Canceled).pipe(Object(h.a)()).subscribe(()=>this._router.navigate(["/secret/all-requests"],{queryParams:{status:"my-pending"}}))})}_setCrumbs(){const e=[{name:this._localizationService.getCachedPageMessage("common","inbox"),routerLink:["/inbox"]}];let t="";this.isMyRequest?this.secretAccess.status===D.V.Pending?t="my-pending":this.secretAccess.status===D.V.Denied?t="my-denied":this.secretAccess.status===D.V.Approved?t="my-approved":this.secretAccess.status===D.V.Canceled&&(t="my-canceled"):this.secretAccess.status===D.V.Pending?t="pending":this.secretAccess.status===D.V.Denied?t="denied":this.secretAccess.status===D.V.Approved?t="approved":this.secretAccess.status===D.V.Canceled&&(t="canceled"),this._localizationService.getMessage(t).subscribe(s=>{e.push({name:s,routerLink:["/inbox"],queryParams:{status:t}}),e.push({name:this.secretAccess.secretName}),this._stateService.events.navigationEvents.crumbsChanged.next(e)})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.U),b.Ob(a.B),b.Ob(c.a),b.Ob(c.e),b.Ob(a.fb),b.Ob(a.db),b.Ob(a.cb),b.Ob(a.eb),b.Ob(a.F),b.Ob(E.c),b.Ob(a.M),b.Ob(m.a))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-access-request-approval"]],viewQuery:function(e,t){if(1&e&&b.Uc(K,1),2&e){let e;b.zc(e=b.cc())&&(t.viewHistoryModal=e.first)}},features:[b.Bb([],[a.B])],decls:24,vars:21,consts:[[1,"ss-inline-detail","ui","form"],[1,"ui","segment","inverted","dimmer"],[1,"ui","loader"],[1,"form-width-medium"],[1,"grid-filter-header"],[1,"inline-block",3,"matTooltip"],["id","view-history-button","ss-locale","view-access-request-history",1,"thy","basic","button",3,"click"],[3,"formGroup",4,"ngIf"],["modalTitleLocale","view-access-request-history"],["viewHistoryModal",""],["modal-body","",1,"history-modal-grid"],["gridName","access-request-history","defaultOrderByField","dateRecorded",3,"getPagedData","isResizable","columnDefinitions","defaultOrderAscending"],["modal-footer",""],[1,"item-count"],[3,"showAsContextMenu"],["id","view-history-ok-button","ss-locale","ok",1,"thy","primary","button","no-right-margin",3,"click"],[3,"formGroup"],["id","form-banner","class","banner",4,"ngIf"],[3,"ssForm","editSection"],["titleLocale","secret-access-request","summaryLocale","secret-access-request-description",3,"showBorder",4,"ngIf"],["id","form-banner",1,"banner"],["titleLocale","secret-access-request","summaryLocale","secret-access-request-description",3,"showBorder"],["fieldId","request-secret","labelLocale","secret-name",3,"showActions"],["value-column","",1,"top-padded-layout-cell"],[3,"routerLink"],["fieldId","request-username","labelLocale","request-user",3,"showActions"],["fieldId","request-comment","labelLocale","reason-for",3,"showActions"],["fieldId","request-ticket","labelLocale","link-ticket",3,"showActions",4,"ngIf"],["fieldId","request-status","labelLocale","status",3,"showActions"],["fieldId","request-duration","labelLocale","when-requested","labelTooltipLocale","request-date-description",3,"showActions"],[3,"value","format"],["labelLocale","duration","labelTooltipLocale","duration-approval-description",3,"showActions","forceRequiredMarker"],["value-column",""],["formControlName","duration",3,"type","options","inputWidthPercent"],[4,"ngIf"],[3,"showActions","labelLocalized",4,"ngIf"],["labelLocale","secretactions.timezone",3,"showActions",4,"ngIf"],["labelLocale","start-date",3,"showActions",4,"ngIf"],["labelLocale","expiration-date",3,"showActions",4,"ngIf"],[3,"showActions"],["label-column",""],[1,"header"],["ss-locale","reason"],["ss-locale","reason-visible",4,"ngIf"],["formControlName","responseComment",3,"type","maxlength"],["class","right floated no-right-margin",4,"ngIf"],["fieldId","request-ticket","labelLocale","link-ticket",3,"showActions"],["ss-locale","to","ss-page-name","common"],[3,"showActions","labelLocalized"],["labelLocale","secretactions.timezone",3,"showActions"],["formControlName","timeZone",3,"type","options","inputWidth"],["labelLocale","start-date",3,"showActions"],["formControlName","startDate","format","datetime",3,"editMode","timezone","offset"],["labelLocale","expiration-date",3,"showActions"],["formControlName","expirationDate","format","datetime",3,"editMode","timezone","offset"],["ss-locale","reason-visible"],[1,"right","floated"],["id","cancel-access-request-button","ss-locale","cancel-request",1,"thy","basic","button","no-right-margin",3,"click"],[1,"right","floated","no-right-margin"],["id","revoke-access-request-button","class","thy basic button no-right-margin","ss-locale","revoke",3,"disabled","click",4,"ngIf"],["id","deny-access-request-button","class","thy basic button","ss-locale","deny",3,"disabled","click",4,"ngIf"],["id","approve-access-request-button","class","thy primary button no-right-margin","ss-locale","approve",3,"disabled","click",4,"ngIf"],["id","revoke-access-request-button","ss-locale","revoke",1,"thy","basic","button","no-right-margin",3,"disabled","click"],["id","deny-access-request-button","ss-locale","deny",1,"thy","basic","button",3,"disabled","click"],["id","approve-access-request-button","ss-locale","approve",1,"thy","primary","button","no-right-margin",3,"disabled","click"]],template:function(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-page-detail"),b.Ub(1,"div",0),b.Ub(2,"div",1),b.Pb(3,"div",2),b.Tb(),b.Ub(4,"div",3),b.Ub(5,"div",4),b.Ub(6,"div"),b.Ub(7,"div",5),b.Ub(8,"button",6),b.bc("click",function(){return t.viewHistory()}),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Mc(9,de,4,5,"form",7),b.Tb(),b.Tb(),b.Tb(),b.Ub(10,"ss-modal-dialog",8,9),b.Ub(12,"div",10),b.Pb(13,"ss-grid",11),b.Tb(),b.Ub(14,"div",12),b.Ub(15,"div",4),b.Ub(16,"div",13),b.Oc(17),b.gc(18,"ssItemCount"),b.Tb(),b.Ub(19,"div"),b.Pb(20,"ss-timezone-selector",14),b.Tb(),b.Ub(21,"div"),b.Ub(22,"button",15),b.bc("click",function(){return b.Ec(e),b.Ac(11).close()}),b.Oc(23,"Ok"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()}2&e&&(b.Cb(2),b.Gb("active",t.isLoading),b.Cb(5),b.nc("matTooltip",t.viewHistoryTooltip),b.Cb(2),b.nc("ngIf",t.requestAccessId&&!t.isError),b.Cb(4),b.nc("getPagedData",t.getHistory)("isResizable",!0)("columnDefinitions",b.vc(16,me,b.rc(12,he),b.rc(13,ue),b.rc(14,pe),b.rc(15,be)))("defaultOrderAscending",!1),b.Cb(4),b.Qc(" ",b.hc(18,10,t.totalRecords)," "),b.Cb(3),b.nc("showAsContextMenu",!0))},directives:[m.j,R.a,f.a,i.o,N.a,L.a,V.a,o.E,o.t,o.l,q.a,G.a,z.a,c.g,B.a,j.a,o.s,o.j,o.o,l.c],pipes:[W.a,H.a],styles:[".history-modal-grid[_ngcontent-%COMP%]{height:50vh}"]}),e=Object(P.b)([Object(M.a)()],e),e})();var fe=s("vSIx"),ve=s("my0S"),ye=s("XNiG"),Se=s("l5mm"),we=s("JX91"),Ce=s("1G5W");function Te(e,t){if(1&e&&(b.Ub(0,"div",7),b.Oc(1," The pending request was denied. "),b.Tb()),2&e){const e=b.fc();b.nc("ss-page-name",e.pageName)}}function Oe(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"div"),b.Pb(2,"svg-icon",8),b.Tb(),b.Ub(3,"h2",9),b.Oc(4,"Secret Access Required123"),b.Tb(),b.Ub(5,"span",10),b.Oc(6,' In order to view this Secret, you must have approval to access it. Request access by clicking "Request Access" below. '),b.Tb(),b.Pb(7,"br"),b.Pb(8,"br"),b.Pb(9,"br"),b.Ub(10,"button",11),b.bc("click",function(){return b.Ec(e),b.fc().requestApproval()}),b.Oc(11," Request Access "),b.Tb(),b.Pb(12,"br"),b.Pb(13,"br"),b.Pb(14,"br"),b.Tb()}if(2&e){const e=b.fc();b.Cb(3),b.nc("ss-page-name",e.pageName),b.Cb(2),b.nc("ss-page-name",e.pageName),b.Cb(5),b.nc("ss-page-name",e.pageName)}}function Ie(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"div"),b.Pb(2,"svg-icon",8),b.Tb(),b.Ub(3,"h2",12),b.Oc(4,"Your request was sent"),b.Tb(),b.Ub(5,"span",13),b.Oc(6," You will receive an email when the request has been approved or denied. "),b.Tb(),b.Pb(7,"br"),b.Pb(8,"br"),b.Pb(9,"br"),b.Ub(10,"button",14),b.bc("click",function(){return b.Ec(e),b.fc().cancelRequest()}),b.Oc(11,"Cancel Request"),b.Tb(),b.Pb(12,"br"),b.Pb(13,"br"),b.Pb(14,"br"),b.Tb()}if(2&e){const e=b.fc();b.Cb(3),b.nc("ss-page-name",e.pageName),b.Cb(2),b.nc("ss-page-name",e.pageName),b.Cb(5),b.nc("ss-page-name",e.pageName)}}function _e(e,t){if(1&e&&(b.Sb(0,15),b.Oc(1,"Hide Request Log"),b.Rb()),2&e){const e=b.fc();b.nc("ss-page-name",e.pageName)}}function Pe(e,t){if(1&e&&(b.Sb(0,16),b.Oc(1,"Show Request Log"),b.Rb()),2&e){const e=b.fc();b.nc("ss-page-name",e.pageName)}}function Me(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.gc(2,"ssDate"),b.Tb()),2&e){const e=b.fc().value,t=b.fc(2);b.Cb(1),b.Pc(b.jc(2,1,e,"datetime",t.stateService.timezone))}}function ke(e,t){1&e&&b.Mc(0,Me,3,5,"span",2),2&e&&b.nc("ngIf","0001-01-01T00:00:00"!==t.value)}function xe(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.Tb()),2&e){const e=b.fc().item;b.Cb(1),b.Qc(" ",e.approverDisplayName," ")}}function De(e,t){1&e&&b.Mc(0,xe,2,1,"span",2),2&e&&b.nc("ngIf",4!==t.item.status)}function Fe(e,t){if(1&e){const e=b.Vb();b.Ub(0,"span"),b.Ub(1,"button",25),b.bc("click",function(){b.Ec(e);const t=b.fc().item;return b.fc(2).cancelRequestById(t.secretAccessRequestId)}),b.Oc(2," Cancel "),b.Tb(),b.Tb()}if(2&e){const e=b.fc(3);b.Cb(1),b.nc("ss-page-name",e.pageName)}}function Ue(e,t){1&e&&b.Mc(0,Fe,3,1,"span",2),2&e&&b.nc("ngIf",1===t.item.status)}const Ae=function(){return{propertyName:"requestDate",displayName:"Req Date",columnOrder:1,columnType:"datetime"}},Ee=function(){return{propertyName:"statusDescription",displayName:"Status",displayNameLocale:"status",columnOrder:2}},Re=function(){return{propertyName:"startDate",displayName:"Start Date",displayNameLocale:"start-date",columnType:"datetime",columnOrder:3}},Ne=function(){return{propertyName:"expirationDate",displayName:"Exp Date",displayNameLocale:"exp-date",columnType:"datetime",columnOrder:4}},Le=function(e){return{propertyName:"approverDisplayName",displayName:"Approver",displayNameLocale:"approver",columnOrder:7,template:e}},Ve=function(e){return{propertyName:"responseDate",displayName:"Response Date",displayNameLocale:"response-date",template:e,columnOrder:5}},qe=function(){return{propertyName:"responseComment",displayName:"Response Comment",displayNameLocale:"response-comment",columnOrder:6}},Ge=function(e,t,s,i,o,n,r){return[e,t,s,i,o,n,r]};function ze(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",17),b.Ub(1,"div",18),b.Ub(2,"div",19),b.Oc(3),b.gc(4,"ssItemCount"),b.Tb(),b.Ub(5,"div"),b.Pb(6,"ss-timezone-selector",20),b.Tb(),b.Ub(7,"div"),b.Oc(8,"\xa0"),b.Tb(),b.Tb(),b.Ub(9,"ss-grid",21),b.bc("rowClick",function(t){return b.Ec(e),b.fc().rowClick(t)}),b.Mc(10,ke,1,1,"ng-template",null,22,b.Nc),b.Mc(12,De,1,1,"ng-template",null,23,b.Nc),b.Mc(14,Ue,1,1,"ng-template",null,24,b.Nc),b.Tb(),b.Tb()}if(2&e){const e=b.Ac(11),t=b.Ac(13),s=b.Ac(15),i=b.fc();b.Cb(3),b.Qc(" ",b.hc(4,9,i.totalRecords)," "),b.Cb(3),b.nc("showAsContextMenu",!0),b.Cb(3),b.nc("items",i.allRequests)("showSummary",!1)("pageName",i.pageName)("defaultOrderAscending",!1)("moreRowTemplate",s)("moreColumnWidth",100)("columnDefinitions",b.yc(20,Ge,b.rc(11,Ae),b.rc(12,Ee),b.rc(13,Re),b.rc(14,Ne),b.sc(15,Le,t),b.sc(17,Ve,e),b.rc(19,qe)))}}let Be=(()=>{let e=class{constructor(e,t,s,i,o,n,r,c,a){this._activatedRoute=e,this._secretService=t,this._secretAccessRequestService=s,this._router=i,this._dialogService=o,this.stateService=n,this._dateService=r,this._localizationService=c,this._breadcrumbService=a,this.approvalInPendingStatus=!1,this.showRequestLog=!1,this.allRequests=[],this.secretAccessModelStatus=D.V,this.pendingRequestDenied=!1,this.secretDetailState=null,this.pageName="secretactions",this.totalRecords=0,this._pollResult=new ye.a,this._pendingRequest=null,this.PageDialogLayout=p.b}ngOnInit(){this._localizationService.loadResourcePage(this.pageName),this.onLoad(),this._localizationService.getPageMessage(this.pageName,"secret-access-required").pipe(Object(h.a)()).subscribe(e=>this._breadcrumbService.setCrumbs(e)),this._activatedRoute.snapshot.queryParamMap.get("openModal")&&this.requestApproval()}requestApproval(){this._activatedRoute.params.pipe(Object(M.b)(this)).subscribe(e=>{this.secretId=e.id,this._secretService.getSecretDetailState(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this.secretDetailState=e,this.secretName=e.secretName;let t=ve.a.Comment;1===e.secretState&&(t=ve.a.Approval),this._dialogService.open(fe.a,{data:{secretId:e.id,approvalType:t,secretName:this.secretName,redirectOnApprove:!0,checkOutAfterComment:!1}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&(this.pendingRequestDenied=!1,this._reload())})})})}rowClick(e){this._router.navigate(["/secret","access-request-approval",e.secretAccessRequestId])}cancelRequest(){this.cancelRequestById(this._pendingRequest.secretAccessRequestId)}cancelRequestById(e){this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage(this.pageName,"cancel-request"),body:this._localizationService.getCachedPageMessage(this.pageName,"cancel-request-body")}}).afterClosed().pipe(Object(h.a)()).subscribe(t=>{t&&this._secretAccessRequestService.changeRequestStatus(e,D.V.Canceled).pipe(Object(h.a)()).subscribe(()=>this.onLoad())})}toggleRequestLog(){this.showRequestLog=!this.showRequestLog}onLoad(){this._pendingRequest=null,this.approvalInPendingStatus=!1,this._activatedRoute.params.pipe(Object(M.b)(this)).subscribe(e=>{this.secretId=e.id,this._reload()})}_reload(){this._secretService.getSecretDetailState(this.secretId).pipe(Object(h.a)()).subscribe(e=>this.secretDetailState=e),this._checkForPendingOrApproved()}_checkForPendingOrApproved(){this._secretAccessRequestService.getSecretAccessRequestsBySecretId(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this.allRequests=e,this.totalRecords=e.length;const t=new Date;e.find(e=>e.status===D.V.Approved&&this._dateService.isDateWithinTimeInterval(t,this._dateService.getDate(e.startDate),this._dateService.getDate(e.expirationDate)))&&this._router.navigate(["/secret",this.secretId,"general"]);const s=e.sort((e,t)=>new Date(t.requestDate).getTime()-new Date(e.requestDate).getTime()).find(e=>e.status===D.V.Pending&&this._dateService.isDateWithinTimeInterval(t,this._dateService.getDate(e.startDate),this._dateService.getDate(e.expirationDate)));s&&(this._pendingRequest=s,this.approvalInPendingStatus=!0,this._checkIfShouldPoll())})}_checkIfShouldPoll(){this._dateService.getDifference(this._pendingRequest.startDate,new Date).asSeconds()>=0?this._poll():setTimeout(()=>{this._checkIfShouldPoll()},5e3)}_poll(){Object(Se.a)(15e3).pipe(Object(M.b)(this),Object(we.a)(0),Object(Ce.a)(this._pollResult),Object(U.a)(()=>{this._pendingRequest&&this._secretAccessRequestService.getSecretAccessRequestById(this._pendingRequest.secretAccessRequestId).pipe(Object(h.a)()).subscribe(e=>{e.status===D.V.Approved?(this._pollResult.next(e.status),this._router.navigate(["/secret",this.secretId,"general"])):e.status===D.V.Denied&&(this._pollResult.next(e.status),this.pendingRequestDenied=!0,this.approvalInPendingStatus=!1,this._checkForPendingOrApproved())})})).subscribe()}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.a),b.Ob(a.V),b.Ob(a.U),b.Ob(c.e),b.Ob(E.c),b.Ob(a.cb),b.Ob(a.db),b.Ob(a.F),b.Ob(m.a))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-access-request"]],decls:11,vars:6,consts:[[1,"access-page"],["class","validationSummary","ss-locale","pending-request-denied",3,"ss-page-name",4,"ngIf"],[4,"ngIf"],[1,"link-button",3,"click"],["ss-locale","hide-request-log",3,"ss-page-name",4,"ngIf"],["ss-locale","show-request-log",3,"ss-page-name",4,"ngIf"],["class","inline-table-container no-top-border-table left-aligned",4,"ngIf"],["ss-locale","pending-request-denied",1,"validationSummary",3,"ss-page-name"],["name","request_access",1,"icon-88","icon-light"],["ss-locale","secret-access-required",3,"ss-page-name"],["ss-locale","request-access-description",3,"ss-page-name"],["ss-locale","request-access",1,"thy","primary","button","createButton",3,"ss-page-name","click"],["ss-locale","request-sent",1,"access-title",3,"ss-page-name"],["ss-locale","request-sent-description",3,"ss-page-name"],["ss-locale","cancel-request",1,"thy","basic","button",3,"ss-page-name","click"],["ss-locale","hide-request-log",3,"ss-page-name"],["ss-locale","show-request-log",3,"ss-page-name"],[1,"inline-table-container","no-top-border-table","left-aligned"],[1,"grid-filter-header"],[1,"item-count"],[3,"showAsContextMenu"],["gridName","secret-access-request",3,"items","showSummary","pageName","defaultOrderAscending","moreRowTemplate","moreColumnWidth","columnDefinitions","rowClick"],["responseDateTemplate",""],["approverNameTemplate",""],["cancelOptionTemplate",""],["type","button","ss-locale","cancel-request",1,"thy","basic","button","norowclick",3,"ss-page-name","click"]],template:function(e,t){1&e&&(b.Ub(0,"thy-page-detail"),b.Ub(1,"div",0),b.Mc(2,Te,2,1,"div",1),b.Mc(3,Oe,15,3,"div",2),b.Mc(4,Ie,15,3,"div",2),b.Ub(5,"div"),b.Ub(6,"button",3),b.bc("click",function(){return t.toggleRequestLog()}),b.Mc(7,_e,2,1,"ng-container",4),b.Mc(8,Pe,2,1,"ng-container",5),b.Tb(),b.Pb(9,"br"),b.Tb(),b.Mc(10,ze,16,28,"div",6),b.Tb(),b.Tb()),2&e&&(b.Cb(2),b.nc("ngIf",t.pendingRequestDenied),b.Cb(1),b.nc("ngIf",!t.approvalInPendingStatus),b.Cb(1),b.nc("ngIf",t.approvalInPendingStatus),b.Cb(3),b.nc("ngIf",t.showRequestLog),b.Cb(1),b.nc("ngIf",!t.showRequestLog),b.Cb(2),b.nc("ngIf",t.showRequestLog))},directives:[m.j,i.o,f.a,n.b,V.a,L.a],pipes:[W.a,H.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();var je=s("9dUh");const We=["checkout"];let He=(()=>{let e=class{constructor(e,t,s,i,o,n){this._stateService=e,this._secretService=t,this._log=s,this._cache=i,this._router=o,this._activatedRoute=n,this.isLoading=!0,this.PageDialogLayout=p.b}ngOnInit(){this._activatedRoute.params.pipe(Object(M.b)(this)).subscribe(e=>{this.secretId=e.id})}onSuccess(){this._secretService.getSecretDetailState(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this._log.Verbose("Secret State",e),3===e.secretState?this.checkout.updateSecretDetailState():0===e.secretState&&(this._cache.remove(`secret-state-${this.secretId}`),this._router.navigate(["secret",this.secretId,"general"]))})}onSecretStateLoad(e){this.isLoading=!1,this.secretDetailState=e,this._setCrumbs(e)}_setCrumbs(e){this.secretDetailState&&this._stateService.events.navigationEvents.secretOpened.next({secretId:e.id,secretName:e.secretName,folderId:e.folderId,context:1})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.cb),b.Ob(a.V),b.Ob(a.fb),b.Ob(a.P),b.Ob(c.e),b.Ob(c.a))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-checkout"]],viewQuery:function(e,t){if(1&e&&b.Uc(We,3),2&e){let e;b.zc(e=b.cc())&&(t.checkout=e.first)}},decls:5,vars:2,consts:[[1,"thy-pos-rel"],[3,"active"],[3,"secretId","success","stateLoaded"],["checkout",""]],template:function(e,t){1&e&&(b.Ub(0,"thy-page-detail"),b.Ub(1,"div",0),b.Pb(2,"thy-loading-dimmer",1),b.Ub(3,"ss-checkout",2,3),b.bc("success",function(){return t.onSuccess()})("stateLoaded",function(e){return t.onSecretStateLoad(e)}),b.Tb(),b.Tb(),b.Tb()),2&e&&(b.Cb(2),b.nc("active",t.isLoading),b.Cb(1),b.nc("secretId",t.secretId))},directives:[m.j,m.h,je.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();var Ke=s("Yf8z"),Qe=s("WsiS");const $e=["dblPassword"];let Ze=(()=>{let e=class{constructor(e,t,s,i){this._router=e,this._secretService=t,this._stateService=s,this._activatedRoute=i,this.pageName="secretactions",this.PageDialogLayout=p.b}ngOnInit(){this._activatedRoute.params.pipe(Object(M.b)(this)).subscribe(e=>{this.secretId=e.id,this._stateService.secret&&this._stateService.secret.id!==this.secretId||!this._stateService.secret?this._secretService.getSecretDetailState(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this.secretName=e.secretName,this.secretDetailState=e,this.action=Ke.a.Enter,5===e.secretState&&(this.action=Ke.a.Create),this._setCrumbs()}):this.secretName=this._stateService.secret.data.name})}LoadSecret(){this._router.navigate(["/secret",this.secretId,"general"])}submitPassword(){this.LoadSecret()}cancel(){this._router.navigate(this.secretDetailState.folderId?["/folders",this.secretDetailState.folderId]:["/secrets/all"])}_setCrumbs(){this.secretDetailState&&this._stateService.events.navigationEvents.secretOpened.next({secretId:this.secretDetailState.id,secretName:this.secretDetailState.secretName,folderId:this.secretDetailState.folderId,context:2})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(a.V),b.Ob(a.cb),b.Ob(c.a))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-double-lock"]],viewQuery:function(e,t){if(1&e&&b.Uc($e,3),2&e){let e;b.zc(e=b.cc())&&(t.dblPassword=e.first)}},features:[b.Bb([],[a.B])],decls:4,vars:2,consts:[[1,"centered-all"],[3,"action","secretName","cancelClicked","passwordSuccess"],["dblPassword",""]],template:function(e,t){1&e&&(b.Ub(0,"thy-page-detail"),b.Ub(1,"div",0),b.Ub(2,"ss-double-lock-password",1,2),b.bc("cancelClicked",function(){return t.cancel()})("passwordSuccess",function(){return t.submitPassword()}),b.Tb(),b.Tb(),b.Tb()),2&e&&(b.Cb(2),b.nc("action",t.action)("secretName",t.secretName))},directives:[m.j,Qe.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();var Ye=s("sgDT"),Je=s("pLZG");let Xe=(()=>{let e=class{constructor(e,t,s,i,o,n,r,c){this._router=e,this._activatedRoute=t,this._secretService=s,this._itemEditService=i,this._secretTemplateService=o,this._stateService=n,this._folderService=r,this._breadcrumbService=c,this.secret=null,this.permissions=[],this.canEdit=!1,this.secretDetail=null,this.secretState=null,this.secretDetailActionType=D.W,this.secretPageContext=null,this._pageLoadedTime=null,this._checkOutExpireTimeout=null,this.ies=i,this.ies.editModeEnabled.pipe(Object(M.b)(this)).subscribe(e=>{(new Date).getTime()-this._pageLoadedTime.getTime()>3e4?this._secretService.getSecretDetailState(this.secretState.id).pipe(Object(h.a)()).subscribe(t=>{0===t.secretState?this.loadEditForm(e):(this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url]))}):this.loadEditForm(e)})}hasAction(e){return this._secretService.hasAction(e,this.secretState)}refreshState(){this._secretService.getSecretDetailState(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this.setSecretState(e)})}loadEditForm(e){}loadSecret(){}secretLoaded(){}secretStateLoaded(){}sitesLoaded(){}setValueWithDirty(e,t,s){e.disabled||this.ies.isEditMode(s)&&(e.setValue(t),e.markAsDirty(),e.updateValueAndValidity())}ngOnInit(){this._pageLoadedTime=new Date,this._activatedRoute.data.pipe(Object(M.b)(this)).subscribe(e=>{this.setSecretState(e.secret),this._stateService.events.secretEvents.secretDetailPageActivated.next(e.secret)})}reloadSecretState(){this.secretState&&this._secretService.getSecretDetailState(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this.setSecretState(e)})}ngOnDestroy(){this._checkOutExpireTimeout&&clearTimeout(this._checkOutExpireTimeout)}setSecretState(e){this.secretState=e,this.secretState&&(this.canEdit=!1,this.secretState.actions&&this.secretState.actions.length>0&&(this.canEdit=this.secretState.actions.findIndex(e=>e===D.W.Edit)>-1),e.isCheckedOutByCurrentUser&&e.checkOutMinutesRemaining>0&&(this._checkOutExpireTimeout&&clearTimeout(this._checkOutExpireTimeout),this._checkOutExpireTimeout=setTimeout(()=>{this._checkOutExpired()},6e4*(e.checkOutMinutesRemaining+1))),this.secretStateLoaded(),this._stateService.events.secretEvents.secretViewed.next(this.secretState.id))}_checkOutExpired(){this._router.navigate(["secret","checkout",this.secretState.id])}_checkIfRoutesMatch(e,t){const s=this._getPathFromRoute(t);return this._getPathFromRoute(e).startsWith(s)}_getPathFromRoute(e){return e.pathFromRoot.map(e=>e.url.map(e=>e.toString()).join("/")).join("/")}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(c.a),b.Ob(a.V),b.Ob(a.B),b.Ob(a.W),b.Ob(a.cb),b.Ob(a.w),b.Ob(m.a))},e.\u0275dir=b.Jb({type:e}),e=Object(P.b)([Object(M.a)()],e),e})();var et=function(e){return e[e.NoRestrict=0]="NoRestrict",e[e.Whitelist=1]="Whitelist",e[e.BlackList=2]="BlackList",e}({}),tt=s("RKdJ"),st=s("NFeN"),it=s("tk/3"),ot=s("Bw+5"),nt=s("cp0P"),rt=s("LRne"),ct=s("JIr8"),at=s("NJ9Y"),lt=s("qvr1"),dt=s("9bG0"),ht=s("VAbG"),ut=s("LmaU"),pt=s("YK7T"),bt=s("+bz6");const mt=["pickFolderModal"],gt=["changePasswordConfirmModal"],ft=["generalForm"];function vt(e,t){1&e&&(b.Ub(0,"div",17),b.Oc(1,"Saving File"),b.Tb())}function yt(e,t){1&e&&(b.Ub(0,"div",18),b.Oc(1,"Saving Files"),b.Tb())}function St(e,t){if(1&e&&(b.Ub(0,"div",19),b.Oc(1),b.gc(2,"async"),b.gc(3,"ssLocale"),b.Tb()),2&e){const e=t.$implicit;b.Cb(1),b.Rc(" ",e.key.file.name," - ",e.value<100?e.value+"%":b.hc(2,2,b.ic(3,4,"processing-uploaded-file","common"))," ")}}function wt(e,t){if(1&e&&(b.Mc(0,vt,2,0,"div",14),b.Mc(1,yt,2,0,"div",15),b.Mc(2,St,4,7,"div",16),b.gc(3,"keyvalue")),2&e){const e=b.fc();b.nc("ngIf",1===e.uploadingFiles.size),b.Cb(1),b.nc("ngIf",e.uploadingFiles.size>1),b.Cb(1),b.nc("ngForOf",b.hc(3,3,e.uploadingFiles))}}function Ct(e,t){if(1&e){const e=b.Vb();b.Ub(0,"li"),b.Ub(1,"svg-icon",38),b.bc("click",function(){return b.Ec(e),b.fc(2).showNameHistory()}),b.Tb(),b.Tb()}}function Tt(e,t){if(1&e){const e=b.Vb();b.Ub(0,"li"),b.Ub(1,"svg-icon",39),b.bc("click",function(){return b.Ec(e),b.fc(2).copyNameToClipboard()}),b.Tb(),b.Tb()}}function Ot(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",40),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.editField("name",t.secretDetailGeneral.name,t.formInputType.String,null,1991)}),b.Oc(1,"Edit"),b.Tb()}}function It(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",41),b.bc("click",function(){return b.Ec(e),b.fc(2).changeTemplate()}),b.Oc(1,"Edit"),b.Tb()}}function _t(e,t){1&e&&(b.Ub(0,"span"),b.Pb(1,"img",52),b.Tb())}function Pt(e,t){1&e&&(b.Ub(0,"span"),b.Pb(1,"img",53),b.Tb())}function Mt(e,t){1&e&&(b.Ub(0,"span"),b.Pb(1,"img",54),b.Tb())}function kt(e,t){1&e&&b.Pb(0,"svg-icon",55)}function xt(e,t){if(1&e){const e=b.Vb();b.Ub(0,"ss-layout-form-row",44),b.Ub(1,"div",45),b.Ub(2,"div",46),b.Ub(3,"div",47),b.Mc(4,_t,2,0,"span",48),b.Mc(5,Pt,2,0,"span",48),b.Mc(6,Mt,2,0,"span",49),b.Mc(7,kt,1,0,"svg-icon",50),b.Tb(),b.Ub(8,"div"),b.Ub(9,"button",51),b.bc("click",function(){b.Ec(e);const s=t.$implicit;return b.fc(3).openLauncher(s)}),b.Oc(10),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=t.$implicit,s=t.index,i=b.fc(3);b.nc("showActions",!1)("showLabel",!1)("rowHeight",i.layoutRowHeight.Small),b.Cb(3),b.nc("ngSwitch",e.typeId),b.Cb(1),b.nc("ngSwitchCase",1),b.Cb(1),b.nc("ngSwitchCase",2),b.Cb(2),b.nc("ngIf",e.isRecorded),b.Cb(2),b.Db("id","launcher-"+s),b.Cb(1),b.Pc(e.name)}}function Dt(e,t){if(1&e&&(b.Ub(0,"ss-layout-form",42),b.Mc(1,xt,11,9,"ss-layout-form-row",43),b.Tb()),2&e){const e=b.fc(2);b.nc("labelColumnWidth",e.LabelColumnWidth.Large),b.Cb(1),b.nc("ngForOf",e.secretDetailGeneral.launchers)}}const Ft=function(e){return["/secret",e,"settings"]};function Ut(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",30),b.Ub(1,"div",31),b.Ub(2,"a",58),b.Oc(3),b.Tb(),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("viewField",e.secretDetailGeneral.expiration)("showActions",!1),b.Cb(2),b.nc("routerLink",b.sc(4,Ft,e.secretDetailGeneral.id)),b.Cb(1),b.Pc(e.secretDetailGeneral.expiration.value)}}function At(e,t){if(1&e&&(b.Sb(0),b.Ub(1,"div",61),b.Oc(2),b.Tb(),b.Rb()),2&e){const e=b.fc(4);b.Cb(2),b.Qc(" ",e.heartbeatFailedDescription," ")}}function Et(e,t){if(1&e&&(b.Sb(0),b.Ub(1,"div",62),b.Oc(2),b.Tb(),b.Rb()),2&e){const e=b.fc(4);b.Cb(1),b.nc("matTooltip",e.lastHeartbeatCheckDate),b.Cb(1),b.Qc(" ",e.lastHeartbeatCheckDateSince," ")}}function Rt(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",30),b.Ub(1,"div",59),b.Ub(2,"div",60),b.Oc(3),b.Tb(),b.Mc(4,At,3,1,"ng-container",27),b.Mc(5,Et,3,2,"ng-container",27),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("viewField",e.secretDetailGeneral.lastHeartBeatStatus)("showActions",!1),b.Cb(2),b.Gb("status-oval-success",e.heartbeatSuccess)("status-oval-pending",e.heartbeatPending)("status-oval-failure",e.heartbeatFailed),b.nc("matTooltip",e.heartbeatStatusTooltip),b.Cb(1),b.Qc(" ",e.heartbeatStatusResult," "),b.Cb(1),b.nc("ngIf",e.heartbeatFailed),b.Cb(1),b.nc("ngIf",e.isShowingLastHeartbeatCheckDateTime(e.secretDetailGeneral.lastHeartBeatStatus.value))}}function Nt(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",65),b.bc("click",function(){b.Ec(e);const t=b.fc(4);return t.editField("heartbeatEnabled",t.secretDetailGeneral.heartbeatEnabled,t.formInputType.Boolean,null,null)}),b.Oc(1,"Edit"),b.Tb()}}function Lt(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",30),b.Pb(1,"ss-form-input",63),b.Ub(2,"div",25),b.Mc(3,Nt,2,0,"button",64),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("viewField",e.secretDetailGeneral.heartbeatEnabled)("showActions",!e.isEditMode),b.Cb(1),b.nc("type",e.formInputType.Boolean)("viewField",e.secretDetailGeneral.heartbeatEnabled),b.Cb(2),b.nc("ngIf",!e.secretDetailGeneral.heartbeatEnabled.readOnly&&!e.secretDetailGeneral.heartbeatEnabled.hidden&&!e.isEditMode&&e.canEdit)}}function Vt(e,t){if(1&e&&(b.Ub(0,"ss-layout-form",56),b.Mc(1,Ut,4,6,"ss-layout-form-row",57),b.Mc(2,Rt,6,12,"ss-layout-form-row",57),b.Mc(3,Lt,4,5,"ss-layout-form-row",57),b.Tb()),2&e){const e=b.fc(2);b.nc("showBorder",!0),b.Cb(1),b.nc("ngIf",!e.secretDetailGeneral.expiration.hidden),b.Cb(1),b.nc("ngIf",!e.secretDetailGeneral.lastHeartBeatStatus.hidden&&e.secretDetailGeneral.heartbeatEnabled.value),b.Cb(1),b.nc("ngIf",!e.secretDetailGeneral.heartbeatEnabled.hidden)}}function qt(e,t){1&e&&(b.Ub(0,"span",72),b.Oc(1,"None selected"),b.Tb())}function Gt(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",73),b.bc("click",function(){b.Ec(e);const t=b.fc(3);return t.editField("folder",t.secretDetailGeneral.folder,t.formInputType.Folder,null,null)}),b.Oc(1,"Edit"),b.Tb()}}function zt(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",74),b.bc("click",function(){b.Ec(e);const t=b.fc(3);return t.editField("secretPolicy",t.secretDetailGeneral.secretPolicy,t.formInputType.DropDown,t.policyOptions,null)}),b.Oc(1,"Edit"),b.Tb()}}function Bt(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",77),b.bc("click",function(){b.Ec(e);const t=b.fc(4);return t.editSite("site",t.secretDetailGeneral.site,t.formInputType.DropDown)}),b.Oc(1,"Edit"),b.Tb()}}function jt(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",30),b.Pb(1,"ss-form-input",75),b.Ub(2,"div",25),b.Mc(3,Bt,2,0,"button",76),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("viewField",e.secretDetailGeneral.site)("showActions",!e.isEditMode),b.Cb(1),b.nc("type",e.formInputType.DropDown)("upwardDropDown",!0)("options",e.siteOptions)("viewField",e.secretDetailGeneral.site),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)&&e.siteOptions.length>1&&e.canEdit&&!e.secretDetailGeneral.site.readOnly)}}function Wt(e,t){if(1&e&&(b.Ub(0,"ss-layout-form",66),b.Ub(1,"ss-layout-form-row",30),b.Ub(2,"div",45),b.Pb(3,"ss-form-input",67),b.Mc(4,qt,2,0,"span",68),b.Tb(),b.Ub(5,"div",25),b.Mc(6,Gt,2,0,"button",69),b.Tb(),b.Tb(),b.Ub(7,"ss-layout-form-row",30),b.Pb(8,"ss-form-input",70),b.Ub(9,"div",25),b.Mc(10,zt,2,0,"button",71),b.Tb(),b.Tb(),b.Mc(11,jt,4,7,"ss-layout-form-row",57),b.Tb()),2&e){const e=b.fc(2);b.nc("showBorder",!0)("highlightHover",!0)("noBottomMargin",!0),b.Cb(1),b.nc("viewField",e.secretDetailGeneral.folder)("showActions",!e.isEditMode),b.Cb(2),b.nc("type",e.formInputType.Folder)("fullFolderPath",!1)("linkFolder",!0),b.Cb(1),b.nc("ngIf",!e.form.controls.folder.value&&!e.ies.isEditMode(null)),b.Cb(2),b.nc("ngIf",e.canEdit),b.Cb(1),b.nc("viewField",e.secretDetailGeneral.secretPolicy)("showActions",!e.isEditMode),b.Cb(1),b.nc("upwardDropDown",!0)("type",e.formInputType.DropDown)("options",e.policyOptions)("viewField",e.secretDetailGeneral.secretPolicy),b.Cb(2),b.nc("ngIf",!e.secretDetailGeneral.secretPolicy.readOnly&&!e.secretDetailGeneral.secretPolicy.hidden&&!e.ies.isEditMode(null)&&e.canEdit),b.Cb(1),b.nc("ngIf",!e.ies.isEditMode(null)||e.siteOptions.length>1)}}function Ht(e,t){if(1&e){const e=b.Vb();b.Ub(0,"ss-form-dialog",20,21),b.bc("save",function(){return b.Ec(e),b.fc().save()})("cancel",function(){return b.Ec(e),b.fc().cancel()}),b.Ub(2,"ss-layout-form",22),b.bc("editAll",function(){return b.Ec(e),b.fc().editAllFields()}),b.Ub(3,"ss-layout-form-row",23),b.Pb(4,"ss-form-input",24),b.Sb(5,25),b.Ub(6,"ul",26),b.Mc(7,Ct,2,0,"li",27),b.Mc(8,Tt,2,0,"li",27),b.Ub(9,"li",28),b.Mc(10,Ot,2,0,"button",29),b.Tb(),b.Tb(),b.Rb(),b.Tb(),b.Ub(11,"ss-layout-form-row",30),b.Ub(12,"div",31),b.Oc(13),b.Tb(),b.Sb(14,25),b.Mc(15,It,2,0,"button",32),b.Rb(),b.Tb(),b.Ub(16,"ss-secret-field-edit",33,34),b.bc("modelUpdated",function(t){return b.Ec(e),b.fc().modelUpdated(t)}),b.Tb(),b.Tb(),b.Mc(18,Dt,2,2,"ss-layout-form",35),b.Mc(19,Vt,4,4,"ss-layout-form",36),b.Mc(20,Wt,12,18,"ss-layout-form",37),b.Tb()}if(2&e){const e=b.fc();b.nc("hideTitleBar",!0)("ssForm",e.form)("canEdit",e.canEdit)("rightAlignButtons",!0),b.Cb(2),b.nc("showBorder",!0)("highlightHover",!0)("showEditAll",e.canEdit&&!e.ies.isEditMode(null)),b.Cb(1),b.nc("viewField",e.secretDetailGeneral.name)("showActions",!e.isEditMode)("hideBorder",!0),b.Cb(1),b.nc("viewField",e.secretDetailGeneral.name)("type",e.formInputType.String)("maxlength",1991)("breakWord",!0),b.Cb(3),b.nc("ngIf",!e.isEditMode&&e.secretDetailGeneral.name.hasHistory),b.Cb(1),b.nc("ngIf",!e.isEditMode),b.Cb(2),b.nc("ngIf",e.canEdit),b.Cb(1),b.nc("viewField",e.secretDetailGeneral.template)("showActions",!e.isEditMode),b.Cb(2),b.Pc(null==e.secretDetailGeneral||null==e.secretDetailGeneral.template?null:e.secretDetailGeneral.template.name),b.Cb(2),b.nc("ngIf",e.canEdit&&e.canConvert),b.Cb(1),b.nc("secretId",e.secretDetailGeneral.id)("secretTemplateId",e.secretDetailGeneral.template.value)("viewFields",e.secretDetailGeneral.fields)("formGroup",e.secretFields)("noMaxWidth",!0)("privateKeyName",e.privateKeyName)("sshKeyDisabledMessage",e.sshKeyDisabled)("inputWidth",e.inputWidth)("secretName",e.secretDetailGeneral.name.value)("isTotpEnabled",e.secretDetailGeneral.isTotpEnabled)("totpPasswordSlug",e.secretDetailGeneral.totpPasswordSlug),b.Cb(2),b.nc("ngIf",e.secretDetailGeneral&&!e.ies.isEditMode(null)&&e.hasLaunchers()),b.Cb(1),b.nc("ngIf",!e.secretDetailGeneral.expiration.hidden||!e.secretDetailGeneral.lastHeartBeatStatus.hidden||!e.secretDetailGeneral.heartbeatEnabled.hidden),b.Cb(1),b.nc("ngIf",e.secretDetailGeneral)}}let Kt=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l,d,h,u,p,b,m,g,f){this._router=e,this._secretService=t,this._ies=s,this._policyService=i,this._siteService=n,this._stateService=r,this._launcherService=c,this._dialogService=a,this._preferenceService=l,this._clipboardService=d,this._log=h,this._errorService=u,this.cdr=p,this._localizationService=b,this._heartbeatService=m,this._dateService=g,this._notificationService=f,this.secretState=null,this.canEdit=null,this.pleaseWaitLauncher=null,this.savingSecret=null,this.heartbeatStatusResult=null,this.confirmPasswordChecked=!1,this.secretDetailGeneral=null,this.secretFields=new o.k({}),this.siteOptions=[],this.policyOptions=[],this.secretPolicies=[],this.secretPolicy=null,this.secretSites=[],this.isEditMode=!1,this.showFolderSelected=!1,this.heartbeatFailed=!1,this.heartbeatSuccess=!1,this.heartbeatPending=!1,this.heartbeatFailedDescription=null,this.isLoading=!0,this.isSavingSecret=!1,this.isSavingFile=!1,this.uploadingFiles=new Map,this.state=null,this._noPolicy=0,this._inheritPolicy=-2,this.layoutRowHeight=lt.c,this.formInputType=A.a,this.form=new o.k({name:new o.h("",k.a.requiredNotEmpty),secretFields:this.secretFields,site:new o.h(""),secretPolicy:new o.h,enableInheritSecretPolicy:new o.h,folder:new o.h,heartbeatEnabled:new o.h}),this.inputWidth=630,this.canConvert=!0,this.privateKeyName=null,this.sshKeyDisabled="This file will be generated",this.heartbeatStatusTooltip=null,this.lastHeartbeatCheckDate=null,this.lastHeartbeatCheckDateSince=null,this.doNotShowWarning="Don't show me this warning again.",this.LabelColumnWidth=lt.a,this._cdrAttached=!0,this._loadingForm=!1,this._dateOnInit=new Date,this._fileUploadError=!1,this.state=r,this.ies=this._ies,this.state.events.secretUndeleted.pipe(Object(M.b)(this)).subscribe(e=>{this._loadSecret(!1)})}ngOnInit(){this.cdr.reattach(),this._cdrAttached=!0;const e=this._localizationService.getCachedMessage("inherits-from-folder");this.doNotShowWarning=this._localizationService.getCachedMessage("do-not-show-warning"),this.pleaseWaitLauncher=this._localizationService.getCachedMessage("please-wait-launcher"),this.savingSecret=this._localizationService.getCachedMessage("saving-secret"),this.form.controls.folder.valueChanges.pipe(Object(M.b)(this)).subscribe(t=>{t?this._hasInheritsFromFolderOption(this.policyOptions)||this.policyOptions.splice(0,0,{value:this._inheritPolicy,text:e}):this._hasInheritsFromFolderOption(this.policyOptions)&&this.policyOptions.splice(0,1),this.policyOptions=this.policyOptions.slice(0)}),this._localizationService.getPageMessage("secretactions","sshkey-file-disabled").pipe(Object(h.a)()).subscribe(e=>{this.sshKeyDisabled=e}),this._ies.editModeEnabled.pipe(Object(M.b)(this)).subscribe(e=>{this.isEditMode=!0;const t=this.form.controls.secretFields;if(null!=t){const e=t.controls.ssGenerateSshKey;null!=e&&e.setValue(!1)}}),this._ies.editModeDisabled.pipe(Object(M.b)(this)).subscribe(e=>{this.isEditMode=!1}),this._stateService.events.secretEvents.expired.pipe(Object(M.b)(this)).subscribe(e=>{e!==this.secretState.id||this._ies.isEditMode(null)||this._loadSecret(!1)}),this._stateService.events.secretEvents.passwordChange.pipe(Object(M.b)(this)).subscribe(e=>{e.id!==this.secretState.id||e.passwordState!==Ye.a.ChangeCompleteSuccess||this._ies.isEditMode(null)||this._loadSecret(!1)}),this._heartbeatService.heartbeatStatusUpdated.pipe(Object(M.b)(this),Object(Je.a)(e=>e.secretId===this.secretState.id)).subscribe(e=>{this.heartbeatFailed=!1,this.heartbeatPending=!1,this.heartbeatSuccess=!1,e.heartbeatStatus===D.A.Success?(this.heartbeatSuccess=!0,this._assignHeartbeatTooltip(1)):e.heartbeatStatus===D.A.Pending||e.heartbeatStatus===D.A.Processing?(this.heartbeatPending=!0,this._assignHeartbeatTooltip(2)):e.heartbeatStatus!==D.A.Disabled&&(this._assignHeartbeatTooltip(0),this.heartbeatFailedDescription=this._localizationService.getCachedMessage("heartbeat-status-"+e.heartbeatStatus.toLowerCase()),this.heartbeatFailed=!0),this.lastHeartbeatCheckDate=null,this.lastHeartbeatCheckDateSince=null})}ngAfterViewInit(){this._setInputWidth()}ngOnDestroy(){this._cdrAttached=!1,this.cdr.detach(),this._notificationService.removeBannerNotification("tab","heartbeatfailed")}ngOnChanges(e){e.secretState&&this._initializeSecret()}onResize(e){this._setInputWidth()}_setInputWidth(){const e=window.innerWidth-(this._stateService.layout.isLeftNavCollapsed?50:this._stateService.layout.leftNavWidth);this.inputWidth=e<740?e-200:630}editAllFields(){this.generalForm.enableEditMode()}selectFolder(){this.pickFolderModal.show()}editSite(e,t,s){this._siteService.getSites().toPromise().then(i=>{this.secretSites=[],i.forEach(e=>{this.secretSites.push(e)}),this.sitesLoaded(),this.editField(e,t,s,this.siteOptions,null)})}editField(e,t,s,i,o){this._dialogService.open(ot.a,{data:{secretId:this.secretState.id,modelName:e,field:t,templateField:null,options:i,type:s,maxLength:o,passwordFunction:null,downloadFileFunction:null}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&this._applyUpdatedViewModel(e.approvedContext)})}policiesLoaded(){if(this.policyOptions&&this.policyOptions.length>0)return;const e=`< ${this._localizationService.getCachedMessage("no-policy")} >`;this.policyOptions.push({value:this._noPolicy,text:e}),this.secretPolicies.forEach(e=>{e.active&&this.policyOptions.push({text:e.secretPolicyName,value:e.secretPolicyId})})}folderNodeClicked(e){this.form.controls.folder.setValue(e.id),this.form.controls.folder.markAsDirty(),this.pickFolderModal.close()}clearFolder(){this.form.controls.folder.setValue(null),this.form.controls.folder.markAsDirty()}sitesLoaded(){this.siteOptions=[],this.secretSites.forEach(e=>{e.active&&this.siteOptions.push({text:e.siteName,value:e.siteId})}),this._checkForInactiveSite()}_checkForInactiveSite(){this.secretDetailGeneral&&0!==this.siteOptions.length&&(this.siteOptions.map(e=>e.value).indexOf(this.secretDetailGeneral.site.value)>-1||(this.siteOptions.push({text:this.secretDetailGeneral.site.name+" (Inactive)",value:this.secretDetailGeneral.site.value}),this.siteOptions=this.siteOptions.slice(0)))}_initializeSecret(){this.secretState.actions&&1===this.secretState.actions.length&&this._secretService.hasAction(D.W.ViewAudit,this.secretState)?this._router.navigate(["/secret",this.secretState.id,"audit"]):(this._loadSecret(!1),0===this.secretPolicies.length&&this._policyService.getPolicies().pipe(Object(h.a)()).subscribe(e=>{this.secretPolicies=e,this.policiesLoaded()}),0===this.secretSites.length&&this._siteService.getSites().pipe(Object(h.a)()).subscribe({next:e=>{this.secretSites=e,this.sitesLoaded()},error:e=>{}}))}_loadSecret(e){this.isLoading=!0,this.bannerMessage&&(this._notificationService.removeBannerNotification("tab","heartbeatfailed"),this.bannerMessage=null),this._secretService.getSecretDetailGeneral(this.secretState.id,e,this.canEdit).pipe(Object(h.a)()).subscribe({next:e=>{this._assignForm(e),this.canConvert=!!e.active.value,this.isLoading=!1,this._cdrAttached&&this.cdr.detectChanges(),2===e.lastHeartBeatStatus.value&&this._heartbeatService.pollHeartbeat({secretId:this.secretState.id,secretName:this.secretState.secretName})},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_SecretRequiresCheckout"!==t.errorCode&&"API_SecretAccessApprovalDenied"!==t.errorCode&&"API_ValidateSecretAccessCommentRequired"!==t.errorCode)throw e;this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])}})}_assignHeartbeatTooltip(e){switch(this.heartbeatSuccess=!1,this.heartbeatPending=!1,this.heartbeatFailed=!1,e){case 2:this.heartbeatStatusResult=this._localizationService.getCachedPageMessage("secretdetail","pending"),this.heartbeatStatusTooltip=this._localizationService.getCachedPageMessage("secretdetail","heartbeat-status-pending"),this.heartbeatPending=!0;break;case 10:this.heartbeatStatusResult=this._localizationService.getCachedPageMessage("secretdetail","processing"),this.heartbeatStatusTooltip=this._localizationService.getCachedPageMessage("secretdetail","heartbeat-status-processing"),this.heartbeatPending=!0;break;case 1:this.heartbeatStatusResult=this._localizationService.getCachedPageMessage("secretdetail","success"),this.heartbeatStatusTooltip=this._localizationService.getCachedPageMessage("secretdetail","heartbeat-status-success"),this.heartbeatSuccess=!0;break;default:this.heartbeatStatusResult=this._localizationService.getCachedPageMessage("secretdetail","failed"),this.heartbeatStatusTooltip=this._localizationService.getCachedPageMessage("secretdetail","heartbeat-status-other"),this.heartbeatFailed=!0}}_getHeartbeatFailedMessage(e){return this._localizationService.getCachedPageMessage("secretdetail","last-heartbeat-failed-message").replace("{0}",e)}_assignForm(e){this._loadingForm=!0,this.secretDetailGeneral=e,this._assignHeartbeatTooltip(this.secretDetailGeneral.lastHeartBeatStatus.value),this.secretDetailGeneral.canGenerateSshKey&&this.secretDetailGeneral.slugPrivateKey&&(this.privateKeyName=this.secretDetailGeneral.slugPrivateKey),this._checkForInactiveSite(),this._log.Verbose("General Model",this.secretDetailGeneral),this._ies.patchViewModel(this.form,this.secretDetailGeneral),this.secretDetailGeneral.folder.value||this.form.get("folder").setValue(null),e.enableInheritSecretPolicy&&e.enableInheritSecretPolicy.value?this.form.controls.secretPolicy.setValue(this._inheritPolicy):this.secretDetailGeneral.secretPolicy&&null===this.secretDetailGeneral.secretPolicy.value&&this.form.controls.secretPolicy.setValue(this._noPolicy),this.secretDetailGeneral.lastHeartBeatStatus.hidden||3===this.secretDetailGeneral.lastHeartBeatStatus.value||(1!==this.secretDetailGeneral.lastHeartBeatStatus.value&&2!==this.secretDetailGeneral.lastHeartBeatStatus.value?(this.bannerMessage=this._getHeartbeatFailedMessage(this._secretService.getHeartbeatDisplay(this.secretDetailGeneral.lastHeartBeatStatus.value)),this.heartbeatFailed=!1,this.heartbeatPending=!1,this.heartbeatSuccess=!1,this.heartbeatFailedDescription=null,this.secretDetailGeneral.lastHeartBeatStatus.hidden||(1===this.secretDetailGeneral.lastHeartBeatStatus.value?this.heartbeatSuccess=!0:2===this.secretDetailGeneral.lastHeartBeatStatus.value||10===this.secretDetailGeneral.lastHeartBeatStatus.value?this.heartbeatPending=!0:3!==this.secretDetailGeneral.lastHeartBeatStatus.value&&(this.heartbeatFailed=!0,this.heartbeatFailedDescription=this._secretService.getHeartbeatDisplay(e.lastHeartBeatStatus.value),this._setHeartbeatFailed()),this.lastHeartbeatCheckDateSince=this.getTimeSince(e.lastHeartBeatCheck.value),this.lastHeartbeatCheckDate=this._dateService.getFormatted(e.lastHeartBeatCheck.value,d.e.DateTime,this._stateService.timezone))):1===this.secretDetailGeneral.lastHeartBeatStatus.value?this.heartbeatSuccess=!0:2!==this.secretDetailGeneral.lastHeartBeatStatus.value&&10!==this.secretDetailGeneral.lastHeartBeatStatus.value&&(this.heartbeatFailed=!0)),this.secretDetailGeneral.fields.forEach(e=>{e.type===D.Y.Password&&(e.passwordLoaded=!1)}),this.initializeViewFields(this.secretDetailGeneral.fields),this._loadingForm=!1,this.form.markAsPristine()}getTimeSince(e){if(!e)return null;const t=this._dateService.getDifference(e,this._dateOnInit);return this._dateService.getFormattedDuration(t)}_setHeartbeatFailed(){this.bannerMessage="Last Heartbeat failed ("+this._secretService.getHeartbeatDisplay(this.secretDetailGeneral.lastHeartBeatStatus.value)+"). Launchers and password changing may not work until resolved.",this._notificationService.addBannerNotification("tab",{message:this.bannerMessage,key:"heartbeat-status"})}hasLaunchers(){return this.secretDetailGeneral&&this.secretDetailGeneral.launchers&&this.secretDetailGeneral.launchers.length>0}copyNameToClipboard(){this._clipboardService.copyFieldToClipboard(this._localizationService.getCachedMessage("secret-name"),this.secretDetailGeneral.name.value)}initializeViewFields(e){e.forEach(e=>{const t=this.secretFields.controls[e.slug];if(t)t.setValue(e.value),e.type===D.Y.Password&&(t.clearValidators(),this._cdrAttached&&this.cdr.detectChanges());else{const t=new o.h("");t.setValue(e.value),e.isRequired&&(e.type===D.Y.Password?t.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this._loadingForm||t.addedRequired||(t.setValidators(k.a.requiredNotEmpty),t.addedRequired=!0)}):t.setValidators(k.a.requiredNotEmpty)),this.secretFields.addControl(e.slug,t)}}),this.secretDetailGeneral.canGenerateSshKey&&this.secretDetailGeneral.slugPrivateKey&&(this.secretFields.addControl("ssGenerateSshKey",new o.h(!1)),this.secretFields.get("ssGenerateSshKey").valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{const t=this.secretFields.get(this.secretDetailGeneral.slugPrivateKey),s=this.secretFields.get(this.secretDetailGeneral.slugPublicKey);e?(t&&t.disable(),s&&s.disable()):(t&&t.enable(),s&&s.enable())})),this.form.controls.secretFields=this.secretFields}cancel(){this.secretDetailGeneral.fields.forEach(e=>{e.type===D.Y.Password&&(e.passwordLoaded=!1)})}save(){let e=!1;this.secretDetailGeneral.fields.forEach(t=>{t.type===D.Y.Password&&this.form.controls.secretFields.controls[t.slug].dirty&&(e=!0)}),e?this._preferenceService.getPreference("confirmPasswordUpdate",null).pipe(Object(h.a)()).subscribe(e=>{e&&"true"===e.settingValue?this.saveSecret():this.changePasswordConfirmModal.show()}):this.saveSecret()}changeTemplate(){this._stateService.selectedSecretIds=[],this._stateService.bulk.secretId=this.secretDetailGeneral.id,this._stateService.bulk.secretName=this.secretDetailGeneral.name.value,this._stateService.bulk.folderId=this.secretDetailGeneral.folder.value,this._stateService.bulk.templateId=this.secretDetailGeneral.template.value,this._router.navigate([{outlets:{modal:["modals","bulk","convert-secret-template"]}}])}confirmSave(){this.confirmPasswordChecked&&this._preferenceService.setPreference("confirmPasswordUpdate",null,!0).pipe(Object(h.a)()).subscribe(),this.changePasswordConfirmModal.close(),this.saveSecret()}saveSecret(){this._log.Verbose("Save general form ",this.form.value);const e=this._ies.createUpdateModel(this.form);e.secretPolicy&&e.secretPolicy.dirty&&(e.secretPolicy.value===this._inheritPolicy?(e.enableInheritSecretPolicy={dirty:!0,value:!0},e.secretPolicy.value=null):(e.enableInheritSecretPolicy={dirty:!0,value:!1},e.secretPolicy.value===this._noPolicy&&(e.secretPolicy.value=null)));const t=[],s=new Map,i=this.form.controls.secretFields;let o=!1;const n=i.get("ssGenerateSshKey");n&&n.value&&(o=!0);for(const r in i.controls)if(i.controls.hasOwnProperty(r)){if("ssGenerateSshKey"===r)continue;const e=i.controls[r];if(e.dirty){const i=this.secretDetailGeneral.fields.find(e=>e.slug===r);if((null==i?void 0:i.type)===D.Y.File){if(o&&(r===this.secretDetailGeneral.slugPrivateKey||r===this.secretDetailGeneral.slugPublicKey))continue;s.set(r,e.value)}else t.push({slug:r,dirty:!0,value:e.value})}}e.secretFields=t.length>0?t:null,e.generateSshKeys=o,this.isLoading=!0,this.isSavingSecret=!0,this._fileUploadError=!1,this._secretService.updateSecretDetailGeneral(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved general ",e),this.isSavingSecret=!1,0===s.size?(this._log.Verbose("Saved general ",e),this._applyUpdatedViewModel(e),this.isSavingFile=!1):(this.isSavingFile=!0,Object(nt.a)(Array.from(s,([e,t])=>this._secretService.uploadSecretFileField(this.secretState.id,e,t).pipe(Object(U.a)(s=>this._fileUploadStatus(s,t,e)),Object(ct.a)(s=>Object(rt.a)(this._updateFileError(s,e,t))),Object(at.a)()))).subscribe({next:()=>{this._fileUploadError||this._secretService.getSecretDetailGeneral(this.secretState.id,!1,this.canEdit).pipe(Object(h.a)()).subscribe(e=>{this._applyUpdatedViewModel(e)})},complete:()=>{this.isLoading=!1,this.isSavingFile=!1,this._fileUploadError=!1}}))},error:e=>{const t=this._errorService.getErrorMessage(e);"API_SecretRequiresCheckout"===t.errorCode||"API_SecretAccessApprovalDenied"===t.errorCode||"API_ValidateSecretAccessCommentRequired"===t.errorCode?(this._ies.disableEditMode(null,!1),this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])):(this.isLoading=!1,this.isSavingSecret=!1,this._ies.assignErrorToFormGroup(this.form,e))}})}_fileUploadStatus(e,t,s){var i;switch(e.type){case it.e.Sent:this.uploadingFiles.set(t,0);break;case it.e.UploadProgress:this.uploadingFiles.set(t,Math.floor(100*e.loaded/e.total));break;case it.e.Response:this.uploadingFiles.delete(t);const o=null===(i=this.secretFields)||void 0===i?void 0:i.controls[s];o&&(o.markAsPristine(),o.value&&(o.value.fileName=t.file.name))}}_updateFileError(e,t,s){let i;this._fileUploadError=!0,this.uploadingFiles.delete(s);const o=this._errorService.getErrorMessage(e);"API_SecretRequiresCheckout"===o.errorCode||"API_SecretAccessApprovalDenied"===o.errorCode||"API_ValidateSecretAccessCommentRequired"===o.errorCode?(this._ies.disableEditMode(null,!1),this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])):"FileTooLarge"===o.errorCode?(i={fileTooLarge:{valid:!1}},this._setFieldError(t,i),this._ies.showValidationMessages=!0):"API_InvalidFileAttachment"===o.errorCode?(i={fileInvalid:{valid:!1,message:this._localizationService.getCachedPageMessage("common","validator-fileInvalid")}},this._setFieldError(t,i),this._ies.assignErrorToFormGroup(this.form,e)):this._ies.assignErrorToFormGroup(this.form,e)}_setFieldError(e,t){if(this.form.controls[e])this.form.controls[e].setErrors(t);else{const s=this.form.controls.secretFields;(null==s?void 0:s.controls[e])&&s.controls[e].setErrors(t)}}modelUpdated(e){this._applyUpdatedViewModel(e)}_applyUpdatedViewModel(e){this.secretDetailGeneral.folder.value!==e.folder.value&&this.state.events.secretFolderUpdated.next(e.folder.value),this.secretDetailGeneral.name.value!==e.name.value&&this.state.events.secretNameUpdated.next(e.name.value),this._assignForm(e),this._ies.disableEditMode(null,!1),this.isLoading=!1,this.state.events.secretUpdated.next(this.secretState.id)}showNameHistory(){this._dialogService.open(dt.a,{data:{secretId:this.secretState.id,slug:null,secretName:this.secretState.secretName,fieldName:"Secret Name",isPassword:!1}})}generateArray(e){return e?Object.keys(e).map(t=>({key:t,value:e[t]})):null}openLauncher(e){this._launcherService.launchSecret(this.secretState.id,e.typeId,null)}isLaunching(){return this._launcherService.isLauncherLoading(this.secretState.id,null)}isShowingLastHeartbeatCheckDateTime(e){return null!=e&&3!==e&&2!==e&&10!==e}_hasInheritsFromFolderOption(e){return e.map(e=>e.value).indexOf(this._inheritPolicy)>=0}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(a.V),b.Ob(a.B),b.Ob(a.L),b.Ob(a.X),b.Ob(a.cb),b.Ob(a.C),b.Ob(E.c),b.Ob(a.M),b.Ob(a.e),b.Ob(a.fb),b.Ob(a.eb),b.Ob(b.h),b.Ob(a.F),b.Ob(a.z),b.Ob(a.db),b.Ob(m.i))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-general"]],viewQuery:function(e,t){if(1&e&&(b.Uc(mt,1),b.Uc(gt,1),b.Uc(ft,1)),2&e){let e;b.zc(e=b.cc())&&(t.pickFolderModal=e.first),b.zc(e=b.cc())&&(t.changePasswordConfirmModal=e.first),b.zc(e=b.cc())&&(t.generalForm=e.first)}},hostBindings:function(e,t){1&e&&b.bc("resize",function(e){return t.onResize(e)},!1,b.Dc)},inputs:{secretState:"secretState",canEdit:"canEdit"},features:[b.Ab],decls:18,vars:11,consts:[[1,"form-width-large"],[3,"active","isFullscreen","displayText"],[3,"active","isFullscreen","contentTemplate"],["filedDimmerTemplate",""],[1,"ui","form",2,"min-height","100%",3,"formGroup"],["formId","general-form","dialogTitle","",3,"hideTitleBar","ssForm","canEdit","rightAlignButtons","save","cancel",4,"ngIf"],["modalTitleLocale","change-password-confirm-title",3,"nullifyOutlets"],["changePasswordConfirmModal",""],["modal-body",""],["ss-locale","changed-password-confirm-text"],["id","confirm-password-checkbox",1,"norowclick",3,"checked","labelAfter","clicked"],["modal-footer",""],["id","cancel-password-button","type","button","ss-locale","cancel",1,"thy","basic","button",3,"click"],["id","confirm-password-button","type","button","autofocus","","ss-locale","yes-save",1,"thy","primary","button",3,"click"],["ss-page-name","secretdetail","ss-locale","saving-file",4,"ngIf"],["ss-page-name","secretdetail","ss-locale","saving-files",4,"ngIf"],["class","saving-filename",4,"ngFor","ngForOf"],["ss-page-name","secretdetail","ss-locale","saving-file"],["ss-page-name","secretdetail","ss-locale","saving-files"],[1,"saving-filename"],["formId","general-form","dialogTitle","",3,"hideTitleBar","ssForm","canEdit","rightAlignButtons","save","cancel"],["generalForm",""],["titleLocale","basic-information","summaryLocale","basic-information-description",3,"showBorder","highlightHover","showEditAll","editAll"],[3,"viewField","showActions","hideBorder"],["formControlName","name",3,"viewField","type","maxlength","breakWord"],["action-column",""],[1,"action-row-links"],[4,"ngIf"],[1,"action-edit"],["id","edit-secret-name","type","button","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],[3,"viewField","showActions"],["value-column","",1,"top-padded-layout-cell"],["type","button","id","edit-template","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],[3,"secretId","secretTemplateId","viewFields","formGroup","noMaxWidth","privateKeyName","sshKeyDisabledMessage","inputWidth","secretName","isTotpEnabled","totpPasswordSlug","modelUpdated"],["secretFieldEdit",""],["titleLocale","launchers-information","summaryLocale","launchers-information-description",3,"labelColumnWidth",4,"ngIf"],["titleLocale","heartbeat-information","summaryLocale","heartbeat-information-description",3,"showBorder",4,"ngIf"],["titleLocale","advanced-information","summaryLocale","advanced-information-description",3,"showBorder","highlightHover","noBottomMargin",4,"ngIf"],["id","name-history","name","access_time",1,"svg-icon","icon-18","pointer","accessTimeIcon",3,"click"],["id","name-copy","name","content_copy",1,"svg-icon","icon-18","pointer",3,"click"],["id","edit-secret-name","type","button","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["type","button","id","edit-template","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["titleLocale","launchers-information","summaryLocale","launchers-information-description",3,"labelColumnWidth"],[3,"showActions","showLabel","rowHeight",4,"ngFor","ngForOf"],[3,"showActions","showLabel","rowHeight"],["value-column",""],[1,"launcher-row"],[1,"launcher-icon",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","record nohover","name","record",4,"ngIf"],["type","button",1,"link-button",3,"click"],["src","assets/images/icons/launcher_rdp.png"],["src","assets/images/icons/launcher_putty.png"],["src","assets/images/icons/launcher_custom.png"],["name","record",1,"record","nohover"],["titleLocale","heartbeat-information","summaryLocale","heartbeat-information-description",3,"showBorder"],[3,"viewField","showActions",4,"ngIf"],["id","secret-expire-link",3,"routerLink"],["value-column","",2,"padding-top","4px"],["id","general-heartbeat-status",1,"status-oval",3,"matTooltip"],[1,"heartbeat-status-detail"],[1,"heartbeat-status-detail",3,"matTooltip"],["formControlName","heartbeatEnabled",3,"type","viewField"],["id","edit-heartbeat","type","button","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],["id","edit-heartbeat","type","button","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["titleLocale","advanced-information","summaryLocale","advanced-information-description",3,"showBorder","highlightHover","noBottomMargin"],["formControlName","folder",3,"type","fullFolderPath","linkFolder"],["value-column","","ss-locale","none-selected",4,"ngIf"],["id","edit-folder","type","button","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],["formControlName","secretPolicy",3,"upwardDropDown","type","options","viewField"],["type","button","id","edit-policy","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],["value-column","","ss-locale","none-selected"],["id","edit-folder","type","button","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["type","button","id","edit-policy","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["formControlName","site",3,"type","upwardDropDown","options","viewField"],["type","button","id","edit-site","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],["type","button","id","edit-site","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"]],template:function(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",0),b.Pb(1,"thy-loading-dimmer",1),b.Pb(2,"thy-loading-dimmer",2),b.Mc(3,wt,4,5,"ng-template",null,3,b.Nc),b.Ub(5,"div",4),b.Mc(6,Ht,21,35,"ss-form-dialog",5),b.Ub(7,"ss-modal-dialog",6,7),b.Ub(9,"div",8),b.Ub(10,"p",9),b.Oc(11," You have changed the password field. This will not update the password on the remote account. To change the password on the remote account, click on the 'Change Password Remotely' button on Secret View. Are you sure you want to save your changes?"),b.Tb(),b.Ub(12,"ss-checkbox",10),b.bc("clicked",function(e){return t.confirmPasswordChecked=e}),b.Tb(),b.Tb(),b.Ub(13,"div",11),b.Ub(14,"button",12),b.bc("click",function(){return b.Ec(e),b.Ac(8).close()}),b.Oc(15,"Cancel"),b.Tb(),b.Ub(16,"button",13),b.bc("click",function(){return t.confirmSave()}),b.Oc(17,"Yes, Save Changes"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.Ac(4);b.Cb(1),b.nc("active",t.isLoading||t.isLaunching()||t.isSavingSecret)("isFullscreen",!0)("displayText",t.isLaunching()?t.pleaseWaitLauncher:t.isSavingSecret?t.savingSecret:null),b.Cb(1),b.nc("active",t.isSavingFile)("isFullscreen",!0)("contentTemplate",e),b.Cb(3),b.nc("formGroup",t.form),b.Cb(1),b.nc("ngIf",t.secretDetailGeneral),b.Cb(1),b.nc("nullifyOutlets",!1),b.Cb(5),b.nc("checked",t.confirmPasswordChecked)("labelAfter",t.doNotShowWarning)}},directives:[m.h,o.t,o.l,i.o,N.a,f.a,ht.a,i.n,ut.a,G.a,z.a,j.a,o.s,o.j,o.o,pt.a,n.b,i.q,i.r,i.s,c.g,R.a],pipes:[i.h,i.b,bt.a],styles:[".nameRow[_ngcontent-%COMP%]{margin-bottom:14px}.folderTree[_ngcontent-%COMP%]{border:1px solid var(--border-color-1)}.header[_ngcontent-%COMP%]{font-weight:700;margin:0 0 .28571429rem;color:var(--font-color-1)}.launcher-row[_ngcontent-%COMP%]{padding-left:6px;display:flex}.launcher-row[_ngcontent-%COMP%]   svg-icon[_ngcontent-%COMP%]{margin-left:-8px}.launcher-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child{margin-left:6px}.heartbeat-status-detail[_ngcontent-%COMP%]{margin-left:10px;display:inline-block}div.saving-filename[_ngcontent-%COMP%]{margin-top:10px}.launcher-icon[_ngcontent-%COMP%]{width:36px}"]}),e=Object(P.b)([Object(M.a)()],e),e})();var Qt=s("d52A"),$t=s("7Rrx"),Zt=s("7pMU"),Yt=s("+blb"),Jt=s("D3Q8"),Xt=s("jArk");function es(e,t){if(1&e&&(b.Ub(0,"div",24),b.Ub(1,"span",25),b.Oc(2),b.Tb(),b.Pb(3,"thy-form-select",26),b.Tb()),2&e){const e=b.fc(),t=e.index,s=e.user,i=b.fc(3);b.nc("formGroupName",t),b.Cb(2),b.Pc(s.name),b.Cb(1),b.nc("editMode",!0)("options",i.scriptOptions)}}function ts(e,t){if(1&e&&b.Mc(0,es,4,4,"div",23),2&e){const e=b.fc(3);b.nc("ngIf",!e.usersUpdating)}}function ss(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"div",3),b.Ub(2,"div",4),b.Pb(3,"ss-form-input",15),b.Tb(),b.Ub(4,"div"),b.Ub(5,"ss-view-field-label",6),b.bc("click",function(){return b.Ec(e),b.fc(2).toggleCheckbox("allowOwnersUnrestrictedSshCommands")}),b.Oc(6,"Allow Owners Unrestricted"),b.Tb(),b.Tb(),b.Tb(),b.Sb(7),b.Ub(8,"form",16),b.Ub(9,"thy-form-layout",17),b.Ub(10,"thy-form-layout-row"),b.Pb(11,"label",18),b.Ub(12,"div",19),b.Pb(13,"ss-validation-summary",20),b.Ub(14,"ss-user-picker",21),b.bc("userAdded",function(t){return b.Ec(e),b.fc(2).addUser(t)})("itemsUpdating",function(){return b.Ec(e),b.fc(2).usersSelecting()})("userRemovedAtIndex",function(t){return b.Ec(e),b.fc(2).removeUserAtIndex(t)}),b.Mc(15,ts,1,1,"ng-template",null,22,b.Nc),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Rb(),b.Tb()}if(2&e){const e=b.Ac(16),t=b.fc(2);b.Cb(3),b.nc("viewField",t.context.secretSecurity.allowOwnersUnrestrictedSshCommands)("type",t.formInputType.Boolean),b.Cb(2),b.nc("viewField",t.context.secretSecurity.allowOwnersUnrestrictedSshCommands)("pointerCursor",!0),b.Cb(3),b.nc("formGroup",t.sshCommandForm),b.Cb(1),b.nc("noBottomMargin",!0)("labelColumnWidth",t.labelColumnWidth)("formGroup",t.sshCommandForm)("wideContent",!0),b.Cb(2),b.nc("ss-page-name",t.pageName),b.Cb(2),b.nc("ssForm",t.sshCommandForm)("requireEditMode",!1),b.Cb(1),b.nc("isEditMode",!0)("showAllUsersWhenSearchEmpty",!0)("selectedUserText",t.selectedUserText)("addUserText",t.addUserText)("rowTemplate",e)("initialUsers",t.overrideUsers)("allowDuplicates",!0)}}function is(e,t){if(1&e&&(b.Ub(0,"div"),b.Ub(1,"thy-form-layout",27),b.Ub(2,"thy-form-layout-row",28),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Pb(5,"thy-form-select",29),b.Tb(),b.Ub(6,"thy-form-layout-row",28),b.gc(7,"async"),b.gc(8,"ssLocale"),b.Pb(9,"thy-form-select",30),b.Tb(),b.Ub(10,"thy-form-layout-row",28),b.gc(11,"async"),b.gc(12,"ssLocale"),b.Pb(13,"thy-form-select",31),b.Tb(),b.Tb(),b.Tb()),2&e){const e=b.fc(2);b.Cb(1),b.nc("noBottomMargin",!0)("labelColumnWidth",e.labelColumnWidth),b.Cb(1),b.nc("showActions",!1)("labelText",b.hc(3,14,b.hc(4,16,"secretactions.owner-permission"))),b.Cb(3),b.nc("options",e.blocklistOptions)("editMode",!0),b.Cb(1),b.nc("showActions",!1)("labelText",b.hc(7,18,b.hc(8,20,"secretactions.edit-permission"))),b.Cb(3),b.nc("options",e.blocklistOptions)("editMode",!0),b.Cb(1),b.nc("showActions",!1)("labelText",b.hc(11,22,b.hc(12,24,"secretactions.view-permission"))),b.Cb(3),b.nc("options",e.blocklistOptions)("editMode",!0)}}function os(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Pb(1,"ss-radio",11),b.Ub(2,"span",12),b.bc("click",function(){return b.Ec(e),b.fc().sshCommandForm.controls.commandRestrictionType.setValue("AllowedMenu")}),b.Oc(3,"Allowed Command Menus"),b.Tb(),b.Pb(4,"ss-radio",13),b.Ub(5,"span",14),b.bc("click",function(){return b.Ec(e),b.fc().sshCommandForm.controls.commandRestrictionType.setValue("BlockedList")}),b.Oc(6,"Blocked Command Lists"),b.Tb(),b.Mc(7,ss,17,19,"div",7),b.Mc(8,is,14,26,"div",7),b.Tb()}if(2&e){const e=b.fc();b.Cb(7),b.nc("ngIf","AllowedMenu"==e.sshCommandForm.controls.commandRestrictionType.value),b.Cb(1),b.nc("ngIf","BlockedList"==e.sshCommandForm.controls.commandRestrictionType.value)}}let ns=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l){this.context=e,this.dialog=t,this.formsService=s,this._scriptService=i,this._secretService=n,this._ies=r,this._router=c,this._sshCommandBlocklistService=a,this._localizationService=l,this.pageName="secretactions",this.labelColumnWidth=lt.a.Medium,this.sharingEditGroup="sharingEditGroup",this.usersAssignedToMenuScript=[],this.formInputType=A.a,this.usersUpdating=!0,this.sshCommandForm=new o.k({allowOwnersUnrestrictedSshCommands:new o.h,restrictSshCommands:new o.h,commandRestrictionType:new o.h,groups:new o.e([]),viewPermission:new o.h("-1"),editPermission:new o.h("-1"),ownerPermission:new o.h("-1")}),this.sshCommandUserForm=new o.k({groupId:new o.h,permission:new o.h}),this.selectedUserText="Overrides for",this.addUserText="Add Groups / Users",this.overrideUsers=[]}ngOnInit(){this.sshCommandForm.controls.restrictSshCommands.setValue(this.context.secretSecurity.restrictSshCommands.value),this.sshCommandForm.controls.allowOwnersUnrestrictedSshCommands.setValue(this.context.secretSecurity.allowOwnersUnrestrictedSshCommands.value),this.formsService.enableEditMode("sshCommands",this.sshCommandForm),this._ies.enableEditMode("sshCommands",this.sshCommandForm),this.sshCommandBlocklistFilter={includeActive:!0,includeInactive:!1,name:null},this.selectedUserText=this._localizationService.getCachedPageMessage(this.pageName,"selected-user-text"),this.addUserText=this._localizationService.getCachedPageMessage(this.pageName,"add-user-text"),Object(nt.a)([this._secretService.getSshRestrictedCommands(this.context.secretId),this._scriptService.getSshCommands(),this._sshCommandBlocklistService.getSshCommandBlocklists(this.sshCommandBlocklistPaging,this.sshCommandBlocklistFilter)]).subscribe(e=>{var t,s,i,o,n,r;const c=e[0],a=e[1];a.unshift({sshCommandId:null,sshCommandName:"Unrestricted"}),this.scriptOptions=a.map(e=>{var t,s;return{value:null!==(s=null===(t=e.sshCommandId)||void 0===t?void 0:t.toString())&&void 0!==s?s:"-1",text:e.sshCommandName}}),this.blocklistOptions=e[2].records.map(e=>({value:e.sshCommandBlocklistId.toString(),text:e.name})),this.blocklistOptions.unshift({value:"-1",text:"Unrestricted"}),this.sshCommandForm.controls.commandRestrictionType.setValue(c.commandRestrictionType),this.sshCommandForm.controls.viewPermission.setValue(null!==(s=null===(t=c.sshCommandBlocklists.filter(e=>10064===e.rolePermissionId).shift())||void 0===t?void 0:t.sshCommandBlocklistId)&&void 0!==s?s:"-1"),this.sshCommandForm.controls.editPermission.setValue(null!==(o=null===(i=c.sshCommandBlocklists.filter(e=>10065===e.rolePermissionId).shift())||void 0===i?void 0:i.sshCommandBlocklistId)&&void 0!==o?o:"-1"),this.sshCommandForm.controls.ownerPermission.setValue(null!==(r=null===(n=c.sshCommandBlocklists.filter(e=>10066===e.rolePermissionId).shift())||void 0===n?void 0:n.sshCommandBlocklistId)&&void 0!==r?r:"-1"),c.sshCommandMenus.map(e=>({id:e.groupId,name:e.displayName,groupId:e.groupId,userId:null})).forEach((e,t,s)=>{var i,o;return this.addUser(e,null!==(o=null===(i=c.sshCommandMenus[t].sshCommandMenuId)||void 0===i?void 0:i.toString())&&void 0!==o?o:"-1")})})}removeUserAtIndex(e){this.sshCommandForm.controls.groups.removeAt(e),this.overrideUsers.splice(e,1),this.usersUpdating=!1}addUser(e,t="-1"){const s=this.sshCommandForm.controls.groups,i=new o.k({groupId:new o.h(e.groupId),permission:new o.h(t)});i.controls.permission.markAsDirty(),s.push(i),this.overrideUsers.push(e),this.usersUpdating=!1}usersSelecting(){this.usersUpdating=!0}toggleCheckbox(e){this.sshCommandForm.controls[e].enabled&&this.sshCommandForm.controls[e].setValue(!this.sshCommandForm.controls[e].value)}dropDownOptionFormatter(e){const t=e.sshCommandName;return e.sshCommandId?t:`<span class='italic'>${t}</span>`}save(){let e=!1;this.sshCommandForm.value.restrictSshCommands&&(e=!0);let t=!1;this.sshCommandForm.value.allowOwnersUnrestrictedSshCommands&&(t=!0);const s=this.sshCommandForm.value.viewPermission,i=this.sshCommandForm.value.editPermission,o=this.sshCommandForm.value.ownerPermission,n=this.sshCommandForm.value.groups.map(e=>({groupId:e.groupId,sshCommandMenuId:"-1"===e.permission?null:e.permission}));this._secretService.updateSshRestrictedCommands(this.context.secretId,this.sshCommandForm.value.commandRestrictionType,n,[{rolePermissionId:10064,sshCommandBlocklistId:"-1"===s?null:s},{rolePermissionId:10065,sshCommandBlocklistId:"-1"===i?null:i},{rolePermissionId:10066,sshCommandBlocklistId:"-1"===o?null:o}],e,t).pipe(Object(h.a)()).subscribe({next:e=>{e&&this.dialog.close({isApproved:!0})},error:e=>{var t;"API_AccessDenied"===(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.errorCode)&&this._router.navigate(["/no-access"]),this._ies.showValidationMessages=!0,this._ies.assignErrorToFormGroup(this.sshCommandForm,e)}})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(E.a),b.Ob(E.i),b.Ob(l.k),b.Ob(a.S),b.Ob(a.V),b.Ob(a.B),b.Ob(c.e),b.Ob(a.Z),b.Ob(a.F))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-modal-restricted-ssh-commands"]],features:[b.Bb([],[a.B,l.k])],decls:16,vars:8,consts:[["mat-dialog-title","","ss-locale","edit-ssh-restrictions",3,"ss-page-name"],["mat-dialog-content",""],[2,"margin-bottom","16px",3,"formGroup"],[1,"flex"],[1,"check-input"],["formControlName","restrictSshCommands","editSection","sshCommands",3,"viewField","type"],[3,"viewField","pointerCursor","click"],[4,"ngIf"],["mat-dialog-actions",""],["mat-dialog-close","","ss-locale","cancel","ss-page-name","common",1,"thy","basic","button"],["type","button","ss-locale","save","ss-page-name","common",1,"thy","primary","button",3,"disabled","click"],["id","allowed-command-menus-radio-button","name","commandRestrictionType","inputValue","AllowedMenu","formControlName","commandRestrictionType",1,"check-input"],["ss-locale","SshCommandRestrictionAllowedMenu",1,"pointer",3,"click"],["id","blocked-command-lists-radio-button","name","commandRestrictionType","inputValue","BlockedList","formControlName","commandRestrictionType",1,"check-input","spacer"],["ss-locale","SshCommandRestrictionBlockedList",1,"pointer",3,"click"],["formControlName","allowOwnersUnrestrictedSshCommands","editSection","sshCommands",3,"viewField","type"],[3,"formGroup"],["formWidth","large",3,"noBottomMargin","labelColumnWidth","formGroup","wideContent"],["label-column","","ss-locale","permission-overrides",1,"field-header","required-field",3,"ss-page-name"],["value-column","","formArrayName","groups",1,"picker"],["editSection","sshCommands",3,"ssForm","requireEditMode"],[3,"isEditMode","showAllUsersWhenSearchEmpty","selectedUserText","addUserText","rowTemplate","initialUsers","allowDuplicates","userAdded","itemsUpdating","userRemovedAtIndex"],["selectedUserTemplate",""],["class","flex-align-center",3,"formGroupName",4,"ngIf"],[1,"flex-align-center",3,"formGroupName"],[1,"share-span"],["formControlName","permission",3,"editMode","options"],[3,"noBottomMargin","labelColumnWidth"],[3,"showActions","labelText"],["formControlName","ownerPermission",3,"options","editMode"],["formControlName","editPermission",3,"options","editMode"],["formControlName","viewPermission",3,"options","editMode"]],template:function(e,t){1&e&&(b.Ub(0,"h1",0),b.Oc(1,"Edit SSH Command Restriction"),b.Tb(),b.Ub(2,"div",1),b.Ub(3,"form",2),b.Ub(4,"div",3),b.Ub(5,"div",4),b.Pb(6,"ss-form-input",5),b.Tb(),b.Ub(7,"div"),b.Ub(8,"ss-view-field-label",6),b.bc("click",function(){return t.toggleCheckbox("restrictSshCommands")}),b.Oc(9,"Restrict SSH Commands"),b.Tb(),b.Tb(),b.Tb(),b.Mc(10,os,9,2,"div",7),b.Tb(),b.Tb(),b.Ub(11,"div",8),b.Ub(12,"button",9),b.Oc(13,"Cancel"),b.Tb(),b.Ub(14,"button",10),b.bc("click",function(){return t.save()}),b.Oc(15,"Save"),b.Tb(),b.Tb()),2&e&&(b.nc("ss-page-name",t.pageName),b.Cb(3),b.nc("formGroup",t.sshCommandForm),b.Cb(3),b.nc("viewField",t.context.secretSecurity.restrictSshCommands)("type",t.formInputType.Boolean),b.Cb(2),b.nc("viewField",t.context.secretSecurity.restrictSshCommands)("pointerCursor",!0),b.Cb(2),b.nc("ngIf",t.sshCommandForm.value.restrictSshCommands),b.Cb(4),b.nc("disabled",!t.formsService.isFormValid()&&t.formsService.isFormDirty()))},directives:[E.j,f.a,E.g,o.E,o.t,o.l,j.a,o.s,o.j,Yt.a,i.o,E.d,E.e,Jt.a,l.e,l.f,o.f,q.a,Xt.a,o.m,l.h],pipes:[i.b,bt.a],styles:[".check-input[_ngcontent-%COMP%]{margin-right:1ex;margin-bottom:1em;display:inline-block}.picker[_ngcontent-%COMP%]{height:30em;width:100%}.spacer[_ngcontent-%COMP%]{margin-left:5em}.small-selection[_ngcontent-%COMP%]{width:50%!important;margin-right:2em}.flex-align-center[_ngcontent-%COMP%]{display:flex}.share-span[_ngcontent-%COMP%]{width:45%;display:inline-flex;margin-right:5px;word-break:break-all}"]}),e=Object(P.b)([Object(M.a)()],e),e})();var rs=s("Z4TF"),cs=s("ti49");function as(e,t){if(1&e&&(b.Ub(0,"pre"),b.Oc(1),b.gc(2,"json"),b.Tb()),2&e){const e=b.fc(2);b.Cb(1),b.Qc("    ",b.hc(2,1,e.errorSummary),"\n  ")}}function ls(e,t){if(1&e&&(b.Ub(0,"span",33),b.Oc(1),b.Tb()),2&e){const e=b.fc(4);b.Cb(1),b.Pc(e.secretSecurity.checkOutDefaultIntervalDisplay.value)}}function ds(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Ub(1,"div",27),b.Pb(2,"ss-radio",28),b.Oc(3," \xa0\xa0 "),b.Ub(4,"label",29),b.bc("click",function(){b.Ec(e);const t=b.fc(3);return t.setValueWithDirty(t.checkoutForm.controls.checkoutTimeType,"Default","checkout")}),b.Oc(5,"Default check out interval"),b.Tb(),b.Oc(6,"\xa0 ("),b.Mc(7,ls,2,1,"span",30),b.Oc(8,") "),b.Tb(),b.Ub(9,"div",27),b.Pb(10,"ss-radio",31),b.Oc(11," \xa0\xa0 "),b.Ub(12,"label",32),b.bc("click",function(){b.Ec(e);const t=b.fc(3);return t.setValueWithDirty(t.checkoutForm.controls.checkoutTimeType,"Custom","checkout")}),b.Oc(13,"Custom check out interval"),b.Tb(),b.Tb(),b.Rb()}if(2&e){const e=b.fc(3);b.Cb(4),b.Gb("pointer",e.ies.isEditMode("checkout")),b.Cb(3),b.nc("ngIf",e.secretSecurity.checkOutDefaultIntervalDisplay),b.Cb(5),b.Gb("pointer",e.ies.isEditMode("checkout"))}}function hs(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.Pc(e.secretSecurity.checkOutIntervalDisplay.value)}}function us(e,t){if(1&e&&(b.Sb(0),b.Pb(1,"ss-form-input",34),b.Rb()),2&e){const e=b.fc(3);b.Cb(1),b.nc("forceEditMode",e.checkoutEditMode)("viewField",e.secretSecurity.checkOutIntervalMinutes)("type",e.formInputType.TimeSpan)}}function ps(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",26),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",20),b.Mc(4,ds,14,5,"ng-container",3),b.Mc(5,hs,2,1,"span",3),b.Mc(6,us,2,3,"ng-container",3),b.Tb(),b.Tb()),2&e){const e=b.fc(2);b.nc("labelText",b.hc(1,5,b.hc(2,7,"check-out-interval")))("showActions",!1),b.Cb(4),b.nc("ngIf",e.checkoutForm.value.checkOutEnabled&&e.checkoutEditMode),b.Cb(1),b.nc("ngIf",!e.checkoutEditMode),b.Cb(1),b.nc("ngIf",e.checkoutEditMode&&"Custom"===e.checkoutForm.value.checkoutTimeType)}}function bs(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",19),b.Sb(1,20),b.Pb(2,"thy-form-boolean",35),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretSecurity.checkOutChangePasswordEnabled)("showActions",!1),b.Cb(2),b.nc("labelText",b.hc(3,3,b.hc(4,5,"change-password-check-in")))}}function ms(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.Qc(" (",e.secretSecurity.approvalWorkflow.readOnlyReason,") ")}}function gs(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",19),b.Sb(1,36),b.Mc(2,ms,2,1,"span",3),b.Rb(),b.Pb(3,"thy-form-select",37),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretSecurity.approvalWorkflow)("showActions",!1),b.Cb(2),b.nc("ngIf",e.secretSecurity.approvalWorkflow.readOnly&&e.ies.isEditMode("approval")),b.Cb(1),b.nc("options",e.approvalWorkflowOptions)}}function fs(e,t){1&e&&(b.Ub(0,"span",46),b.Oc(1,"Validate on Create"),b.Tb())}function vs(e,t){1&e&&(b.Ub(0,"span",47),b.Oc(1,"Do not validate on Create"),b.Tb())}function ys(e,t){1&e&&(b.Ub(0,"span",48),b.Oc(1,"Validate on Edit"),b.Tb())}function Ss(e,t){1&e&&(b.Ub(0,"span",49),b.Oc(1,"Do not validate on Edit"),b.Tb())}function ws(e,t){if(1&e&&(b.Ub(0,"span",56),b.Oc(1,"Custom"),b.Tb()),2&e){const e=b.fc().index;b.nc("id","password-type-"+e)}}function Cs(e,t){if(1&e&&(b.Ub(0,"span",57),b.Oc(1,"Template"),b.Tb()),2&e){const e=b.fc().index;b.nc("id","password-type-"+e)}}function Ts(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",58),b.bc("click",function(){b.Ec(e);const t=b.fc().$implicit;return b.fc(3).editPasswordRequirement(t)}),b.Oc(1,"Edit"),b.Tb()}if(2&e){const e=b.fc().index;b.nc("id","edit-password-"+e)}}function Os(e,t){1&e&&(b.Ub(0,"div",62),b.Oc(1,"Must Include"),b.Tb())}function Is(e,t){if(1&e&&(b.Ub(0,"div",65),b.Oc(1),b.Tb()),2&e){const e=t.$implicit;b.Cb(1),b.Qc(" ",e.description," ")}}function _s(e,t){if(1&e&&(b.Ub(0,"div",63),b.Mc(1,Is,2,1,"div",64),b.Tb()),2&e){const e=b.fc(2).$implicit,t=b.fc(3);b.Cb(1),b.nc("ngForOf",t.passwordRequirementTooltips[e.fieldName].rules)}}function Ps(e,t){1&e&&(b.Ub(0,"div",66),b.Oc(1,"Must Include"),b.Tb())}function Ms(e,t){if(1&e&&(b.Ub(0,"div",65),b.Oc(1),b.Tb()),2&e){const e=t.$implicit;b.Cb(1),b.Qc(" ",e.description," ")}}function ks(e,t){if(1&e&&(b.Ub(0,"div",63),b.Mc(1,Ms,2,1,"div",64),b.Tb()),2&e){const e=b.fc(2).$implicit,t=b.fc(3);b.Cb(1),b.nc("ngForOf",t.passwordRequirementTooltips[e.fieldName].validators)}}function xs(e,t){1&e&&(b.Ub(0,"div",63),b.Ub(1,"div",67),b.Oc(2,"No password rules are defined for this requirement."),b.Tb(),b.Tb())}function Ds(e,t){if(1&e&&(b.Mc(0,Os,2,0,"div",59),b.Mc(1,_s,2,1,"div",60),b.Mc(2,Ps,2,0,"div",61),b.Mc(3,ks,2,1,"div",60),b.Mc(4,xs,3,0,"div",60)),2&e){const e=b.fc().$implicit,t=b.fc(3);b.nc("ngIf",t.passwordRequirementTooltips&&(null==t.passwordRequirementTooltips[e.fieldName]||null==t.passwordRequirementTooltips[e.fieldName].rules?null:t.passwordRequirementTooltips[e.fieldName].rules.length)>0),b.Cb(1),b.nc("ngIf",t.passwordRequirementTooltips&&(null==t.passwordRequirementTooltips[e.fieldName]||null==t.passwordRequirementTooltips[e.fieldName].rules?null:t.passwordRequirementTooltips[e.fieldName].rules.length)>0),b.Cb(1),b.nc("ngIf",t.passwordRequirementTooltips&&(null==t.passwordRequirementTooltips[e.fieldName]||null==t.passwordRequirementTooltips[e.fieldName].validators?null:t.passwordRequirementTooltips[e.fieldName].validators.length)>0),b.Cb(1),b.nc("ngIf",t.passwordRequirementTooltips&&(null==t.passwordRequirementTooltips[e.fieldName]||null==t.passwordRequirementTooltips[e.fieldName].validators?null:t.passwordRequirementTooltips[e.fieldName].validators.length)>0),b.Cb(1),b.nc("ngIf",t.passwordRequirementTooltips&&0===(null==t.passwordRequirementTooltips[e.fieldName]||null==t.passwordRequirementTooltips[e.fieldName].rules?null:t.passwordRequirementTooltips[e.fieldName].rules.length)&&0===(null==t.passwordRequirementTooltips[e.fieldName]||null==t.passwordRequirementTooltips[e.fieldName].validators?null:t.passwordRequirementTooltips[e.fieldName].validators.length))}}function Fs(e,t){if(1&e&&(b.Sb(0),b.Ub(1,"thy-form-layout-row",50),b.Ub(2,"div",20),b.Ub(3,"div",51),b.Oc(4),b.Mc(5,ws,2,1,"span",52),b.Mc(6,Cs,2,1,"span",53),b.Oc(7,") "),b.Tb(),b.Tb(),b.Sb(8,22),b.Mc(9,Ts,2,1,"button",54),b.Rb(),b.Tb(),b.Mc(10,Ds,5,5,"ng-template",null,55,b.Nc),b.Rb()),2&e){const e=t.$implicit,s=b.Ac(11),i=b.fc(3);b.Cb(1),b.nc("labelText",e.fieldDisplayName)("showActions",!0)("alignLabelTop",!0),b.Cb(2),b.nc("thyTooltipTemplate",s),b.Cb(1),b.Qc("",e.passwordRequirementName," \xa0 ("),b.Cb(1),b.nc("ngIf",e.isCustom),b.Cb(1),b.nc("ngIf",!e.isCustom),b.Cb(3),b.nc("ngIf",i.canEditPasswordRequirements)}}function Us(e,t){if(1&e&&(b.Ub(0,"thy-form-layout",38),b.gc(1,"async"),b.gc(2,"ssLocale"),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Ub(5,"thy-form-layout-row",39),b.gc(6,"async"),b.gc(7,"ssLocale"),b.gc(8,"async"),b.gc(9,"ssLocale"),b.Ub(10,"div",20),b.Ub(11,"div",40),b.gc(12,"async"),b.gc(13,"ssLocale"),b.Ub(14,"i"),b.Mc(15,fs,2,0,"span",41),b.Mc(16,vs,2,0,"span",42),b.Pb(17,"br"),b.Mc(18,ys,2,0,"span",43),b.Mc(19,Ss,2,0,"span",44),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Mc(20,Fs,12,8,"ng-container",45),b.Tb()),2&e){const e=b.fc(2);b.nc("summaryTitle",b.hc(1,13,b.hc(2,15,"password-requirements")))("summaryDescription",b.hc(3,17,b.hc(4,19,"password-requirement-summary")))("showBorder",!0),b.Cb(5),b.nc("labelText",b.hc(6,21,b.hc(7,23,"validation")))("labelTooltip",b.hc(8,25,b.hc(9,27,"password-validation-explanation")))("showActions",!1)("alignLabelTop",!0),b.Cb(6),b.nc("matTooltip",b.hc(12,29,b.hc(13,31,"password-validation-on-template"))),b.Cb(4),b.nc("ngIf",e.secretSecurity.passwordRequirements.validateOnCreate),b.Cb(1),b.nc("ngIf",!e.secretSecurity.passwordRequirements.validateOnCreate),b.Cb(2),b.nc("ngIf",e.secretSecurity.passwordRequirements.validateOnEdit),b.Cb(1),b.nc("ngIf",!e.secretSecurity.passwordRequirements.validateOnEdit),b.Cb(1),b.nc("ngForOf",e.secretSecurity.passwordRequirements.requirements)}}const As=function(e){return{value:e}};function Es(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",19),b.Sb(1,20),b.Pb(2,"template",21),b.Rb(),b.Sb(3,22),b.Ub(4,"button",68),b.bc("click",function(){return b.Ec(e),b.fc(2).editField("webLauncherRequiresIncognitoMode")}),b.Oc(5,"Edit"),b.Tb(),b.Rb(),b.Tb()}if(2&e){b.fc();const e=b.Ac(51),t=b.fc();b.nc("thyFormLayoutRowDefinition",t.secretSecurity.webLauncherRequiresIncognitoMode)("showActions",t.hasEditSecurity&&!t.secretSecurity.webLauncherRequiresIncognitoMode.readOnly),b.Cb(2),b.nc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.sc(4,As,t.otherForm.value.webLauncherRequiresIncognitoMode))}}const Rs=function(e){return["/admin/doublelock/detail/",e]};function Ns(e,t){if(1&e&&(b.Ub(0,"a",73),b.Oc(1),b.Tb()),2&e){const e=b.fc(4);b.nc("routerLink",b.sc(2,Rs,e.secretSecurity.doubleLockId.value)),b.Cb(1),b.Pc(e.secretSecurity.doubleLockName.value)}}function Ls(e,t){if(1&e&&(b.Ub(0,"span",74),b.Oc(1),b.Tb()),2&e){const e=b.fc(4);b.Cb(1),b.Pc(e.secretSecurity.doubleLockName.value)}}function Vs(e,t){if(1&e&&(b.Sb(0,36),b.Oc(1," \xa0( "),b.Mc(2,Ns,2,4,"a",71),b.Mc(3,Ls,2,1,"span",72),b.Oc(4," ) "),b.Rb()),2&e){const e=b.fc(3);b.Cb(2),b.nc("ngIf",e.canManageDoubleLocks),b.Cb(1),b.nc("ngIf",!e.canManageDoubleLocks)}}function qs(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",19),b.Mc(1,Vs,5,2,"ng-container",69),b.Sb(2,20),b.Pb(3,"template",21),b.Rb(),b.Sb(4,22),b.Ub(5,"button",70),b.bc("click",function(){return b.Ec(e),b.fc(2).editDoubleLock()}),b.Oc(6,"Edit"),b.Tb(),b.Rb(),b.Tb()}if(2&e){b.fc();const e=b.Ac(51),t=b.fc();b.nc("thyFormLayoutRowDefinition",t.secretSecurity.isDoubleLock)("showActions",t.hasEditSecurity),b.Cb(1),b.nc("ngIf",t.secretSecurity.isDoubleLock.value),b.Cb(2),b.nc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.sc(5,As,t.secretSecurity.isDoubleLock.value))}}function Gs(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",19),b.Sb(1,20),b.Pb(2,"template",21),b.Rb(),b.Sb(3,22),b.Ub(4,"button",75),b.bc("click",function(){return b.Ec(e),b.fc(2).editField("proxyEnabled")}),b.Oc(5,"Edit"),b.Tb(),b.Rb(),b.Tb()}if(2&e){b.fc();const e=b.Ac(51),t=b.fc();b.nc("thyFormLayoutRowDefinition",t.secretSecurity.proxyEnabled)("showActions",t.hasEditSecurity&&!t.secretSecurity.proxyEnabled.readOnly),b.Cb(2),b.nc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.sc(4,As,t.otherForm.value.proxyEnabled))}}function zs(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",19),b.Sb(1,20),b.Pb(2,"template",21),b.Rb(),b.Sb(3,22),b.Ub(4,"button",76),b.bc("click",function(){return b.Ec(e),b.fc(2).editField("sessionRecordingEnabled")}),b.Oc(5,"Edit"),b.Tb(),b.Rb(),b.Tb()}if(2&e){b.fc();const e=b.Ac(51),t=b.fc();b.nc("thyFormLayoutRowDefinition",t.secretSecurity.sessionRecordingEnabled)("showActions",t.hasEditSecurity&&!t.secretSecurity.sessionRecordingEnabled.readOnly),b.Cb(2),b.nc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.sc(4,As,t.otherForm.value.sessionRecordingEnabled))}}function Bs(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",19),b.Sb(1,20),b.Pb(2,"template",21),b.Rb(),b.Sb(3,22),b.Ub(4,"button",77),b.bc("click",function(){return b.Ec(e),b.fc(2).editField("hideLauncherPassword")}),b.Oc(5,"Edit"),b.Tb(),b.Rb(),b.Tb()}if(2&e){b.fc();const e=b.Ac(51),t=b.fc();b.nc("thyFormLayoutRowDefinition",t.secretSecurity.hideLauncherPassword)("showActions",t.hasEditSecurity&&!t.secretSecurity.hideLauncherPassword.readOnly),b.Cb(2),b.nc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.sc(4,As,t.otherForm.value.hideLauncherPassword))}}function js(e,t){1&e&&(b.Ub(0,"div"),b.Oc(1,"Owners Unrestricted"),b.Tb())}function Ws(e,t){1&e&&b.Pb(0,"span",83)}function Hs(e,t){1&e&&b.Pb(0,"span",84)}function Ks(e,t){if(1&e&&(b.Ub(0,"div"),b.Mc(1,js,2,0,"div",3),b.Ub(2,"div"),b.Oc(3),b.Mc(4,Ws,1,0,"span",81),b.Mc(5,Hs,1,0,"span",82),b.Tb(),b.Tb()),2&e){const e=b.fc(4);b.Cb(1),b.nc("ngIf",e.secretSecurity.allowOwnersUnrestrictedSshCommands.value),b.Cb(2),b.Qc("",e.secretSecurity.restrictedSshCommandCount," "),b.Cb(1),b.nc("ngIf",1===e.secretSecurity.restrictedSshCommandCount),b.Cb(1),b.nc("ngIf",1!==e.secretSecurity.restrictedSshCommandCount)}}function Qs(e,t){if(1&e&&(b.Ub(0,"div"),b.Ub(1,"div"),b.Pb(2,"span",85),b.Oc(3),b.Tb(),b.Ub(4,"div"),b.Pb(5,"span",86),b.Oc(6),b.Tb(),b.Ub(7,"div"),b.Pb(8,"span",87),b.Oc(9),b.Tb(),b.Tb()),2&e){const e=b.fc(4);b.Cb(3),b.Qc(": ",e.restrictSshCommandsOwnerPermission,""),b.Cb(3),b.Qc(": ",e.restrictSshCommandsEditPermission,""),b.Cb(3),b.Qc(": ",e.restrictSshCommandsViewPermission,"")}}function $s(e,t){if(1&e&&(b.Sb(0),b.Pb(1,"div",80),b.Mc(2,Ks,6,4,"div",3),b.Mc(3,Qs,10,3,"div",3),b.Rb()),2&e){const e=b.fc(3);b.Cb(1),b.nc("ss-locale","SshCommandRestriction"+e.secretSecurity.commandRestrictionType.value),b.Cb(1),b.nc("ngIf","AllowedMenu"===e.secretSecurity.commandRestrictionType.value),b.Cb(1),b.nc("ngIf","BlockedList"===e.secretSecurity.commandRestrictionType.value)}}function Zs(e,t){1&e&&b.Pb(0,"span",88)}function Ys(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",89),b.bc("click",function(){return b.Ec(e),b.fc(3).editRestrictSshCommands()}),b.Oc(1,"Edit"),b.Tb()}}function Js(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",19),b.Sb(1,20),b.Mc(2,$s,4,3,"ng-container",3),b.Mc(3,Zs,1,0,"span",78),b.Rb(),b.Sb(4,22),b.Mc(5,Ys,2,0,"button",79),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretSecurity.restrictSshCommands)("showActions",e.hasEditSecurity&&!e.secretSecurity.hideLauncherPassword.readOnly),b.Cb(2),b.nc("ngIf",e.secretSecurity.restrictSshCommands.value),b.Cb(1),b.nc("ngIf",!e.secretSecurity.restrictSshCommands.value),b.Cb(2),b.nc("ngIf",e.hasEditSecurity&&!e.secretSecurity.restrictSshCommands.readOnly)}}function Xs(e,t){1&e&&(b.Ub(0,"span",91),b.Oc(1,"Yes"),b.Tb())}function ei(e,t){1&e&&(b.Ub(0,"span",88),b.Oc(1,"No"),b.Tb())}function ti(e,t){if(1&e&&(b.Mc(0,Xs,2,0,"span",90),b.Mc(1,ei,2,0,"span",78)),2&e){const e=t.value;b.nc("ngIf",e),b.Cb(1),b.nc("ngIf",!e)}}function si(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",2),b.Mc(1,as,3,3,"pre",3),b.Ub(2,"form",4),b.Ub(3,"thy-form-layout",5),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("checkout",t.checkoutForm)}),b.gc(4,"async"),b.gc(5,"ssLocale"),b.gc(6,"async"),b.gc(7,"ssLocale"),b.Ub(8,"thy-form-layout-row",6),b.gc(9,"async"),b.gc(10,"ssLocale"),b.Pb(11,"thy-form-boolean",7),b.Tb(),b.Mc(12,ps,7,9,"thy-form-layout-row",8),b.Mc(13,bs,5,7,"thy-form-layout-row",9),b.Ub(14,"thy-form-layout-button-row",10),b.bc("save",function(){return b.Ec(e),b.fc().saveCheckout()})("cancel",function(){return b.Ec(e),b.fc().formsService.disableEditMode()}),b.Tb(),b.Tb(),b.Tb(),b.Pb(15,"ss-input-validation-message",11),b.Ub(16,"form",4),b.Ub(17,"thy-form-layout",12),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("approval",t.approvalForm)}),b.gc(18,"async"),b.gc(19,"ssLocale"),b.gc(20,"async"),b.gc(21,"ssLocale"),b.Ub(22,"thy-form-layout-row",6),b.gc(23,"async"),b.gc(24,"ssLocale"),b.Pb(25,"thy-form-select",13),b.Tb(),b.Mc(26,gs,4,4,"thy-form-layout-row",9),b.Pb(27,"ss-approval-groups",14,15),b.Ub(29,"thy-form-layout-button-row",16),b.bc("save",function(){return b.Ec(e),b.fc().saveApproval()})("cancel",function(){return b.Ec(e),b.fc().formsService.disableEditMode()}),b.Tb(),b.Tb(),b.Tb(),b.Mc(30,Us,21,33,"thy-form-layout",17),b.Ub(31,"form",4),b.Ub(32,"thy-form-layout",18),b.gc(33,"async"),b.gc(34,"ssLocale"),b.gc(35,"async"),b.gc(36,"ssLocale"),b.Ub(37,"thy-form-layout-row",19),b.Sb(38,20),b.Pb(39,"template",21),b.Rb(),b.Sb(40,22),b.Ub(41,"button",23),b.bc("click",function(){return b.Ec(e),b.fc().editField("requiresComment")}),b.Oc(42,"Edit"),b.Tb(),b.Rb(),b.Tb(),b.Mc(43,Es,6,6,"thy-form-layout-row",9),b.Mc(44,qs,7,7,"thy-form-layout-row",9),b.Mc(45,Gs,6,6,"thy-form-layout-row",9),b.Mc(46,zs,6,6,"thy-form-layout-row",9),b.Mc(47,Bs,6,6,"thy-form-layout-row",9),b.Mc(48,Js,6,5,"thy-form-layout-row",9),b.Tb(),b.Tb(),b.Pb(49,"div",24),b.Mc(50,ti,2,2,"ng-template",null,25,b.Nc),b.Tb()}if(2&e){const e=b.Ac(51),t=b.fc();b.Cb(1),b.nc("ngIf",t.errorSummary),b.Cb(1),b.nc("formGroup",t.checkoutForm),b.Cb(1),b.nc("summaryTitle",b.hc(4,41,b.hc(5,43,"check-out")))("summaryDescription",b.hc(6,45,b.hc(7,47,"check-out-description")))("showBorder",!0)("disableEdit",!t.hasEditSecurity||t.secretSecurity.checkOutEnabled.readOnly),b.Cb(5),b.nc("labelText",b.hc(9,49,b.hc(10,51,"require-check-out")))("thyFormLayoutRowDefinition",t.secretSecurity.checkOutEnabled)("showActions",!1),b.Cb(4),b.nc("ngIf",t.checkoutForm.controls.checkOutEnabled.value),b.Cb(1),b.nc("ngIf",t.checkoutForm.controls.checkOutEnabled.value),b.Cb(2),b.nc("control",t.approvalForm.controls.approvers),b.Cb(1),b.nc("formGroup",t.approvalForm),b.Cb(1),b.nc("summaryTitle",b.hc(18,53,b.hc(19,55,"approval")))("summaryDescription",b.hc(20,57,b.hc(21,59,"approval-description")))("showBorder",!0)("disableEdit",!t.hasEditSecurity),b.Cb(5),b.nc("labelText",b.hc(23,61,b.hc(24,63,"require-approval")))("thyFormLayoutRowDefinition",t.secretSecurity.requireApprovalType)("showActions",!1),b.Cb(3),b.nc("options",t.approvalOptions),b.Cb(1),b.nc("ngIf","None"!==t.approvalForm.controls.requireApprovalType.value),b.Cb(1),b.nc("editMode",t.approvalEditMode)("selectedApprovers",t.secretSecurity.approvers)("form",t.approvalForm)("showApprovers","None"!==t.approvalForm.controls.requireApprovalType.value&&"0"===t.approvalForm.controls.approvalWorkflow.value),b.Cb(3),b.nc("ngIf",t.secretSecurity.passwordRequirements),b.Cb(1),b.nc("formGroup",t.otherForm),b.Cb(1),b.nc("summaryTitle",b.hc(33,65,b.hc(34,67,"other-security")))("summaryDescription",b.hc(35,69,b.hc(36,71,"other-security-description")))("showBorder",!0),b.Cb(5),b.nc("thyFormLayoutRowDefinition",t.secretSecurity.requiresComment)("showActions",t.hasEditSecurity&&!t.secretSecurity.requiresComment.readOnly),b.Cb(2),b.nc("ngTemplateOutlet",e)("ngTemplateOutletContext",b.sc(73,As,t.otherForm.value.requiresComment)),b.Cb(4),b.nc("ngIf",!t.secretSecurity.webLauncherRequiresIncognitoMode.hidden),b.Cb(1),b.nc("ngIf",!t.secretSecurity.isDoubleLock.hidden),b.Cb(1),b.nc("ngIf",!t.secretSecurity.proxyEnabled.hidden),b.Cb(1),b.nc("ngIf",!t.secretSecurity.sessionRecordingEnabled.hidden),b.Cb(1),b.nc("ngIf",!t.secretSecurity.hideLauncherPassword.hidden),b.Cb(1),b.nc("ngIf",!t.secretSecurity.restrictSshCommands.hidden)}}let ii=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l,d,h,u){this._router=e,this._secretService=t,this._stateService=s,this._userService=i,this._dialogService=n,this._log=r,this._errorService=c,this._localizationService=a,this._doubleLockService=l,this._secretTemplateService=d,this.ies=h,this.formsService=u,this.secretState=null,this.hasEditSecurity=!1,this.canEditPasswordRequirements=!1,this.secretSecurity=null,this.formInputType=A.a,this.errorSummary=null,this.templateCustomTip="Template / Custom",this.hasEdit=!1,this.checkoutEditMode=!1,this.approvalEditMode=!1,this.checkoutForm=new o.k({checkOutEnabled:new o.h("",o.C.required),checkOutIntervalMinutes:new o.h,checkOutChangePasswordEnabled:new o.h,checkoutTimeType:new o.h}),this.approvalForm=new o.k({requireApprovalType:new o.h,approvers:new o.e([]),approvalWorkflow:new o.h,workflows:new o.e([])}),this.otherForm=new o.k({requiresComment:new o.h,webLauncherRequiresIncognitoMode:new o.h,isDoubleLock:new o.h,sessionRecordingEnabled:new o.h,hideLauncherPassword:new o.h,proxyEnabled:new o.h,restrictSshCommands:new o.h}),this.isLoading=!0,this.approvalOptions=[{value:"None",text:"No"},{value:"RequireApproval",text:"Standard (editors and approvers do not need approval)"},{value:"RequireEditorsApproval",text:"Standard including Editors (Owners and approvers do not need approval)"},{value:"RequireEveryoneApproval",text:"Everyone (including owners and approvers)"}],this.approvalWorkflowOptions=[],this.validatePasswordTip=null,this.passwordRequirementTooltips={},this.canManageDoubleLocks=!1,this.updateApprovers=!1,this._passwordRequirementDropDownOptions=null,this.LayoutRowHeight=lt.c,this.LabelColumnWidth=lt.a,this.requireApprovalTypeObserver={next:e=>{this.updateApprovers&&this.updateApproversValidity()},error:e=>{},complete:()=>{}},this.approvalWorkflowObserver={next:e=>{-1==+e&&window.open("../app/#/workflow/templates","_blank"),this.updateApprovers&&this.updateApproversValidity()},error:e=>{},complete:()=>{}}}ngOnInit(){this._localizeDropDowns(),this.validatePasswordTip=this._localizationService.getCachedPageMessage("secretdetail","validate-password-tip"),this.templateCustomTip=this._localizationService.getCachedPageMessage("secretdetail","template-custom-description"),this.approvalForm.controls.requireApprovalType.valueChanges.pipe(Object(M.b)(this)).subscribe(this.requireApprovalTypeObserver),this.approvalForm.controls.approvalWorkflow.valueChanges.pipe(Object(M.b)(this)).subscribe(this.approvalWorkflowObserver),this.approvalForm.setValidators(this.validateApprovalWorkflow.bind(this.approvalForm)),this._userService.currentUserHasPermission("View DoubleLock Keys").pipe(Object(h.a)()).subscribe(e=>{this.canManageDoubleLocks=e}),this.formsService.statusChanges.pipe(Object(M.b)(this)).subscribe(e=>{"checkout"===e.editSection?this.checkoutEditMode=e.isEditMode:"approval"===e.editSection&&(this.approvalEditMode=e.isEditMode)})}ngOnChanges(e){e.secretState&&this._loadOnChange()}setValueWithDirty(e,t,s){e.disabled||this.ies.isEditMode(s)&&(e.setValue(t),e.markAsDirty(),e.updateValueAndValidity())}cancelForm(){this.errorSummary=null,this.secretSecurity.approvers=this.deepCopy(this.secretSecurity.approvers),this.approvalForm.markAsPristine()}deepCopy(e){return JSON.parse(JSON.stringify(e))}saveOtherSingle(e){const t=this.ies.createUpdateModel(this.otherForm);return this._secretService.updateSecretDetailSecurityGeneral(this.secretState.id,t).pipe(Object(h.a)(),Object(u.a)(e=>({success:!0,context:e})))}editDoubleLock(){this._doubleLockService.promptDoubleLockPassword().pipe(Object(h.a)()).subscribe(e=>{e.passwordCached?this._dialogService.open(Zt.a,{data:{secretId:this.secretState.id}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{this._loadSecret(!0)}):e.userHasPassword?e.userHasPassword&&this._dialogService.open(Qt.a,{data:{action:Ke.a.Enter}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&this._dialogService.open(Zt.a,{data:{secretId:this.secretState.id}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{this._loadSecret(!0)})}):this._dialogService.open(Qt.a,{data:{action:Ke.a.Create}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&this._dialogService.open(Zt.a,{data:{secretId:this.secretState.id}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{this._loadSecret(!0)})})})}checkSaveError(e){const t=this._errorService.getErrorMessage(e);return"API_SecretRequiresCheckout"===t.errorCode||"API_SecretAccessApprovalDenied"===t.errorCode||"API_ValidateSecretAccessCommentRequired"===t.errorCode?(this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url]),{cancelModal:!0}):{cancelModal:!1}}editField(e){const t={dialogTitle:this._localizationService.getCachedPageMessage("secretdetail","edit-security"),form:this.otherForm,fieldName:e,viewField:this.secretSecurity[e],formInputType:A.a.Boolean,saveForm:()=>this.saveOtherSingle(this.otherForm),saveErrorHandler:this.checkSaveError.bind(this)};this._dialogService.open($t.a,{data:t}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{e&&(this.secretSecurity=e.context,this._assignForm(!1))})}savePasswordRequirement(e){let t=parseInt(e.value.passwordRequirement,10);return-1===t&&(t=null),this._secretService.updatePasswordRequirement(this.secretState.id,e.value.fieldNameSlug,t).pipe(Object(h.a)(),Object(u.a)(e=>({success:!0})))}_updatePasswordRequirementDisplay(e){let t=parseInt(e.value.passwordRequirement,10);if(-1===t&&(t=null),e.value.passwordRequirement>0){const t=this.secretSecurity.passwordRequirements.requirements.find(t=>t.fieldName===e.value.fieldNameSlug);t.passwordRequirementId=parseInt(e.value.passwordRequirement,10),t.isCustom=!0,t.passwordRequirementName=this._passwordRequirementDropDownOptions.find(t=>t.value===e.value.passwordRequirement).text,this._updatePasswordRequirementTooltop(t.fieldName)}else this._loadSecret(!1)}editPasswordRequirement(e){null===this._passwordRequirementDropDownOptions?this._secretTemplateService.getPasswordRequirements().pipe(Object(h.a)()).subscribe(t=>{this._passwordRequirementDropDownOptions=[],this._passwordRequirementDropDownOptions.push({value:-1,text:this._localizationService.getCachedPageMessage("secretdetail","use-template")});for(let e=0;e<t.length;e++)this._passwordRequirementDropDownOptions.push({value:t[e].passwordRequirementId,text:t[e].passwordRequirementName});this._editPassword(e)}):this._editPassword(e)}_editPassword(e){const t=new o.k({passwordRequirement:new o.h(""),fieldNameSlug:new o.h(e.fieldName)});t.controls.passwordRequirement.setValue(e.isCustom?e.passwordRequirementId:-1);const s={dialogTitle:this._localizationService.getCachedPageMessage("secretdetail","edit-password-requirement"),form:t,fieldName:"passwordRequirement",label:this._localizationService.getCachedPageMessage("secretdetail","password-requirement"),description:this._localizationService.getCachedPageMessage("secretdetail","password-requirement-description"),formInputType:A.a.DropDown,saveForm:()=>this.savePasswordRequirement(t),dropDownOptions:this._passwordRequirementDropDownOptions};this._dialogService.open($t.a,{data:s}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{e&&this._updatePasswordRequirementDisplay(e.form)})}editRestrictSshCommands(){this._dialogService.open(ns,{data:{secretId:this.secretState.id,secretSecurity:this.secretSecurity},width:F.c.Large}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&this._loadSecret(!1)})}loadEditForm(e){this._loadSecret(!0)}_loadOnChange(){this._loadSecret(!1,!0),this._userService.currentUserHasPermission("Administer Custom Password Requirements").pipe(Object(h.a)()).subscribe(e=>{this.canEditPasswordRequirements=e&&this._secretService.hasAction(D.W.EditSecurity,this.secretState)})}_loadSecret(e,t=!1){this.isLoading=!0,this.hasEditSecurity=this._secretService.hasAction(D.W.EditSecurity,this.secretState),this._secretService.getSecretDetailSecurity(this.secretState.id,this.hasEditSecurity).pipe(Object(h.a)()).subscribe({next:s=>{this.secretSecurity=s,this._loadSecretSshRestrictions(),this._assignForm(e,t),this.isLoading=!1},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_SecretRequiresCheckout"!==t.errorCode&&"API_SecretAccessApprovalDenied"!==t.errorCode&&"API_ValidateSecretAccessCommentRequired"!==t.errorCode)throw e;this.ies.disableEditMode(null,!1),this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])}})}_loadSecretSshRestrictions(){this.secretSecurity.restrictSshCommands&&!this.secretSecurity.restrictSshCommands.hidden&&this._secretService.getSshRestrictedCommands(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{var t,s,i,o,n,r;this.restrictSshCommandsViewPermission=null!==(s=null===(t=e.sshCommandBlocklists.filter(e=>10064===e.rolePermissionId).shift())||void 0===t?void 0:t.sshCommandBlocklistName)&&void 0!==s?s:"Unrestricted",this.restrictSshCommandsEditPermission=null!==(o=null===(i=e.sshCommandBlocklists.filter(e=>10065===e.rolePermissionId).shift())||void 0===i?void 0:i.sshCommandBlocklistName)&&void 0!==o?o:"Unrestricted",this.restrictSshCommandsOwnerPermission=null!==(r=null===(n=e.sshCommandBlocklists.filter(e=>10066===e.rolePermissionId).shift())||void 0===n?void 0:n.sshCommandBlocklistName)&&void 0!==r?r:"Unrestricted"})}_localizeDropDowns(){this.approvalOptions[0].text=this._localizationService.getCachedPageMessage("common","no"),this.approvalOptions[1].text=this._localizationService.getCachedPageMessage("secretdetail","standard-approval"),this.approvalOptions[2].text=this._localizationService.getCachedPageMessage("secretdetail","standard-approval-include-editors"),this.approvalOptions[3].text=this._localizationService.getCachedPageMessage("secretdetail","standard-approval-everyone")}initApprovalOptions(){if(this.secretSecurity.requireApprovalType.readOnly)return;const e=this.secretSecurity.availableRequireApprovalTypes.value;this.approvalOptions=[],e.indexOf("None")>-1&&this.approvalOptions.push({value:"None",text:this._localizationService.getCachedPageMessage("common","no")}),e.indexOf("RequireApproval")>-1&&this.approvalOptions.push({value:"RequireApproval",text:this._localizationService.getCachedPageMessage("secretdetail","standard-approval")}),e.indexOf("RequireEditorsApproval")>-1&&this.approvalOptions.push({value:"RequireEditorsApproval",text:this._localizationService.getCachedPageMessage("secretdetail","standard-approval-include-editors")}),e.indexOf("RequireEveryoneApproval")>-1&&this.approvalOptions.push({value:"RequireEveryoneApproval",text:this._localizationService.getCachedPageMessage("secretdetail","standard-approval-everyone")})}initApprovalWorkflowOptions(){if(this.approvalWorkflowOptions=[{value:"0",text:this._localizationService.getCachedPageMessage("secretdetail","create-basic-workflow")}],!this.secretSecurity.approvers.readOnly||"0"!==this.secretSecurity.approvalWorkflow.value){this.approvalWorkflowOptions.push({value:"-1",text:this._localizationService.getCachedPageMessage("secretdetail","go-to-workflow-designer")});const e=this.secretSecurity.approvalWorkflowOptions.value,t=e.find(e=>e.workflowTemplateId.toString()===this.secretSecurity.approvalWorkflow.value),s=e.filter(e=>e.workflowTemplateId.toString()!==this.secretSecurity.approvalWorkflow.value);if(void 0!==t){let e=t.name;this.ies.isEditMode("approval")&&!t.active&&(e=`(${this._localizationService.getCachedPageMessage("common","inactive")}) ${t.name}`),this.approvalWorkflowOptions.push({value:t.workflowTemplateId.toString(),text:e})}s.filter(e=>e.active).map(e=>({value:e.workflowTemplateId.toString(),text:e.name})).forEach(e=>this.approvalWorkflowOptions.push(e))}for(const e of Object.keys(this.approvalForm.controls))if(this.approvalForm.controls.hasOwnProperty(e)){const t=this.approvalForm.get(e);t.dirty&&t.markAsPristine()}}saveCheckout(){const e=this.ies.createUpdateModel(this.checkoutForm);this.checkoutForm.controls.checkoutTimeType.pristine||"Default"===this.checkoutForm.value.checkoutTimeType&&(e.CheckOutIntervalMinutes={value:null,dirty:!0}),delete e.checkoutTimeType,this.formsService.isSaving=!0,this._secretService.updateSecretDetailSecurityCheckout(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("saved security checkout",e),this.formsService.disableEditMode(),this.secretSecurity=e,this._assignForm(!1)},error:e=>{this.formsService.isSaving=!1;const t=this._errorService.getErrorMessage(e);"API_SecretRequiresCheckout"===t.errorCode||"API_SecretAccessApprovalDenied"===t.errorCode||"API_ValidateSecretAccessCommentRequired"===t.errorCode?(this.formsService.disableEditMode(),this._router.navigate(["secret/checkout",this.secretState.id.toString()])):(this._log.Error("Error saving checkout",this.checkoutForm.value,e),this.ies.assignErrorToFormGroup(this.checkoutForm,e))}})}saveApproval(){this.ies.isSaving=!0;const e=this.ies.createUpdateModel(this.approvalForm);if(e.requireApprovalType&&"None"===e.requireApprovalType.value)e.approvers=this.setApproversUpdate(null);else{const t=this.approvalForm.controls.approvalWorkflow.value;if(t&&+t>0)e.workflowTemplateId=+t<1?null:{value:+t,dirty:!0};else{const t=this.approvalForm.controls.approvers.value?this.approvalForm.controls.approvers.value.map(e=>e.id):null;t&&(e.approvers=this.setApproversUpdate(t))}}this._secretService.updateSecretDetailSecurityApproval(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved approval",e),this.formsService.disableEditMode(),this.secretSecurity=e,null!==this.secretSecurity.approvalWorkflow.value?this.secretSecurity.approvalWorkflow.value=this.secretSecurity.approvalWorkflow.value.workflowTemplateId.toString():null===this.secretSecurity.approvalWorkflow.value&&null!==this.secretSecurity.approvers.value&&(this.secretSecurity.approvalWorkflow.value="0"),this._assignForm(!1),this.ies.isSaving=!1},error:t=>{var s,i,o,n,r;this.ies.isSaving=!1,"API_SecretAccessApprovalDenied"===this._errorService.getErrorMessage(t).errorCode?(this.formsService.disableEditMode(),this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])):(this._log.Error("Error saving approval",this.checkoutForm.value,t),this.ies.assignErrorToFormGroup(this.approvalForm,t,!1),("0"!==e.approvalWorkflow||"0"!==this.approvalForm.controls.approvalWorkflow.value)&&(null===(o=null===(i=null===(s=null==t?void 0:t.error)||void 0===s?void 0:s.modelState)||void 0===i?void 0:i.approvers)||void 0===o?void 0:o.length)>0&&(this.approvalForm.setErrors({serverValidationError:{valid:!1,message:null===(r=null===(n=null==t?void 0:t.error)||void 0===n?void 0:n.modelState)||void 0===r?void 0:r.approvers[0]}}),this.ies.showValidationMessages=!0),this.approvalForm.controls.approvers.statusChanges.emit(this.approvalForm.controls.approvers.status),this.updateApprovers=!0)}})}saveOther(){const e=this.ies.createUpdateModel(this.otherForm);this._secretService.updateSecretDetailSecurityGeneral(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved security other",e),this.ies.disableEditMode("otherForm",!1),this.secretSecurity=e,this._assignForm(!1,!1)},error:e=>{this._log.Error("Error saving security other",this.checkoutForm.value,e),this.ies.assignErrorToFormGroup(this.otherForm,e)}})}validateApprovalWorkflow(e){if(!e)return{approvalWorkflow:"Empty form"};const t=e.value.approvers,s=e.value.approvalWorkflow;return"None"===e.get("requireApprovalType").value?null:0===t.length&&+s<1?{approvalWorkflow:"At least one approver needs to be specified"}:null}_assignForm(e,t=!1){this.secretSecurity.approvalWorkflow.value&&this.secretSecurity.approvalWorkflow.value.workflowTemplateId?this.secretSecurity.approvalWorkflow.value=this.secretSecurity.approvalWorkflow.value.workflowTemplateId.toString():null===this.secretSecurity.approvalWorkflow.value&&null!==this.secretSecurity.approvers.value&&(this.secretSecurity.approvalWorkflow.value="0"),this.ies.patchViewModel(this.checkoutForm,this.secretSecurity),this.checkoutForm.controls.checkoutTimeType.setValue(this.secretSecurity.checkOutIntervalMinutes&&!this.secretSecurity.checkOutIntervalMinutes.value?"Default":"Custom"),this.secretSecurity.checkOutIntervalMinutes.readOnly&&this.checkoutForm.controls.checkoutTimeType.disable(),this.ies.patchViewModel(this.approvalForm,this.secretSecurity),this.ies.patchViewModel(this.otherForm,this.secretSecurity),e&&this.initApprovalOptions(),this.initApprovalWorkflowOptions(),this._setupPasswordRequirementTooltips(),t||this._stateService.events.navigationEvents.tabBarEvent.next({name:"security-updated"})}setApproversUpdate(e){return this.secretSecurity.approvers.readOnly?null:{dirty:!0,value:e}}updateApproversValidity(){this.approvalForm.controls.approvers.updateValueAndValidity(),this.updateApprovers=!1}_setupPasswordRequirementTooltips(){if(this.secretSecurity.passwordRequirements&&this.secretSecurity.passwordRequirements.requirements&&0!==this.secretSecurity.passwordRequirements.requirements.length)for(let e=0;e<this.secretSecurity.passwordRequirements.requirements.length;e++)this._updatePasswordRequirementTooltop(this.secretSecurity.passwordRequirements.requirements[e].fieldName)}_updatePasswordRequirementTooltop(e){this._secretService.validatePassword(this.secretState.id,e,{password:"",secretPasswordValidationFields:[]}).pipe(Object(h.a)()).subscribe(t=>{this.passwordRequirementTooltips[e]=t})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(a.V),b.Ob(a.cb),b.Ob(a.kb),b.Ob(E.c),b.Ob(a.fb),b.Ob(a.eb),b.Ob(a.F),b.Ob(a.r),b.Ob(a.W),b.Ob(a.B),b.Ob(l.k))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-security"]],inputs:{secretState:"secretState"},features:[b.Bb([],[a.B]),b.Ab],decls:2,vars:3,consts:[[3,"active","isFullscreen"],["class","full-height",4,"ngIf"],[1,"full-height"],[4,"ngIf"],[3,"formGroup"],["editSection","checkout","labelColumnWidth","medium","editSectionId","check-out",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],[3,"labelText","thyFormLayoutRowDefinition","showActions"],["formControlName","checkOutEnabled","editSection","checkout"],[3,"labelText","showActions",4,"ngIf"],[3,"thyFormLayoutRowDefinition","showActions",4,"ngIf"],["editSection","checkout",3,"save","cancel"],[3,"control"],["editSection","approval","editSectionId","check-out",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],["formControlName","requireApprovalType","editSection","approval",3,"options"],[3,"editMode","selectedApprovers","form","showApprovers"],["approvalGroups",""],["editSection","approval",3,"save","cancel"],[3,"summaryTitle","summaryDescription","showBorder",4,"ngIf"],["labelColumnWidth","large",3,"summaryTitle","summaryDescription","showBorder"],[3,"thyFormLayoutRowDefinition","showActions"],["value-column",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["action-column",""],["id","edit-require-comment","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],[1,"footerPush"],["yesNo",""],[3,"labelText","showActions"],[1,"width-100","checkout-radio-opton"],["name","checkoutTimeTypeDefault","inputValue","Default","formControlName","checkoutTimeType"],["ss-locale","default-interval",3,"click"],["class","formText",4,"ngIf"],["id","checkoutTimeTypeCustom","name","checkoutTimeType","inputValue","Custom","formControlName","checkoutTimeType"],["ss-locale","custom-interval",3,"click"],[1,"formText"],["formControlName","checkOutIntervalMinutes","editSection","checkout",3,"forceEditMode","viewField","type"],["formControlName","checkOutChangePasswordEnabled","editSection","checkout",3,"labelText"],["label-column",""],["formControlName","approvalWorkflow","editSection","approval",3,"options"],[3,"summaryTitle","summaryDescription","showBorder"],[3,"labelText","labelTooltip","showActions","alignLabelTop"],[3,"matTooltip"],["id","validate-create","ss-locale","validate-create",4,"ngIf"],["id","validate-create","ss-locale","do-not-validate-create",4,"ngIf"],["id","validate-edit","ss-locale","validate-edit",4,"ngIf"],["id","validate-edit","ss-locale","do-not-validate-edit",4,"ngIf"],[4,"ngFor","ngForOf"],["id","validate-create","ss-locale","validate-create"],["id","validate-create","ss-locale","do-not-validate-create"],["id","validate-edit","ss-locale","validate-edit"],["id","validate-edit","ss-locale","do-not-validate-edit"],[3,"labelText","showActions","alignLabelTop"],[1,"password-requirement-name",3,"thyTooltipTemplate"],["ss-locale","custom",3,"id",4,"ngIf"],["ss-localte","template",3,"id",4,"ngIf"],["class","link-button","ss-locale","edit","ss-page-name","common",3,"id","click",4,"ngIf"],["passwordTemplate",""],["ss-locale","custom",3,"id"],["ss-localte","template",3,"id"],["ss-locale","edit","ss-page-name","common",1,"link-button",3,"id","click"],["class","header","ss-locale","must-include",4,"ngIf"],["class","content",4,"ngIf"],["class","header","ss-locale","must-exclude",4,"ngIf"],["ss-locale","must-include",1,"header"],[1,"content"],["class","password-rule",4,"ngFor","ngForOf"],[1,"password-rule"],["ss-locale","must-exclude",1,"header"],["ss-locale","no-password-requirement-rules",1,"password-rule"],["id","edit-web-launcher-requires-incognito-mode","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["label-column","",4,"ngIf"],["id","edit-doublelock","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["class","break-word",3,"routerLink",4,"ngIf"],["class","break-word",4,"ngIf"],[1,"break-word",3,"routerLink"],[1,"break-word"],["id","edit-ssh-proxy","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["id","edit-session-recording","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["id","edit-hide-launcher-password","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["ss-locale","no","ss-page-name","common",4,"ngIf"],["id","edit-restrict-ssh","class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],[3,"ss-locale"],["ss-locale","SshCommandRestriction",4,"ngIf"],["ss-locale","SshCommandRestrictions",4,"ngIf"],["ss-locale","SshCommandRestriction"],["ss-locale","SshCommandRestrictions"],["ss-locale","Owner"],["ss-locale","Edit"],["ss-locale","View"],["ss-locale","no","ss-page-name","common"],["id","edit-restrict-ssh","ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],["ss-locale","yes","ss-page-name","common",4,"ngIf"],["ss-locale","yes","ss-page-name","common"]],template:function(e,t){1&e&&(b.Pb(0,"thy-loading-dimmer",0),b.Mc(1,si,52,75,"div",1)),2&e&&(b.nc("active",t.isLoading||!t.secretSecurity)("isFullscreen",!0),b.Cb(1),b.nc("ngIf",t.secretSecurity))},directives:[m.h,i.o,o.E,o.t,o.l,l.e,l.f,l.b,o.s,o.j,l.d,rs.a,l.h,cs.a,i.t,f.a,Jt.a,j.a,R.a,i.n,m.p,c.g],pipes:[i.b,bt.a,i.g],styles:[".checkout-radio-opton[_ngcontent-%COMP%]{margin-bottom:16px}.checkout-radio-opton[_ngcontent-%COMP%]:first-child{margin-top:8px}.removeLink[_ngcontent-%COMP%]{padding-right:14px}.single-edit-link[_ngcontent-%COMP%]{float:right;margin-right:-2px}.ui.grid[_ngcontent-%COMP%] > .row.password-row[_ngcontent-%COMP%]{padding-top:0}.password-rule[_ngcontent-%COMP%]{margin-bottom:4px}div.password-requirements[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:inline-block;width:40%}div.password-requirements[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{margin-left:50px}.password-requirement-name[_ngcontent-%COMP%]{max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}),e=Object(P.b)([Object(M.a)()],e),e})();var oi=s("aRgc"),ni=s("4mkw"),ri=s("y1ec");const ci=["grid"],ai=["detailModal"];function li(e,t){1&e&&b.Oc(0),2&e&&b.Qc(" ",t.context.item.recordingMessage," ")}function di(e,t){if(1&e&&(b.Ub(0,"div"),b.Oc(1),b.Tb()),2&e){const e=b.fc().item;b.Cb(1),b.Pc(e.recordingMessage)}}function hi(e,t){if(1&e&&(b.Ub(0,"div"),b.Ub(1,"a",15),b.Oc(2),b.Tb(),b.Tb()),2&e){const e=b.fc().item;b.Cb(1),b.nc("ssHref","~/SessionPlayback.aspx?session="+e.recordingSessionId),b.Cb(1),b.Pc(e.recordingMessage)}}function ui(e,t){if(1&e&&(b.Ub(0,"div"),b.Ub(1,"a",16),b.Oc(2,"View SSH Session Log"),b.Tb(),b.Tb()),2&e){const e=b.fc().item,t=b.fc();b.Cb(1),b.nc("ssHref","~/SSHSessionData.aspx?secretid="+t.secretId+"&AuditSecretId="+e.id)}}function pi(e,t){if(1&e&&(b.Mc(0,di,2,1,"div",14),b.Mc(1,hi,3,2,"div",14),b.Mc(2,ui,3,1,"div",14)),2&e){const e=t.item;b.nc("ngIf",e.recordingMessage&&!e.recordingSessionId),b.Cb(1),b.nc("ngIf",e.recordingMessage&&e.recordingSessionId),b.Cb(1),b.nc("ngIf",e.hasProxySessionData)}}function bi(e,t){if(1&e&&(b.Ub(0,"a"),b.Oc(1),b.Tb()),2&e){const e=t.item;b.Cb(1),b.Pc(e.ticketNumber)}}function mi(e,t){if(1&e&&(b.Ub(0,"div",22),b.Pb(1,"thy-form-boolean",23),b.gc(2,"async"),b.gc(3,"ssLocale"),b.Tb()),2&e){const e=b.fc(2);b.Cb(1),b.nc("showAsToggle",!0)("editMode",!0)("formControl",e.includePasswordChangeLogControl)("labelText",b.hc(2,4,b.hc(3,6,"display-passsword-log")))}}function gi(e,t){if(1&e&&(b.Ub(0,"div",17),b.Ub(1,"div",18),b.Oc(2),b.gc(3,"ssItemCount"),b.Tb(),b.Ub(4,"div",19),b.Pb(5,"ss-timezone-selector",20),b.Tb(),b.Mc(6,mi,4,8,"div",21),b.Tb()),2&e){const e=b.fc();b.Cb(2),b.Qc(" ",b.hc(3,3,e.totalRecords)," "),b.Cb(3),b.nc("showAsContextMenu",!0),b.Cb(1),b.nc("ngIf",e.canTogglePasswordChangeLog)}}function fi(e,t){if(1&e&&(b.Ub(0,"ss-layout-form",24),b.Ub(1,"ss-layout-form-row",25),b.Pb(2,"div",26),b.Ub(3,"div",27),b.Oc(4),b.gc(5,"ssDate"),b.Tb(),b.Tb(),b.Ub(6,"ss-layout-form-row",25),b.Pb(7,"div",28),b.Ub(8,"div",27),b.Oc(9),b.Tb(),b.Tb(),b.Ub(10,"ss-layout-form-row",25),b.Pb(11,"div",29),b.Ub(12,"div",27),b.Oc(13),b.Tb(),b.Tb(),b.Tb()),2&e){const e=b.fc();b.nc("noBottomMargin",!0),b.Cb(1),b.nc("showActions",!1),b.Cb(3),b.Rc(" ",e.selectedAudit.byUserDisplayName," (",b.hc(5,8,e.selectedAudit.dateRecorded),") "),b.Cb(2),b.nc("showActions",!1),b.Cb(3),b.Qc(" ",e.selectedAudit.actionForDisplay," "),b.Cb(1),b.nc("showActions",!1),b.Cb(3),b.Qc(" ",e.selectedAudit.notes," ")}}const vi=function(e){return{propertyName:"dateRecorded",displayName:"Date",displayNameLocale:"date",columnOrder:1,columnType:e,columnWidth:145,canExport:!0}},yi=function(){return{propertyName:"byUserDisplayName",displayName:"FullName",displayNameLocale:"full-name",columnOrder:2,canExport:!0}},Si=function(e){return{propertyName:"actionForDisplay",displayName:"Action",displayNameLocale:"action",columnOrder:3,canExport:!0,columnType:e}},wi=function(e){return{propertyName:"status",displayName:"Status",displayNameLocale:"status",showColumn:e,columnOrder:4,canExport:!0}},Ci=function(){return{propertyName:"notes",displayName:"Notes",displayNameLocale:"notes",columnOrder:5,canExport:!0}},Ti=function(e,t){return{propertyName:"recordingMessage",cellPopupTemplate:e,displayName:"Session Recording",displayNameLocale:"session-recording",template:t,columnOrder:6,canExport:!0,disableColumnSort:!0}},Oi=function(e,t){return{propertyName:"ticketNumber",displayName:"Ticket Number",displayNameLocale:"ticket-number",template:e,columnOrder:7,showColumn:t,canExport:!0}},Ii=function(e,t,s,i,o,n,r){return[e,t,s,i,o,n,r]};let _i=(()=>{let e=class{constructor(e,t,s,i){this._secretService=e,this.stateService=t,this._secretAuditService=s,this._cdr=i,this.secretState=null,this.canEdit=!1,this.headerCheckboxValue=!1,this.sortColumn="dateRecorded",this.isLoading=!1,this.results=null,this.includePasswordChangeLogControl=new o.h(!1),this.secretId=null,this.showticketColumn=!1,this.canTogglePasswordChangeLog=!1,this.downloadFileName="secret-audit",this.selectedAudit=null,this.columnType=oi.a,this.downloadData=e=>this.getDataDownload(e)}ngOnInit(){this.getDataMethod=this.loadData.bind(this),this.includePasswordChangeLogControl.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>this.grid.refreshData())}ngOnChanges(e){e.secretState&&this._initializeSecret()}loadData(e){return this.isLoading=!0,this._cdr.detectChanges(),this._secretAuditService.getAudit(this.secretId,e,this.includePasswordChangeLogControl.value).pipe(Object(h.a)(),Object(U.a)(e=>{this._checkTicketNumberVisibility(e.records),this.totalRecords=e.total,this.isLoading=!1,this._cdr.detectChanges()}))}rowClick(e){this.selectedAudit=e,this.detailModal.show()}getDataDownload(e){let t=e.startRecord,s=e.endRecord;return e.allRecords&&(t=0,s=this.totalRecords),this._secretAuditService.getAudit(this.secretId,{endRecord:s,startRecord:t,recordsPerPage:s},this.includePasswordChangeLogControl.value).pipe(Object(u.a)(e=>({data:e.records})),Object(h.a)())}_checkTicketNumberVisibility(e){if(!this.showticketColumn)for(let t=0;t<e.length;t++)e[t].ticketNumber&&(this.showticketColumn=!0)}_initializeSecret(){this.secretId=this.secretState.id,this.canTogglePasswordChangeLog=this._secretService.hasAction(D.W.Edit,this.secretState)}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.V),b.Ob(a.cb),b.Ob(ni.a),b.Ob(b.h))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-audit"]],viewQuery:function(e,t){if(1&e&&(b.Uc(ci,3),b.Uc(ai,3)),2&e){let e;b.zc(e=b.cc())&&(t.grid=e.first),b.zc(e=b.cc())&&(t.detailModal=e.first)}},inputs:{secretState:"secretState",canEdit:"canEdit"},features:[b.Ab],decls:18,vars:32,consts:[[1,"full-height"],[3,"active","isFullscreen"],["gridName","secret-audit","defaultOrderByField","dateRecorded",3,"defaultOrderAscending","columnDefinitions","getPagedData","supportsCustomRecords","downloadFileName","headerTemplate","dataDownloadCallback","rowClick"],["grid",""],["popupTemplate",""],["recordingTemplate",""],["ticketNumberTemplate",""],["headerTemplate",""],["modalTitleLocale","audit"],["detailModal",""],["modal-body",""],[3,"noBottomMargin",4,"ngIf"],["modal-footer",""],["ss-locale","ok","ss-page-name","common",1,"thy","primary","button",3,"click"],[4,"ngIf"],[1,"norowclick",3,"ssHref"],["ss-locale","view-ssh-log",1,"norowclick",3,"ssHref"],[1,"grid-filter-header"],[1,"item-count"],[1,"toggle-column"],[3,"showAsContextMenu"],["class","password-toggle",4,"ngIf"],[1,"password-toggle"],["id","secret-audit-password-log",3,"showAsToggle","editMode","formControl","labelText"],[3,"noBottomMargin"],[3,"showActions"],["label-column","","ss-locale","full-name",1,"field-header"],["value-column","",1,"top-padded-layout-cell"],["label-column","","ss-locale","action",1,"field-header"],["label-column","","ss-locale","notes",1,"field-header"]],template:function(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",0),b.Pb(1,"thy-loading-dimmer",1),b.Ub(2,"ss-grid",2,3),b.bc("rowClick",function(e){return t.rowClick(e)}),b.Mc(4,li,1,1,"ng-template",null,4,b.Nc),b.Mc(6,pi,3,3,"ng-template",null,5,b.Nc),b.Mc(8,bi,2,1,"ng-template",null,6,b.Nc),b.Tb(),b.Tb(),b.Mc(10,gi,7,5,"ng-template",null,7,b.Nc),b.Ub(12,"ss-modal-dialog",8,9),b.Sb(14,10),b.Mc(15,fi,14,10,"ss-layout-form",11),b.Rb(),b.Ub(16,"div",12),b.Ub(17,"button",13),b.bc("click",function(){return b.Ec(e),b.Ac(13).close()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.Ac(5),s=b.Ac(7),i=b.Ac(9),o=b.Ac(11);b.Cb(1),b.nc("active",t.isLoading)("isFullscreen",!0),b.Cb(1),b.nc("defaultOrderAscending",!1)("columnDefinitions",b.yc(24,Ii,b.sc(10,vi,t.columnType.DateTime),b.rc(12,yi),b.sc(13,Si,t.columnType.AuditAction),b.sc(15,wi,t.includePasswordChangeLogControl.value),b.rc(17,Ci),b.tc(18,Ti,e,s),b.tc(21,Oi,i,t.showticketColumn)))("getPagedData",t.getDataMethod)("supportsCustomRecords",!0)("downloadFileName",t.downloadFileName)("headerTemplate",o)("dataDownloadCallback",t.downloadData),b.Cb(13),b.nc("ngIf",t.selectedAudit)}},directives:[m.h,L.a,N.a,i.o,f.a,ri.a,V.a,l.b,o.s,o.i,G.a,z.a],pipes:[W.a,i.b,bt.a,H.a],styles:[".audit-header[_ngcontent-%COMP%]   .password-toggle[_ngcontent-%COMP%]{width:30%;text-align:right}.toggle-column[_ngcontent-%COMP%]{width:60%}.items-column[_ngcontent-%COMP%]{width:10%}"]}),e=Object(P.b)([Object(M.a)()],e),e})();var Pi=s("ITfe"),Mi=s("VEN5"),ki=function(e){return e[e.Up=-1]="Up",e[e.Down=1]="Down",e}({});function xi(e,t){1&e&&b.Pb(0,"div",18)}function Di(e,t){1&e&&(b.Ub(0,"div",19),b.Ub(1,"div"),b.Pb(2,"mat-icon",20),b.Tb(),b.Pb(3,"div",21),b.Tb())}function Fi(e,t){1&e&&(b.Ub(0,"div",19),b.Ub(1,"div"),b.Pb(2,"mat-icon",22),b.Tb(),b.Pb(3,"div",23),b.Tb())}function Ui(e,t){1&e&&b.Pb(0,"div",27)}function Ai(e,t){1&e&&b.Pb(0,"div",28)}function Ei(e,t){if(1&e&&(b.Ub(0,"div",19),b.Ub(1,"div"),b.Pb(2,"mat-icon",24),b.Tb(),b.Mc(3,Ui,1,0,"div",25),b.Mc(4,Ai,1,0,"div",26),b.Tb()),2&e){const e=b.fc(3);b.Cb(3),b.nc("ngIf",!e.cancelledWithoutAttempts),b.Cb(1),b.nc("ngIf",e.cancelledWithoutAttempts)}}function Ri(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",11),b.gc(1,"async"),b.gc(2,"ssLocale"),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Ub(5,"div",29),b.Pb(6,"ss-date",30),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("labelText",b.hc(1,5,b.ic(2,7,"last-rpc-date","secretdetail")))("labelTooltip",b.hc(3,10,b.ic(4,12,"last-rpc-date-description","secretdetail")))("showActions",!1),b.Cb(6),b.nc("value",e.secretRpc.passwordStatus.lastRpcDate)("format",e.displayDateFormat.Duration)}}function Ni(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",11),b.gc(1,"async"),b.gc(2,"ssLocale"),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Ub(5,"div",31),b.Pb(6,"ss-date",30),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("labelText",b.hc(1,5,b.ic(2,7,"next-rpc-date","secretdetail")))("labelTooltip",b.hc(3,10,b.ic(4,12,"next-rpc-date-description","secretdetail")))("showActions",!1),b.Cb(6),b.nc("value",e.secretRpc.passwordStatus.nextRpcDate)("format",e.displayDateFormat.DateTime)}}function Li(e,t){if(1&e&&(b.Ub(0,"div"),b.Oc(1),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.Pc(e.passwordRpcMessage)}}function Vi(e,t){if(1&e&&(b.Ub(0,"thy-form-layout",8),b.gc(1,"async"),b.gc(2,"ssLocale"),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Ub(5,"div",9),b.Mc(6,xi,1,0,"div",10),b.Tb(),b.Ub(7,"thy-form-layout-row",11),b.gc(8,"async"),b.gc(9,"ssLocale"),b.gc(10,"async"),b.gc(11,"ssLocale"),b.Sb(12,12),b.Mc(13,Di,4,0,"div",13),b.Mc(14,Fi,4,0,"div",13),b.Mc(15,Ei,5,2,"div",13),b.Rb(),b.Tb(),b.Mc(16,Ri,7,15,"thy-form-layout-row",14),b.Mc(17,Ni,7,15,"thy-form-layout-row",14),b.Ub(18,"thy-form-layout-row",15),b.gc(19,"async"),b.gc(20,"ssLocale"),b.Ub(21,"div",16),b.Ub(22,"div",17),b.Oc(23),b.Tb(),b.Mc(24,Li,2,1,"div",7),b.Tb(),b.Tb(),b.Tb()),2&e){const e=b.fc(2);b.nc("summaryTitle",b.hc(1,16,b.hc(2,18,"password-status")))("summaryDescription",b.hc(3,20,b.hc(4,22,"password-status-description")))("showBorder",!0),b.Cb(6),b.nc("ngIf",e.isPasswordFail),b.Cb(1),b.nc("labelText",b.hc(8,24,b.ic(9,26,"status","common")))("labelTooltip",b.hc(10,29,b.ic(11,31,"rpc-status-description","secretdetail")))("showActions",!1),b.Cb(6),b.nc("ngIf",2===e.secretRpc.passwordStatus.status),b.Cb(1),b.nc("ngIf",1===e.secretRpc.passwordStatus.status),b.Cb(1),b.nc("ngIf",3===e.secretRpc.passwordStatus.status),b.Cb(1),b.nc("ngIf",e.secretRpc.passwordStatus.lastRpcDate&&!e.cancelledWithoutAttempts),b.Cb(1),b.nc("ngIf",e.secretRpc.passwordStatus.nextRpcDate&&!e.cancelledWithoutAttempts),b.Cb(1),b.nc("labelText",b.hc(19,34,b.ic(20,36,"result","common")))("showActions",!1),b.Cb(5),b.Pc(e.passwordStatusMessage),b.Cb(1),b.nc("ngIf",e.isPasswordFail)}}function qi(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout",32),b.bc("editForm",function(){b.Ec(e);const t=b.fc(2);return t.formsService.enableEditMode("passwordtype",t.rpcForm)}),b.gc(1,"async"),b.gc(2,"ssLocale"),b.gc(3,"async"),b.gc(4,"ssLocale"),b.Ub(5,"thy-form-layout-row",15),b.gc(6,"async"),b.gc(7,"ssLocale"),b.Pb(8,"thy-form-select",33),b.Tb(),b.Ub(9,"thy-form-layout-button-row",34),b.bc("save",function(){return b.Ec(e),b.fc(2).saveRpc()})("cancel",function(){return b.Ec(e),b.fc(2).formsService.disableEditMode()}),b.Tb(),b.Tb()}if(2&e){const e=b.fc(2);b.nc("summaryTitle",b.hc(1,7,b.ic(2,9,"password-type","secretdetail")))("summaryDescription",b.hc(3,12,b.ic(4,14,"password-type-description","secretdetail")))("showBorder",!0)("disableEdit",!e.hasEditRpc),b.Cb(5),b.nc("labelText",b.hc(6,17,b.ic(7,19,"password-type","secretdetail")))("showActions",!1),b.Cb(3),b.nc("options",e.passwordTypeWebScriptOptions)}}function Gi(e,t){1&e&&(b.Ub(0,"span",47),b.Oc(1,"Change Password Using Credentials on Secret"),b.Tb())}function zi(e,t){1&e&&(b.Ub(0,"span",48),b.Oc(1,"Change Password Using Privileged Account"),b.Tb())}function Bi(e,t){if(1&e&&(b.Sb(0),b.Mc(1,Gi,2,0,"span",45),b.Mc(2,zi,2,0,"span",46),b.Rb()),2&e){const e=b.fc(4);b.Cb(1),b.nc("ngIf","Secret"===e.rpcForm.value.changePasswordUsing),b.Cb(1),b.nc("ngIf","PrivilegedAccount"===e.rpcForm.value.changePasswordUsing)}}function ji(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Ub(1,"div",49),b.Ub(2,"div",50),b.Ub(3,"div"),b.Pb(4,"ss-radio",51),b.Tb(),b.Ub(5,"div"),b.Ub(6,"span",52),b.bc("click",function(){b.Ec(e);const t=b.fc(4);return t.setValueWithDirty(t.rpcForm.controls.changePasswordUsing,"Secret","rpc")}),b.Oc(7,"Credentials on Secret"),b.Tb(),b.Tb(),b.Tb(),b.Ub(8,"div",50),b.Ub(9,"div"),b.Pb(10,"ss-radio",53),b.Tb(),b.Ub(11,"div"),b.Ub(12,"span",54),b.bc("click",function(){b.Ec(e);const t=b.fc(4);return t.setValueWithDirty(t.rpcForm.controls.changePasswordUsing,"PrivilegedAccount","rpc")}),b.Oc(13,"Privileged Account Credentials"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Rb()}if(2&e){const e=b.fc(4);b.Cb(6),b.Gb("pointer",e.editModeRpc),b.Cb(6),b.Gb("pointer",e.editModeRpc)}}function Wi(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",44),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",12),b.Mc(4,Bi,3,2,"ng-container",7),b.Mc(5,ji,14,4,"ng-container",7),b.Tb(),b.Tb()),2&e){const e=b.fc(3);b.nc("thyFormLayoutRowDefinition",e.secretRpc.privilegedAccountSecretId)("labelText",b.hc(1,5,b.hc(2,7,"change-password-using")))("showActions",!1),b.Cb(4),b.nc("ngIf",!e.editModeRpc),b.Cb(1),b.nc("ngIf",e.editModeRpc)}}function Hi(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",38),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Sb(3,12),b.Pb(4,"ss-form-input",55),b.Rb(),b.Tb()),2&e){const e=b.fc(3);b.nc("labelText",b.hc(1,10,b.hc(2,12,"priv-account")))("thyFormLayoutRowDefinition",e.secretRpc.privilegedAccountSecretId)("showActions",!1),b.Cb(4),b.nc("type",e.formInputType.Secret)("initialSecretName",null==e.secretRpc||null==e.secretRpc.privilegedAccountSecretName?null:e.secretRpc.privilegedAccountSecretName.value)("forceEditMode",e.editModeRpc)("passwordTypeIdsFilter",e.getPasswordTypeIds(null==e.secretRpc?null:e.secretRpc.passwordTypeId))("onlyRpcEnabledFilter",!0)("allowDoubleLocks",!1)("doNotAddTopPadding",!0)}}function Ki(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",15),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Pb(3,"thy-form-select",56),b.Tb()),2&e){const e=b.fc(3);b.nc("labelText",b.hc(1,3,b.hc(2,5,"next-password")))("showActions",!1),b.Cb(3),b.nc("options",e.autoChangeNextPasswordTypeOptions)}}function Qi(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",57),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",12),b.Ub(4,"ss-form-input",58),b.bc("showPasswordClick",function(t){return b.Ec(e),b.fc(3).retrievePassword(t)})("modifyPasswordClick",function(t){return b.Ec(e),b.fc(3).modifyPassword(t)}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc(3);b.nc("labelText",b.hc(1,8,b.hc(2,10,"password")))("forceRequiredMarker",!0)("showActions",!1),b.Cb(4),b.nc("type",e.formInputType.Password)("maxlength",1e4)("forceEditMode",e.editModeRpc)("alwaysHidePasswordGenerate",!0)("context",e.passwordLoadingContext)}}function $i(e,t){1&e&&(b.Ub(0,"thy-form-layout-row",15),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",64),b.Ub(4,"div"),b.Pb(5,"thy-form-number",65),b.Tb(),b.Pb(6,"div",66),b.Tb(),b.Tb()),2&e&&(b.nc("labelText",b.hc(1,4,b.hc(2,6,"change-every")))("showActions",!1),b.Cb(5),b.nc("minNumberValue",1)("maxNumberValue",99999999))}function Zi(e,t){1&e&&(b.Ub(0,"thy-form-layout-row",15),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",64),b.Ub(4,"div"),b.Pb(5,"thy-form-number",67),b.Tb(),b.Pb(6,"div",68),b.Tb(),b.Tb()),2&e&&(b.nc("labelText",b.hc(1,4,b.hc(2,6,"change-every")))("showActions",!1),b.Cb(5),b.nc("minNumberValue",1)("maxNumberValue",99999999))}function Yi(e,t){if(1&e&&(b.Sb(0),b.Oc(1),b.Rb()),2&e){const e=b.fc(6);b.Cb(1),b.Qc(" ",e.selectedWeekdays," ")}}function Ji(e,t){1&e&&(b.Sb(0),b.Ub(1,"div",70),b.Ub(2,"div"),b.Pb(3,"thy-form-boolean",71),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Tb(),b.Ub(6,"div"),b.Pb(7,"thy-form-boolean",72),b.gc(8,"async"),b.gc(9,"ssLocale"),b.Tb(),b.Ub(10,"div"),b.Pb(11,"thy-form-boolean",73),b.gc(12,"async"),b.gc(13,"ssLocale"),b.Tb(),b.Ub(14,"div"),b.Pb(15,"thy-form-boolean",74),b.gc(16,"async"),b.gc(17,"ssLocale"),b.Tb(),b.Ub(18,"div"),b.Pb(19,"thy-form-boolean",75),b.gc(20,"async"),b.gc(21,"ssLocale"),b.Tb(),b.Ub(22,"div"),b.Pb(23,"thy-form-boolean",76),b.gc(24,"async"),b.gc(25,"ssLocale"),b.Tb(),b.Ub(26,"div"),b.Pb(27,"thy-form-boolean",77),b.gc(28,"async"),b.gc(29,"ssLocale"),b.Tb(),b.Tb(),b.Rb()),2&e&&(b.Cb(3),b.nc("labelText",b.hc(4,7,b.hc(5,9,"monday"))),b.Cb(4),b.nc("labelText",b.hc(8,11,b.hc(9,13,"tuesday"))),b.Cb(4),b.nc("labelText",b.hc(12,15,b.hc(13,17,"wednesday"))),b.Cb(4),b.nc("labelText",b.hc(16,19,b.hc(17,21,"thursday"))),b.Cb(4),b.nc("labelText",b.hc(20,23,b.hc(21,25,"friday"))),b.Cb(4),b.nc("labelText",b.hc(24,27,b.hc(25,29,"saturday"))),b.Cb(4),b.nc("labelText",b.hc(28,31,b.hc(29,33,"sunday"))))}function Xi(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",69),b.Sb(1,12),b.Mc(2,Yi,2,1,"ng-container",7),b.Mc(3,Ji,30,35,"ng-container",7),b.Rb(),b.Tb()),2&e){const e=b.fc(5);b.nc("showActions",!1),b.Cb(2),b.nc("ngIf",!e.editModeRpc),b.Cb(1),b.nc("ngIf",e.editModeRpc)}}function eo(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.Tb()),2&e){const e=b.fc(6);b.Cb(1),b.Pc(e.rpcForm.value.autoChangeSchedule.changeEveryMonthsDayNumber)}}function to(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",15),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",78),b.Ub(4,"div",79),b.Pb(5,"thy-form-number",80),b.Tb(),b.Pb(6,"div",81),b.Mc(7,eo,2,1,"span",7),b.Tb(),b.Tb()),2&e){const e=b.fc(5);b.nc("labelText",b.hc(1,5,b.hc(2,7,"change-every")))("showActions",!1),b.Cb(5),b.nc("minNumberValue",1)("maxNumberValue",99999999),b.Cb(2),b.nc("ngIf",!e.editModeRpc&&(null==e.rpcForm.value||null==e.rpcForm.value.autoChangeSchedule?null:e.rpcForm.value.autoChangeSchedule.changeEveryMonthsDayNumber))}}function so(e,t){1&e&&b.Pb(0,"ss-radio",87)}function io(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",82),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",83),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Mc(6,so,1,0,"ss-radio",84),b.Oc(7," \xa0"),b.Ub(8,"span",85),b.Oc(9,"Date"),b.Tb(),b.Oc(10,": "),b.Tb(),b.Sb(11,12),b.Ub(12,"div",79),b.Pb(13,"thy-form-number",86),b.Tb(),b.Rb(),b.Tb()),2&e){const e=b.fc(5);b.nc("labelTooltip",b.hc(1,5,b.hc(2,7,"date-radio-popup")))("showActions",!1),b.Cb(3),b.nc("matTooltip",b.hc(4,9,b.hc(5,11,"date-radio-popup"))),b.Cb(3),b.nc("ngIf",e.editModeRpc),b.Cb(7),b.nc("minNumberValue",1)}}function oo(e,t){1&e&&b.Pb(0,"ss-radio",93)}function no(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",82),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Ub(3,"div",83),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Mc(6,oo,1,0,"ss-radio",88),b.Oc(7," \xa0"),b.Ub(8,"label",89),b.Oc(9,"Day"),b.Tb(),b.Tb(),b.Sb(10,12),b.Ub(11,"div",90),b.Ub(12,"div",79),b.Pb(13,"thy-form-select",91),b.Tb(),b.Ub(14,"div",79),b.Pb(15,"thy-form-select",92),b.Tb(),b.Tb(),b.Rb(),b.Tb()),2&e){const e=b.fc(5);b.nc("labelTooltip",b.hc(1,6,b.hc(2,8,"date-radio-popup")))("showActions",!1),b.Cb(3),b.nc("matTooltip",b.hc(4,10,b.hc(5,12,"date-radio-popup"))),b.Cb(3),b.nc("ngIf",e.editModeRpc),b.Cb(7),b.nc("options",e.monthInstances),b.Cb(2),b.nc("options",e.monthInstanceTargets)}}function ro(e,t){1&e&&(b.Pb(0,"thy-form-boolean",96),b.gc(1,"async"),b.gc(2,"ssLocale")),2&e&&b.nc("labelText",b.hc(1,1,b.hc(2,3,"only-change-expired")))}function co(e,t){1&e&&b.Pb(0,"span",97)}function ao(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",69),b.Sb(1,12),b.Mc(2,ro,3,5,"thy-form-boolean",94),b.Mc(3,co,1,0,"span",95),b.Rb(),b.Tb()),2&e){const e=b.fc(5);b.nc("showActions",!1),b.Cb(2),b.nc("ngIf",e.editModeRpc),b.Cb(1),b.nc("ngIf",!e.editModeRpc&&e.getScheduleValue("onlyChangeIfExpired"))}}function lo(e,t){if(1&e&&(b.Sb(0),b.Mc(1,$i,7,8,"thy-form-layout-row",40),b.Mc(2,Zi,7,8,"thy-form-layout-row",40),b.Mc(3,Xi,4,3,"thy-form-layout-row",61),b.Mc(4,to,8,9,"thy-form-layout-row",40),b.Mc(5,io,14,13,"thy-form-layout-row",62),b.Mc(6,no,16,14,"thy-form-layout-row",62),b.Ub(7,"thy-form-layout-row",15),b.gc(8,"async"),b.gc(9,"ssLocale"),b.Sb(10,12),b.Pb(11,"thy-form-date",63),b.Rb(),b.Tb(),b.Mc(12,ao,4,3,"thy-form-layout-row",61),b.Rb()),2&e){const e=b.fc(4);b.Cb(1),b.nc("ngIf","Daily"===e.getScheduleType()),b.Cb(1),b.nc("ngIf","Weekly"===e.getScheduleType()),b.Cb(1),b.nc("ngIf","Weekly"===e.getScheduleType()),b.Cb(1),b.nc("ngIf","Monthly"===e.getScheduleType()),b.Cb(1),b.nc("ngIf",e.editModeRpc&&"Monthly"===e.getScheduleType()),b.Cb(1),b.nc("ngIf","Monthly"===e.getScheduleType()&&(e.editModeRpc||"Day"===e.getScheduleValue("monthScheduleType"))),b.Cb(1),b.nc("labelText",b.hc(8,12,b.hc(9,14,"starting-on")))("showActions",!1),b.Cb(4),b.nc("timezone",e.stateService.dateTimeServerTimezone)("offset",e.stateService.dateTimeServerOffset)("offsetDescription",e.stateService.timezoneOffsetDisplay),b.Cb(1),b.nc("ngIf",e.editModeRpc||e.getScheduleValue("onlyChangeIfExpired"))}}function ho(e,t){if(1&e&&(b.Sb(0,59),b.Ub(1,"thy-form-layout-row",15),b.gc(2,"async"),b.gc(3,"ssLocale"),b.Pb(4,"thy-form-select",60),b.Tb(),b.Mc(5,lo,13,16,"ng-container",7),b.Rb()),2&e){const e=b.fc(3);b.Cb(1),b.nc("labelText",b.hc(2,4,b.hc(3,6,"auto-change-schedule")))("showActions",!1),b.Cb(3),b.nc("options",e.scheduleTypeOptions),b.Cb(1),b.nc("ngIf","Expires"!==e.getScheduleType())}}function uo(e,t){if(1&e){const e=b.Vb();b.Ub(0,"form",4),b.Ub(1,"thy-form-layout",35),b.bc("editForm",function(){b.Ec(e);const t=b.fc(2);return t.formsService.enableEditMode("rpc",t.rpcForm)}),b.gc(2,"async"),b.gc(3,"ssLocale"),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Mc(6,Wi,6,9,"thy-form-layout-row",36),b.Mc(7,Hi,5,14,"thy-form-layout-row",37),b.Ub(8,"thy-form-layout-row",38),b.gc(9,"async"),b.gc(10,"ssLocale"),b.Sb(11,12),b.Pb(12,"thy-form-boolean",39),b.Rb(),b.Tb(),b.Mc(13,Ki,4,7,"thy-form-layout-row",40),b.Mc(14,Qi,5,12,"thy-form-layout-row",41),b.Mc(15,ho,6,8,"ng-container",42),b.Ub(16,"thy-form-layout-button-row",43),b.bc("save",function(){return b.Ec(e),b.fc(2).saveRpc()})("cancel",function(){return b.Ec(e),b.fc(2).cancelRpc()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc(2);b.nc("formGroup",e.rpcForm),b.Cb(1),b.nc("summaryTitle",b.hc(2,13,b.hc(3,15,"rpc-autochange")))("summaryDescription",b.hc(4,17,b.hc(5,19,"rpc-autochange-description")))("showBorder",!0)("disableEdit",!e.hasEditRpc),b.Cb(5),b.nc("ngIf",e.secretRpc.privilegedAccountSecretId&&!e.secretRpc.privilegedAccountSecretId.hidden),b.Cb(1),b.nc("ngIf",e.secretRpc.privilegedAccountSecretId&&!e.secretRpc.privilegedAccountSecretId.hidden&&"PrivilegedAccount"===e.rpcForm.value.changePasswordUsing),b.Cb(1),b.nc("labelText",b.hc(9,21,b.hc(10,23,"auto-change")))("thyFormLayoutRowDefinition",e.secretRpc.autoChangeEnabled)("showActions",!1),b.Cb(5),b.nc("ngIf",e.isAutoChangeEnabled()&&!0===e.secretRpc.canEnterNextPassword.value),b.Cb(1),b.nc("ngIf",e.isAutoChangeEnabled()&&"Manual"===e.rpcForm.value.autoChangeNextPasswordType&&!0===e.secretRpc.canEnterNextPassword.value),b.Cb(1),b.nc("ngIf",e.secretRpc.autoChangeSchedule&&!e.secretRpc.autoChangeSchedule.hidden&&e.isAutoChangeEnabled())}}function po(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",107),b.bc("click",function(){return b.Ec(e),b.fc(3).editModeAssociatedSecrets=!0}),b.Oc(1,"Edit"),b.Tb()}}function bo(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",108),b.Ub(1,"button",109),b.bc("click",function(){return b.Ec(e),b.fc(3).cancelAccounts()}),b.Oc(2,"Cancel"),b.Tb(),b.Ub(3,"button",110),b.bc("click",function(){return b.Ec(e),b.fc(3).addSecret()}),b.Oc(4,"Add Secret"),b.Tb(),b.Ub(5,"button",111),b.bc("click",function(){return b.Ec(e),b.fc(3).saveAccounts()}),b.Oc(6,"Save"),b.Tb(),b.Tb()}}function mo(e,t){1&e&&(b.Ub(0,"div",112),b.Oc(1," The following Secrets are available to be used in Custom Password Changing Commands and Scripts "),b.Tb())}function go(e,t){1&e&&(b.Ub(0,"div",113),b.Oc(1," No Secrets have been specified for use in Custom Password Changing Commands and Scripts. "),b.Tb())}function fo(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"svg-icon",114),b.bc("click",function(){b.Ec(e);const t=b.fc().item,s=b.fc(3);return s.move(t.order,s.moveDirectionType.Up)}),b.Tb(),b.Ub(2,"svg-icon",115),b.bc("click",function(){b.Ec(e);const t=b.fc().item,s=b.fc(3);return s.move(t.order,s.moveDirectionType.Down)}),b.Tb(),b.Oc(3," \xa0\xa0\xa0 "),b.Ub(4,"button",116),b.bc("click",function(){b.Ec(e);const t=b.fc().item;return b.fc(3).removeSecret(t.order)}),b.Oc(5,"Remove"),b.Tb(),b.Tb()}if(2&e){const e=b.fc().item,t=b.fc(3);b.Cb(1),b.Gb("disabledMove",1===e.order),b.Cb(1),b.Gb("disabledMove",e.order===t.formAccounts.value.resetSecrets.length)}}function vo(e,t){if(1&e&&b.Mc(0,fo,6,4,"div",7),2&e){const e=b.fc(3);b.nc("ngIf",e.editModeAssociatedSecrets)}}const yo=function(){return{propertyName:"order",displayName:"Order",displayNameLocale:"order",columnOrder:1}},So=function(){return{propertyName:"secretName",displayName:"Secret Name",displayNameLocale:"secret-name",columnOrder:2}},wo=function(){return{propertyName:"secretId",displayName:"Secret ID",displayNameLocale:"secret-id",columnOrder:3}},Co=function(){return{propertyName:"secretTemplateName",displayName:"Template",displayNameLocale:"template",columnOrder:4}},To=function(){return{propertyName:"folderName",displayName:"Folder",displayNameLocale:"folder",columnOrder:5}},Oo=function(e,t){return{propertyName:"optionsCell",displayName:" ",columnOrder:6,columnWidth:125,canResize:!1,template:e,ignore:t,hideColumnSelection:!0,ignoreLocalizationErrors:!0}},Io=function(e,t,s,i,o,n){return[e,t,s,i,o,n]};function _o(e,t){if(1&e&&(b.Sb(0),b.Ub(1,"div"),b.Pb(2,"span",98),b.Oc(3," \xa0\xa0 "),b.Mc(4,po,2,0,"button",99),b.Tb(),b.Mc(5,bo,7,0,"div",100),b.Mc(6,mo,2,0,"div",101),b.Mc(7,go,2,0,"div",102),b.Ub(8,"div",103),b.Ub(9,"ss-grid",104),b.Mc(10,vo,1,1,"ng-template",null,105,b.Nc),b.Ub(12,"div",106),b.Oc(13,"\xa0"),b.Tb(),b.Tb(),b.Tb(),b.Rb()),2&e){const e=b.Ac(11),t=b.fc(2);b.Cb(4),b.nc("ngIf",t.hasEditRpc&&!t.editModeAssociatedSecrets&&!t.secretRpc.resetSecrets.readOnly),b.Cb(1),b.nc("ngIf",t.editModeAssociatedSecrets),b.Cb(1),b.nc("ngIf",t.formAccounts.value.resetSecrets&&t.formAccounts.value.resetSecrets.length>0||t.editModeAssociatedSecrets),b.Cb(1),b.nc("ngIf",!t.editModeAssociatedSecrets&&0===(null==t.formAccounts||null==t.formAccounts.value||null==t.formAccounts.value.resetSecrets?null:t.formAccounts.value.resetSecrets.length)),b.Cb(1),b.Gb("associated-edit-mode",t.editModeAssociatedSecrets),b.Cb(1),b.nc("items",t.formAccounts.value.resetSecrets)("showSummary",!1)("isResizable",!0)("columnDefinitions",b.xc(18,Io,b.rc(10,yo),b.rc(11,So),b.rc(12,wo),b.rc(13,Co),b.rc(14,To),b.tc(15,Oo,e,!t.editModeAssociatedSecrets)))}}function Po(e,t){if(1&e&&(b.Ub(0,"div",2),b.Mc(1,Vi,25,39,"thy-form-layout",3),b.Ub(2,"form",4),b.Mc(3,qi,10,22,"thy-form-layout",5),b.Tb(),b.Mc(4,uo,17,25,"form",6),b.Mc(5,_o,14,25,"ng-container",7),b.Tb()),2&e){const e=b.fc();b.Cb(1),b.nc("ngIf",e.hasPasswordStatus),b.Cb(1),b.nc("formGroup",e.rpcForm),b.Cb(1),b.nc("ngIf",e.secretRpc.passwordTypeWebScriptId&&!e.secretRpc.passwordTypeWebScriptId.hidden),b.Cb(1),b.nc("ngIf",e.secretRpc&&e.isAutoChangeFormVisible()),b.Cb(1),b.nc("ngIf",e.secretRpc&&!e.secretRpc.resetSecrets.hidden)}}let Mo=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l,d,h,u,p){this._router=e,this._secretService=t,this._ies=s,this._stateService=i,this._formBuilder=n,this._dialogService=r,this._folderService=c,this._log=a,this._localizationService=l,this._dateService=d,this._errorService=h,this.formsService=u,this._cdr=p,this.secretState=null,this.moveDirectionType=ki,this.formInputType=A.a,this.numberedDayOfWeekOptions=[],this.dayOfWeekOptions=[],this.isLoading=!0,this.canStopPasswordChange=!1,this.secretChangeInProcessBannerMessage=null,this.passwordTypeWebScriptOptions=[],this.passwordLoadingContext={},this.displayDateFormat=x.a,this.hasEditRpc=!1,this.cancelledWithoutAttempts=!1,this.autoChangeNextPasswordTypeOptions=[{text:"Randomly generated",value:"Random"},{text:"Manual",value:"Manual"}],this.scheduleTypeOptions=[{text:"When password expires",value:"Expires"},{text:"Daily",value:"Daily"},{text:"Weekly",value:"Weekly"},{text:"Monthly",value:"Monthly"}],this.monthInstances=[{text:"First",value:"First"},{text:"Second",value:"Second"},{text:"Third",value:"Third"},{text:"Fourth",value:"Fourth"},{text:"Last",value:"Last"}],this.monthInstanceTargets=[{text:"Sunday",value:"Sunday"},{text:"Monday",value:"Monday"},{text:"Tuesday",value:"Tuesday"},{text:"Wednesday",value:"Wednesday"},{text:"Thursday",value:"Thursday"},{text:"Friday",value:"Friday"},{text:"Saturday",value:"Saturday"},{text:"Weekday",value:"Weekday"},{text:"Weekend Day",value:"WeekendDay"},{text:"Day",value:"Day"}],this.rpcForm=new o.k({autoChangeEnabled:new Pi.a("Auto Change Enabled"),autoChangeNextPasswordType:new o.h(""),autoChangeNextPassword:new Pi.a("Password"),changePasswordUsing:new o.h(""),privilegedAccountSecretId:new Pi.a("Privileged Account"),privilegedAccountSecretName:new o.h(""),passwordTypeWebScriptId:new Pi.a("Password Type"),autoChangeSchedule:new o.k({scheduleType:new o.h,days:new Pi.a("Change Every Days"),weeks:new Pi.a("Weeks"),sunday:new o.h,monday:new o.h,tuesday:new o.h,wednesday:new o.h,thursday:new o.h,friday:new o.h,saturday:new o.h,monthScheduleType:new o.h,numberMonthlyDay:new Pi.a("Change Every Months"),changeEveryMonths:new Pi.a("Change Every X Months on"),changeEveryMonthsDayNumber:new Pi.a("Monthly Date"),changeEveryMonthsInstance:new Pi.a("Month Day Instance"),changeEveryMonthsInstanceTarget:new Pi.a("Month Day Target"),onlyChangeIfExpired:new o.h,startingOn:new Pi.a("Starting on")})}),this.autochangeMonthText=null,this.formAccounts=new o.k({resetSecrets:new o.e([])}),this.hasPasswordStatus=!1,this.passwordStatusMessage=null,this.passwordRpcMessage=null,this.isPasswordFail=!1,this.editModeRpc=!1,this.editModeAssociatedSecrets=!1,this.ies=this._ies,this.stateService=i}ngOnInit(){this._stateService.events.secretEvents.passwordChange.pipe(Object(M.b)(this)).subscribe(e=>{this.updatePasswordStatus(e.passwordStatus)}),this.formsService.statusChanges.pipe(Object(M.b)(this)).subscribe(e=>{"rpc"===e.editSection&&(this.editModeRpc=e.isEditMode)})}ngOnChanges(e){e.secretState&&this._load()}get selectedWeekdays(){const e=[];return this.getScheduleValue("sunday")&&e.push("Sunday"),this.getScheduleValue("monday")&&e.push("Monday"),this.getScheduleValue("tuesday")&&e.push("Tuesday"),this.getScheduleValue("wednesday")&&e.push("Wednesday"),this.getScheduleValue("thursday")&&e.push("Thursday"),this.getScheduleValue("friday")&&e.push("Friday"),this.getScheduleValue("saturday")&&e.push("Saturday"),e.join(", ")}setValueWithDirty(e,t,s){e.disabled||this.ies.isEditMode(s)&&(e.setValue(t),e.markAsDirty(),e.updateValueAndValidity())}isAutoChangeEnabled(){return this.secretRpc.autoChangeEnabled.readOnly?this.secretRpc.autoChangeEnabled.value:this.rpcForm.value.autoChangeEnabled}isAutoChangeFormVisible(){return!this.secretRpc.autoChangeEnabled.hidden}updatePasswordStatus(e){if(0!==e.status){this.hasPasswordStatus=!0,this.isPasswordFail=!1;let t=null,s=!1;if(this.cancelledWithoutAttempts=!1,1===e.status)t=null===e.lastRpcDate?"password-change-pending-short":"password-change-pending";else if(3===e.status){const i=this._dateService.getDifference(e.lastRpcDate,e.nextRpcDate);0===e.failedAttempts?(t="password-change-fail-canceled",this.cancelledWithoutAttempts=!0):i.asMilliseconds()<=0?(t="password-change-fail-short",s=!0):t="password-change-fail",this.isPasswordFail=!0}else 2===e.status&&(t="password-change-success");this._localizationService.getMessage(t).pipe(Object(h.a)()).subscribe(t=>{this.passwordStatusMessage=t;const i=[];i.push(this._dateService.getFormatted(e.lastRpcDate,d.e.DateTime,d.f.Server)),3===e.status&&(s||i.push(this._dateService.getFormatted(e.nextRpcDate,d.e.DateTime,d.f.Server)),e.failedAttempts&&i.push(e.failedAttempts.toString())),this.passwordStatusMessage=this._localizationService.replaceVariables(this.passwordStatusMessage,i)}),this.isPasswordFail&&(this.passwordRpcMessage=e.rpcMessage)}}getScheduleType(){return this.secretRpc.autoChangeSchedule.readOnly?this.secretRpc.autoChangeSchedule.value.scheduleType.value:this.rpcForm.value.autoChangeSchedule.scheduleType}getScheduleValue(e){return this.secretRpc.autoChangeSchedule.readOnly?this.secretRpc.autoChangeSchedule.value[e]?this.secretRpc.autoChangeSchedule.value[e].value:null:this.rpcForm.value.autoChangeSchedule[e]}addSecret(){this._dialogService.open(Mi.a,{width:F.c.Large,data:{allowDoubleLocks:!1,currentSecretName:null,currentSecretId:null,extendedTypeIdFilter:null,passwordTypeIdsFilter:null,onlyRpcEnabledFilter:null,showShowRecommended:null,disableRequiresApproval:!1,disableRequiresApprovalDescription:null,permissionRequired:2}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{if(null==e?void 0:e.isApproved){const t=e.approvedContext;let s=1;const i=this.formAccounts.controls.resetSecrets;i.value.forEach(e=>{e.order>=s&&(s=e.order+1)}),this._folderService.getFolderDetail(t.folderId).pipe(Object(h.a)()).subscribe(e=>{i.push(this._formBuilder.group({secretId:t.id,secretName:t.name,folderName:e.name,secretTemplateName:t.secretTemplateName,order:s}))}),this.formAccounts.controls.resetSecrets.markAsDirty(),this.formAccounts.controls.resetSecrets.updateValueAndValidity()}})}cancelRpc(){this.formsService.disableEditMode(),this.passwordLoadingContext.passwordLoaded=!1,this.rpcForm.markAsPristine(),this.rpcForm.updateValueAndValidity()}saveRpc(){this.formsService.isSaving=!0;const e=this._ies.createUpdateModel(this.rpcForm);null!=e.autoChangeSchedule&&(e.autoChangeSchedule={dirty:!0,value:e.autoChangeSchedule}),"PrivilegedAccount"!==this.rpcForm.value.changePasswordUsing||this.rpcForm.value.privilegedAccountSecretId||this.rpcForm.controls.privilegedAccountSecretId.setErrors({serverValidationError:{valid:!1,message:"Must select a privileged account."}}),e.autoChangeNextPasswordType&&"Random"===e.autoChangeNextPasswordType.value&&e.autoChangeNextPassword&&e.autoChangeNextPassword.dirty&&delete e.autoChangeNextPassword,e.autoChangeSchedule&&e.autoChangeSchedule.value&&e.autoChangeSchedule.value.scheduleType&&"Monthly"!==e.autoChangeSchedule.value.scheduleType.value&&delete e.autoChangeSchedule.value.changeEveryMonths,this._secretService.updateSecretDetailRpc(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._assignViewModel(e),this.secretRpc=e,this.passwordLoadingContext.passwordLoaded=!1,this._log.Verbose("saved rpc",e),this.formsService.disableEditMode(),this.rpcForm.markAsPristine(),this.rpcForm.controls.changePasswordUsing.setValue(e.privilegedAccountSecretId.value?"PrivilegedAccount":"Secret"),this.secretRpc.hasNextPassword?this.rpcForm.controls.autoChangeNextPasswordType.setValue("Manual"):(this.rpcForm.controls.autoChangeNextPasswordType.setValue("Random"),this.passwordLoadingContext.hideModify=!0)},error:e=>{this._ies.assignErrorToFormGroup(this.rpcForm,e),this.formsService.isSaving=!1}})}_assignViewModel(e){this._ies.patchViewModel(this.rpcForm,e)}changePassword(){this.secretRpc.isValidForSshKeyRpc.value&&!this.canStopPasswordChange?window.location.href="../SecretChangeNow.aspx?secretid="+this.secretState.id:(this._stateService.selectedSecretIds=[],this._stateService.bulk.secretId=this.secretState.id,this._stateService.bulk.secretName=this.secretState.secretName,this._router.navigate([{outlets:{modal:["modals","bulk","change-password"]}}]))}saveAccounts(){const e=this.formAccounts.controls.resetSecrets.value.sort((e,t)=>e.order-t.order).map(e=>e.secretId);this._secretService.updateSecretDetailRpcSecretScripts(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("saved rpc secret scripts",e),this.editModeAssociatedSecrets=!1},error:e=>{this._ies.assignErrorToFormGroup(this.formAccounts,e)}})}removeSecret(e){this.formAccounts.controls.resetSecrets.removeAt(e-1),this.reinitResetSecretsOrder(),this.formAccounts.controls.resetSecrets.markAsDirty(),this.formAccounts.controls.resetSecrets.updateValueAndValidity()}cancelAccounts(){const e=this.formAccounts.controls.resetSecrets;for(;e.value.length>0;)e.removeAt(0);this._load(),this.reinitResetSecretsOrder(),this._ies.disableEditMode("accounts",!1),this.editModeAssociatedSecrets=!1}move(e,t){const s=e-1,i=this.formAccounts.controls.resetSecrets;if(t===ki.Up&&0===s)return;if(t===ki.Down&&s===i.value.length-1)return;const o=s+t,n=i.value[s];i.value[s]=i.value[o],i.value[o]=n,this.reinitResetSecretsOrder(),i.patchValue(i.value),i.markAsDirty(),this.formAccounts.controls.resetSecrets.updateValueAndValidity()}getPasswordTypeIds(e){const t=[];return e&&t.push(e),t}reinitResetSecretsOrder(){const e=this.formAccounts.controls.resetSecrets;for(let t=0;t<e.length;t++)e.value[t].order=t+1}_setValidation(e,t,s,i){let n=!1;"PrivilegedAccount"!==e||this.secretRpc.privilegedAccountSecretId.hidden||(n=!0),n?this.rpcForm.controls.privilegedAccountSecretId.setValidators([o.C.required]):(this.rpcForm.controls.changePasswordUsing.clearValidators(),this.rpcForm.controls.privilegedAccountSecretId.clearValidators(),this.rpcForm.controls.privilegedAccountSecretId.updateValueAndValidity());const r=this.rpcForm.controls.autoChangeSchedule;if("Expires"!==t)switch(r.controls.startingOn.setValidators([o.C.required]),r.controls.weeks.clearValidators(),r.controls.days.clearValidators(),r.controls.changeEveryMonths.clearValidators(),r.controls.changeEveryMonthsDayNumber.clearValidators(),r.controls.changeEveryMonthsInstance.clearValidators(),r.controls.changeEveryMonthsInstanceTarget.clearValidators(),t){case"Weekly":r.controls.weeks.setValidators([o.C.required,o.C.min(1),o.C.max(99999999),k.a.mustBeWholeNumber,k.a.mustBePositiveNumber]);break;case"Daily":r.controls.days.setValidators([o.C.required,o.C.min(1),o.C.max(99999999),k.a.mustBeWholeNumber,k.a.mustBePositiveNumber]);break;case"Monthly":r.controls.changeEveryMonths.setValidators([o.C.required,o.C.min(1),o.C.max(99999999),k.a.mustBeWholeNumber,k.a.mustBePositiveNumber]),"Date"===i?r.controls.changeEveryMonthsDayNumber.setValidators([o.C.required,o.C.min(1),o.C.max(31),k.a.mustBeWholeNumber,k.a.mustBePositiveNumber]):(r.controls.changeEveryMonthsInstance.setValidators([o.C.required]),r.controls.changeEveryMonthsInstanceTarget.setValidators([o.C.required]))}else r.controls.startingOn.clearValidators(),r.controls.weeks.clearValidators(),r.controls.days.clearValidators(),r.controls.changeEveryMonths.clearValidators(),r.controls.changeEveryMonthsDayNumber.clearValidators(),r.controls.changeEveryMonthsInstance.clearValidators(),r.controls.changeEveryMonthsInstanceTarget.clearValidators();"Manual"===s?this.secretRpc.hasNextPassword&&!this.passwordLoadingContext.passwordLoaded||this.rpcForm.controls.autoChangeNextPassword.setValidators([k.a.requiredNotEmpty]):this.rpcForm.controls.autoChangeNextPassword.clearValidators(),this.rpcForm.controls.autoChangeNextPassword.updateValueAndValidity(),r.controls.startingOn.updateValueAndValidity(),r.controls.weeks.updateValueAndValidity(),r.controls.days.updateValueAndValidity(),r.controls.changeEveryMonths.updateValueAndValidity(),r.controls.changeEveryMonthsDayNumber.updateValueAndValidity(),r.controls.changeEveryMonthsInstance.updateValueAndValidity(),r.controls.changeEveryMonthsInstanceTarget.updateValueAndValidity(),this._cdr.detectChanges()}modifyPassword(e){this.retrievePassword(e)}retrievePassword(e){this.passwordLoadingContext.passwordLoaded||(this.passwordLoadingContext.passwordLoading=!0,this._secretService.getNextRpcPasswordField(this.secretState.id,1).pipe(Object(h.a)()).subscribe({next:e=>{this.passwordLoadingContext.passwordLoaded=!0,this.passwordLoadingContext.passwordLoading=!1,this.rpcForm.controls.autoChangeNextPassword.setValue(e),this.rpcForm.controls.autoChangeNextPassword.setValidators([k.a.requiredNotEmpty]),this.rpcForm.controls.autoChangeNextPassword.updateValueAndValidity()},error:e=>{this.passwordLoadingContext.passwordLoadingFailure=this._errorService.getErrorMessage(e).message,this.passwordLoadingContext.passwordLoaded=!1,this.passwordLoadingContext.passwordLoading=!1}}))}_load(){this.hasEditRpc=this._secretService.hasAction(D.W.EditRpc,this.secretState),this._secretService.getSecretDetailRpc(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this.secretRpc=e,this._log.Verbose("secretRpc",this.secretRpc),this.secretRpc.autoChangeEnabled.readOnly&&(this.rpcForm.controls.autoChangeEnabled.disable(),this.rpcForm.controls.autoChangeEnabled.meta.tooltip="This field is disabled due Secret Policy.");const t=this.rpcForm.controls.autoChangeSchedule;if(this.secretRpc.autoChangeSchedule.readOnly&&t.controls.monthScheduleType.disable(),this.rpcForm.controls.autoChangeEnabled.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this._setValidation(this.rpcForm.value.changePasswordUsing,t.controls.scheduleType.value,this.rpcForm.controls.autoChangeNextPasswordType.value,t.controls.monthScheduleType.value)}),this.rpcForm.controls.changePasswordUsing.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{"PrivilegedAccount"!==e&&this.rpcForm.controls.privilegedAccountSecretId.setValue(null),this._setValidation(e,t.controls.scheduleType.value,this.rpcForm.controls.autoChangeNextPasswordType.value,t.controls.monthScheduleType.value)}),this._assignViewModel(this.secretRpc),this.rpcForm.controls.autoChangeNextPasswordType.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this._setValidation(this.rpcForm.controls.changePasswordUsing.value,t.controls.scheduleType.value,e,t.controls.monthScheduleType.value)}),this.secretRpc.hasNextPassword?this.rpcForm.controls.autoChangeNextPasswordType.setValue("Manual"):(this.rpcForm.controls.autoChangeNextPasswordType.setValue("Random"),this.passwordLoadingContext.hideModify=!0),t.controls.scheduleType.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{t.controls.monthScheduleType.value||(t.controls.monthScheduleType.setValue("Date"),t.controls.monthScheduleType.markAsDirty()),this._setValidation(this.rpcForm.controls.changePasswordUsing.value,e,this.rpcForm.controls.autoChangeNextPasswordType.value,t.controls.monthScheduleType.value)}),this.secretRpc.passwordTypeWebScriptId&&!this.secretRpc.passwordTypeWebScriptId.hidden&&this._secretService.getAutoChangeWebscriptTypes(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this._log.Verbose("webscriptTypeResults",e);for(const t of e)this.passwordTypeWebScriptOptions.push({value:t.id,text:t.name});this.passwordTypeWebScriptOptions=this.passwordTypeWebScriptOptions.slice()}),this.secretRpc.expireText&&this.secretRpc.expireText.value&&(this.scheduleTypeOptions[0].text=`When password expires (${this.secretRpc.expireText.value})`),this.secretRpc.autoChangeSchedule.readOnly)for(const o in t.controls)t.controls.hasOwnProperty(o)&&t.controls[o].disable();t.controls.monthScheduleType.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{"Date"===e?(t.controls.changeEveryMonthsInstance.disable(),t.controls.changeEveryMonthsInstanceTarget.disable(),t.controls.changeEveryMonthsDayNumber.enable()):(t.controls.changeEveryMonthsInstance.enable(),t.controls.changeEveryMonthsInstanceTarget.enable(),t.controls.changeEveryMonthsDayNumber.disable()),this._setValidation(this.rpcForm.controls.changePasswordUsing.value,t.controls.scheduleType.value,this.rpcForm.controls.autoChangeNextPasswordType.value,e)}),this.secretRpc.privilegedAccountSecretId&&!this.secretRpc.privilegedAccountSecretId.hidden&&this.rpcForm.controls.changePasswordUsing.setValue(this.secretRpc.privilegedAccountSecretId.value?"PrivilegedAccount":"Secret");const s=this.formAccounts.controls.resetSecrets,i=s.controls.map(e=>e.value.secretId);this.secretRpc.resetSecrets.value.forEach(e=>{i.includes(e.secretId)||s.push(this._formBuilder.group({secretId:e.secretId,secretName:e.secretName,folderName:e.folderName,secretTemplateName:e.secretTemplateName,order:e.order}))}),this._localizationService.getPageMessage("secretactions","processing-by-site").pipe(Object(h.a)()).subscribe(e=>{this.secretChangeInProcessBannerMessage=e}),this.updatePasswordStatus(this.secretRpc.passwordStatus),this.isLoading=!1})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(a.V),b.Ob(a.B),b.Ob(a.cb),b.Ob(o.g),b.Ob(E.c),b.Ob(a.w),b.Ob(a.fb),b.Ob(a.F),b.Ob(a.db),b.Ob(a.eb),b.Ob(l.k),b.Ob(b.h))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-rpc"]],inputs:{secretState:"secretState"},features:[b.Ab],decls:2,vars:3,consts:[[3,"active","isFullscreen"],["class","full-height thy-pos-rel",4,"ngIf"],[1,"full-height","thy-pos-rel"],["editSectionId","password-status",3,"summaryTitle","summaryDescription","showBorder",4,"ngIf"],[3,"formGroup"],["editSection","passwordtype","editSectionId","passwordtype",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm",4,"ngIf"],[3,"formGroup",4,"ngIf"],[4,"ngIf"],["editSectionId","password-status",3,"summaryTitle","summaryDescription","showBorder"],["additional-description",""],["ss-locale","password-change-fail-kb","ss-page-name","secretdetail",4,"ngIf"],[3,"labelText","labelTooltip","showActions"],["value-column",""],["class","flex middle-aligned nicely-spaced",4,"ngIf"],[3,"labelText","labelTooltip","showActions",4,"ngIf"],[3,"labelText","showActions"],["value-column","","id","rpc-status-text"],[1,"text-block"],["ss-locale","password-change-fail-kb","ss-page-name","secretdetail"],[1,"flex","middle-aligned","nicely-spaced"],["svgIcon","check_circle",1,"icon-18","success"],["id","rpc-status-text","ss-locale","success","ss-page-name","common"],["svgIcon","pending",1,"icon-18"],["id","rpc-status-text","ss-locale","pending","ss-page-name","common"],["svgIcon","not_interested",1,"icon-18","failure"],["id","rpc-status-text","ss-locale","failed","ss-page-name","common",4,"ngIf"],["id","rpc-status-text","ss-locale","canceled","ss-page-name","common",4,"ngIf"],["id","rpc-status-text","ss-locale","failed","ss-page-name","common"],["id","rpc-status-text","ss-locale","canceled","ss-page-name","common"],["value-column","","id","last-rpc-date"],[3,"value","format"],["value-column","","id","next-rpc-date"],["editSection","passwordtype","editSectionId","passwordtype",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],["formControlName","passwordTypeWebScriptId","editSection","passwordtype",3,"options"],["editSection","passwordtype",3,"save","cancel"],["editSection","rpc","labelColumnWidth","medium","editSectionId","check-out",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],[3,"thyFormLayoutRowDefinition","labelText","showActions",4,"ngIf"],[3,"labelText","thyFormLayoutRowDefinition","showActions",4,"ngIf"],[3,"labelText","thyFormLayoutRowDefinition","showActions"],["formControlName","autoChangeEnabled","editSection","rpc"],[3,"labelText","showActions",4,"ngIf"],[3,"labelText","forceRequiredMarker","showActions",4,"ngIf"],["formGroupName","autoChangeSchedule",4,"ngIf"],["editSection","rpc",3,"save","cancel"],[3,"thyFormLayoutRowDefinition","labelText","showActions"],["ss-locale","change-use-secret",4,"ngIf"],["ss-locale","change-priv-account",4,"ngIf"],["ss-locale","change-use-secret"],["ss-locale","change-priv-account"],[1,"nicely-spaced-rows"],[1,"flex","nicely-spaced","middle-aligned"],["name","changePasswordUsing","inputValue","Secret","formControlName","changePasswordUsing"],["ss-locale","creds-on-secret",3,"click"],["name","changePasswordUsing","inputValue","PrivilegedAccount","formControlName","changePasswordUsing"],["ss-locale","priv-account-creds",3,"click"],["formControlName","privilegedAccountSecretId","editSection","rpc",3,"type","initialSecretName","forceEditMode","passwordTypeIdsFilter","onlyRpcEnabledFilter","allowDoubleLocks","doNotAddTopPadding"],["formControlName","autoChangeNextPasswordType","editSection","rpc",3,"options"],[3,"labelText","forceRequiredMarker","showActions"],["formControlName","autoChangeNextPassword","editSection","rpc",3,"type","maxlength","forceEditMode","alwaysHidePasswordGenerate","context","showPasswordClick","modifyPasswordClick"],["formGroupName","autoChangeSchedule"],["formControlName","scheduleType","editSection","rpc",3,"options"],[3,"showActions",4,"ngIf"],[3,"labelTooltip","showActions",4,"ngIf"],["formControlName","startingOn","editSection","rpc","format","datetime",3,"timezone","offset","offsetDescription"],["value-column","",1,"flex","middle-aligned","nicely-spaced"],["formControlName","days","editSection","rpc",3,"minNumberValue","maxNumberValue"],["ss-locale","days"],["formControlName","weeks","editSection","rpc",3,"minNumberValue","maxNumberValue"],["ss-locale","weeks-on"],[3,"showActions"],[1,"weekcheck"],["formControlName","monday","editSection","rpc",3,"labelText"],["formControlName","tuesday","editSection","rpc",3,"labelText"],["formControlName","wednesday","editSection","rpc",3,"labelText"],["formControlName","thursday","editSection","rpc",3,"labelText"],["formControlName","friday","editSection","rpc",3,"labelText"],["formControlName","saturday","editSection","rpc",3,"labelText"],["formControlName","sunday","editSection","rpc",3,"labelText"],["value-column","",1,"flex","middle-aligned","nicely-spaced","no-break"],[1,"width-45"],["formControlName","changeEveryMonths","editSection","rpc",3,"minNumberValue","maxNumberValue"],["ss-locale","months-on"],[3,"labelTooltip","showActions"],["label-column","",3,"matTooltip"],["name","monthScheduleTypeDate","inputValue","Date","formControlName","monthScheduleType",4,"ngIf"],["ss-locale","date"],["formControlName","changeEveryMonthsDayNumber","editSection","rpc",3,"minNumberValue"],["name","monthScheduleTypeDate","inputValue","Date","formControlName","monthScheduleType"],["name","monthScheduleTypeDate","inputValue","Day","formControlName","monthScheduleType",4,"ngIf"],["ss-locale","day",1,"thy-field-label"],[1,"flex"],["formControlName","changeEveryMonthsInstance","editSection","rpc",3,"options"],["formControlName","changeEveryMonthsInstanceTarget","editSection","rpc",3,"options"],["name","monthScheduleTypeDate","inputValue","Day","formControlName","monthScheduleType"],["formControlName","onlyChangeIfExpired","editSection","rpc",3,"labelText",4,"ngIf"],["ss-locale","only-change-expired",4,"ngIf"],["formControlName","onlyChangeIfExpired","editSection","rpc",3,"labelText"],["ss-locale","only-change-expired"],["ss-locale","associated-secrets",1,"section-title"],["class","link-button","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],["class","associated-secrets-options",4,"ngIf"],["class","associated-secret-text","ss-locale","secrets-custom-scripts",4,"ngIf"],["ss-locale","no-secrets-specified","class","associated-secret-text",4,"ngIf"],[1,"associated-secret-grid"],["gridName","priv-rpc",3,"items","showSummary","isResizable","columnDefinitions"],["optionCellTemplate",""],[1,"no-results-content"],["ss-locale","edit","ss-page-name","common",1,"link-button",3,"click"],[1,"associated-secrets-options"],["id","form-edit-form-cancel","ss-locale","cancel","ss-page-name","common",1,"thy","basic","button","nohoverlink",3,"click"],["id","add-associated-secret","ss-locale","add-secret",1,"thy","basic","button","nohoverlink",3,"click"],["id","form-edit-form-save","ss-locale","save","ss-page-name","common",1,"thy","primary","button","no-right-margin",3,"click"],["ss-locale","secrets-custom-scripts",1,"associated-secret-text"],["ss-locale","no-secrets-specified",1,"associated-secret-text"],["name","arrow_drop_up",1,"svg-icon","icon-18",3,"click"],["name","arrow_drop_down",1,"svg-icon","icon-18",3,"click"],["ss-locale","remove",1,"link-button",3,"click"]],template:function(e,t){1&e&&(b.Pb(0,"thy-loading-dimmer",0),b.Mc(1,Po,6,5,"div",1)),2&e&&(b.nc("active",t.isLoading||!t.secretRpc)("isFullscreen",!0),b.Cb(1),b.nc("ngIf",t.secretRpc))},directives:[m.h,i.o,o.E,o.t,o.l,l.e,l.f,f.a,st.a,B.a,l.h,o.s,o.j,l.d,l.b,Jt.a,j.a,o.o,o.m,l.c,l.g,R.a,L.a,n.b],pipes:[i.b,bt.a],styles:[".rpc-radio-opton[_ngcontent-%COMP%]{margin-bottom:16px}.rpc-radio-opton[_ngcontent-%COMP%]:first-child{margin-top:8px}.width-45[_ngcontent-%COMP%]{margin-right:16px}.weekcheck[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inlineDiv[_ngcontent-%COMP%]{display:inline-block}.middleAlign[_ngcontent-%COMP%]{vertical-align:middle}.topAlign[_ngcontent-%COMP%]{vertical-align:top}.containerDiv[_ngcontent-%COMP%]{text-align:left;margin:3px 0}.schedule[_ngcontent-%COMP%]{background:var(--row-hover-1);border:1px solid var(--border-color-1);padding:16px}.disabledMove[_ngcontent-%COMP%]{color:var(--font-color-3);fill:var(--font-color-3);cursor:default!important}div.day-grid[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:not(:first-child){padding-top:0!important}div.day-grid[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:not(:last-child){padding-bottom:0!important}.change-every[_ngcontent-%COMP%]{text-transform:lowercase}.change-every[_ngcontent-%COMP%]:first-letter{text-transform:uppercase}.change-units[_ngcontent-%COMP%]{text-transform:lowercase}.associated-secret-text[_ngcontent-%COMP%]{margin:16px 0}.associated-secrets-options[_ngcontent-%COMP%]{margin-top:16px}.associated-secret-grid[_ngcontent-%COMP%]{margin-bottom:16px}.associated-secret-grid.associated-edit-mode[_ngcontent-%COMP%]{min-height:300px}"]}),e=Object(P.b)([Object(M.a)()],e),e})();function ko(e,t){1&e&&(b.Ub(0,"option"),b.Oc(1),b.gc(2,"async"),b.gc(3,"ssLocale"),b.Tb()),2&e&&(b.Cb(1),b.Qc("-- ",b.hc(2,1,b.hc(3,3,"select-type"))," --"))}function xo(e,t){if(1&e&&(b.Ub(0,"option",20),b.Oc(1),b.Tb()),2&e){const e=b.fc().$implicit,t=b.fc();b.nc("value",e.templateId)("selected",t.isTemplateSelected(e)),b.Db("dependencyTypeId",e.dependencyTypeId),b.Cb(1),b.Pc(e.templateName)}}function Do(e,t){if(1&e&&(b.Sb(0),b.Mc(1,xo,2,4,"option",19),b.Rb()),2&e){const e=t.$implicit;b.Cb(1),b.nc("ngIf",!e.scripts||0===e.scripts.length)}}function Fo(e,t){if(1&e&&(b.Ub(0,"option",24),b.Oc(1),b.Tb()),2&e){const e=t.$implicit,s=b.fc(2).$implicit,i=b.fc();b.nc("value",e.scriptId)("selected",i.isScriptSelected(s,e)),b.Db("dependencyTypeId",s.dependencyTypeId),b.Cb(1),b.Pc(e.scriptName)}}function Uo(e,t){if(1&e&&(b.Ub(0,"optgroup",22),b.Mc(1,Fo,2,4,"option",23),b.Tb()),2&e){const e=b.fc().$implicit;b.nc("label",e.templateName),b.Cb(1),b.nc("ngForOf",e.scripts)}}function Ao(e,t){if(1&e&&(b.Sb(0),b.Mc(1,Uo,2,2,"optgroup",21),b.Rb()),2&e){const e=t.$implicit;b.Cb(1),b.nc("ngIf",e.scripts&&e.scripts.length>0)}}function Eo(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",8),b.Ub(1,"label",35),b.Oc(2,"Dependency Group"),b.Tb(),b.Pb(3,"ss-form-input",36),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1),b.Cb(3),b.nc("type",e.formInputType.DropDown)("options",e.dependencyGroups)}}function Ro(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",8),b.Ub(1,"label",37),b.Oc(2," New Group Name "),b.Tb(),b.Pb(3,"ss-form-input",38),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1),b.Cb(1),b.nc("matTooltip",e.newGroupNameTip),b.Cb(2),b.nc("type",e.formInputType.String)}}function No(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",8),b.Ub(1,"label",39),b.Oc(2," New Group Site "),b.Tb(),b.Pb(3,"ss-form-input",40),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1),b.Cb(1),b.nc("matTooltip",e.newGroupSiteTip),b.Cb(2),b.nc("type",e.formInputType.DropDown)("options",e.siteOptions)}}function Lo(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",8),b.Ub(1,"label",41),b.Oc(2,"Sort Order"),b.Tb(),b.Pb(3,"ss-form-input",42),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1),b.Cb(3),b.nc("type",e.formInputType.Number)}}function Vo(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",8),b.Ub(1,"label",43),b.Oc(2),b.Tb(),b.Ub(3,"div",44),b.Oc(4),b.Tb(),b.Tb()),2&e){const e=t.$implicit;b.nc("showActions",!1),b.Cb(2),b.Pc(e.scriptConditionTypeName),b.Cb(2),b.Qc(" ",e.scriptName," ")}}function qo(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",26),b.Pb(1,"ss-form-input",45),b.Tb()),2&e){const e=b.fc(2);b.nc("viewField",e.dependency.runCondition)("showActions",!1),b.Cb(1),b.nc("type",e.formInputType.DropDown)("options",e.runConditionOptions)}}function Go(e,t){if(1&e&&(b.Ub(0,"ss-layout-form-row",26),b.Pb(1,"ss-form-input",46),b.Tb()),2&e){const e=b.fc(2);b.nc("viewField",e.dependency.runConditionDependency)("showActions",!1),b.Cb(1),b.nc("type",e.formInputType.DropDown)("options",e.runConditionDependencyOptions)}}function zo(e,t){if(1&e){const e=b.Vb();b.Ub(0,"ss-layout-form-row",26),b.Ub(1,"ss-form-input",47),b.bc("click",function(){b.Ec(e);const t=b.fc().$implicit;return b.fc(2).updateField(t,!0)})("keyup",function(){b.Ec(e);const t=b.fc().$implicit;return b.fc(2).updateField(t,!1)}),b.Tb(),b.Tb()}if(2&e){const e=b.fc().$implicit,t=b.fc(2);b.nc("viewField",e)("showActions",!1),b.Cb(1),b.nc("formControlName",t.getFieldKey(e))("type",t.getFieldType(e.type))("viewField",e)}}function Bo(e,t){if(1&e&&(b.Sb(0,3),b.Mc(1,zo,2,5,"ss-layout-form-row",31),b.Rb()),2&e){const e=b.fc(2);b.nc("formGroup",e.dependencyFields),b.Cb(1),b.nc("ngIf",!e.isLoading)}}function jo(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Mc(1,Eo,4,3,"ss-layout-form-row",25),b.Mc(2,Ro,4,3,"ss-layout-form-row",25),b.Mc(3,No,4,4,"ss-layout-form-row",25),b.Mc(4,Lo,4,2,"ss-layout-form-row",25),b.Ub(5,"ss-layout-form-row",26),b.Pb(6,"ss-form-input",27),b.Tb(),b.Ub(7,"ss-layout-form-row",26),b.Pb(8,"ss-form-input",28),b.Tb(),b.Mc(9,Vo,5,3,"ss-layout-form-row",29),b.Ub(10,"ss-layout-form-row",26),b.Pb(11,"ss-form-input",30),b.Tb(),b.Mc(12,qo,2,4,"ss-layout-form-row",31),b.Mc(13,Go,2,4,"ss-layout-form-row",31),b.Ub(14,"ss-layout-form-row",26),b.Ub(15,"ss-form-input",32),b.bc("secretSelected",function(t){return b.Ec(e),b.fc().updatePrivilegedAccountSecret(t)}),b.Tb(),b.Tb(),b.Ub(16,"ss-layout-form-row",26),b.Ub(17,"ss-form-input",33),b.bc("secretSelected",function(t){return b.Ec(e),b.fc().updateSSHKeySecret(t)}),b.Tb(),b.Tb(),b.Mc(18,Bo,2,2,"ng-container",34),b.Rb()}if(2&e){const e=b.fc();b.Cb(1),b.nc("ngIf",e.isTypeSelected),b.Cb(1),b.nc("ngIf",e.isTypeSelected&&-1===e.form.value.dependencyGroupId),b.Cb(1),b.nc("ngIf",e.isTypeSelected&&-1===e.form.value.dependencyGroupId),b.Cb(1),b.nc("ngIf",e.isTypeSelected&&e.context.dependencyId),b.Cb(1),b.nc("viewField",e.dependency.name)("showActions",!1),b.Cb(1),b.nc("type",e.formInputType.String),b.Cb(1),b.nc("viewField",e.dependency.description)("showActions",!1),b.Cb(1),b.nc("type",e.formInputType.String),b.Cb(1),b.nc("ngForOf",null==e.dependency?null:e.dependency.scripts),b.Cb(1),b.nc("viewField",e.dependency.active)("showActions",!1),b.Cb(1),b.nc("type",e.formInputType.Boolean),b.Cb(1),b.nc("ngIf",(null==e.dependency.sortOrder?null:e.dependency.sortOrder.value)>1),b.Cb(1),b.nc("ngIf",(null==e.dependency.sortOrder?null:e.dependency.sortOrder.value)>1&&("SpecificDependencySucceeds"===e.form.value.runCondition||"SpecificDependencyFails"===e.form.value.runCondition)),b.Cb(1),b.nc("viewField",e.dependency.runAsPrivilegedAccountSecretId)("showActions",!1),b.Cb(1),b.nc("initialSecretName",null==e.dependency||null==e.dependency.runAsPrivilegedAccountSecretId?null:e.dependency.runAsPrivilegedAccountSecretId.name)("type",e.formInputType.Secret)("passwordTypeIdsFilter",null==e.dependency?null:e.dependency.runAsPasswordTypeIds)("showShowRecommended",!0),b.Cb(1),b.nc("viewField",e.dependency.sshKeySecretId)("showActions",!1),b.Cb(1),b.nc("initialSecretName",null==e.dependency||null==e.dependency.sshKeySecretId?null:e.dependency.sshKeySecretId.name)("type",e.formInputType.Secret)("showShowRecommended",!0)("extendedTypeIdFilter",null==e.dependency?null:e.dependency.sshKeyExtendedTypeId),b.Cb(1),b.nc("ngForOf",null==e.dependency?null:e.dependency.fields)}}let Wo=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a){this.context=e,this.dialog=t,this._dependencyService=s,this._ies=i,this._localizationService=n,this._errorService=r,this._logService=c,this._siteService=a,this.templates=[],this.dependencyGroups=[],this.dependency=null,this.formInputType=A.a,this.isLoading=!0,this.standard="Standard",this.runConditionOptions=[{text:"Always Run",value:"AlwaysRun"},{text:"All Dependencies Above Succeed",value:"AllPriorSucceeded"},{text:"Any Dependency Above Fails",value:"AnyPriorFail"},{text:"Specific Dependency Succeeds",value:"SpecificDependencySucceeds"},{text:"Specific Dependency Fails",value:"SpecificDependencyFails"}],this.runConditionDependencyOptions=[],this.ies=null,this.isTypeSelected=!1,this.form=new o.k({dependencyTemplateId:new o.h(""),sortOrder:new o.h(999999),dependencyTypeId:new o.h,dependencyScriptId:new o.h,dependencyGroupId:new o.h(-1,o.C.required),dependencyNewGroupName:new o.h("",k.a.conditionalRequired(()=>{var e,t;return-1===(null===(t=null===(e=this.form)||void 0===e?void 0:e.controls.dependencyGroupId)||void 0===t?void 0:t.value)})),dependencyNewGroupSite:new o.h("-1"),name:new o.h("",[o.C.required,k.a.requiredNotEmpty]),description:new o.h,active:new o.h,runAsPrivilegedAccountSecretId:new o.h,sshKeySecretId:new o.h,runCondition:new o.h,runConditionDependency:new o.h,fields:new o.k({})}),this.pageTitle="Create Dependency",this.pageName="secretdetail",this.dependencyFields=new o.k({}),this.newGroupNameTip="",this.newGroupSiteTip="",this.siteOptions=[],this._oldFormData=null,this._assigningForm=!1,this._previousScanItems=new Map,this._addedNewGroup=!1,this.ies=i}ngOnInit(){this._initForm(),this.ies.enableEditMode("dependency",this.form),this.standard=this._localizationService.getCachedMessage("standard"),this.newGroupNameTip=this._localizationService.getCachedMessage("new-group-name-description"),this.newGroupSiteTip=this._localizationService.getCachedMessage("new-group-site-description"),this._loadSites(),this._dependencyService.getDependencyTemplates().pipe(Object(h.a)()).subscribe(e=>{this.templates=e}),this._dependencyService.getDependencyGroups(this.context.secretId).pipe(Object(h.a)()).subscribe(e=>{this.dependencyGroups.push({text:this._localizationService.getCachedMessage("create-new-group"),value:-1}),e.forEach(e=>{this.dependencyGroups.push({text:e.groupName,value:e.groupId})})}),this.context.dependencyId?(this._localizationService.getPageMessage(this.pageName,"edit-dependency").pipe(Object(h.a)()).subscribe(e=>{this.pageTitle=e}),this._dependencyService.getDependency(this.context.secretId,this.context.dependencyId).pipe(Object(h.a)()).subscribe({next:e=>{this.dependency=e,this._assignForm(!1)},error:e=>{if("API_AccessDenied"!==this._errorService.getErrorMessage(e).errorCode)throw e;this.isLoading=!1,this._logService.Warning(`The dependency id ${this.context.dependencyId} failed to load`),this.dialog.close({isApproved:!1,deniedContext:!1})}})):(this._localizationService.getPageMessage(this.pageName,"create-dependency").pipe(Object(h.a)()).subscribe(e=>{this.pageTitle=e}),this.isLoading=!1),this.form.controls.runCondition.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{"SpecificDependencySucceeds"===e||"SpecificDependencyFails"===e?(this._assignDependencyGroupOption(),this.form.controls.runConditionDependency.setValidators(o.C.required)):this.form.controls.runConditionDependency.clearValidators(),this.form.controls.runConditionDependency.updateValueAndValidity()}),this.form.controls.dependencyGroupId.valueChanges.subscribe(e=>{this.form.controls.dependencyNewGroupName.updateValueAndValidity()})}_loadSites(){this.siteOptions.length>0||(this.siteOptions.push({text:this._localizationService.getCachedMessage("use-site-from-secret"),value:"-1"}),this._siteService.getSites().pipe(Object(h.a)()).subscribe({next:e=>{e.forEach(e=>{e.active&&this.siteOptions.push({text:e.siteName,value:e.siteId})}),this.siteOptions=this.siteOptions.slice(0)}}))}onChangeType(e){const t=e.options[e.selectedIndex].getAttribute("dependencyType"),s=e.options[e.selectedIndex].value;let i=null,n=null;if("template"===t){if(i=parseInt(s,10),isNaN(i))return}else if(n=parseInt(s,10),isNaN(n))return;if(this.form.controls.dependencyTemplateId.setValue(i),this.dependency&&this.dependency.dependencyTemplateId&&this.dependency.dependencyTemplateId.value===i||this.form.controls.dependencyTemplateId.markAsDirty(),this.form.controls.dependencyScriptId.setValue(n),this.dependency&&this.dependency.dependencyScriptId&&this.dependency.dependencyScriptId.value===n||this.form.controls.dependencyScriptId.markAsDirty(),this.dependency){this._oldFormData=this.form.value;const e=this.form.controls.fields;this.dependency.fields.forEach(t=>{const s=this.getFieldKey(t);"ScanItem"===t.category.toString()&&e.controls[s]&&(this._previousScanItems[t.name.toLowerCase()]=e.controls[s].value)})}this.dependencyFields=new o.k({}),this._initForm(),this.stub(this.context.secretId,i,n)}updatePrivilegedAccountSecret(e){this.dependency.runAsPrivilegedAccountSecretId.value=e.id,this.dependency.runAsPrivilegedAccountSecretId.name=e.name}updateSSHKeySecret(e){this.dependency.sshKeySecretId.value=e.id,this.dependency.sshKeySecretId.name=e.name}stub(e,t,s){this._assigningForm||(this.isLoading=!0,this._dependencyService.stubDependency(e,t,s).pipe(Object(h.a)()).subscribe(e=>{if(this.dependency&&(this.dependency.runAsPrivilegedAccountSecretId&&(e.runAsPrivilegedAccountSecretId=this.dependency.runAsPrivilegedAccountSecretId),this.dependency.sshKeySecretId&&(e.sshKeySecretId=this.dependency.sshKeySecretId)),this.dependency=e,this._assignForm(!0),this.form.controls.active.setValue(!0),this._oldFormData&&this.form.patchValue(this._oldFormData),this._previousScanItems){const e=this.form.controls.fields;this.dependency.fields.forEach(t=>{"ScanItem"===t.category.toString()&&this._previousScanItems[t.name.toLowerCase()]&&e.controls[this.getFieldKey(t)].setValue(this._previousScanItems[t.name.toLowerCase()])}),this.form.updateValueAndValidity()}1===this.dependencyGroups.length&&this.form.controls.dependencyGroupId.setValue(this.dependencyGroups[0].value),this.form.controls.dependencyTemplateId.markAsDirty(),this.form.controls.dependencyScriptId.markAsDirty(),this.form.markAsDirty(),this.isLoading=!1}))}cancel(){this.dialog.close({isApproved:!1,deniedContext:!0})}showField(e){return this.dependency&&e&&!e.hidden}updateField(e,t){const s=this.form.controls.fields,i=this.getFieldKey(e),o=s.get(i);(this.getFieldType(e.type)===A.a.Boolean&&t||!t)&&(o.markAsDirty(),o.updateValueAndValidity(),this.form.markAsDirty(),this.form.updateValueAndValidity())}save(){if(this.form.value.dependencyGroupId>-1)return this._addedNewGroup=!1,void this.saveDependency();this.dependencyGroups.map(e=>e.text.toLocaleLowerCase()).indexOf(this.form.value.dependencyNewGroupName.toLocaleLowerCase())>=0?this.form.controls.dependencyNewGroupName.setErrors({valueAlreadyExists:{valid:!1}}):this._dependencyService.SaveDependencyGroup(null,this.context.secretId,this.form.value.dependencyNewGroupName,"-1"===this.form.value.dependencyNewGroupSite?null:this.form.value.dependencyNewGroupSite).pipe(Object(h.a)()).subscribe(e=>{this._dependencyService.getDependencyGroups(this.context.secretId).pipe(Object(h.a)()).subscribe(e=>{const t=e.map(e=>e.groupName).indexOf(this.form.value.dependencyNewGroupName);this.form.controls.dependencyGroupId.setValue(e[t].groupId),this._addedNewGroup=!0,this.saveDependency()})})}saveDependency(){this.ies.isSaving=!0;const e={groupId:this.form.value.dependencyGroupId,isNew:!0,addedNewGroup:this._addedNewGroup};if(this.context.dependencyId){e.isNew=!1;const t=this.ies.createUpdateModel(this.form);t.fields=[];const s=this.form.controls.fields;this.dependency.fields.forEach(e=>{const i=this.getFieldKey(e),o=s.get(i);o.dirty&&t.fields.push({category:e.category,id:e.id,name:e.name,parentName:e.parentName,value:o.value,dirty:!0})}),this._dependencyService.updateDependency(this.context.secretId,this.context.dependencyId,t).pipe(Object(h.a)()).subscribe({next:t=>{this.ies.disableEditMode("dependency",!1),this.dialog.close({isApproved:!0,approvedContext:e})},error:e=>{this.ies.assignErrorToFormGroup(this.form,e)}})}else{e.isNew=!0;const t=[],s=this.form.controls.fields;this.dependency.fields.forEach(e=>{const i={category:e.category,id:e.id,name:e.name,parentName:e.parentName,type:e.type,value:s.controls[this.getFieldKey(e)].value};t.push(i)}),this._dependencyService.createDependency(this.context.secretId,{active:!!this.form.value.active,description:this.form.value.description,dependencyGroupId:this.form.value.dependencyGroupId,name:this.form.value.name,runAsPrivilegedAccountSecretId:this.form.value.runAsPrivilegedAccountSecretId,runCondition:1,runConditionDependency:this.form.value.runConditionDependency,sSHKeySecretId:this.form.value.sshKeySecretId,dependencyScriptId:this.form.value.dependencyTemplateId?null:this.form.value.dependencyScriptId,secretId:this.form.value.secretId,dependencyTemplateId:this.form.value.dependencyTemplateId,fields:t}).pipe(Object(h.a)()).subscribe({next:t=>{this.ies.disableEditMode("dependency",!1),this.dialog.close({isApproved:!0,approvedContext:e})},error:e=>{this.ies.assignErrorToFormGroup(this.form,e)}})}}isTemplateSelected(e){return!!this.dependency&&this.dependency.dependencyTypeId&&this.dependency.dependencyTypeId.value===e.dependencyTypeId&&this.dependency.dependencyTemplateId&&this.dependency.dependencyTemplateId.value===e.templateId}isScriptSelected(e,t){return!(!this.dependency||!this.dependency.dependencyChangerId)&&(!this.dependency.dependencyChangerId||!this.dependency.dependencyChangerId.value)&&this.dependency.dependencyTypeId&&this.dependency.dependencyTypeId.value===e.dependencyTypeId&&this.dependency.dependencyScriptId&&this.dependency.dependencyScriptId.value===t.scriptId}_initForm(){this.form.controls.fields=this.dependencyFields}_assignForm(e){this._assigningForm=!0,this.ies.patchViewModel(this.form,this.dependency),this.isTypeSelected=!1,this.dependency.dependencyTemplateId?(this.isTypeSelected=!0,this.form.controls.dependencyTemplateId.setValue(this.dependency.dependencyTemplateId.value)):this.form.controls.dependencyTemplateId.setValue(null),this.dependency.dependencyScriptId?(this.isTypeSelected=!0,this.form.controls.dependencyScriptId.setValue(this.dependency.dependencyScriptId.value)):this.form.controls.dependencyScriptId.setValue(null),this.dependency.fields.forEach(e=>{const t=new Pi.a(e.label);t.setValue("False"!==e.value&&("True"===e.value||e.value)),e.isRequired?t.setValidators([o.C.required,k.a.requiredNotEmpty]):t.clearValidators(),this.dependencyFields.addControl(this.getFieldKey(e),t)}),this.form.updateValueAndValidity(),this._assigningForm=!1,this.isLoading=!1}getFieldKey(e){return`f${e.name}${e.id}${e.category}`}getFieldType(e){switch(e){case D.e.Boolean:return A.a.Boolean;case D.e.Integer:return A.a.Number;default:return A.a.String}}_assignDependencyGroupOption(){this._dependencyService.GetDependencyGroupsForSecret(this.context.secretId).pipe(Object(h.a)()).subscribe(e=>{e.forEach(e=>{this.form.value.dependencyGroupId===e.SecretDependencyGroupId&&e.Dependencies.forEach(e=>{e.SortOrder<this.dependency.sortOrder.value&&this.runConditionDependencyOptions.push({text:e.ServiceName,value:e.SecretDependencyId.toString()})})}),this.runConditionDependencyOptions=this.runConditionDependencyOptions.slice(0)})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(E.a),b.Ob(E.i),b.Ob(a.k),b.Ob(a.B),b.Ob(a.F),b.Ob(a.eb),b.Ob(a.fb),b.Ob(a.X))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-dependency-edit-modal"]],features:[b.Bb([],[a.B])],decls:30,vars:27,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["editSection","dependency",3,"ssForm"],[3,"formGroup"],[1,"ui","segment","inverted","dimmer"],[1,"ui","loader"],[1,"ui","form",3,"formGroup"],[3,"noBottomMargin"],[3,"showActions"],["label-column","","ss-locale","type",1,"header","required-field"],["value-column",""],[3,"change"],[4,"ngIf"],[4,"ngFor","ngForOf"],["mat-dialog-actions",""],[1,"thy","basic","button",3,"click"],[1,"no-right-margin",2,"display","inline-block",3,"matTooltip"],[1,"thy","primary","button","no-right-margin",3,"disabled","click"],[2,"clear","right"],["dependencyType","template",3,"value","selected",4,"ngIf"],["dependencyType","template",3,"value","selected"],[3,"label",4,"ngIf"],[3,"label"],["dependencyType","script",3,"value","selected",4,"ngFor","ngForOf"],["dependencyType","script",3,"value","selected"],[3,"showActions",4,"ngIf"],[3,"viewField","showActions"],["formControlName","name","editSection","dependency",3,"type"],["formControlName","description","editSection","dependency",3,"type"],[3,"showActions",4,"ngFor","ngForOf"],["formControlName","active","editSection","dependency",3,"type"],[3,"viewField","showActions",4,"ngIf"],["formControlName","runAsPrivilegedAccountSecretId","editSection","dependency",3,"initialSecretName","type","passwordTypeIdsFilter","showShowRecommended","secretSelected"],["formControlName","sshKeySecretId","editSection","dependency",3,"initialSecretName","type","showShowRecommended","extendedTypeIdFilter","secretSelected"],[3,"formGroup",4,"ngFor","ngForOf"],["label-column","","ss-locale","dependency-group",1,"header","required-field"],["formControlName","dependencyGroupId","editSection","dependency",3,"type","options"],["label-column","","ss-locale","new-group-name",1,"header","required-field",3,"matTooltip"],["formControlName","dependencyNewGroupName","editSection","dependency",3,"type"],["label-column","","ss-locale","new-group-site",1,"header","required-field",3,"matTooltip"],["formControlName","dependencyNewGroupSite","editSection","dependency",3,"type","options"],["label-column","","ss-locale","sort-order",1,"header","required-field"],["formControlName","sortOrder","editSection","dependency",3,"type"],["label-column",""],["value-column","",1,"top-padded-layout-cell"],["formControlName","runCondition","editSection","dependency",3,"type","options"],["formControlName","runConditionDependency","editSection","dependency",3,"type","options"],["editSection","dependency",3,"formControlName","type","viewField","click","keyup"]],template:function(e,t){1&e&&(b.Ub(0,"h1",0),b.Oc(1),b.Tb(),b.Ub(2,"div",1),b.Pb(3,"ss-validation-summary",2),b.Ub(4,"form",3),b.Ub(5,"div",4),b.Pb(6,"div",5),b.Tb(),b.Ub(7,"div",6),b.Ub(8,"ss-layout-form",7),b.Ub(9,"ss-layout-form-row",8),b.Ub(10,"label",9),b.Oc(11,"Type"),b.Tb(),b.Ub(12,"div",10),b.Ub(13,"select",11),b.bc("change",function(e){return t.onChangeType(e.target)}),b.Mc(14,ko,4,5,"option",12),b.Ub(15,"optgroup"),b.Mc(16,Do,2,1,"ng-container",13),b.Tb(),b.Mc(17,Ao,2,1,"ng-container",13),b.Tb(),b.Tb(),b.Tb(),b.Mc(18,jo,19,29,"ng-container",12),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(19,"div",14),b.Ub(20,"button",15),b.bc("click",function(){return t.cancel()}),b.Oc(21),b.gc(22,"async"),b.gc(23,"ssLocale"),b.Tb(),b.Ub(24,"div",16),b.Ub(25,"button",17),b.bc("click",function(){return t.save()}),b.Oc(26),b.gc(27,"async"),b.gc(28,"ssLocale"),b.Tb(),b.Tb(),b.Pb(29,"div",18),b.Tb()),2&e&&(b.Cb(1),b.Pc(t.pageTitle),b.Cb(2),b.nc("ssForm",t.form),b.Cb(1),b.nc("formGroup",t.form),b.Cb(1),b.Gb("active",t.isLoading),b.Cb(2),b.nc("formGroup",t.form),b.Cb(1),b.nc("noBottomMargin",!0),b.Cb(1),b.nc("showActions",!1),b.Cb(5),b.nc("ngIf",!t.dependency),b.Cb(1),b.Db("label",t.standard),b.Cb(1),b.nc("ngForOf",t.templates),b.Cb(1),b.nc("ngForOf",t.templates),b.Cb(1),b.nc("ngIf",t.dependency),b.Cb(3),b.Pc(b.hc(22,17,b.ic(23,19,"cancel","common"))),b.Cb(3),b.nc("matTooltip",t.ies.okButtonTooltip),b.Cb(1),b.nc("disabled",t.ies.isSaveDisabled("dependency")),b.Cb(1),b.Pc(b.hc(27,22,b.ic(28,24,"save","common"))))},directives:[E.j,E.g,q.a,o.E,o.t,o.l,G.a,z.a,f.a,i.o,i.n,E.d,R.a,o.w,o.D,j.a,o.s,o.j],pipes:[i.b,bt.a],styles:[".header[_ngcontent-%COMP%]{font-weight:700;margin:0 0 .28571429rem;color:var(--font-color-1);word-break:break-word}"]}),e=Object(P.b)([Object(M.a)()],e),e})();function Ho(e,t){1&e&&(b.Ub(0,"div"),b.Oc(1," There are no history entries for this Secret Dependency. "),b.Tb())}const Ko=function(e){return{propertyName:"dateRecorded",displayName:"Date Recorded",displayNameLocale:"date-recorded",columnType:e,pageNameOverride:"common"}},Qo=function(){return{propertyName:"message",displayName:"Message",displayNameLocale:"message",pageNameOverride:"common"}},$o=function(e,t){return[e,t]};function Zo(e,t){if(1&e&&(b.Ub(0,"div"),b.Pb(1,"ss-grid",7),b.Tb()),2&e){const e=b.fc(2);b.Cb(1),b.nc("items",e.items)("columnDefinitions",b.tc(7,$o,b.sc(4,Ko,e.ColumnType.DateTime),b.rc(6,Qo)))("orderByField","dateRecorded")("defaultOrderAscending",!1)}}function Yo(e,t){if(1&e&&(b.Ub(0,"div"),b.Mc(1,Ho,2,0,"div",4),b.Mc(2,Zo,2,10,"div",4),b.Tb()),2&e){const e=b.fc();b.Cb(1),b.nc("ngIf",!e.items||0===e.items.length),b.Cb(1),b.nc("ngIf",e.items&&e.items.length>0)}}let Jo=(()=>{class e{constructor(e,t,s){this.context=e,this.dialog=t,this._dependencyService=s,this.items=null,this.isLoading=!0,this.ColumnType=oi.a}ngOnInit(){this._dependencyService.GetLogsForDependency(this.context.secretId,this.context.secretDependencyId).pipe(Object(h.a)()).subscribe(e=>{this.items=e,this.isLoading=!1})}}return e.\u0275fac=function(t){return new(t||e)(b.Ob(E.a),b.Ob(E.i),b.Ob(a.k))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-dependency-history-modal"]],decls:9,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"historyModal","thy-pos-rel"],[3,"active"],[4,"ngIf"],["mat-dialog-actions",""],["mat-dialog-close","","autofocus","",1,"thy","primary","button"],["gridName","secret-dependency-history",3,"items","columnDefinitions","orderByField","defaultOrderAscending"]],template:function(e,t){1&e&&(b.Ub(0,"h1",0),b.Oc(1,"Secret Dependency History"),b.Tb(),b.Ub(2,"div",1),b.Ub(3,"div",2),b.Pb(4,"thy-loading-dimmer",3),b.Mc(5,Yo,3,2,"div",4),b.Tb(),b.Tb(),b.Ub(6,"div",5),b.Ub(7,"button",6),b.Oc(8,"OK"),b.Tb(),b.Tb()),2&e&&(b.Cb(4),b.nc("active",t.isLoading),b.Cb(1),b.nc("ngIf",!t.isLoading))},directives:[E.j,E.g,m.h,i.o,E.d,E.e,L.a],styles:[".historyModal[_ngcontent-%COMP%]{height:400px;overflow:auto;margin-bottom:16px}"]}),e})();var Xo=s("gtor"),en=s("6L6c");const tn=["runResultTemplate"],sn=["checkBoxTemplate"],on=["checkBoxHeaderTemplate"],nn=["rowOptionButton"],rn=["rowGroupOptionButton"],cn=["templateFilter"],an=["statusFilter"],ln=["searchContextInput"];function dn(e,t){1&e&&b.Pb(0,"div",14)}function hn(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Mc(1,dn,1,0,"div",11),b.Ub(2,"div",12),b.Ub(3,"ss-checkbox",13),b.bc("ngModelChange",function(t){return b.Ec(e),b.fc(3).checkAllDependency(t)}),b.Tb(),b.Tb(),b.Rb()}if(2&e){const e=b.fc(3);b.Cb(1),b.nc("ngIf",e.groupDependencies.length>1&&!e.isIE),b.Cb(1),b.Gb("some-selected",e.groupHasSelections),b.Cb(1),b.nc("checked",e.allSelected)("ngModel",e.allSelected)("indeterminate",e.indeterminateGroup)}}function un(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.gc(2,"ssItemCount"),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.Pc(b.hc(2,1,null==e.groupPageRequests||null==e.groupPageRequests.results?null:e.groupPageRequests.results.totalRecords))}}function pn(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.gc(2,"ssItemCount"),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.Pc(b.hc(2,1,e.groupSelectedIds.length))}}function bn(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"select",15),b.bc("change",function(t){return b.Ec(e),b.fc(3).selectAction(t)}),b.Ub(2,"option",16),b.Oc(3),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Tb(),b.Ub(6,"option",17),b.Oc(7),b.gc(8,"async"),b.gc(9,"ssLocale"),b.Tb(),b.Ub(10,"option",18),b.Oc(11),b.gc(12,"async"),b.gc(13,"ssLocale"),b.Tb(),b.Ub(14,"option",19),b.Oc(15),b.gc(16,"async"),b.gc(17,"ssLocale"),b.Tb(),b.Ub(18,"option",20),b.Oc(19),b.gc(20,"async"),b.gc(21,"ssLocale"),b.Tb(),b.Tb(),b.Tb()}2&e&&(b.Cb(3),b.Qc("-- ",b.hc(4,5,b.hc(5,7,"select-bulk-dependency-action"))," --"),b.Cb(4),b.Pc(b.hc(8,9,b.hc(9,11,"delete-selected-dependencies"))),b.Cb(4),b.Pc(b.hc(12,13,b.hc(13,15,"enable-selected-dependencies"))),b.Cb(4),b.Pc(b.hc(16,17,b.hc(17,19,"disable-selected-dependencies"))),b.Cb(4),b.Pc(b.hc(20,21,b.hc(21,23,"run-selected-dependencies"))))}function mn(e,t){if(1&e){const e=b.Vb();b.Ub(0,"li",30),b.bc("click",function(t){b.Ec(e);const s=b.fc().$implicit;return b.fc(4).setTemplate(s,t)}),b.Oc(1),b.Tb()}if(2&e){const e=b.fc().$implicit,t=b.fc(4);b.Gb("selected",t.groupFilter.templateId===e.templateId),b.Cb(1),b.Pc(e.templateName)}}function gn(e,t){if(1&e&&(b.Sb(0),b.Mc(1,mn,2,3,"li",29),b.Rb()),2&e){const e=t.$implicit;b.Cb(1),b.nc("ngIf",e.templateId)}}const fn=function(){return{"width.px":"18"}};function vn(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Ub(1,"ss-context-button",21,22),b.Ub(3,"span",23),b.Ub(4,"span"),b.Oc(5),b.Tb(),b.Pb(6,"svg-icon",24),b.Tb(),b.Ub(7,"span",25),b.Ub(8,"ul",26),b.Ub(9,"li",27),b.bc("click",function(t){return b.Ec(e),b.fc(3).setTemplate(null,t)}),b.Oc(10,"All Templates"),b.Tb(),b.Mc(11,gn,2,1,"ng-container",28),b.Tb(),b.Tb(),b.Tb(),b.Rb()}if(2&e){const e=b.fc(3);b.Cb(1),b.nc("contextLinkButton",!0)("topMargin",12)("menuWidth",200),b.Cb(4),b.Pc(e.groupSelectedTemplateFilter),b.Cb(1),b.nc("svgStyle",b.rc(10,fn)),b.Cb(2),b.Gb("context-menu-scroll",(null==e.groupPageRequests||null==e.groupPageRequests.results?null:e.groupPageRequests.results.totalRecords)>7||e.templates.length>7),b.Cb(1),b.Gb("selected",!e.groupFilter.templateId),b.Cb(2),b.nc("ngForOf",e.templates)}}function yn(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Ub(1,"ss-context-button",21,31),b.Ub(3,"span",23),b.Ub(4,"span"),b.Oc(5),b.Tb(),b.Pb(6,"svg-icon",24),b.Tb(),b.Ub(7,"span",25),b.Ub(8,"ul",26),b.Ub(9,"li",32),b.bc("click",function(t){return b.Ec(e),b.fc(3).setStatusFilter(null,t)}),b.Oc(10,"All Run Results"),b.Tb(),b.Ub(11,"li",33),b.bc("click",function(t){b.Ec(e);const s=b.fc(3);return s.setStatusFilter(s.dependencyRunResultStatus.Failed,t)}),b.Oc(12,"Failed"),b.Tb(),b.Ub(13,"li",34),b.bc("click",function(t){b.Ec(e);const s=b.fc(3);return s.setStatusFilter(s.dependencyRunResultStatus.NotRun,t)}),b.Oc(14,"Not Run"),b.Tb(),b.Ub(15,"li",35),b.bc("click",function(t){b.Ec(e);const s=b.fc(3);return s.setStatusFilter(s.dependencyRunResultStatus.Success,t)}),b.Oc(16,"Success"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Rb()}if(2&e){const e=b.fc(3);b.Cb(1),b.nc("contextLinkButton",!0)("topMargin",12)("menuWidth",200),b.Cb(4),b.Pc(e.groupSelectedStatusFilter),b.Cb(1),b.nc("svgStyle",b.rc(13,fn)),b.Cb(3),b.Gb("selected",!e.groupFilter.lastRunStatus),b.Cb(2),b.Gb("selected",e.groupFilter.lastRunStatus===e.dependencyRunResultStatus.Failed),b.Cb(2),b.Gb("selected",e.groupFilter.lastRunStatus===e.dependencyRunResultStatus.NotRun),b.Cb(2),b.Gb("selected",e.groupFilter.lastRunStatus===e.dependencyRunResultStatus.Success)}}function Sn(e,t){if(1&e&&(b.Ub(0,"span",46),b.Oc(1),b.Tb()),2&e){const e=b.fc(4);b.Cb(1),b.Pc(e.groupFilter.searchText)}}function wn(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",47),b.bc("click",function(t){return b.Ec(e),b.fc(4).clearSearch(t)}),b.Tb()}}const Cn=function(){return{"width.px":"24"}};function Tn(e,t){if(1&e){const e=b.Vb();b.Sb(0),b.Ub(1,"ss-context-button",36,37),b.bc("openContext",function(){return b.Ec(e),b.fc(3).openSearchFilter()}),b.Ub(3,"span",38),b.Mc(4,Sn,2,1,"span",39),b.Pb(5,"svg-icon",40),b.Tb(),b.Ub(6,"span",25),b.Ub(7,"div",41),b.Ub(8,"div",42),b.Ub(9,"input",43,44),b.bc("ngModelChange",function(t){return b.Ec(e),b.fc(3).setSearchText(t)})("keyup",function(t){return b.Ec(e),b.fc(3).checkSearchKey(t)}),b.Tb(),b.Mc(11,wn,1,0,"svg-icon",45),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Rb()}if(2&e){const e=b.fc(3);b.Cb(1),b.nc("menuWidth",250)("topMargin",12)("contextLinkButton",!0),b.Cb(3),b.nc("ngIf",e.groupFilter.searchText),b.Cb(1),b.nc("svgStyle",b.rc(8,Cn)),b.Cb(4),b.nc("placeholder",e.searchPlaceHolder)("ngModel",e.groupFilter.searchText),b.Cb(2),b.nc("ngIf",e.groupFilter.searchText)}}function On(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",7),b.Mc(1,hn,4,6,"ng-container",8),b.Ub(2,"div",9),b.Mc(3,un,3,3,"span",8),b.Mc(4,pn,3,3,"span",8),b.Tb(),b.Mc(5,bn,22,25,"div",8),b.Mc(6,vn,12,11,"ng-container",8),b.Mc(7,yn,17,14,"ng-container",8),b.Mc(8,Tn,12,9,"ng-container",8),b.Ub(9,"div"),b.Ub(10,"div"),b.Ub(11,"thy-form-boolean",10),b.bc("ngModelChange",function(t){return b.Ec(e),b.fc(2).setIncludeDisabled(t)}),b.gc(12,"async"),b.gc(13,"ssLocale"),b.Tb(),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc(2);b.Cb(1),b.nc("ngIf",e.canEditDependency),b.Cb(2),b.nc("ngIf",!e.groupHasSelections),b.Cb(1),b.nc("ngIf",e.groupHasSelections),b.Cb(1),b.nc("ngIf",e.groupHasSelections),b.Cb(1),b.nc("ngIf",!e.groupHasSelections),b.Cb(1),b.nc("ngIf",!e.groupHasSelections),b.Cb(1),b.nc("ngIf",!e.groupHasSelections),b.Cb(3),b.nc("ngModel",e.groupFilter.includeInactive)("editMode",!0)("labelText",b.hc(12,11,b.hc(13,13,"include-disabled")))("showAsToggle",!0)}}function In(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"ss-grid",5),b.bc("sort",function(t){return b.Ec(e),b.fc().sortGroup(t)})("loadNextPage",function(){return b.Ec(e),b.fc().loadNextPage()})("rowDropped",function(t){return b.Ec(e),b.fc().rowDropped(t)}),b.Tb(),b.Mc(2,On,14,15,"ng-template",null,6,b.Nc),b.Tb()}if(2&e){const e=b.Ac(3),t=b.fc(),s=b.Ac(4);b.Gb("dependencies-group",(null==t.groupPageRequests||null==t.groupPageRequests.results?null:t.groupPageRequests.results.totalRecords)>7),b.Cb(1),b.nc("pageName",t.pageName)("showSummary",!1)("items",t.groupDependencies)("columnDefinitions",t.columnDefinitions)("isResizable",!0)("gridName",t.gridName)("fixedHeaders",(null==t.groupPageRequests||null==t.groupPageRequests.results?null:t.groupPageRequests.results.totalRecords)>7)("defaultOrderAscending",!0)("useSortPipe",!1)("headerTemplate",e)("includePaging",!1)("hasMoreRecordsToLoad",null==t.groupPageRequests||null==t.groupPageRequests.results?null:t.groupPageRequests.results.hasMoreRecordsToLoad)("isLoadingMore",t.loadingMore)("enableDownload",!0)("moreRowTemplate",s)("noTableBottomBorder",!0)("enableRowDragDrop",t.canEditDependency&&t.groupDependencies.length>1)("rowDragDropCurrentlyAllowed","order"===t.groupPageRequests.sortField&&t.groupPageRequests.isAscending)("rowDragDropNotAllowedMessage",t.dependencyReorderNotice)}}function _n(e,t){if(1&e&&b.Pb(0,"svg-icon",52),2&e){const e=b.fc(2);b.nc("matTooltip",e.failed)}}function Pn(e,t){if(1&e&&b.Pb(0,"svg-icon",53),2&e){const e=b.fc(2);b.nc("matTooltip",e.notRun)}}function Mn(e,t){if(1&e&&b.Pb(0,"svg-icon",54),2&e){const e=b.fc(2);b.nc("matTooltip",e.succeeded)}}function kn(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",55),b.bc("click",function(){b.Ec(e);const t=b.fc().item;return b.fc().runDependency(t)}),b.Tb()}if(2&e){const e=b.fc(2);b.nc("matTooltip",e.runTheDependency)}}function xn(e,t){if(1&e&&(b.Mc(0,_n,1,1,"svg-icon",48),b.Mc(1,Pn,1,1,"svg-icon",49),b.Mc(2,Mn,1,1,"svg-icon",50),b.Mc(3,kn,1,1,"svg-icon",51)),2&e){const e=t.item,s=b.fc();b.nc("ngIf",e.runResult===s.dependencyRunResultStatus.Failed),b.Cb(1),b.nc("ngIf",e.runResult===s.dependencyRunResultStatus.NotRun),b.Cb(1),b.nc("ngIf",e.runResult===s.dependencyRunResultStatus.Success),b.Cb(1),b.nc("ngIf",s.canEditDependency)}}function Dn(e,t){if(1&e&&(b.Ub(0,"div",56),b.Ub(1,"div",57),b.Ub(2,"thy-context-button",58),b.Pb(3,"mat-icon",59),b.Tb(),b.Tb(),b.Tb()),2&e){const e=t.item,s=b.fc();b.Cb(2),b.nc("menuItems",s.rowLinks)("context",e)}}function Fn(e,t){1&e&&b.Oc(0,"\n\xa0\n")}function Un(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",61),b.Ub(1,"span"),b.Ub(2,"ss-checkbox",62),b.bc("ngModelChange",function(t){b.Ec(e);const s=b.fc().item;return b.fc().checkDependency(s,t)}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc().item,t=b.fc();b.Cb(1),b.Gb("rowHoverInline",!t.groupHasSelections),b.Cb(1),b.nc("checked",e.isSelected)("ngModel",e.isSelected)}}function An(e,t){if(1&e&&b.Mc(0,Un,3,4,"div",60),2&e){const e=b.fc();b.nc("ngIf",e.canEditDependency)}}let En=(()=>{let e=class{constructor(e,t,s,i,o,n,r,c){this._router=e,this._secretService=t,this._stateService=s,this._dependencyService=i,this._bulkOperationService=o,this._dialogService=n,this._localizationService=r,this._log=c,this.secretId=null,this.groupId=null,this.isOpen=!1,this.canEditDependency=!1,this.otherGroupUpdated=new b.n,this.pageName="secretdetail",this.gridName="secret-dependencies-",this.rowContextItem=null,this.groupDependencies=null,this.groupPageRequests={page:1,sortField:"order",isAscending:!0},this.groupExpanded=!1,this.groupHasSelections=!1,this.allSelected=!1,this.indeterminateGroup=!1,this.loadingMore=!1,this.groupSelectedIds=[],this.groupFilter={secretId:null,includeInactive:!1,groupId:null,templateId:null,searchText:null,lastRunStatus:null},this.groupSelectedTemplateFilter=null,this.groupSelectedStatusFilter=null,this.dependencyRunResultStatus=D.f,this.templates=[],this.searchPlaceHolder="Search Title / Machine",this.succeeded="Succeeded",this.failed="Failed",this.notRun="Not Run",this.runTheDependency="Run Dependency",this.dependencyReorderNotice="",this._allTemplates="All Templates",this._allRunResults="All Run Results",this.rowLinks=[{id:"edit",displayText:"Edit",menuClicked:new ye.a,hide:!1},{id:"view-log",displayText:"View Log",menuClicked:new ye.a,hide:!1},{id:"delete",displayText:"Delete",menuClicked:new ye.a,hide:!1},{id:"test",displayText:"Test",menuClicked:new ye.a,hide:!1}],this.filterStatuses=[{name:"All",localeString:"all",context:"All"},{name:"Succeeded",localeString:"succeeded",context:"Succeeded"},{name:"Failed",localeString:"failed",context:"Failed"},{name:"Not Run",localeString:"not-run",context:"NotRun"}]}ngOnInit(){this.isIE="ie"===this._stateService.browser.name,this.gridName+=this.groupId,this.searchPlaceHolder=this._localizationService.getCachedPageMessage("secretdetail","search-dependency-place-holder"),this.succeeded=this._localizationService.getCachedPageMessage("common","success"),this.failed=this._localizationService.getCachedPageMessage("secretdetail","failed"),this.notRun=this._localizationService.getCachedPageMessage("secretdetail","not-run"),this._allTemplates=this._localizationService.getCachedPageMessage("secretdetail","all-templates"),this._allRunResults=this._localizationService.getCachedPageMessage("secretdetail","all-run-results"),this.runTheDependency=this._localizationService.getCachedPageMessage("secretdetail","run-dependency"),this.dependencyReorderNotice=this._localizationService.getCachedPageMessage("secretdetail","dependency-reorder-notice"),this.rowLinks[0].displayText=this._localizationService.getCachedPageMessage("common","edit"),this.rowLinks[1].displayText=this._localizationService.getCachedPageMessage("secretdetail","view-log"),this.rowLinks[2].displayText=this._localizationService.getCachedPageMessage("common","delete"),this.rowLinks[3].displayText=this._localizationService.getCachedPageMessage("secretdetail","test"),this.rowLinks.forEach(e=>{e.menuClicked.pipe(Object(M.b)(this)).subscribe(e=>this._onContextMenuClick(e))}),this.groupSelectedTemplateFilter=this._allTemplates,this.groupSelectedStatusFilter=this._allRunResults,this._stateService.events.bulkOperationCompleted.pipe(Object(M.b)(this),Object(Je.a)(([e,t])=>t===this.gridName)).subscribe(()=>this._loadGroup())}ngAfterViewInit(){this._setColumns()}ngOnChanges(e){e.groupId&&(this.groupFilter.groupId=this.groupId),e.secretId&&(this.groupFilter.secretId=this.secretId),e.isOpen&&e.isOpen.previousValue!==e.isOpen.currentValue&&this.isOpen&&(!this.groupDependencies||this.groupDependencies.length<=0)&&(this._loadGroup(),this._loadTemplates()),e.canEditDependency&&(this.rowLinks[0].disabled=!this.canEditDependency,this.rowLinks[2].disabled=!this.canEditDependency)}reload(){this.groupPageRequests.page=1,this._loadGroup()}_loadGroup(){this.loadingMore=!0,this._dependencyService.searchDependencies(this.groupPageRequests,this.groupFilter).pipe(Object(h.a)()).subscribe(e=>{1===this.groupPageRequests.page?this.groupDependencies=e.records:(this.groupDependencies.push.apply(this.groupDependencies,e.records),this.groupDependencies=this.groupDependencies.slice()),this.checkAllDependency(!1),this.loadingMore=!1})}openSearchFilter(){setTimeout(()=>{this.searchContextInput.nativeElement.focus()},50)}clearSearch(e){this.groupFilter.searchText=null,clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>this._loadGroup(),500)}setSearchText(e){this.groupFilter.searchText=e,clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>this._loadGroup(),500)}checkSearchKey(e){e&&"Escape"===e.key&&this.clearSearch(null),clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(()=>this._loadGroup(),500)}filterStatus(e,t){this.groupFilter.lastRunStatus=this.groupFilter.lastRunStatus===e?null:e,this._loadGroup(),t&&(t.preventDefault(),t.stopPropagation())}_loadTemplates(){this._dependencyService.getDependencyTemplates().pipe(Object(h.a)()).subscribe(e=>{this.templates=e})}loadNextPage(){this.loadingMore=!0,this.groupPageRequests.page++,this._loadGroup()}checkAllDependency(e){this.allSelected=e,this.groupHasSelections=e,this.groupDependencies.forEach(t=>t.isSelected=e),e?(this.groupHasSelections=!0,this.groupSelectedIds=this.groupDependencies.map(e=>e.id)):(this.groupSelectedIds=[],this.groupHasSelections=!1)}_resetGroupDependencies(){this.groupPageRequests.page=1,this._loadGroup()}setStatusFilter(e,t){null===e?(this.groupFilter.lastRunStatus=null,this.groupSelectedStatusFilter=this._allRunResults):(this.groupFilter.lastRunStatus=e,this.groupSelectedStatusFilter=e.toString()),this.statusFilter.closeMenu(t),this._resetGroupDependencies()}setIncludeDisabled(e){this.groupFilter.includeInactive=e,this._resetGroupDependencies()}setTemplate(e,t){null===e?(this.groupFilter.templateId=null,this.groupSelectedTemplateFilter=this._allTemplates):(this.groupFilter.templateId=e.templateId,this.groupSelectedTemplateFilter=e.templateName),this.templateFilter.closeMenu(t),this._resetGroupDependencies()}sortGroup(e){this.groupPageRequests.page=1,this.groupPageRequests.sortField=e.name,this.groupPageRequests.isAscending=e.isAscending,this._loadGroup()}runDependency(e){this._dialogService.open(F.a,{width:F.c.Small,data:{title:this.runTheDependency,body:this._localizationService.getCachedPageMessage("secretdetail","run-dependency-confirm")}}).afterClosed().pipe(Object(h.a)()).subscribe(t=>{if(t){const t=[];t.push(this.secretId);const s=[];s.push(e.id),this._bulkOperationService.setDependencyPassword(t,s).pipe(Object(h.a)()).subscribe(e=>{this._stateService.activeBulkOperations.push({taskId:e,taskName:this.runTheDependency,secretIds:t,internalTaskId:this.gridName}),this._router.navigate([{outlets:{modal:["modals","bulk","bulk-progress"]}}])})}})}openRowContext(e){this.rowContextItem=e}viewLog(e){this._dialogService.open(Jo,{data:{secretId:this.secretId,secretDependencyId:e}})}deleteItem(e){this.performAction("delete",[e])}performAction(e,t){switch(e){case"delete":this._bulkAction(t,this._localizationService.getCachedPageMessage("secretdetail","delete-dependencies"),this._localizationService.replaceVariables(this._localizationService.getCachedPageMessage("secretdetail","delete-dependencies-confirm"),[t.length.toString()]),"",e);break;case"enable":const s=this._localizationService.getCachedPageMessage("secretdetail","enable-dependencies");this._bulkAction(t,s,this._localizationService.replaceVariables(this._localizationService.getCachedPageMessage("secretdetail","enable-dependencies-confirm"),[t.length.toString()]),s,e);break;case"disable":const i=this._localizationService.getCachedPageMessage("secretdetail","disable-dependencies");this._bulkAction(t,i,this._localizationService.replaceVariables(this._localizationService.getCachedPageMessage("secretdetail","disable-dependencies-confirm"),[t.length.toString()]),i,e);break;case"run":const o=this._localizationService.getCachedPageMessage("secretdetail","run-dependencies");this._bulkAction(t,o,this._localizationService.replaceVariables(this._localizationService.getCachedPageMessage("secretdetail","run-dependencies-confirm"),[t.length.toString()]),o,e)}}_bulkAction(e,t,s,i,o){this._dialogService.open(F.a,{width:F.c.Small,data:{title:t,body:s}}).afterClosed().pipe(Object(h.a)()).subscribe(t=>{if(t){const t=[];switch(t.push(this.secretId),o){case"delete":this._bulkOperationService.deleteDependencies(t,e).pipe(Object(h.a)()).subscribe(e=>this._watchBulkAction(e,i,t));break;case"enable":this._bulkOperationService.enableDependencies(t,e).pipe(Object(h.a)()).subscribe(e=>this._watchBulkAction(e,i,t));break;case"disable":this._bulkOperationService.disableDependencies(t,e).pipe(Object(h.a)()).subscribe(e=>this._watchBulkAction(e,i,t));break;case"run":this._bulkOperationService.setDependencyPassword(t,e).pipe(Object(h.a)()).subscribe(e=>this._watchBulkAction(e,i,t))}}})}testItem(e){this._secretService.testSecretDependency(this.secretId,e).pipe(Object(h.a)()).subscribe(e=>{let t=null;e&&Array.isArray(e.messages)&&(t=e.messages.join("; ")),this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage("secretdetail","test-dependency-result"),body:t,showCancelButton:!1}})})}selectAction(e){"select"!==e.target.value&&this.performAction(e.target.value,this.groupSelectedIds)}editItem(e){this._dialogService.open(Wo,{data:{secretId:this.secretId,dependencyId:e}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)?(e.approvedContext.groupId!==this.groupId&&this.otherGroupUpdated.emit(e.approvedContext.groupId),this.reload()):e.deniedContext||this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage("common","failed-to-load-title"),body:this._localizationService.getCachedPageMessage("common","failed-to-load-text"),showCancelButton:!1}})})}checkDependency(e,t){e.isSelected=t;const s=e.id,i=this.groupSelectedIds.indexOf(s);i>=0&&!t?this.groupSelectedIds.splice(i,1):-1===i&&t&&this.groupSelectedIds.push(s);const o=this.groupSelectedIds.length;o===this.groupDependencies.length?(this.allSelected=!0,this.indeterminateGroup=!1):0===o?(this.allSelected=!1,this.indeterminateGroup=!1):this.indeterminateGroup=!0,this.groupHasSelections=o>0}rowDropped(e){let t=e.droppedGridItem;const s=e.droppedOntoGridItem,i=t.order;let o=s.order+1;if(t.id===s.id||i===o)return;const n=i>o;n||o--,this._dependencyService.updateDependencySort(this.secretId,t.id,o).pipe(Object(h.a)()).subscribe(e=>{e&&(t=this.groupDependencies.find(e=>e.id===t.id),t.order=o,this.groupDependencies.filter(e=>e.id!==t.id).forEach(e=>{n&&e.order>=o&&e.order<i?e.order++:!n&&e.order>i&&e.order<=o&&e.order--}),this.groupDependencies=this.groupDependencies.sort((e,t)=>e.order>t.order?1:e.order<t.order?-1:0),this.groupDependencies=this.groupDependencies.slice())})}_watchBulkAction(e,t,s){this._stateService.activeBulkOperations.push({taskId:e,taskName:t,secretIds:s,internalTaskId:this.gridName}),this._router.navigate([{outlets:{modal:["modals","bulk","bulk-progress"]}}]),this.checkAllDependency(!1)}_onContextMenuClick(e){switch(e.id){case"edit":this.canEditDependency&&this.editItem(e.menuContext.id);break;case"view-log":this.viewLog(e.menuContext.id);break;case"delete":this.canEditDependency&&this.deleteItem(e.menuContext.id);break;case"test":this.canEditDependency&&this.testItem(e.menuContext.id);break;default:this._log.Error("Invalid context menu item clicked in secret dependencies grid",e)}}_setColumns(){this.columnDefinitions=[{propertyName:"checkbox",columnOrder:1,template:this.checkBoxTemplate,headerTemplate:this.checkBoxHeaderTemplate,columnWidth:25,columnMinWidth:25,align:"center",hideColumnSelection:!0,cellClass:"checkbox-column",cellHeaderClass:"checkbox-column",canExport:!1,ignoreLocalizationErrors:!0},{propertyName:"order",displayName:"Order",displayNameLocale:"order",template:null,columnOrder:10},{propertyName:"serviceName",displayName:"Title",displayNameLocale:"title",template:null,columnOrder:20},{propertyName:"typeName",displayName:"Type",displayNameLocale:"type",template:null,columnOrder:30},{propertyName:"machineName",displayName:"Machine",displayNameLocale:"machine",template:null,columnOrder:40},{propertyName:"enabled",displayName:"Enabled",displayNameLocale:"enabled",pageNameOverride:"common",template:null,columnOrder:50,columnType:oi.a.ActiveIcon},{propertyName:"runResult",displayName:"Run Result",displayNameLocale:"run-result",template:this.runResultTemplate,columnOrder:60}]}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(a.V),b.Ob(a.cb),b.Ob(a.k),b.Ob(a.d),b.Ob(E.c),b.Ob(a.F),b.Ob(a.fb))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-dependencies-grid"]],viewQuery:function(e,t){if(1&e&&(b.Uc(tn,1),b.Uc(sn,1),b.Uc(on,1),b.Uc(nn,1),b.Uc(rn,1),b.Uc(cn,1),b.Uc(an,1),b.Uc(ln,1)),2&e){let e;b.zc(e=b.cc())&&(t.runResultTemplate=e.first),b.zc(e=b.cc())&&(t.checkBoxTemplate=e.first),b.zc(e=b.cc())&&(t.checkBoxHeaderTemplate=e.first),b.zc(e=b.cc())&&(t.rowOptionButton=e.first),b.zc(e=b.cc())&&(t.rowGroupOptionButton=e.first),b.zc(e=b.cc())&&(t.templateFilter=e.first),b.zc(e=b.cc())&&(t.statusFilter=e.first),b.zc(e=b.cc())&&(t.searchContextInput=e.first)}},inputs:{secretId:"secretId",groupId:"groupId",isOpen:"isOpen",canEditDependency:"canEditDependency"},outputs:{otherGroupUpdated:"otherGroupUpdated"},features:[b.Ab],decls:9,vars:1,consts:[[3,"dependencies-group",4,"ngIf"],["runResultTemplate",""],["contextMenuColumn",""],["checkBoxHeaderTemplate",""],["checkBoxTemplate",""],["columnPreferenceName","secret-dependency-columns","defaultOrderByField","order","downloadFileName","secret-server-dependencies","rowDragDropHandleBeforeColumnName","checkbox",3,"pageName","showSummary","items","columnDefinitions","isResizable","gridName","fixedHeaders","defaultOrderAscending","useSortPipe","headerTemplate","includePaging","hasMoreRecordsToLoad","isLoadingMore","enableDownload","moreRowTemplate","noTableBottomBorder","enableRowDragDrop","rowDragDropCurrentlyAllowed","rowDragDropNotAllowedMessage","sort","loadNextPage","rowDropped"],["headerTemplate",""],[1,"grid-header"],[4,"ngIf"],[1,"item-count"],["formElementUniqueId","include-disabled",3,"ngModel","editMode","labelText","showAsToggle","ngModelChange"],["class","grid-drag-handle-placeholder",4,"ngIf"],[1,"all-checkbox","row-check"],[1,"norowclick",3,"checked","ngModel","indeterminate","ngModelChange"],[1,"grid-drag-handle-placeholder"],[2,"margin","2px 0 2px 0","padding","4px",3,"change"],["value","select"],["value","delete"],["value","enable"],["value","disable"],["value","run"],[3,"contextLinkButton","topMargin","menuWidth"],["templateFilter",""],["button","",1,"context-button-filter-selection"],["name","keyboard_arrow_down",1,"svg-icon","filter-svg-drop-down",3,"svgStyle"],["flyout",""],[1,"drop-down-list"],["ss-locale","all-templates",3,"click"],[4,"ngFor","ngForOf"],[3,"selected","click",4,"ngIf"],[3,"click"],["statusFilter",""],["ss-locale","all-run-results",3,"click"],["ss-locale","failed",3,"click"],["ss-locale","not-run",3,"click"],["ss-locale","success",3,"click"],[3,"menuWidth","topMargin","contextLinkButton","openContext"],["searchButton",""],["button","",1,"context-button-filter-selection","nohoverlink"],["class","filter-search-text",4,"ngIf"],["name","search",1,"svg-icon","filter-svg-search",3,"svgStyle"],[2,"cursor","default","height","36px"],[1,"ui","form","template-search-container"],["type","text","ss-locale-placeholder","search-dependencies-placeholder",1,"templateSearch",3,"placeholder","ngModel","ngModelChange","keyup"],["searchContextInput",""],["name","close","class","svg-icon icon-24 grid-search-filter",3,"click",4,"ngIf"],[1,"filter-search-text"],["name","close",1,"svg-icon","icon-24","grid-search-filter",3,"click"],["name","not_interested","class","svg-icon result-failure icon-18",3,"matTooltip",4,"ngIf"],["name","info","class","svg-icon result-warning icon-18",3,"matTooltip",4,"ngIf"],["name","check_circle","class","svg-icon result-success icon-18",3,"matTooltip",4,"ngIf"],["name","refresh","class","svg-icon icon-18 margin-left-17 pointer",3,"matTooltip","click",4,"ngIf"],["name","not_interested",1,"svg-icon","result-failure","icon-18",3,"matTooltip"],["name","info",1,"svg-icon","result-warning","icon-18",3,"matTooltip"],["name","check_circle",1,"svg-icon","result-success","icon-18",3,"matTooltip"],["name","refresh",1,"svg-icon","icon-18","margin-left-17","pointer",3,"matTooltip","click"],[1,"secret-more",2,"width","20px","float","right"],[1,"rowHoverDisplay","norowclick"],["iconName","more_vert",3,"menuItems","context"],["svgIcon","more_vert",1,"icon-18"],["class","row-check",4,"ngIf"],[1,"row-check"],[1,"norowclick",3,"checked","ngModel","ngModelChange"]],template:function(e,t){1&e&&(b.Mc(0,In,4,21,"div",0),b.Mc(1,xn,4,4,"ng-template",null,1,b.Nc),b.Mc(3,Dn,4,2,"ng-template",null,2,b.Nc),b.Mc(5,Fn,1,0,"ng-template",null,3,b.Nc),b.Mc(7,An,1,1,"ng-template",null,4,b.Nc)),2&e&&b.nc("ngIf",t.isOpen&&t.groupDependencies)},directives:[i.o,L.a,l.b,o.s,o.v,ht.a,o.w,o.D,Xo.a,n.b,f.a,i.n,o.d,en.a,R.a,m.c,st.a],pipes:[i.b,bt.a,W.a],styles:[".grid-header[_ngcontent-%COMP%]{padding-top:0;width:100%;display:flex;align-items:center}.grid-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:33px;height:33px;overflow:visible}.grid-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:not(.grid-drag-handle-placeholder){margin-right:6px}.grid-header[_ngcontent-%COMP%]   div.item-count[_ngcontent-%COMP%], .grid-header[_ngcontent-%COMP%]   div.search[_ngcontent-%COMP%]{min-width:95px}.grid-header[_ngcontent-%COMP%]   div.all-checkbox[_ngcontent-%COMP%]{width:20px;margin-left:4px;margin-top:-1px}.grid-header[_ngcontent-%COMP%]   div.all-checkbox.some-selected[_ngcontent-%COMP%]{margin-top:-5px}.grid-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{flex-grow:1;text-align:right;margin-right:0}.grid-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{display:inline-block}.grid-drag-handle-placeholder[_ngcontent-%COMP%]{width:40px}.grid-search-filter[_ngcontent-%COMP%]{position:absolute;margin-left:-26px;margin-top:6px;color:var(--font-color-4);fill:var(--font-color-4);cursor:pointer}.dependencies-group[_ngcontent-%COMP%]{height:350px;overflow:auto}.context-menu-scroll[_ngcontent-%COMP%]{height:200px;overflow:auto}.margin-left-17[_ngcontent-%COMP%], .margin-left-17[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-left:17px}.row-check[_ngcontent-%COMP%]{height:20px}.filter-search-text[_ngcontent-%COMP%]{padding-right:3px}"]}),e=Object(P.b)([Object(M.a)()],e),e})();const Rn=["statusButton"],Nn=["groupModal"],Ln=["groupNameInput"];function Vn(e,t){1&e&&(b.Ub(0,"a",23),b.Oc(1,"Find New Dependencies"),b.Tb())}function qn(e,t){1&e&&(b.Ub(0,"a",24),b.Oc(1,"Dependency Templates"),b.Tb())}function Gn(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",25),b.bc("click",function(){return b.Ec(e),b.fc(2).createNewDependency()}),b.Tb()}}function zn(e,t){if(1&e&&(b.Ub(0,"div"),b.Ub(1,"div",18),b.Ub(2,"div"),b.Mc(3,Vn,2,0,"a",19),b.Mc(4,qn,2,0,"a",20),b.Mc(5,Gn,1,0,"button",21),b.Tb(),b.Tb(),b.Pb(6,"div",22),b.Tb()),2&e){const e=b.fc();b.Cb(3),b.nc("ngIf",e.canEditDependency),b.Cb(1),b.nc("ngIf",e.canEditDependency),b.Cb(1),b.nc("ngIf",e.canEditDependency)}}function Bn(e,t){1&e&&(b.Ub(0,"div",26),b.Oc(1," This Secret does not have any Dependencies.\n"),b.Tb())}function jn(e,t){1&e&&b.Pb(0,"svg-icon",43)}function Wn(e,t){1&e&&b.Pb(0,"svg-icon",44)}function Hn(e,t){1&e&&(b.Ub(0,"span",45),b.Oc(1,"Use Site from Secret"),b.Tb())}function Kn(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.Tb()),2&e){const e=b.fc().$implicit;b.Cb(1),b.Pc(e.siteName)}}function Qn(e,t){if(1&e&&(b.Ub(0,"div",46),b.Oc(1),b.Ub(2,"span",47),b.Oc(3,"Not Run"),b.Tb(),b.Tb()),2&e){const e=b.fc().$implicit;b.Cb(1),b.Qc(" ",e.statusNotRunCount," ")}}function $n(e,t){if(1&e&&(b.Ub(0,"div",48),b.Oc(1),b.Ub(2,"span",49),b.Oc(3,"Failed"),b.Tb(),b.Tb()),2&e){const e=b.fc().$implicit;b.Cb(1),b.Qc(" ",e.statusFailedCount," ")}}function Zn(e,t){if(1&e&&(b.Ub(0,"div",50),b.Ub(1,"div"),b.Ub(2,"thy-context-button",51),b.Pb(3,"mat-icon",52),b.Tb(),b.Tb(),b.Tb()),2&e){const e=b.fc().$implicit,t=b.fc(2);b.Cb(2),b.nc("menuItems",t.groupContextLinks)("context",e)}}function Yn(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",29),b.Ub(1,"div",30),b.bc("click",function(s){b.Ec(e);const i=t.$implicit;return b.fc(2).toggleGroup(i.id,s)}),b.Mc(2,jn,1,0,"svg-icon",31),b.Mc(3,Wn,1,0,"svg-icon",32),b.Ub(4,"span",33),b.Ub(5,"span",34),b.Oc(6,"Group"),b.Tb(),b.Oc(7),b.Ub(8,"span",12),b.Oc(9,"Site"),b.Tb(),b.Oc(10,": "),b.Mc(11,Hn,2,0,"span",35),b.Mc(12,Kn,2,1,"span",1),b.Oc(13),b.Ub(14,"span",36),b.Oc(15,"Total Enabled"),b.Tb(),b.Oc(16,") "),b.Tb(),b.Ub(17,"div",37),b.Ub(18,"div",38),b.Mc(19,Qn,4,1,"div",39),b.Tb(),b.Ub(20,"div",38),b.Mc(21,$n,4,1,"div",40),b.Tb(),b.Mc(22,Zn,4,2,"div",41),b.Tb(),b.Tb(),b.Ub(23,"ss-secret-dependencies-grid",42),b.bc("otherGroupUpdated",function(t){return b.Ec(e),b.fc(2).refreshGroup(t)}),b.Tb(),b.Tb()}if(2&e){const e=t.$implicit,s=b.fc(2);b.Cb(2),b.nc("ngIf",s.groupExpanded[e.id]),b.Cb(1),b.nc("ngIf",!s.groupExpanded[e.id]),b.Cb(4),b.Qc(": ",e.name,", "),b.Cb(4),b.nc("ngIf",!e.siteName),b.Cb(1),b.nc("ngIf",e.siteName),b.Cb(1),b.Qc(" (",e.totalDependencies," "),b.Cb(6),b.nc("ngIf",e.statusNotRunCount>0),b.Cb(2),b.nc("ngIf",e.statusFailedCount>0),b.Cb(1),b.nc("ngIf",s.canEditDependency),b.Cb(1),b.nc("secretId",s.secretState.id)("groupId",e.id)("isOpen",s.groupExpanded[e.id])("canEditDependency",s.canEditDependency)}}function Jn(e,t){if(1&e&&(b.Ub(0,"div",27),b.Mc(1,Yn,24,13,"div",28),b.Tb()),2&e){const e=b.fc();b.Cb(1),b.nc("ngForOf",e.groupsOnly)}}let Xn=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l){this._router=e,this._secretService=t,this._ies=s,this._stateService=i,this._dependencyService=n,this._dialogService=r,this._siteService=c,this._localizationService=a,this._log=l,this.secretState=null,this.groupExpanded=[],this.groupsOnly=null,this.searchForm=new o.k({searchText:new o.h,showInactive:new o.h}),this.status="All",this.isLoading=!0,this.formInputType=A.a,this.siteOptions=[],this.canEditDependency=!1,this.groupForm=new o.k({groupName:new o.h("",k.a.requiredNotEmpty),site:new o.h("",o.C.required)}),this._editGroup="Edit Group",this._deleteGroup="Delete Group",this._useSiteFromSecret="Use Site from Secret",this.groupContextLinks=[{id:"edit-group",displayText:this._editGroup,menuClicked:new ye.a,hide:!1},{id:"delete-group",displayText:this._deleteGroup,menuClicked:new ye.a,hide:!1}],this._groupId=null,this.ies=this._ies}ngOnInit(){this._editGroup=this._localizationService.getCachedPageMessage("secretdetail","edit-group"),this._deleteGroup=this._localizationService.getCachedPageMessage("secretdetail","delete-group"),this._useSiteFromSecret=this._localizationService.getCachedPageMessage("secretdetail","use-site-from-secret"),this.groupContextLinks[0].displayText=this._editGroup,this.groupContextLinks[1].displayText=this._deleteGroup,this.groupContextLinks.forEach(e=>{e.menuClicked.pipe(Object(M.b)(this)).subscribe(e=>this._onContextMenuClick(e))}),this._stateService.events.bulkOperationCompleted.pipe(Object(M.b)(this),Object(Je.a)(([e,t])=>this.dependencyGrids.some(e=>e.gridName===t))).subscribe(([e,t])=>{const s=t.split("-"),i=parseInt(s[s.length-1],10);this._updateGroupMetadata(i)})}ngOnChanges(e){e.secretState&&(this._load(),this._assignPermission())}_load(){this._secretService.hasAction(D.W.ViewDependencies,this.secretState)||this._router.navigate(["/no-access"]),this._dependencyService.getSecretDependencyGroups(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this.groupsOnly=e,this._assignPermission(),this.groupsOnly&&1===this.groupsOnly.length&&(this.groupExpanded[this.groupsOnly[0].id]=!0),this.isLoading=!1})}_updateGroupMetadata(e){this._dependencyService.getSecretDependencyGroups(this.secretState.id).pipe(Object(h.a)()).subscribe(t=>{if(null!=e){const s=this.groupsOnly.find(t=>t.id===e),i=t.find(t=>t.id===e);s&&i&&this._assignNewGroupToOld(s,i)}else t.forEach(e=>{const t=this.groupsOnly.find(t=>t.id===e.id);t?this._assignNewGroupToOld(t,e):this.groupsOnly.push(e)})})}_assignNewGroupToOld(e,t){e.name=t.name,e.siteName=t.siteName,e.statusFailedCount=t.statusFailedCount,e.statusNotRunCount=t.statusNotRunCount,e.statusSuccessCount=t.statusSuccessCount,e.totalDependencies=t.totalDependencies}toggleGroup(e,t){t.target.closest(".display-on-hover")||(this.groupExpanded[e]=!this.groupExpanded[e])}createNewDependency(){this.canEditDependency&&this._dialogService.open(Wo,{data:{secretId:this.secretState.id,dependencyId:null}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&(e.approvedContext.addedNewGroup?this._load():(this.dependencyGrids.find(t=>t.groupId===e.approvedContext.groupId).reload(),this._updateGroupMetadata(e.approvedContext.groupId)))})}groupCancel(){this._ies.disableEditMode("group"),this.groupModal.close(),this._resetGroupForm()}saveGroup(){this._ies.isSaving=!0;const e=this.groupsOnly.map(e=>e.name.toLocaleLowerCase().trim()).indexOf(this.groupForm.value.groupName.toLocaleLowerCase().trim());if(e>=0&&this.groupsOnly[e].id!==this._groupId)return this.groupForm.controls.groupName.setErrors({valueAlreadyExists:{valid:!1}}),this._ies.showValidationMessages=!0,void(this._ies.isSaving=!1);this._dependencyService.SaveDependencyGroup(this._groupId,this.secretState.id,this.groupForm.value.groupName,"-1"===this.groupForm.value.site?null:this.groupForm.value.site).pipe(Object(h.a)()).subscribe(()=>{this._updateGroupMetadata(),this._ies.disableEditMode("group"),this.groupModal.close(),this._resetGroupForm()})}editGroup(e,t){this._loadSites(),this._groupId=e;const s=this.groupsOnly.map(e=>e.id).indexOf(e),i=this.groupsOnly[s];if(!i)throw new Error(this._localizationService.getCachedPageMessage("secretdetail","dependency-group-not-found"));this.groupForm.controls.site.setValue(null===i.siteId?"-1":i.siteId),this.groupForm.controls.groupName.setValue(i.name),this._ies.enableEditMode("group",this.groupForm),this.groupModal.modalTitle=this._localizationService.getCachedPageMessage("secretdetail","edit-dependency-group"),this.groupModal.show()}refreshGroup(e){const t=this.dependencyGrids.find(t=>t.groupId===e);null==t||t.reload()}deleteGroup(e,t){const s=this.groupsOnly.map(e=>e.id).indexOf(e);0===this.groupsOnly[s].totalDependencies?this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage("secretdetail","delete-dependency-group-modal-title"),body:this._localizationService.getCachedPageMessage("secretdetail","delete-dependency-group-modal-description").replace("{0}",t)}}).afterClosed().pipe(Object(h.a)()).subscribe(t=>{t&&this._secretService.deleteSecretDependencyGroup(e).pipe(Object(h.a)()).subscribe(()=>this.groupsOnly.splice(s,1))}):this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage("secretdetail","delete-dependency-group-modal-title"),body:this._localizationService.getCachedPageMessage("secretdetail","delete-dependency-group-not-empty"),showCancelButton:!1}})}_loadSites(){this.siteOptions.length>0||(this.siteOptions.push({text:this._useSiteFromSecret,value:"-1"}),this._siteService.getSites().pipe(Object(h.a)()).subscribe({next:e=>{e.forEach(e=>{e.active&&this.siteOptions.push({text:e.siteName,value:e.siteId.toString()})}),this.siteOptions=this.siteOptions.slice(0)}}))}_resetGroupForm(){this.groupForm=new o.k({groupName:new o.h("",k.a.requiredNotEmpty),site:new o.h("",o.C.required)})}_onContextMenuClick(e){switch(e.id){case"edit-group":this.canEditDependency&&this.editGroup(e.menuContext.id,!0);break;case"delete-group":this.canEditDependency&&this.deleteGroup(e.menuContext.id,e.menuContext.name);break;default:this._log.Error("Invalid context menu item clicked in secret dependencies",e)}}_assignPermission(){this.canEditDependency=this._secretService.hasAction(D.W.EditDependencies,this.secretState)}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(a.V),b.Ob(a.B),b.Ob(a.cb),b.Ob(a.k),b.Ob(E.c),b.Ob(a.X),b.Ob(a.F),b.Ob(a.fb))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-dependencies"]],viewQuery:function(e,t){if(1&e&&(b.Uc(Rn,1),b.Uc(Nn,1),b.Uc(Ln,1),b.Uc(En,1)),2&e){let e;b.zc(e=b.cc())&&(t.statusButton=e.first),b.zc(e=b.cc())&&(t.groupModal=e.first),b.zc(e=b.cc())&&(t.groupNameInput=e.first),b.zc(e=b.cc())&&(t.dependencyGrids=e)}},inputs:{secretState:"secretState"},features:[b.Ab],decls:27,vars:23,consts:[[3,"active","isFullscreen"],[4,"ngIf"],["ss-locale","no-dependencies-for-secret",4,"ngIf"],["class","group-container ui form",4,"ngIf"],["modalTitleLocale","new-dependency-group",3,"formGroup","modalClose"],["groupModal",""],["modal-body",""],[1,"outer-container"],[1,"inner-container"],["ss-locale","group-name"],["formControlName","groupName","editSection","group",3,"type"],["groupNameInput",""],["ss-locale","site"],["formControlName","site","editSection","group",3,"type","options"],["modal-footer",""],[1,"thy","basic","button",3,"click"],[2,"display","inline-block",3,"matTooltip"],[1,"thy","primary","button","no-right-margin",3,"disabled","click"],[1,"grid-filter-header"],["ssHref","~/AdminNetworkView.aspx","class","thy basic button nohoverlink","ss-locale","find-new-dependencies",4,"ngIf"],["ssHref","~/DependencyTemplates.aspx","class","thy basic button nohoverlink","ss-locale","dependency-templates",4,"ngIf"],["class","thy primary button createButton","ss-locale","new-dependency",3,"click",4,"ngIf"],[2,"clear","right","margin-bottom","32px"],["ssHref","~/AdminNetworkView.aspx","ss-locale","find-new-dependencies",1,"thy","basic","button","nohoverlink"],["ssHref","~/DependencyTemplates.aspx","ss-locale","dependency-templates",1,"thy","basic","button","nohoverlink"],["ss-locale","new-dependency",1,"thy","primary","button","createButton",3,"click"],["ss-locale","no-dependencies-for-secret"],[1,"group-container","ui","form"],["class","group-row",4,"ngFor","ngForOf"],[1,"group-row"],[1,"group-header",3,"click"],["name","arrow_drop_down","class","svg-icon icon-14",4,"ngIf"],["name","arrow_right","class","svg-icon icon-14",4,"ngIf"],[1,"groupTitle"],["ss-locale","group"],["ss-locale","use-site-from-secret",4,"ngIf"],["ss-locale","total-enabled"],[1,"pill-box"],[1,"pill"],["class","status-pill status-pill-warning",4,"ngIf"],["class","status-pill status-pill-failure",4,"ngIf"],["class","display-on-hover",4,"ngIf"],[3,"secretId","groupId","isOpen","canEditDependency","otherGroupUpdated"],["name","arrow_drop_down",1,"svg-icon","icon-14"],["name","arrow_right",1,"svg-icon","icon-14"],["ss-locale","use-site-from-secret"],[1,"status-pill","status-pill-warning"],["ss-locale","not-run"],[1,"status-pill","status-pill-failure"],["ss-locale","failed"],[1,"display-on-hover"],["iconName","more_vert",3,"menuItems","context"],["svgIcon","more_vert",1,"icon-18"]],template:function(e,t){1&e&&(b.Pb(0,"thy-loading-dimmer",0),b.Mc(1,zn,7,3,"div",1),b.Mc(2,Bn,2,0,"div",2),b.Mc(3,Jn,2,1,"div",3),b.Ub(4,"ss-modal-dialog",4,5),b.bc("modalClose",function(){return t.groupCancel()}),b.Ub(6,"div",6),b.Ub(7,"div",7),b.Ub(8,"div",8),b.Ub(9,"label",9),b.Oc(10,"Group Name"),b.Tb(),b.Pb(11,"ss-form-input",10,11),b.Tb(),b.Ub(13,"div",8),b.Ub(14,"label",12),b.Oc(15,"Site"),b.Tb(),b.Pb(16,"ss-form-input",13),b.Tb(),b.Tb(),b.Tb(),b.Ub(17,"div",14),b.Ub(18,"button",15),b.bc("click",function(){return t.groupCancel()}),b.Oc(19),b.gc(20,"async"),b.gc(21,"ssLocale"),b.Tb(),b.Ub(22,"div",16),b.Ub(23,"button",17),b.bc("click",function(){return t.saveGroup()}),b.Oc(24),b.gc(25,"async"),b.gc(26,"ssLocale"),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&e&&(b.nc("active",t.isLoading)("isFullscreen",!0),b.Cb(1),b.nc("ngIf",!t.isLoading),b.Cb(1),b.nc("ngIf",t.groupsOnly&&0==t.groupsOnly.length),b.Cb(1),b.nc("ngIf",t.groupsOnly&&t.groupsOnly.length>0),b.Cb(1),b.nc("formGroup",t.groupForm),b.Cb(7),b.nc("type",t.formInputType.String),b.Cb(5),b.nc("type",t.formInputType.DropDown)("options",t.siteOptions),b.Cb(3),b.Pc(b.hc(20,13,b.ic(21,15,"cancel","common"))),b.Cb(3),b.nc("matTooltip",t.ies.okButtonTooltip),b.Cb(1),b.nc("disabled",t.ies.isSaveDisabled("group")),b.Cb(1),b.Pc(b.hc(25,18,b.ic(26,20,"save","common"))))},directives:[m.h,i.o,N.a,o.t,o.l,f.a,j.a,o.s,o.j,R.a,ri.a,i.n,En,n.b,m.c,st.a],pipes:[i.b,bt.a],styles:["div.dependencyContainer[_ngcontent-%COMP%]   div.dependencyGroupName[_ngcontent-%COMP%]{font-weight:500;font-size:14px}div.dependencyContainer[_ngcontent-%COMP%]   div.dependencyGroups[_ngcontent-%COMP%]:not(:first-child){margin-top:30px}.groupTitle[_ngcontent-%COMP%]{color:var(--font-color-2);font-size:12px;font-weight:500;display:inline-block;margin-right:auto;min-width:260px}.filter-cell[_ngcontent-%COMP%]{margin-top:16px!important}.white-text[_ngcontent-%COMP%]{color:var(--toast-text)!important}.drag-target[_ngcontent-%COMP%]{background:var(--hover-1)}.group-header[_ngcontent-%COMP%]{cursor:pointer;padding:8px;background:var(--background-2);border-top:1px solid var(--border-color-1)}.group-header[_ngcontent-%COMP%], .pill-box[_ngcontent-%COMP%]{display:flex;align-items:center}.pill-box[_ngcontent-%COMP%]{cursor:default;width:220px}.pill-box[_ngcontent-%COMP%] > div.pill[_ngcontent-%COMP%]{width:40%}.group-row[_ngcontent-%COMP%]   .display-on-hover[_ngcontent-%COMP%]{visibility:hidden}.group-row[_ngcontent-%COMP%]:hover   .display-on-hover[_ngcontent-%COMP%]{visibility:visible}.outer-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inner-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-top:10px}.inner-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{width:33%}.inner-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{width:67%}"]}),e=Object(P.b)([Object(M.a)()],e),e})();function er(e,t){if(1&e&&b.Pb(0,"h1",18),2&e){const e=b.fc();b.nc("ss-page-name",e.pageName)}}function tr(e,t){if(1&e&&b.Pb(0,"h1",19),2&e){const e=b.fc();b.nc("ss-page-name",e.pageName)}}function sr(e,t){if(1&e&&(b.Ub(0,"option",20),b.Oc(1),b.Tb()),2&e){const e=t.$implicit;b.nc("value",e.scriptId),b.Cb(1),b.Qc(" ",e.scriptName," ")}}function ir(e,t){if(1&e&&(b.Ub(0,"option",20),b.Oc(1),b.Tb()),2&e){const e=t.$implicit;b.nc("value",e.scriptId),b.Cb(1),b.Qc(" ",e.scriptName," ")}}function or(e,t){if(1&e&&(b.Ub(0,"option",20),b.Oc(1),b.Tb()),2&e){const e=t.$implicit;b.nc("value",e.scriptId),b.Cb(1),b.Qc(" ",e.scriptName," ")}}function nr(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",26),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.prePostOption),b.Cb(2),b.nc("type",e.formInputType.DropDown)("options",e.prePostOptions)("viewField",e.hook.prePostOption)}}function rr(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",27),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.eventActionId),b.Cb(2),b.nc("type",e.formInputType.DropDown)("options",e.eventActionOptions)("viewField",e.hook.eventActionId)}}function cr(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",28),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.arguments),b.Cb(2),b.nc("type",e.formInputType.String)}}function ar(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",29),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.serverName),b.Cb(2),b.nc("type",e.formInputType.String)}}function lr(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",30),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.database),b.Cb(2),b.nc("type",e.formInputType.String)}}function dr(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",31),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.serverKeyDigest),b.Cb(2),b.nc("type",e.formInputType.String)}}function hr(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",32),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.port),b.Cb(2),b.nc("type",e.formInputType.String)}}function ur(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Pb(2,"ss-form-input",33),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.stopOnFailure),b.Cb(2),b.nc("type",e.formInputType.Boolean)}}function pr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Ub(2,"ss-form-input",34),b.bc("secretSelected",function(t){return b.Ec(e),b.fc(2).updatePrivilegedSecret(t)}),b.Tb(),b.Rb(),b.Tb()}if(2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.privilegedSecretId),b.Cb(2),b.nc("type",e.formInputType.Secret)("viewField",e.hook.privilegedSecretId)("initialSecretName",null==e.hook.privilegedSecretId?null:e.hook.privilegedSecretId.name)}}function br(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",22),b.Sb(1,7),b.Ub(2,"ss-form-input",35),b.bc("secretSelected",function(t){return b.Ec(e),b.fc(2).updateSSHKeySecret(t)}),b.Tb(),b.Rb(),b.Tb()}if(2&e){const e=b.fc(2);b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.sshKeySecretId),b.Cb(2),b.nc("type",e.formInputType.Secret)("viewField",e.hook.sshKeySecretId)("initialSecretName",null==e.hook.sshKeySecretId?null:e.hook.sshKeySecretId.name)}}function mr(e,t){if(1&e&&(b.Sb(0),b.Ub(1,"thy-form-layout-row",40),b.Sb(2,7),b.Pb(3,"ss-form-input",41),b.Rb(),b.Tb(),b.Rb()),2&e){const e=b.fc().index,t=b.fc(3);b.Cb(1),b.nc("showActions",!1)("labelText",t.hook.parameters[e].parameterName),b.Cb(2),b.nc("placeholder",t.hook.parameters[e].parameterType)("type",t.formInputType.String)}}function gr(e,t){if(1&e&&(b.Sb(0,39),b.Mc(1,mr,4,4,"ng-container",13),b.Rb()),2&e){const e=t.index,s=b.fc(3);b.nc("formGroupName",e),b.Cb(1),b.nc("ngIf",s.hook.parameters[e])}}function fr(e,t){if(1&e&&(b.Sb(0,36),b.Ub(1,"label",37),b.Oc(2,"Parameters"),b.Tb(),b.Mc(3,gr,2,2,"ng-container",38),b.Rb()),2&e){const e=b.fc(2);b.Cb(3),b.nc("ngForOf",e.hookFormParameters.controls)}}function vr(e,t){if(1&e&&(b.Sb(0),b.Mc(1,nr,3,5,"thy-form-layout-row",21),b.Mc(2,rr,3,5,"thy-form-layout-row",21),b.Ub(3,"thy-form-layout-row",22),b.Sb(4,7),b.Pb(5,"ss-form-input",23),b.Rb(),b.Tb(),b.Ub(6,"thy-form-layout-row",22),b.Sb(7,7),b.Pb(8,"ss-form-input",24),b.Rb(),b.Tb(),b.Mc(9,cr,3,3,"thy-form-layout-row",21),b.Mc(10,ar,3,3,"thy-form-layout-row",21),b.Mc(11,lr,3,3,"thy-form-layout-row",21),b.Mc(12,dr,3,3,"thy-form-layout-row",21),b.Mc(13,hr,3,3,"thy-form-layout-row",21),b.Mc(14,ur,3,3,"thy-form-layout-row",21),b.Mc(15,pr,3,5,"thy-form-layout-row",21),b.Mc(16,br,3,5,"thy-form-layout-row",21),b.Mc(17,fr,4,1,"ng-container",25),b.Rb()),2&e){const e=b.fc();b.Cb(1),b.nc("ngIf",!e.hook.prePostOption.hidden),b.Cb(1),b.nc("ngIf",!e.hook.eventActionId.hidden),b.Cb(1),b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.name),b.Cb(2),b.nc("type",e.formInputType.String),b.Cb(1),b.nc("showActions",!1)("thyFormLayoutRowDefinition",e.hook.description),b.Cb(2),b.nc("type",e.formInputType.String),b.Cb(1),b.nc("ngIf",!e.hook.arguments.hidden),b.Cb(1),b.nc("ngIf",!e.hook.serverName.hidden),b.Cb(1),b.nc("ngIf",!e.hook.database.hidden),b.Cb(1),b.nc("ngIf",!e.hook.serverKeyDigest.hidden),b.Cb(1),b.nc("ngIf",!e.hook.port.hidden),b.Cb(1),b.nc("ngIf",!e.hook.stopOnFailure.hidden),b.Cb(1),b.nc("ngIf",!e.hook.privilegedSecretId.hidden),b.Cb(1),b.nc("ngIf",!e.hook.sshKeySecretId.hidden),b.Cb(1),b.nc("ngIf",e.hook.parameters&&e.hook.parameters.length>0)}}let yr=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a){this.context=e,this.dialog=t,this._ies=s,this._secretService=i,this._localizationService=n,this._scriptService=r,this._router=c,this._errorService=a,this.ies=null,this.pageName="secretdetail",this.isEdit=!1,this.hook=null,this.isLoading=!0,this.formInputType=A.a,this.pageTitle=null,this.prePostOptions=[{text:"PRE",value:"PRE"},{text:"POST",value:"POST"}],this.eventActionOptions=[{text:"Check Out",value:10026},{text:"Check In",value:10025}],this.hookForm=new o.k({secretHookId:new o.h(""),secretId:new o.h(""),scriptId:new o.h(""),eventActionId:new o.h(""),name:new Pi.a("Name"),description:new Pi.a("description"),prePostOption:new Pi.a("PRE/POST"),serverName:new Pi.a("Server Name"),serverKeyDigest:new Pi.a("Server Key Digest"),database:new Pi.a("Database"),port:new Pi.a("Port"),stopOnFailure:new Pi.a("Stop on Failure"),arguments:new Pi.a("Arguments"),privilegedSecretId:new Pi.a("Privileged Account"),sshKeySecretId:new Pi.a("SSH Key"),parameters:new o.e([])}),this._previousData=null,this.ies=s}ngOnInit(){this.ies.enableEditMode("hook",this.hookForm),this.hookForm.get("secretId").setValue(this.context.secretId),this.context.secretHookId&&(this.isEdit=!0,this._secretService.getHook(this.context.secretId,this.context.secretHookId).pipe(Object(h.a)()).subscribe(e=>{this._applyModel(e)})),this._scriptService.getAll().pipe(Object(h.a)()).subscribe(e=>{this.activeScripts=e,this.powershellScripts=e.filter(e=>e.typeId===D.T.PowerShell),this.sqlScripts=e.filter(e=>e.typeId===D.T.Sql),this.sshScripts=e.filter(e=>e.typeId===D.T.Ssh)}),this.hookForm.get("scriptId").valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{e!==this.hookForm.value.scriptId&&null!==e&&this._secretService.stubHook(this.context.secretId,e).pipe(Object(h.a)()).subscribe({next:t=>{if(this.hook){if(this.hook.scriptId.value===e)return;this.hook.privilegedSecretId.value&&(t.privilegedSecretId=this.hook.privilegedSecretId),this.hook.sshKeySecretId&&(t.sshKeySecretId=this.hook.sshKeySecretId),this._previousData=this.hookForm.value}this.hook=t,this._applyModel(this.hook),this._previousData&&this.hookForm.patchValue(this._previousData,{emitEvent:!1}),this.hookForm.controls.scriptId.markAsDirty(),this.isLoading=!1},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_SecretRequiresCheckout"!==t.errorCode&&"API_SecretAccessApprovalDenied"!==t.errorCode&&"API_ValidateSecretAccessCommentRequired"!==t.errorCode)throw e;this._router.navigate(["/secret/checkout/",this.context.secretId]).then(()=>{this.dialog.close({isApproved:!1})})}})})}updatePrivilegedSecret(e){this.hook.privilegedSecretId.value=e.id,this.hook.privilegedSecretId.name=e.name}updateSSHKeySecret(e){this.hook.sshKeySecretId.value=e.id,this.hook.sshKeySecretId.name=e.name}cancel(){this.dialog.close({isApproved:!1})}save(){this.hookForm.value.secretHookId?this._updateExisting():this._createNew()}get hookFormParameters(){return this.hookForm.controls.parameters}_applyModel(e){this.hook=e,this.ies.patchViewModel(this.hookForm,this.hook),this.ies.applyViewModelMetaDataToForm(this.hook,this.hookForm);const t=this.hookForm.controls.parameters;for(let s=t.length-1;s>=0;s--)t.removeAt(s);this.hook.parameters&&this.hook.parameters.length>0&&this.hook.parameters.forEach(e=>{t.push(new o.k({parameterName:new o.h(e.parameterName),parameterValue:new o.h(e.parameterValue),parameterType:new o.h(e.parameterType)}))}),this.isLoading=!1}_updateExisting(){const e=this.ies.createUpdateModel(this.hookForm);e.parameters=this.hookForm.value.parameters,this._secretService.updateHook(this.context.secretId,this.context.secretHookId,e).pipe(Object(h.a)()).subscribe({next:e=>{this.dialog.close({isApproved:!0})},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_SecretRequiresCheckout"!==t.errorCode&&"API_SecretAccessApprovalDenied"!==t.errorCode&&"API_ValidateSecretAccessCommentRequired"!==t.errorCode)throw e;this._router.navigate(["/secret/checkout/",this.context.secretId]).then(()=>{this.dialog.close({isApproved:!0})})}})}_createNew(){const e=this.hookForm.value;e.secretId=this.context.secretId,this._secretService.createHook(e).pipe(Object(h.a)()).subscribe({next:e=>{this.dialog.close({isApproved:!0})},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_SecretRequiresCheckout"!==t.errorCode&&"API_SecretAccessApprovalDenied"!==t.errorCode&&"API_ValidateSecretAccessCommentRequired"!==t.errorCode)throw e;this._router.navigate(["/secret/checkout/",this.context.secretId]).then(()=>{this.dialog.close({isApproved:!1})})}})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(E.a),b.Ob(E.i),b.Ob(a.B),b.Ob(a.V),b.Ob(a.F),b.Ob(a.S),b.Ob(c.e),b.Ob(a.eb))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-hook-edit-modal"]],features:[b.Bb([],[a.B])],decls:24,vars:19,consts:[["mat-dialog-title","","class","header","ss-locale","edit-hook",3,"ss-page-name",4,"ngIf"],["mat-dialog-title","","class","header","ss-locale","new-hook",3,"ss-page-name",4,"ngIf"],["mat-dialog-content",""],["editSection","hook",3,"ssForm"],[3,"formGroup"],["editSection","hook","editSectionId","hoot",3,"showBorder","noBottomMargin"],[3,"labelText","showActions"],["value-column",""],["formControlName","scriptId",1,"thy-input"],["label","PowerShell"],[3,"value",4,"ngFor","ngForOf"],["label","SQL"],["label","SSH"],[4,"ngIf"],["mat-dialog-actions",""],["ss-locale","cancel","ss-page-name","common",1,"thy","basic","button",3,"click"],[2,"display","inline-block",3,"matTooltip"],["ss-locale","save","ss-page-name","common",1,"thy","primary","button",3,"disabled","click"],["mat-dialog-title","","ss-locale","edit-hook",1,"header",3,"ss-page-name"],["mat-dialog-title","","ss-locale","new-hook",1,"header",3,"ss-page-name"],[3,"value"],[3,"showActions","thyFormLayoutRowDefinition",4,"ngIf"],[3,"showActions","thyFormLayoutRowDefinition"],["formControlName","name","editSection","hook",3,"type"],["formControlName","description","editSection","hook",3,"type"],["formArrayName","parameters",4,"ngIf"],["formControlName","prePostOption","editSection","hook",3,"type","options","viewField"],["formControlName","eventActionId","editSection","hook",3,"type","options","viewField"],["formControlName","arguments","editSection","hook",3,"type"],["formControlName","serverName","editSection","hook",3,"type"],["formControlName","database","editSection","hook",3,"type"],["formControlName","serverKeyDigest","editSection","hook",3,"type"],["formControlName","port","editSection","hook",3,"type"],["formControlName","stopOnFailure","editSection","hook",3,"type"],["formControlName","privilegedSecretId","editSection","hook",3,"type","viewField","initialSecretName","secretSelected"],["formControlName","sshKeySecretId","editSection","hook",3,"type","viewField","initialSecretName","secretSelected"],["formArrayName","parameters"],["ss-locale","parameters",1,"field-header"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[3,"showActions","labelText"],["formControlName","parameterValue","editSection","hook",3,"placeholder","type"]],template:function(e,t){1&e&&(b.Mc(0,er,1,1,"h1",0),b.Mc(1,tr,1,1,"h1",1),b.Ub(2,"div",2),b.Pb(3,"ss-validation-summary",3),b.Ub(4,"form",4),b.Ub(5,"thy-form-layout",5),b.Ub(6,"thy-form-layout-row",6),b.gc(7,"async"),b.gc(8,"ssLocale"),b.Sb(9,7),b.Ub(10,"select",8),b.Ub(11,"optgroup",9),b.Mc(12,sr,2,2,"option",10),b.Tb(),b.Ub(13,"optgroup",11),b.Mc(14,ir,2,2,"option",10),b.Tb(),b.Ub(15,"optgroup",12),b.Mc(16,or,2,2,"option",10),b.Tb(),b.Tb(),b.Rb(),b.Tb(),b.Mc(17,vr,18,17,"ng-container",13),b.Tb(),b.Tb(),b.Tb(),b.Ub(18,"div",14),b.Ub(19,"button",15),b.bc("click",function(){return t.cancel()}),b.Oc(20,"Cancel"),b.Tb(),b.Ub(21,"div",16),b.Ub(22,"button",17),b.bc("click",function(){return t.save()}),b.Oc(23," Save "),b.Tb(),b.Tb(),b.Tb()),2&e&&(b.nc("ngIf",t.isEdit),b.Cb(1),b.nc("ngIf",!t.isEdit),b.Cb(2),b.nc("ssForm",t.hookForm),b.Cb(1),b.nc("formGroup",t.hookForm),b.Cb(1),b.nc("showBorder",!1)("noBottomMargin",!0),b.Cb(1),b.nc("labelText",b.hc(7,14,b.ic(8,16,"type","common")))("showActions",!1),b.Cb(6),b.nc("ngForOf",t.powershellScripts),b.Cb(2),b.nc("ngForOf",t.sqlScripts),b.Cb(2),b.nc("ngForOf",t.sshScripts),b.Cb(1),b.nc("ngIf",t.hook),b.Cb(4),b.nc("matTooltip",t.ies.okButtonTooltip),b.Cb(1),b.nc("disabled",t.ies.isSaveDisabled("hook")))},directives:[i.o,E.g,q.a,o.E,o.t,o.l,l.e,l.f,o.B,o.s,o.j,i.n,E.d,f.a,R.a,E.j,o.w,o.D,j.a,o.f,o.m],pipes:[i.b,bt.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();const Sr=["groupHeader"],wr=["optionsTemplate"],Cr=["yesNoTemplate"],Tr=["passFailTemplate"];function Or(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",9),b.bc("click",function(){return b.Ec(e),b.fc().createNewHook()}),b.Oc(1," Create New Hook "),b.Tb()}}function Ir(e,t){if(1&e&&(b.Ub(0,"span",10),b.Oc(1),b.Tb()),2&e){const e=t.item;b.Cb(1),b.Rc("",e.prePostOption," - ",e.eventActionName,"")}}function _r(e,t){if(1&e&&(b.Ub(0,"div",11),b.Ub(1,"thy-context-button",12),b.Pb(2,"mat-icon",13),b.Tb(),b.Tb()),2&e){const e=t.item,s=b.fc();b.Cb(1),b.nc("menuItems",s.links)("context",e)}}function Pr(e,t){1&e&&(b.Ub(0,"span",16),b.Oc(1,"Yes"),b.Tb())}function Mr(e,t){1&e&&(b.Ub(0,"span",17),b.Oc(1,"No"),b.Tb())}function kr(e,t){if(1&e&&(b.Mc(0,Pr,2,0,"span",14),b.Mc(1,Mr,2,0,"span",15)),2&e){const e=t.value;b.nc("ngIf",e),b.Cb(1),b.nc("ngIf",!e)}}function xr(e,t){1&e&&(b.Ub(0,"span",20),b.Oc(1,"Success"),b.Tb())}function Dr(e,t){1&e&&(b.Ub(0,"span",21),b.Oc(1,"Fail"),b.Tb())}function Fr(e,t){if(1&e&&(b.Mc(0,xr,2,0,"span",18),b.Mc(1,Dr,2,0,"span",19)),2&e){const e=t.value;b.nc("ngIf",e),b.Cb(1),b.nc("ngIf",!e)}}let Ur=(()=>{let e=class{constructor(e,t,s,i){this._secretService=e,this._dialogService=t,this._cdr=s,this._log=i,this.secretState=null,this.columnDefinitions=null,this.canCreate=!0,this.hooks=null,this.links=[{id:"edit",displayText:"Edit",menuClicked:new ye.a},{id:"delete",displayText:"Delete",menuClicked:new ye.a}]}ngOnInit(){this.links.forEach(e=>e.menuClicked.pipe(Object(M.b)(this)).subscribe(e=>this._onContextMenuClick(e))),this.canCreate=this._secretService.hasAction(D.W.EditHooks,this.secretState)}ngAfterViewInit(){this._applyColumnDefinitions()}ngOnChanges(e){e.secretState&&this._loadHooks()}createNewHook(){this._openHook(null)}_loadHooks(){this._secretService.getHooks(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{e.forEach(e=>{let t="B";"PRE"===e.prePostOption&&(t="A"),e.groupCategory=e.eventActionName+t+e.prePostOption}),this.hooks=e})}_applyColumnDefinitions(){this.columnDefinitions=[{propertyName:"groupCategory",displayName:"Group",displayNameLocale:"group",columnOrder:1,groupByColumnOrder:1,groupTemplate:this.groupHeader,showColumn:!1},{propertyName:"name",displayName:"Name",displayNameLocale:"name",columnOrder:2},{propertyName:"scriptTypeName",displayName:"Type",displayNameLocale:"type",columnOrder:30},{propertyName:"scriptName",displayName:"Script",displayNameLocale:"script",columnOrder:40},{propertyName:"status",displayName:"status",displayNameLocale:"status",columnOrder:50,template:this.passFailTemplate},{propertyName:"stopOnFailure",displayName:"Stop on Failure",displayNameLocale:"stop-on-failure",columnOrder:60,template:this.yesNoTemplate}],this._cdr.detectChanges()}_onContextMenuClick(e){switch(e.id){case"delete":this._dialogService.open(F.a,{width:F.c.Small,data:{title:"Remove Hook",body:"Press OK to confirm that you want to remove this hook."}}).afterClosed().pipe(Object(h.a)()).subscribe(t=>{t&&this._secretService.deleteHook(this.secretState.id,e.menuContext.secretHookId).pipe(Object(h.a)()).subscribe(e=>{this._loadHooks()})});break;case"edit":this._openHook(e.menuContext.secretHookId);break;default:this._log.Error("Invalid context menu button clicked in secret hooks",e)}}_openHook(e){this._dialogService.open(yr,{data:{secretId:this.secretState.id,secretHookId:e}}).afterClosed().pipe(Object(h.a)()).subscribe(e=>{(null==e?void 0:e.isApproved)&&this._loadHooks()})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.V),b.Ob(E.c),b.Ob(b.h),b.Ob(a.fb))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-hooks"]],viewQuery:function(e,t){if(1&e&&(b.Uc(Sr,1),b.Uc(wr,1),b.Uc(Cr,1),b.Uc(Tr,1)),2&e){let e;b.zc(e=b.cc())&&(t.groupHeader=e.first),b.zc(e=b.cc())&&(t.optionsTemplate=e.first),b.zc(e=b.cc())&&(t.yesNoTemplate=e.first),b.zc(e=b.cc())&&(t.passFailTemplate=e.first)}},inputs:{secretState:"secretState"},features:[b.Ab],decls:17,vars:7,consts:[[1,"right","floated"],["class","thy primary button","ss-locale","create-new-hook",3,"click",4,"ngIf"],["ss-locale","hooks"],[2,"clear","right","margin-bottom","8px"],["pageName","secretDetail","gridName","secret-hooks",3,"items","showSummary","defaultOrderByField","columnDefinitions","includePaging","moreRowTemplate"],["groupHeader",""],["optionsTemplate",""],["yesNoTemplate",""],["passFailTemplate",""],["ss-locale","create-new-hook",1,"thy","primary","button",3,"click"],[1,"groupTitle"],[1,"rowHoverDisplay",2,"text-align","right","height","18px"],["iconName","more_vert",3,"menuItems","context"],["svgIcon","more_vert",1,"icon-18"],["ss-locale","yes","ss-page-name","common",4,"ngIf"],["ss-locale","no","ss-page-name","common",4,"ngIf"],["ss-locale","yes","ss-page-name","common"],["ss-locale","no","ss-page-name","common"],["ss-locale","success","ss-page-name","common",4,"ngIf"],["ss-locale","failed","ss-page-name","common",4,"ngIf"],["ss-locale","success","ss-page-name","common"],["ss-locale","failed","ss-page-name","common"]],template:function(e,t){if(1&e&&(b.Ub(0,"div"),b.Ub(1,"div"),b.Ub(2,"div",0),b.Ub(3,"div"),b.Mc(4,Or,2,0,"button",1),b.Tb(),b.Tb(),b.Ub(5,"h1",2),b.Oc(6,"Hooks"),b.Tb(),b.Pb(7,"div",3),b.Pb(8,"ss-grid",4),b.Mc(9,Ir,2,2,"ng-template",null,5,b.Nc),b.Mc(11,_r,3,2,"ng-template",null,6,b.Nc),b.Mc(13,kr,2,2,"ng-template",null,7,b.Nc),b.Mc(15,Fr,2,2,"ng-template",null,8,b.Nc),b.Tb(),b.Tb()),2&e){const e=b.Ac(12);b.Cb(4),b.nc("ngIf",t.canCreate),b.Cb(4),b.nc("items",t.hooks)("showSummary",!1)("defaultOrderByField","SortOrder")("columnDefinitions",t.columnDefinitions)("includePaging",!1)("moreRowTemplate",e)}},directives:[i.o,f.a,L.a,m.c,st.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();var Ar=s("Tpcn"),Er=s("xpnO"),Rr=s("BYOP"),Nr=s("q5RR");function Lr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",15),b.bc("click",function(){return b.Ec(e),b.fc(2).enableEdit()}),b.Oc(1,"Edit"),b.Tb()}}function Vr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"ss-layout-form-row",16),b.Ub(1,"label",17),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.shareForm.controls.enableInheritPermissions.setValue(!t.shareForm.value.enableInheritPermissions)}),b.Oc(2,"Inherit Permissions from folder"),b.Tb(),b.Pb(3,"ss-form-input",18),b.Tb()}if(2&e){const e=b.fc(2);b.nc("showActions",!1),b.Cb(3),b.nc("type",e.formInputType.Boolean)("editSection",e.editSection)}}function qr(e,t){1&e&&b.Pb(0,"svg-icon",29)}function Gr(e,t){1&e&&b.Pb(0,"svg-icon",30)}function zr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",31),b.bc("click",function(){b.Ec(e);const t=b.fc().$implicit;return b.fc(2).showGroup(t)}),b.Oc(1),b.Tb()}if(2&e){const e=b.fc().$implicit;b.Cb(1),b.Pc(e.get("name").value)}}function Br(e,t){if(1&e&&(b.Ub(0,"span"),b.Oc(1),b.Tb()),2&e){const e=b.fc().$implicit;b.Cb(1),b.Pc(e.get("name").value)}}function jr(e,t){if(1&e&&b.Pb(0,"ss-form-input",32),2&e){const e=b.fc(3);b.nc("type",e.formInputType.DropDown)("options",e.permissionTypes)}}function Wr(e,t){if(1&e&&b.Pb(0,"ss-form-input",33),2&e){const e=b.fc(3);b.nc("type",e.formInputType.DropDown)("options",e.permissionTypes)("inputWidth",100)}}function Hr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",31),b.bc("click",function(){b.Ec(e);const t=b.fc(2).index;return b.fc(2).removeGroup(t)}),b.Oc(1,"Remove"),b.Tb()}}function Kr(e,t){if(1&e&&(b.Ub(0,"td",34),b.Mc(1,Hr,2,0,"button",23),b.Tb()),2&e){const e=b.fc(3);b.Cb(1),b.nc("ngIf",e.ies.isEditMode(e.editSection)&&!e.shareForm.value.enableInheritPermissions)}}function Qr(e,t){if(1&e&&(b.Ub(0,"tr",19),b.Ub(1,"td",20),b.Mc(2,qr,1,0,"svg-icon",21),b.Mc(3,Gr,1,0,"svg-icon",22),b.Tb(),b.Ub(4,"td"),b.Mc(5,zr,2,1,"button",23),b.Mc(6,Br,2,1,"span",24),b.Tb(),b.Ub(7,"td",25),b.Mc(8,jr,1,2,"ss-form-input",26),b.Mc(9,Wr,1,3,"ss-form-input",27),b.Tb(),b.Mc(10,Kr,2,1,"td",28),b.Tb()),2&e){const e=t.$implicit,s=t.index,i=b.fc(2);b.nc("formGroupName",s),b.Db("data-gid",e.get("id").value),b.Cb(2),b.nc("ngIf",e.get("isGroup").value),b.Cb(1),b.nc("ngIf",!e.get("isGroup").value),b.Cb(2),b.nc("ngIf",e.get("isGroup").value),b.Cb(1),b.nc("ngIf",!e.get("isGroup").value),b.Cb(2),b.nc("ngIf",i.shareForm.value.enableInheritPermissions),b.Cb(1),b.nc("ngIf",!i.shareForm.value.enableInheritPermissions),b.Cb(1),b.nc("ngIf",i.ies.isEditMode(i.editSection))}}function $r(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",35),b.Ub(1,"div",36),b.Ub(2,"b"),b.Ub(3,"span",37),b.Oc(4,"Add Groups / Users"),b.Tb(),b.Tb(),b.Tb(),b.Ub(5,"div",38),b.Ub(6,"ss-user-lookup",39),b.bc("selectItem",function(t){return b.Ec(e),b.fc(2).selectUser(t)}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc(2);b.Cb(6),b.nc("excludeGroupIds",e.groupIdsToExclude)("isMultiSelect",!0)("showAllUsersWhenSearchEmpty",!0)}}function Zr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div",2),b.Pb(1,"ss-validation-summary",3),b.Ub(2,"form",4),b.Ub(3,"ss-layout-form",5),b.Sb(4,6),b.Oc(5,"\xa0\xa0 "),b.Ub(6,"span"),b.Mc(7,Lr,2,0,"button",7),b.Tb(),b.Rb(),b.Mc(8,Vr,4,3,"ss-layout-form-row",8),b.Ub(9,"div"),b.Ub(10,"div"),b.Ub(11,"div",9),b.Oc(12),b.gc(13,"async"),b.gc(14,"ssLocale"),b.Tb(),b.Ub(15,"div",10),b.Ub(16,"table",11),b.Mc(17,Qr,11,9,"tr",12),b.Tb(),b.Tb(),b.Tb(),b.Ub(18,"div"),b.Mc(19,$r,7,3,"div",13),b.Tb(),b.Tb(),b.Ub(20,"ss-layout-button-row",14),b.bc("cancel",function(t){return b.Ec(e),b.fc().cancelEdit(t)})("save",function(t){return b.Ec(e),b.fc().saveShare(t)}),b.Tb(),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.nc("formGroup",e.shareForm),b.Cb(1),b.nc("ssForm",e.shareForm)("editSection",e.editSection),b.Cb(1),b.nc("formGroup",e.shareForm),b.Cb(1),b.nc("labelColumnWidth",e.LabelColumnWidth.Large)("noBottomMargin",!0),b.Cb(4),b.nc("ngIf",e.canModifyShare&&!e.ies.isAnyEditModeEnabled),b.Cb(1),b.nc("ngIf",!e.hideInherit),b.Cb(4),b.Rc("",b.hc(13,13,b.hc(14,15,"shared-with"))," (",null==e.shareFormPermissions?null:e.shareFormPermissions.length,")"),b.Cb(5),b.nc("ngForOf",e.shareFormPermissions.controls),b.Cb(2),b.nc("ngIf",e.ies.isEditMode(e.editSection)&&!e.shareForm.value.enableInheritPermissions),b.Cb(1),b.nc("editSection",e.editSection)}}let Yr=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l,d,h){this._dialogService=e,this._ies=t,this._log=s,this._userService=i,this._cache=n,this._errorService=r,this._localizationService=c,this._stateService=a,this._secretService=l,this._router=d,this._notificationService=h,this.secretState=null,this.formInputType=A.a,this.bannerMessage=null,this.hideInherit=!1,this.shareFormPermissions=new o.e([]),this.shareForm=new o.k({enableInheritPermissions:new o.h,permissions:this.shareFormPermissions}),this.isLoading=!0,this.permissionRoles=null,this.permissions=null,this.folderPermissions=null,this.permissionTypes=[],this.groupIdsToExclude=[],this.workingPermissions=null,this.addedValueChanges=!1,this.canModifyShare=!1,this._shareModel=null,this._canModifyShareAfterSave=!1,this.ies=null,this.editSection="share",this.LabelColumnWidth=lt.a,this.UserSearchType=Ar.a,this.initialUsers=[],this.ies=this._ies}ngOnChanges(e){e.secretState&&(this._shareModel=null,this._loadSecret(!1),this.canModifyShare=this._secretService.hasAction(D.W.EditShare,this.secretState))}enableEdit(){this.ies.enableEditMode(this.editSection,this.shareForm)}_assignFolderPermissions(){this.workingPermissions=this.shareForm.controls.permissions.controls.slice(),this._assignPermissionList(this.folderPermissions)}_loadSecret(e){this.shareFormPermissions=new o.e([]),this.shareForm.controls.permissions=this.shareFormPermissions,this.isLoading=!0,this._shareModel?e?Object(nt.a)([this._secretService.getSecretDetailShare(this.secretState.id),this._secretService.getPermissions(this.secretState.id)]).pipe(Object(h.a)()).subscribe(t=>{this._shareModel=t[0],this.permissions=t[1],this._applyData(e)}):this._applyData(e):Object(nt.a)([this._secretService.getSecretDetailShare(this.secretState.id),this._secretService.getPermissions(this.secretState.id),this._secretService.getPermissionRoles(!1)]).pipe(Object(h.a)()).subscribe(t=>{this._shareModel=t[0],this.permissions=t[1],this.permissionRoles=t[2],this.permissionTypes=[],this.permissionRoles.SecretRoles.forEach(e=>{this.permissionTypes.push({text:this._getLocalizedRoleName(e.Name),value:e.Id.toString()})}),this._applyData(e)})}_getLocalizedRoleName(e){const t=e.toLowerCase().replace(/ /g,"-");return this._localizationService.hasPageMessage("common",t)?this._localizationService.getCachedPageMessage("common",t):e}_applyData(e){this._loadDetailShare(e,this._shareModel),this._assignPermissionList(this.permissions),this.isLoading=!1}_loadDetailShare(e,t){this._log.Verbose("getSecretDetailShare",t),this.canModifyShare||(this.bannerMessage=this._localizationService.getCachedMessage("cannot-share-not-owner"),this._notificationService.addBannerNotification("tab",{message:this.bannerMessage,key:"nosharemodify"})),this.shareForm.controls.enableInheritPermissions.setValue(t.enableInheritPermissions.value);const s=t.enableInheritPermissions.value;this.hideInherit=t.enableInheritPermissions.hidden,this.addedValueChanges||(this.addedValueChanges=!0,this.shareForm.get("enableInheritPermissions").valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{e?null!==this.folderPermissions&&this.workingPermissions&&this.workingPermissions.length>0?this._assignFolderPermissions():this._secretService.getPermissionsForFolder(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this.folderPermissions=e,this._assignFolderPermissions()}):this.workingPermissions&&this.workingPermissions.length>0&&(this.shareForm.controls.permissions.controls=this.workingPermissions),s!==e&&this.shareForm.markAsDirty()})),e&&(this.shareForm.markAsPristine(),this.shareForm.markAsUntouched(),this.shareForm.updateValueAndValidity())}_assignPermissionList(e){const t=this.shareForm.controls.permissions;for(let s=t.length-1;s>=0;s--)t.removeAt(s);e.forEach(e=>{t.push(new o.k({id:new o.h(e.GroupId),name:new o.h(e.DisplayNameWithDomain),isGroup:new o.h(!e.IsPersonal),permissionType:new o.h(e.SecretAccessRoleId.toString())}))}),t.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this.shareForm.markAsDirty(),this.shareForm.updateValueAndValidity()}),this._assignExcludedGroupIds()}selectUser(e){const t=this.shareForm.controls.permissions;this._userService.getMembersForGroup(e.groupId).pipe(Object(h.a)()).subscribe(s=>{t.push(new o.k({id:new o.h(e.groupId),name:new o.h(e.displayName),isGroup:new o.h(!e.userId),permissionType:new o.h(this.permissionRoles.DefaultSecretRole.Id.toString())})),this._assignExcludedGroupIds(),this.shareForm.markAsDirty(),this.shareForm.updateValueAndValidity()})}_assignExcludedGroupIds(){this.groupIdsToExclude=[],this.shareForm.controls.permissions.controls.forEach(e=>{this.groupIdsToExclude.push(e.get("id").value)})}cancelEdit(e){this.ies.disableEditMode(this.editSection,!0),this._assignPermissionList(this.permissions)}saveShare(e){const t=[],s=this.shareForm.controls.permissions;for(let i=0;i<s.controls.length;i++){const e=s.controls[i];t.push({GroupId:e.value.id,SecretAccessRoleId:e.value.permissionType,SecretId:this.secretState.id})}this._canModifyShareAfterSave=this.canModifyShare,this._secretService.isCurrentUserSecretOwner(t).pipe(Object(h.a)()).subscribe(e=>{e?this._confirmSave(t):this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedMessage("no-longer-owner"),body:this._localizationService.getCachedMessage("remove-owner-description")}}).afterClosed().subscribe(e=>{e&&(this._canModifyShareAfterSave=!1,this._confirmSave(t))})})}_confirmSave(e){this._secretService.saveSecretPermissions(this.secretState.id,this.shareForm.value.enableInheritPermissions,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved general ",e),this.ies.disableEditMode("share",!1),this._canModifyShareAfterSave||(this.canModifyShare=!1),this.isLoading=!1,this._cache.remove(`secret-state-${this.secretState.id}`)},error:e=>{const t=this._errorService.getErrorMessage(e);"API_SecretRequiresCheckout"===t.errorCode||"API_SecretAccessApprovalDenied"===t.errorCode||"API_ValidateSecretAccessCommentRequired"===t.errorCode?(this.ies.disableEditMode(null,!1),this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])):(this.isLoading=!1,this.ies.assignErrorToFormGroup(this.shareForm,e))}})}removeGroup(e){const t=this.shareForm.controls.permissions;let s=0,i=!1;for(let o=0;o<t.controls.length;o++)t.controls[o].get("permissionType").value===this.permissionRoles.SecretOwnerRoleId.toString()&&(s++,e===o&&(i=!0));i&&1===s?this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedMessage("owner-required"),body:this._localizationService.getCachedMessage("owner-required-description")}}).afterClosed().subscribe(e=>{e&&(this.shareForm.markAsDirty(),this.shareForm.updateValueAndValidity())}):(t.controls.splice(e,1),this.shareForm.markAsDirty(),this.shareForm.updateValueAndValidity(),this._assignExcludedGroupIds())}showGroup(e){const t=e.get("id").value,s=e.get("name").value;this._dialogService.open(Er.a,{width:F.c.Small,data:{groupId:t,groupName:s}})}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(E.c),b.Ob(a.B),b.Ob(a.fb),b.Ob(a.kb),b.Ob(a.P),b.Ob(a.eb),b.Ob(a.F),b.Ob(a.cb),b.Ob(a.V),b.Ob(c.e),b.Ob(m.i))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-share"]],inputs:{secretState:"secretState"},features:[b.Ab],decls:2,vars:3,consts:[[3,"active","isFullscreen"],["class","ui form form-width-medium full-height",3,"formGroup",4,"ngIf"],[1,"ui","form","form-width-medium","full-height",3,"formGroup"],[3,"ssForm","editSection"],[3,"formGroup"],["titleLocale","secret-share","summaryLocale","secret-share-overview",3,"labelColumnWidth","noBottomMargin"],["additional-title",""],["id","edit-secret-share","class","nohoverlink link-button add-remove","ss-locale","edit","ss-page-name","common",3,"click",4,"ngIf"],["labelLocale","inherit-from-folder","labelTooltipLocale","inherit-from-folder-description","fieldId","inherit-from-folder",3,"showActions",4,"ngIf"],[1,"header"],["formArrayName","permissions",1,"shared-with-container"],[1,"share-permissions"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","full-height",4,"ngIf"],[3,"editSection","cancel","save"],["id","edit-secret-share","ss-locale","edit","ss-page-name","common",1,"nohoverlink","link-button","add-remove",3,"click"],["labelLocale","inherit-from-folder","labelTooltipLocale","inherit-from-folder-description","fieldId","inherit-from-folder",3,"showActions"],["ss-locale","inherit-from-folder",1,"pointer",3,"click"],["formControlName","enableInheritPermissions",3,"type","editSection"],[3,"formGroupName"],[1,"icon-cell"],["name","people","class","svg-icon icon-14",4,"ngIf"],["name","person","class","svg-icon icon-14",4,"ngIf"],["class","link-button",3,"click",4,"ngIf"],[4,"ngIf"],[1,"permission-cell"],["formControlName","permissionType","editSection","nosection",3,"type","options",4,"ngIf"],["formControlName","permissionType","editSection","share",3,"type","options","inputWidth",4,"ngIf"],["class","remove-cell",4,"ngIf"],["name","people",1,"svg-icon","icon-14"],["name","person",1,"svg-icon","icon-14"],[1,"link-button",3,"click"],["formControlName","permissionType","editSection","nosection",3,"type","options"],["formControlName","permissionType","editSection","share",3,"type","options","inputWidth"],[1,"remove-cell"],[1,"full-height"],[1,"label-text","add-group-users"],["ss-locale","add-groups-user"],[1,"permissions-container"],[3,"excludeGroupIds","isMultiSelect","showAllUsersWhenSearchEmpty","selectItem"]],template:function(e,t){1&e&&(b.Pb(0,"thy-loading-dimmer",0),b.Mc(1,Zr,21,17,"div",1)),2&e&&(b.nc("active",t.isLoading)("isFullscreen",!0),b.Cb(1),b.nc("ngIf",!t.isLoading))},directives:[m.h,i.o,o.t,o.l,q.a,o.E,G.a,o.f,i.n,Rr.a,f.a,z.a,j.a,o.s,o.j,o.m,n.b,Nr.a],pipes:[i.b,bt.a],styles:[".add-group-users[_ngcontent-%COMP%]{margin-top:16px}.permissions-container[_ngcontent-%COMP%], .shared-with-container[_ngcontent-%COMP%]{border:1px solid var(--border-color-1);padding:16px}.permissions-container[_ngcontent-%COMP%]{height:400px}table.share-permissions[_ngcontent-%COMP%]{width:100%;border-spacing:0}table.share-permissions[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover > td[_ngcontent-%COMP%]{background:var(--row-hover-1)}table.share-permissions[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{height:40px}table.share-permissions[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-align:left}table.share-permissions[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td.icon-cell[_ngcontent-%COMP%]{padding-left:4px;width:24px}table.share-permissions[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td.permission-cell[_ngcontent-%COMP%]{width:130px;text-align:right;padding-right:4px}table.share-permissions[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td.remove-cell[_ngcontent-%COMP%]{width:70px;text-align:right;padding-right:4px}"]}),e=Object(P.b)([Object(M.a)()],e),e})();const Jr=["sshSettingSecretPicker"];function Xr(e,t){if(1&e){const e=b.Vb();b.Ub(0,"form",3),b.Ub(1,"thy-form-layout",4),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("personalize",t.personalizeForm)}),b.gc(2,"async"),b.gc(3,"ssLocale"),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Ub(6,"thy-form-layout-row",5),b.Pb(7,"thy-form-boolean",6),b.Tb(),b.Ub(8,"thy-form-layout-row",5),b.Pb(9,"thy-form-boolean",7),b.Tb(),b.Ub(10,"thy-form-layout-row",5),b.Pb(11,"thy-form-boolean",8),b.Tb(),b.Ub(12,"thy-form-layout-button-row",9),b.bc("save",function(){return b.Ec(e),b.fc().savePersonalize()})("cancel",function(){return b.Ec(e),b.fc().cancelEdit()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.nc("formGroup",e.personalizeForm),b.Cb(1),b.nc("summaryTitle",b.hc(2,11,b.hc(3,13,"email-notifications")))("summaryDescription",b.hc(4,15,b.hc(5,17,"email-notifications-description")))("showBorder",!0)("disableEdit",e.secretDetailSettings.sendEmailWhenViewed.readOnly),b.Cb(5),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.sendEmailWhenViewed)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.sendEmailWhenChanged)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.sendEmailWhenHeartbeatFails)("showActions",!1)}}function ec(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",5),b.Pb(1,"thy-form-number",19),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.launcherHeight)("showActions",!1),b.Cb(1),b.nc("maxNumberValue",99999)("minNumberValue",0)}}function tc(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",5),b.Pb(1,"thy-form-number",20),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.launcherWidth)("showActions",!1),b.Cb(1),b.nc("maxNumberValue",99999)("minNumberValue",0)}}function sc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"form",3),b.Ub(1,"thy-form-layout",10),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("rdp",t.rdpForm)}),b.gc(2,"async"),b.gc(3,"ssLocale"),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Ub(6,"thy-form-layout-row",5),b.Pb(7,"thy-form-boolean",11),b.Tb(),b.Ub(8,"thy-form-layout-row",5),b.Pb(9,"thy-form-boolean",12),b.Tb(),b.Ub(10,"thy-form-layout-row",5),b.Pb(11,"thy-form-boolean",13),b.Tb(),b.Ub(12,"thy-form-layout-row",5),b.Pb(13,"thy-form-boolean",14),b.Tb(),b.Ub(14,"thy-form-layout-row",5),b.Pb(15,"thy-form-boolean",15),b.Tb(),b.Ub(16,"thy-form-layout-row",5),b.Pb(17,"thy-form-boolean",16),b.Tb(),b.Mc(18,ec,2,4,"thy-form-layout-row",17),b.Mc(19,tc,2,4,"thy-form-layout-row",17),b.Ub(20,"thy-form-layout-button-row",18),b.bc("save",function(){return b.Ec(e),b.fc().saveLauncher()})("cancel",function(){return b.Ec(e),b.fc().cancelEdit()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.nc("formGroup",e.rdpForm),b.Cb(1),b.nc("summaryTitle",b.hc(2,18,b.hc(3,20,"rdp-launcher-title")))("summaryDescription",b.hc(4,22,b.hc(5,24,"rdp-launcher-description")))("showBorder",!0),b.Cb(5),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.connectToConsole)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.allowPrinters)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.allowDrives)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.allowClipboard)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.allowSmartCards)("showActions",!1),b.Cb(2),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.rdpLauncherSettings.value.useCustomLauncherResolution)("showActions",!1),b.Cb(2),b.nc("ngIf",!e.formsService.currentEditSection||e.rdpForm.value.useCustomLauncherResolution),b.Cb(1),b.nc("ngIf",!e.formsService.currentEditSection||e.rdpForm.value.useCustomLauncherResolution)}}function ic(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",22),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Sb(3,26),b.Pb(4,"ss-form-input",27,28),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("labelText",b.hc(1,8,b.hc(2,10,"secret-to-use")))("thyFormLayoutRowDefinition",e.secretDetailSettings.sshLauncherSettings)("showActions",!1),b.Cb(4),b.nc("type",e.formInputType.Secret)("initialSecretName",e.sshSecretName)("forceEditMode","sshLauncher"===e.formsService.currentEditSection)("showShowRecommended",null!=e.sshSecretExtendedTypeIdFilter)("extendedTypeIdFilter",e.sshSecretExtendedTypeIdFilter)}}function oc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"form",3),b.Ub(1,"thy-form-layout",21),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("sshLauncher",t.sshLauncherForm)}),b.gc(2,"async"),b.gc(3,"ssLocale"),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Ub(6,"thy-form-layout-row",22),b.gc(7,"async"),b.gc(8,"ssLocale"),b.Pb(9,"thy-form-select",23),b.Tb(),b.Mc(10,ic,6,12,"thy-form-layout-row",24),b.Ub(11,"thy-form-layout-button-row",25),b.bc("save",function(){return b.Ec(e),b.fc().saveSshLauncher()})("cancel",function(){return b.Ec(e),b.fc().cancelEdit()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.nc("formGroup",e.sshLauncherForm),b.Cb(1),b.nc("summaryTitle",b.hc(2,10,b.hc(3,12,"ssh-launcher-title")))("summaryDescription",b.hc(4,14,b.hc(5,16,"ssh-launcher-description")))("showBorder",!0)("disableEdit",e.secretDetailSettings.sshLauncherSettings.readOnly),b.Cb(5),b.nc("labelText",b.hc(7,18,b.hc(8,20,"connect-using")))("thyFormLayoutRowDefinition",e.secretDetailSettings.sshLauncherSettings)("showActions",!1),b.Cb(3),b.nc("options",e.sshLauncherDropDownOptions),b.Cb(1),b.nc("ngIf",e.sshLauncherForm.value.runLauncherType!==e.SshRunLauncherType.ConnectAsSecret)}}function nc(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",5),b.Ub(1,"div",26),b.Ub(2,"div",33),b.Ub(3,"div"),b.Pb(4,"thy-form-number",34),b.Tb(),b.Ub(5,"div"),b.Oc(6,"\xa0"),b.Ub(7,"span",35),b.Oc(8,"Days"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.expirationDayInterval)("showActions",!1),b.Cb(4),b.nc("minNumberValue",0)("maxNumberValue",9999)("maxlength",4)}}function rc(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",5),b.Pb(1,"thy-form-date",36),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.expirationDate)("showActions",!1),b.Cb(1),b.nc("minDate",e.minimumDate)("timezone",e.stateService.dateTimeServerTimezone)("offset",e.stateService.dateTimeServerOffset)("offsetDescription",e.stateService.timezoneOffsetDisplay)}}function cc(e,t){if(1&e&&(b.Ub(0,"thy-form-layout-row",5),b.Sb(1,26),b.Oc(2),b.Rb(),b.Tb()),2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.expirationTemplateText)("showActions",!1),b.Cb(2),b.Pc(e.secretDetailSettings.expirationTemplateText.value)}}function ac(e,t){if(1&e){const e=b.Vb();b.Ub(0,"form",3),b.Ub(1,"thy-form-layout",29),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("expiration",t.expirationForm)}),b.gc(2,"async"),b.gc(3,"ssLocale"),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Ub(6,"thy-form-layout-row",30),b.Pb(7,"thy-form-select",31),b.Tb(),b.Mc(8,nc,9,5,"thy-form-layout-row",17),b.Mc(9,rc,2,6,"thy-form-layout-row",17),b.Mc(10,cc,3,3,"thy-form-layout-row",17),b.Ub(11,"thy-form-layout-button-row",32),b.bc("save",function(){return b.Ec(e),b.fc().saveExpiration()})("cancel",function(){return b.Ec(e),b.fc().cancelEdit()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.nc("formGroup",e.expirationForm),b.Cb(1),b.nc("summaryTitle",b.hc(2,10,b.hc(3,12,"expiration")))("summaryDescription",b.hc(4,14,b.hc(5,16,"expiration-description")))("showBorder",!0)("disableEdit",!e.canEditExpiration),b.Cb(5),b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.expirationType),b.Cb(1),b.nc("options",e.expirationOptions),b.Cb(1),b.nc("ngIf","DayInterval"===e.expirationForm.value.expirationType),b.Cb(1),b.nc("ngIf","SpecificDate"===e.expirationForm.value.expirationType),b.Cb(1),b.nc("ngIf","Template"===e.expirationForm.value.expirationType)}}function lc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",5),b.Sb(1,26),b.Ub(2,"ss-form-input",40),b.bc("showPasswordClick",function(){return b.Ec(e),b.fc(2).toggleTotpKey()})("modifyPasswordClick",function(){return b.Ec(e),b.fc(2).toggleTotpKey()}),b.Tb(),b.Rb(),b.Tb()}if(2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.oneTimePasswordSettings.value.key)("showActions",!1),b.Cb(2),b.nc("viewField",e.secretDetailSettings.oneTimePasswordSettings.value.key)("type",e.formInputType.Password)("showModifyShowLink",e.canAdministerTotp)("passwordPopupText",e.totpKeysNotLoaded)("maxlength",1e4)("alwaysHidePasswordGenerate",!0)("forceEditMode","totp"===e.formsService.currentEditSection)("breakWord",!0)}}function dc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-form-layout-row",5),b.Sb(1,26),b.Ub(2,"ss-form-input",41),b.bc("showPasswordClick",function(){return b.Ec(e),b.fc(2).toggleTotpBackupCodes()})("modifyPasswordClick",function(){return b.Ec(e),b.fc(2).toggleTotpBackupCodes()}),b.Tb(),b.Rb(),b.Tb()}if(2&e){const e=b.fc(2);b.nc("thyFormLayoutRowDefinition",e.secretDetailSettings.oneTimePasswordSettings.value.backupCodes)("showActions",!1),b.Cb(2),b.nc("type",e.formInputType.Password)("viewField",e.secretDetailSettings.oneTimePasswordSettings.value.backupCodes)("passwordPopupText",e.totpCodesNotLoaded)("maxlength",1e4)("alwaysHidePasswordGenerate",!0)("forceEditMode","totp"===e.formsService.currentEditSection)("breakWord",!0)}}function hc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"form",3),b.Ub(1,"thy-form-layout",37),b.bc("editForm",function(){b.Ec(e);const t=b.fc();return t.formsService.enableEditMode("totp",t.totpForm)}),b.gc(2,"async"),b.gc(3,"ssLocale"),b.gc(4,"async"),b.gc(5,"ssLocale"),b.Ub(6,"thy-form-layout-row",22),b.gc(7,"async"),b.gc(8,"ssLocale"),b.Pb(9,"thy-form-boolean",38),b.Tb(),b.Mc(10,lc,3,10,"thy-form-layout-row",17),b.Mc(11,dc,3,9,"thy-form-layout-row",17),b.Ub(12,"thy-form-layout-button-row",39),b.bc("save",function(){return b.Ec(e),b.fc().saveTotp()})("cancel",function(){return b.Ec(e),b.fc().cancelEdit()}),b.Tb(),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.nc("formGroup",e.totpForm),b.Cb(1),b.nc("summaryTitle",b.hc(2,10,b.hc(3,12,"totp-settings")))("summaryDescription",b.hc(4,14,b.hc(5,16,"totp-settings-description")))("showBorder",!0)("disableEdit",!e.canAdministerTotp),b.Cb(5),b.nc("labelText",b.hc(7,18,b.hc(8,20,"connect-using")))("thyFormLayoutRowDefinition",e.secretDetailSettings.oneTimePasswordSettings.value.enabled)("showActions",!1),b.Cb(4),b.nc("ngIf",e.totpForm.controls.enabled.value&&e.canAdministerTotp),b.Cb(1),b.nc("ngIf",e.totpForm.controls.enabled.value)}}let uc=(()=>{let e=class{constructor(e,t,s,i,n,r,c,a,l){this.ies=e,this._router=t,this._secretService=s,this._localizationService=i,this._log=n,this._errorService=r,this._dateService=c,this.formsService=a,this.stateService=l,this.secretState=null,this.formInputType=A.a,this.isLoading=!0,this.hasLauncherProperties=!1,this.showLauncherProperties=!1,this.totpHashOptions=[],this.canAdministerTotp=!1,this.canEditSshLauncherSettings=!1,this.SshRunLauncherType=D.bb,this.personalizeForm=new o.k({sendEmailWhenViewed:new o.h,sendEmailWhenChanged:new o.h,sendEmailWhenHeartbeatFails:new o.h([])}),this.rdpForm=new o.k({connectToConsole:new o.h([]),allowPrinters:new o.h([]),allowDrives:new o.h([]),allowClipboard:new o.h([]),allowSmartCards:new o.h([]),useCustomLauncherResolution:new o.h([]),launcherHeight:new o.h("",[o.C.max(99999),k.a.mustBePositiveNumber,k.a.mustBeWholeNumber,k.a.conditionalRequired(()=>this.rdpForm&&this.rdpForm.controls.useCustomLauncherResolution.value)]),launcherWidth:new o.h("",[o.C.max(99999),k.a.mustBePositiveNumber,k.a.mustBeWholeNumber,k.a.conditionalRequired(()=>this.rdpForm&&this.rdpForm.controls.useCustomLauncherResolution.value)])}),this.sshLauncherForm=new o.k({runLauncherType:new o.h([]),secretId:new o.h([])}),this.launcherForm=new o.k({id:new o.h,name:new o.h,imagePath:new o.h,runUsingCredentialsOnSelf:new o.h,runUsingCredentialsOnOtherSecret:new o.h,connectAsSelf:new o.h,connectAsOtherSecret:new o.h,associatedSecrets:new o.e([]),launcherType:new o.h,active:new o.h,processName:new o.h,parameters:new o.h,launchAsSecretCredentials:new o.h}),this.canEditExpiration=!1,this.expirationForm=new o.k({expirationType:new o.h,expirationDayInterval:new Pi.a("Expiration Day Interval"),expirationDate:new o.h}),this.totpForm=new o.k({enabled:new o.h,key:new o.h("",k.a.requiredNotEmpty),backupCodes:new o.h("")}),this.expirationOptions=[{text:"Template Interval",value:"Template"},{text:"Custom Day Interval",value:"DayInterval"},{text:"Custom Date",value:"SpecificDate"}],this.sshSecretName=null,this.sshSecretExtendedTypeIdFilter=null,this.totpKeysNotLoaded=null,this.totpCodesNotLoaded=null}ngOnInit(){this.expirationOptions[0].text=this._localizationService.getCachedMessage("template"),this.expirationOptions[1].text=this._localizationService.getCachedMessage("custom-day-interval"),this.expirationOptions[2].text=this._localizationService.getCachedMessage("custom-date"),this._localizationService.waitUntilResourcePageLoaded("secretdetail").pipe(Object(h.a)()).subscribe(e=>{this.sshLauncherDropDownOptions=[{value:D.bb.ConnectAsSecret,text:this._localizationService.getCachedMessage("connect-as-this-secret")},{value:D.bb.UseSshKeyOnSecret,text:this._localizationService.getCachedMessage("ssh-on-other-secret")}],this._connectAsCredentialsLocalized=this._localizationService.getCachedMessage("connect-as-other-secret"),this.needProxyForCredentialsLocalized=this._localizationService.getCachedMessage("connect-as-disabled-explanation"),this.expirationForm.controls.expirationDayInterval.meta.label=this._localizationService.getCachedMessage("expiration-day-interval"),this.totpKeysNotLoaded=this._localizationService.getCachedMessage("totp-keys-not-loaded"),this.totpCodesNotLoaded=this._localizationService.getCachedMessage("totp-codes-not-loaded")}),this.enableOrDisableTotpValidation(),this._addExpirationValidation(),this.rdpForm.controls.useCustomLauncherResolution.valueChanges.subscribe({next:()=>this._validateLauncherResolution()}),this._initializeSecret()}ngOnChanges(e){e.secretState&&this._initializeSecret()}_initializeSecret(){this.secretState&&(this.canAdministerTotp=this.secretState.role===D.X.Owner,this.canEditSshLauncherSettings=this.secretState.role===D.X.Owner,this.canEditExpiration=this._secretService.hasAction(D.W.EditExpiration,this.secretState),this._secretService.getSecretDetailSettings(this.secretState.id).pipe(Object(h.a)()).subscribe(e=>{this.secretDetailSettings=e,this._log.Verbose("secretDetailSettings",this.secretDetailSettings),this.ies.patchViewModel(this.personalizeForm,this.secretDetailSettings),this.ies.patchViewModel(this.totpForm,this.secretDetailSettings.oneTimePasswordSettings.value),this._patchRdpForm(),this._patchSshLauncherForm(),this.ies.patchViewModel(this.expirationForm,this.secretDetailSettings),this.showLaunchers()&&this.secretDetailSettings.launchers.value[0].id&&this._bindLauncherForm(this.secretDetailSettings.launchers.value[0].id.value),this.minimumDate=this._dateService.getLocalAsUtcIso(new Date),this.secretDetailSettings.sshLauncherSettings.readOnly&&(this.canEditSshLauncherSettings=!1,this.sshLauncherTitle=this.secretDetailSettings.sshLauncherSettings.readOnlyReason),this.isLoading=!1}),this._validateLauncherResolution())}cancelEdit(){this.formsService.disableEditMode(!0)}_validateLauncherResolution(){this.rdpForm.controls.launcherHeight.updateValueAndValidity(),this.rdpForm.controls.launcherWidth.updateValueAndValidity()}enableOrDisableTotpValidation(){this.totpForm.controls.enabled.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{!0===e?this.totpForm.controls.key.setValidators(k.a.requiredNotEmpty):this.totpForm.controls.key.clearValidators(),this.totpForm.controls.key.updateValueAndValidity()})}_patchRdpForm(){this.secretDetailSettings.rdpLauncherSettings.hidden||(this._setRdpPreferenceOption(this.secretDetailSettings.rdpLauncherSettings.value.allowClipboard,"allowClipboard"),this._setRdpPreferenceOption(this.secretDetailSettings.rdpLauncherSettings.value.allowSmartCards,"allowSmartCards"),this._setRdpPreferenceOption(this.secretDetailSettings.rdpLauncherSettings.value.allowDrives,"allowDrives"),this._setRdpPreferenceOption(this.secretDetailSettings.rdpLauncherSettings.value.allowPrinters,"allowPrinters"),this._setRdpPreferenceOption(this.secretDetailSettings.rdpLauncherSettings.value.connectToConsole,"connectToConsole"),this._setRdpPreferenceOption(this.secretDetailSettings.rdpLauncherSettings.value.useCustomLauncherResolution,"useCustomLauncherResolution"),this.rdpForm.controls.useCustomLauncherResolution.value&&(this.rdpForm.controls.launcherHeight.setValue(this.secretDetailSettings.rdpLauncherSettings.value.launcherHeight.value),this.rdpForm.controls.launcherWidth.setValue(this.secretDetailSettings.rdpLauncherSettings.value.launcherWidth.value),"UsePreferenceYes"===this.secretDetailSettings.rdpLauncherSettings.value.useCustomLauncherResolution.value&&this.rdpForm.controls.useCustomLauncherResolution.setValue(!1)))}_setRdpPreferenceOption(e,t){const s=e.value;this.rdpForm.controls[t].setValue("Yes"===s||"UsePreferenceYes"===s)}_patchSshLauncherForm(){if(this.secretDetailSettings.sshLauncherSettings.hidden)return;const e=this.sshLauncherForm.controls.runLauncherType,t=this.sshLauncherForm.controls.secretId;t.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{this.sshSettingSecretPicker&&(this.sshSecretName=this.sshSettingSecretPicker.secretName)}),e.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{e===D.bb.ConnectAsSecret?(t.clearValidators(),this.sshSecretExtendedTypeIdFilter=null):(this.sshSecretExtendedTypeIdFilter=e===D.bb.ConnectAsDifferentSecret?null:this.secretDetailSettings.sshLauncherSettings.value.sshKeyExtendedTypeId,t.setValidators(o.C.required)),t.updateValueAndValidity()}),e.setValue(this.secretDetailSettings.sshLauncherSettings.value.launcherType),this.sshSecretName=this.secretDetailSettings.sshLauncherSettings.value.secretName.value,t.setValue(this.secretDetailSettings.sshLauncherSettings.value.secretId.value),this.secretDetailSettings.sshLauncherSettings.value.canConnectAsCredentials&&this.sshLauncherDropDownOptions.map(e=>e.value).indexOf(D.bb.ConnectAsDifferentSecret)<0&&this.sshLauncherDropDownOptions.push({value:D.bb.ConnectAsDifferentSecret,text:this._connectAsCredentialsLocalized})}_getAssociatedSecret(e){const t=new o.k({id:new o.h,order:new o.h,secretName:new o.h("",o.C.required),secretFolderName:new o.h,secretTemplateName:new o.h});return t.patchValue(e),t}_bindLauncherForm(e){const t=this.secretDetailSettings.launchers.value.find(t=>t.id.value===e);this.ies.patchViewModel(this.launcherForm,t);const s=t.associatedSecrets.value,i=this.launcherForm.controls.associatedSecrets;for(let o=0;o<s.length;o++){const e=this.ies.getPatchableModel(s[o]),t=this._getAssociatedSecret(e);i.insert(o,t)}this.hasLauncherProperties=!t.processName.hidden}showLaunchers(){return!1}hasMultipleLaunchers(){return this.showLaunchers()&&this.secretDetailSettings.launchers.value.length>1}selectLauncher(e){this._log.Verbose("select launcher",e)}bindLauncherForm(){this.launcherForm=new o.k({id:new o.h,Name:new o.h,ImagePath:new o.h,RunUsingCredentialsOnSelf:new o.h,RunUsingCredentialsOnOtherSecret:new o.h,ConnectAsSelf:new o.h,ConnectAsOtherSecret:new o.h,associatedSecrets:new o.e([])}),this.ies.patchViewModel(this.launcherForm,this.secretDetailSettings)}savePersonalize(){const e=this.ies.createUpdateModel(this.personalizeForm);this._secretService.updateSecretDetailEmail(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved email",e),this.formsService.disableEditMode()},error:e=>this._handleError(e,this.personalizeForm,"personalizeForm")})}saveLauncher(){var e;const t=this.ies.createUpdateModel(this.rdpForm);let s=!1;!1===(null===(e=null==t?void 0:t.useCustomLauncherResolution)||void 0===e?void 0:e.value)&&(t.useCustomLauncherResolution.value=null,s=!0,delete t.launcherHeight,delete t.launcherWidth),this._secretService.updateRdpLauncherSettings(this.secretState.id,t).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved RDP",e),s&&(this.rdpForm.controls.launcherHeight.setValue(e.launcherHeight.value),this.rdpForm.controls.launcherWidth.setValue(e.launcherWidth.value)),this.formsService.disableEditMode()},error:e=>this._handleError(e,this.rdpForm,"rdp")})}cancelSshLauncher(){this.sshLauncherForm.controls.secretId.setValue(this.secretDetailSettings.sshLauncherSettings.value.secretId.value),this.sshSecretName=this.secretDetailSettings.sshLauncherSettings.value.secretName.value}saveSshLauncher(){const e=this.ies.createUpdateModel(this.sshLauncherForm,!1,!0);e.runLauncherType||(e.runLauncherType={dirty:!1,value:this.sshLauncherForm.controls.runLauncherType.value}),this._secretService.updateSshLauncherSettings(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved SSH launcher settings",e),this.formsService.disableEditMode()},error:e=>this._handleError(e,this.sshLauncherForm,"sshLauncher")})}saveExpiration(){const e=this.ies.createUpdateModel(this.expirationForm);this._secretService.updateSecretDetailExpiration(this.secretState.id,e).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Verbose("Saved expiration",e),this.ies.patchViewModel(this.expirationForm,e),this.formsService.disableEditMode()},error:e=>this._handleError(e,this.expirationForm,"expirationForm")})}_handleError(e,t,s){const i=this._errorService.getErrorMessage(e);"API_SecretRequiresCheckout"===i.errorCode||"API_SecretAccessApprovalDenied"===i.errorCode||"API_ValidateSecretAccessCommentRequired"===i.errorCode?(this.ies.disableEditMode(s,!1),this._router.onSameUrlNavigation="reload",this._router.navigate([this._router.url])):this.ies.assignErrorToFormGroup(t,e)}_addExpirationValidation(){this.expirationForm.get("expirationType").valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{const t=this.expirationForm.get("expirationDayInterval"),s=this.expirationForm.get("expirationDate");"DayInterval"===e?t.setValidators([k.a.requiredNotEmpty,o.C.min(0),o.C.max(9999),k.a.mustBeWholeNumber,k.a.mustBePositiveNumber]):t.clearValidators(),"SpecificDate"===e?s.setValidators(k.a.requiredNotEmpty):s.clearValidators(),t.updateValueAndValidity(),s.updateValueAndValidity(),this.expirationForm.updateValueAndValidity()})}retrieveKey(e){this._secretService.getOneTimePasswordSettingsKey(this.secretState.id).pipe(Object(h.a)()).subscribe({next:t=>{e.value=t.key.value,e.keyRetrieved=!0,this.totpForm.controls.key.setValue(t.key.value),this._log.Verbose("Retrieved TOTP key")}})}retrieveBackupCodes(e){this._secretService.getOneTimePasswordSettingsBackupCodes(this.secretState.id).pipe(Object(h.a)()).subscribe({next:t=>{e.value=t.backupCodes.value,e.codesRetrieved=!0,this.totpForm.controls.backupCodes.setValue(t.backupCodes.value),this._log.Verbose("Retrieved backup codes")}})}toggleTotpKey(){const e=this.secretDetailSettings.oneTimePasswordSettings.value.key;e.keyRetrieved||this.retrieveKey(e)}toggleTotpBackupCodes(){const e=this.secretDetailSettings.oneTimePasswordSettings.value.backupCodes;e.codesRetrieved||this.retrieveBackupCodes(e)}saveTotp(){this.totpForm.controls.enabled.value||(this.totpForm.controls.key.setValue(this.secretDetailSettings.oneTimePasswordSettings.value.key.value),this.totpForm.controls.backupCodes.setValue(this.secretDetailSettings.oneTimePasswordSettings.value.backupCodes.value),this.totpForm.controls.key.markAsPristine(),this.totpForm.controls.backupCodes.markAsPristine());let e=this.totpForm.controls.key.value;e&&(e=this._purgeWhiteSpace(e.toUpperCase()),this.totpForm.controls.key.setValue(e));const t=this.ies.createUpdateModel(this.totpForm);this._secretService.updateOneTimePasswordSettings(this.secretState.id,t).pipe(Object(h.a)()).subscribe({next:e=>{const t=e.oneTimePasswordSettings.value;this._log.Verbose("Saved totp",t),this.secretDetailSettings.oneTimePasswordSettings.value.key.keyRetrieved=!1,this.secretDetailSettings.oneTimePasswordSettings.value.backupCodes.codesRetrieved=!1,this.ies.patchViewModel(this.totpForm,t),this.formsService.disableEditMode()},error:e=>this._handleError(e,this.totpForm,"totpForm")})}cancelTotp(e){this.secretDetailSettings.oneTimePasswordSettings.value.key.keyRetrieved=!1,this.secretDetailSettings.oneTimePasswordSettings.value.backupCodes.codesRetrieved=!1,this.ies.disableEditMode("totpForm")}_purgeWhiteSpace(e){if(e)return e.indexOf(" ")>-1?e.replace(/\s/g,""):e}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(a.B),b.Ob(c.e),b.Ob(a.V),b.Ob(a.F),b.Ob(a.fb),b.Ob(a.eb),b.Ob(a.db),b.Ob(l.k),b.Ob(a.cb))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-settings"]],viewQuery:function(e,t){if(1&e&&b.Uc(Jr,1),2&e){let e;b.zc(e=b.cc())&&(t.sshSettingSecretPicker=e.first)}},inputs:{secretState:"secretState"},features:[b.Ab],decls:7,vars:7,consts:[[2,"min-height","100%"],[3,"active","isFullscreen"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["editSection","personalize","labelColumnWidth","large","editSectionId","edit-email",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],[3,"thyFormLayoutRowDefinition","showActions"],["formControlName","sendEmailWhenViewed","editSection","personalize"],["formControlName","sendEmailWhenChanged","editSection","personalize"],["formControlName","sendEmailWhenHeartbeatFails","editSection","personalize"],["editSection","personalize",3,"save","cancel"],["editSection","rdp","labelColumnWidth","large","editSectionId","edit-rdp",3,"summaryTitle","summaryDescription","showBorder","editForm"],["formControlName","connectToConsole","editSection","rdp"],["formControlName","allowPrinters","editSection","rdp"],["formControlName","allowDrives","editSection","rdp"],["formControlName","allowClipboard","editSection","rdp"],["formControlName","allowSmartCards","editSection","rdp"],["formControlName","useCustomLauncherResolution","editSection","rdp"],[3,"thyFormLayoutRowDefinition","showActions",4,"ngIf"],["editSection","rdp",3,"save","cancel"],["formControlName","launcherHeight","editSection","rdp",3,"maxNumberValue","minNumberValue"],["formControlName","launcherWidth","editSection","rdp",3,"maxNumberValue","minNumberValue"],["editSection","sshLauncher","labelColumnWidth","medium-large","editSectionId","edit-ssh",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],[3,"labelText","thyFormLayoutRowDefinition","showActions"],["formControlName","runLauncherType","editSection","sshLauncher",3,"options"],[3,"labelText","thyFormLayoutRowDefinition","showActions",4,"ngIf"],["editSection","sshLauncher",3,"save","cancel"],["value-column",""],["formControlName","secretId","editSection","sshLauncher",3,"type","initialSecretName","forceEditMode","showShowRecommended","extendedTypeIdFilter"],["sshSettingSecretPicker",""],["editSection","expiration","labelColumnWidth","medium-large","editSectionId","edit-expiration",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],[3,"thyFormLayoutRowDefinition"],["formControlName","expirationType","editSection","expiration",3,"options"],["editSection","expiration",3,"save","cancel"],[1,"flex","middle-aligned","nicely-spaced"],["formControlName","expirationDayInterval","editSection","expiration",3,"minNumberValue","maxNumberValue","maxlength"],["ss-locale","days","ss-page-name","common"],["formControlName","expirationDate","editSection","expiration",3,"minDate","timezone","offset","offsetDescription"],["editSection","totp","labelColumnWidth","medium-large","editSectionId","edit-totp",3,"summaryTitle","summaryDescription","showBorder","disableEdit","editForm"],["formControlName","enabled","editSection","totp"],["editSection","totp",3,"save","cancel"],["formControlName","key","editSection","totp",3,"viewField","type","showModifyShowLink","passwordPopupText","maxlength","alwaysHidePasswordGenerate","forceEditMode","breakWord","showPasswordClick","modifyPasswordClick"],["formControlName","backupCodes","editSection","totp",3,"type","viewField","passwordPopupText","maxlength","alwaysHidePasswordGenerate","forceEditMode","breakWord","showPasswordClick","modifyPasswordClick"]],template:function(e,t){1&e&&(b.Ub(0,"div",0),b.Pb(1,"thy-loading-dimmer",1),b.Mc(2,Xr,13,19,"form",2),b.Mc(3,sc,21,26,"form",2),b.Mc(4,oc,12,22,"form",2),b.Mc(5,ac,12,18,"form",2),b.Mc(6,hc,13,22,"form",2),b.Tb()),2&e&&(b.Cb(1),b.nc("active",t.isLoading)("isFullscreen",!0),b.Cb(1),b.nc("ngIf",t.secretDetailSettings),b.Cb(1),b.nc("ngIf",!t.isLoading&&t.secretDetailSettings&&t.secretDetailSettings.rdpLauncherSettings&&!t.secretDetailSettings.rdpLauncherSettings.hidden),b.Cb(1),b.nc("ngIf",!t.isLoading&&t.secretDetailSettings&&!(null!=t.secretDetailSettings.sshLauncherSettings&&t.secretDetailSettings.sshLauncherSettings.hidden)),b.Cb(1),b.nc("ngIf",!t.isLoading&&t.secretDetailSettings.expirationType&&!t.secretDetailSettings.expirationType.hidden),b.Cb(1),b.nc("ngIf",!t.isLoading&&t.secretDetailSettings.oneTimePasswordSettings.value.enabledOnTemplate))},directives:[m.h,i.o,o.E,o.t,o.l,l.e,l.f,l.b,o.s,o.j,l.d,l.g,l.h,j.a,o.o,f.a,l.c],pipes:[i.b,bt.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();var pc=s("cwej");let bc=(()=>{let e=class{constructor(){this.secretId=null}};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-metadata"]],inputs:{secretId:"secretId"},decls:1,vars:1,consts:[["metadataTypeName","Secret",3,"itemId"]],template:function(e,t){1&e&&b.Pb(0,"ss-metadata-viewer",0),2&e&&b.nc("itemId",t.secretId)},directives:[pc.a],styles:[""]}),e=Object(P.b)([Object(M.a)()],e),e})();const mc=["favoriteTemplate"],gc=["deleteSecretModal"],fc=["undeleteSecretModal"],vc=["sshProxyModal"],yc=["sshTerminalModal"],Sc=["pageDetail"];function wc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",48),b.bc("click",function(){return b.Ec(e),b.fc().checkInSecret()}),b.Ub(1,"div"),b.Pb(2,"mat-icon",49),b.Tb(),b.Ub(3,"div",50),b.Oc(4,"Check In"),b.Tb(),b.Tb()}}function Cc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",51),b.bc("click",function(){return b.Ec(e),b.fc().heartbeat()}),b.Ub(1,"div"),b.Pb(2,"mat-icon",52),b.Tb(),b.Ub(3,"div",53),b.Oc(4,"Heartbeat"),b.Tb(),b.Tb()}if(2&e){const e=b.fc();b.Gb("disabled",e.isHeartbeating)}}function Tc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",54),b.bc("click",function(){return b.Ec(e),b.fc().changePassword()}),b.Ub(1,"div"),b.Pb(2,"mat-icon",55),b.Tb(),b.Ub(3,"div",56),b.Oc(4,"Change Password Now"),b.Tb(),b.Tb()}}function Oc(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",57),b.bc("click",function(){return b.Ec(e),b.fc().stopChangePassword()}),b.Ub(1,"div"),b.Pb(2,"mat-icon",58),b.Tb(),b.Ub(3,"div",59),b.Oc(4,"Stop Password Change"),b.Tb(),b.Tb()}}function Ic(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",60),b.bc("click",function(){b.Ec(e);const t=b.fc();return t.openLauncher(t.launchers[0])}),b.Ub(1,"div"),b.Pb(2,"mat-icon",61),b.Tb(),b.Ub(3,"div",62),b.Oc(4,"Launch"),b.Tb(),b.Tb()}}function _c(e,t){if(1&e&&(b.Pb(0,"thy-context-button",63),b.gc(1,"async"),b.gc(2,"ssLocale")),2&e){const e=b.fc();b.nc("menuItems",e.launcherOptions)("isBasicButton",!0)("displayTextButton",b.hc(1,3,b.ic(2,5,"launchers","common")))}}function Pc(e,t){if(1&e&&b.Pb(0,"ss-secret-general",65),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)("canEdit",e.canEdit)}}const Mc=function(e){return["/secret",e,"general"]};function kc(e,t){if(1&e&&(b.Ub(0,"thy-tab",64),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Pc,1,2,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"general","secretdetail")))("tabRouterLink",b.sc(7,Mc,e.secretId.toString()))}}function xc(e,t){if(1&e&&b.Pb(0,"ss-secret-security",67),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)}}const Dc=function(e){return["/secret",e,"security"]};function Fc(e,t){if(1&e&&(b.Ub(0,"thy-tab",66),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,xc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"security","secretdetail")))("tabRouterLink",b.sc(7,Dc,e.secretId.toString()))}}function Uc(e,t){if(1&e&&b.Pb(0,"ss-secret-audit",65),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)("canEdit",e.canEdit)}}const Ac=function(e){return["/secret",e,"audit"]};function Ec(e,t){if(1&e&&(b.Ub(0,"thy-tab",68),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Uc,1,2,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"audit","secretdetail")))("tabRouterLink",b.sc(7,Ac,e.secretId.toString()))}}function Rc(e,t){if(1&e&&b.Pb(0,"ss-secret-rpc",67),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)}}const Nc=function(e){return["/secret",e,"rpc"]};function Lc(e,t){if(1&e&&(b.Ub(0,"thy-tab",69),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Rc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"rpc","secretdetail")))("tabRouterLink",b.sc(7,Nc,e.secretId.toString()))}}function Vc(e,t){if(1&e&&b.Pb(0,"ss-secret-dependencies",67),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)}}const qc=function(e){return["/secret",e,"depend"]};function Gc(e,t){if(1&e&&(b.Ub(0,"thy-tab",70),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Vc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"dependencies","secretdetail")))("tabRouterLink",b.sc(7,qc,e.secretId.toString()))}}function zc(e,t){if(1&e&&b.Pb(0,"ss-secret-hooks",67),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)}}const Bc=function(e){return["/secret",e,"hooks"]};function jc(e,t){if(1&e&&(b.Ub(0,"thy-tab",71),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,zc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"hooks","secretdetail")))("tabRouterLink",b.sc(7,Bc,e.secretId.toString()))}}function Wc(e,t){if(1&e&&b.Pb(0,"ss-secret-share",67),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)}}const Hc=function(e){return["/secret",e,"sharing"]};function Kc(e,t){if(1&e&&(b.Ub(0,"thy-tab",72),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Wc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"sharing","secretdetail")))("tabRouterLink",b.sc(7,Hc,e.secretId.toString()))}}function Qc(e,t){if(1&e&&b.Pb(0,"ss-secret-settings",67),2&e){const e=b.fc(2);b.nc("secretState",e.secretState)}}const $c=function(e){return["/secret",e,"settings"]};function Zc(e,t){if(1&e&&(b.Ub(0,"thy-tab",73),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Qc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"settings","secretdetail")))("tabRouterLink",b.sc(7,$c,e.secretId.toString()))}}function Yc(e,t){if(1&e&&b.Pb(0,"ss-secret-metadata",75),2&e){const e=b.fc(2);b.nc("secretId",e.secretId)}}const Jc=function(e){return["/secret",e,"metadata"]};function Xc(e,t){if(1&e&&(b.Ub(0,"thy-tab",74),b.gc(1,"async"),b.gc(2,"ssLocale"),b.Mc(3,Yc,1,1,"ng-template"),b.Tb()),2&e){const e=b.fc();b.nc("displayText",b.hc(1,2,b.ic(2,4,"metadata","common")))("tabRouterLink",b.sc(7,Jc,e.secretId.toString()))}}function ea(e,t){if(1&e&&(b.Ub(0,"div",76),b.Ub(1,"label",77),b.Oc(2,"Laucher Name"),b.Tb(),b.Pb(3,"ss-form-input",78),b.Tb()),2&e){const e=b.fc();b.Cb(3),b.nc("type",e.formInputType.DropDown)("options",e.sshProxyLauncherOptions)}}function ta(e,t){if(1&e&&b.Pb(0,"ss-form-input",84),2&e){const e=b.fc(2);b.nc("type",e.formInputType.String)("maxlength",255)}}function sa(e,t){if(1&e&&b.Pb(0,"ss-form-input",85),2&e){const e=b.fc(2);b.nc("type",e.formInputType.DropDown)("options",e.sshProxyLauncherWhitelist)}}function ia(e,t){1&e&&(b.Ub(0,"label",86),b.Oc(1,"Site"),b.Tb())}function oa(e,t){if(1&e&&b.Pb(0,"ss-form-input",87),2&e){const e=b.fc(2);b.nc("type",e.formInputType.DropDown)("options",e.proxySiteSelection)}}function na(e,t){if(1&e&&(b.Ub(0,"div",76),b.Ub(1,"label",79),b.Oc(2,"Machine Name"),b.Tb(),b.Mc(3,ta,1,2,"ss-form-input",80),b.Mc(4,sa,1,2,"ss-form-input",81),b.Mc(5,ia,2,0,"label",82),b.Mc(6,oa,1,2,"ss-form-input",83),b.Tb()),2&e){const e=b.fc();b.Cb(3),b.nc("ngIf",e.sshProxyModalDisplayMode===e.sshProxyRestrictedHostType.NoRestrict||e.sshProxyModalDisplayMode===e.sshProxyRestrictedHostType.BlackList),b.Cb(1),b.nc("ngIf",e.sshProxyModalDisplayMode===e.sshProxyRestrictedHostType.Whitelist),b.Cb(1),b.nc("ngIf",e.proxySiteSelection.length>0),b.Cb(1),b.nc("ngIf",e.proxySiteSelection.length>0)}}function ra(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.sshCreds.host,"Host")}),b.Tb()}}function ca(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.sshCreds.port.toString(),"Port")}),b.Tb()}}function aa(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.sshCreds.username,"Username")}),b.Tb()}}function la(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.sshCreds.password,"Password")}),b.Tb()}}function da(e,t){if(1&e&&(b.Ub(0,"div",88),b.Ub(1,"div",89),b.Mc(2,ra,1,0,"svg-icon",90),b.Ub(3,"label",91),b.Oc(4,"Host"),b.Tb(),b.Oc(5),b.Tb(),b.Ub(6,"div",89),b.Mc(7,ca,1,0,"svg-icon",90),b.Ub(8,"label",92),b.Oc(9,"Port"),b.Tb(),b.Oc(10),b.Tb(),b.Ub(11,"div",89),b.Mc(12,aa,1,0,"svg-icon",90),b.Ub(13,"label",93),b.Oc(14,"Username"),b.Tb(),b.Oc(15),b.Tb(),b.Ub(16,"div",89),b.Mc(17,la,1,0,"svg-icon",90),b.Ub(18,"label",94),b.Oc(19,"Password"),b.Tb(),b.Oc(20),b.Tb(),b.Tb()),2&e){const e=b.fc();b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.sshCreds.host," "),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.sshCreds.port," "),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.sshCreds.username," "),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.sshCreds.password," ")}}function ha(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.rdpCreds.host,"Host")}),b.Tb()}}function ua(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.rdpCreds.domain,"Domain")}),b.Tb()}}function pa(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.rdpCreds.username,"Username")}),b.Tb()}}function ba(e,t){if(1&e){const e=b.Vb();b.Ub(0,"svg-icon",95),b.bc("click",function(){b.Ec(e);const t=b.fc(2);return t.copyToClipboard(t.rdpCreds.password,"Password")}),b.Tb()}}function ma(e,t){if(1&e&&(b.Ub(0,"div",88),b.Ub(1,"div",89),b.Mc(2,ha,1,0,"svg-icon",90),b.Ub(3,"label",91),b.Oc(4,"Host"),b.Tb(),b.Oc(5),b.Tb(),b.Ub(6,"div",89),b.Mc(7,ua,1,0,"svg-icon",90),b.Ub(8,"label",96),b.Oc(9,"Domain"),b.Tb(),b.Oc(10),b.Tb(),b.Ub(11,"div",89),b.Mc(12,pa,1,0,"svg-icon",90),b.Ub(13,"label",93),b.Oc(14,"Username"),b.Tb(),b.Oc(15),b.Tb(),b.Ub(16,"div",89),b.Mc(17,ba,1,0,"svg-icon",90),b.Ub(18,"label",94),b.Oc(19,"Password"),b.Tb(),b.Oc(20),b.Tb(),b.Tb()),2&e){const e=b.fc();b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.rdpCreds.host," "),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.rdpCreds.domain," "),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.rdpCreds.username," "),b.Cb(2),b.nc("ngIf",!e.ies.isEditMode(null)),b.Cb(3),b.Qc(" ",e.rdpCreds.password," ")}}function ga(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",97),b.bc("click",function(){return b.Ec(e),b.fc().cancelSshProxyCred()}),b.Oc(1),b.gc(2,"async"),b.gc(3,"ssLocale"),b.Tb()}2&e&&(b.Cb(1),b.Qc(" ",b.hc(2,1,b.ic(3,3,"cancel","common"))," "))}function fa(e,t){if(1&e){const e=b.Vb();b.ec(),b.Ub(0,"svg",100),b.bc("click",function(){return b.Ec(e),b.fc(2).toggleFavorite()}),b.Pb(1,"path",101),b.Pb(2,"path",102),b.Tb()}}function va(e,t){if(1&e){const e=b.Vb();b.ec(),b.Ub(0,"svg",103),b.bc("click",function(){return b.Ec(e),b.fc(2).toggleFavorite()}),b.Pb(1,"path",104),b.Pb(2,"path",105),b.Tb()}}function ya(e,t){if(1&e&&(b.Mc(0,fa,3,0,"svg",98),b.Mc(1,va,3,0,"svg",99)),2&e){const e=b.fc();b.nc("ngIf",!e.isFavorite),b.Cb(1),b.nc("ngIf",e.isFavorite)}}let Sa=(()=>{let e=class extends Xe{constructor(e,t,s,i,n,r,c,a,l,d,h,u,b,m,g,f,v,y,S){super(e,t,s,n,r,c,f,v),this._dialogService=a,this._launcherService=l,this._log=d,this._toastService=h,this._localizationService=u,this._errorService=b,this._clipboardService=m,this._heartbeatService=g,this.formsService=y,this._notificationService=S,this.selectedPage=null,this.isFavorite=!1,this.showDeleteSecret=!1,this.showUndeleteSecret=!1,this.launchers=null,this.isMoreOpen=!1,this.isLaunchersOpen=!1,this.state=null,this.isHeartbeating=!1,this.maxWidth=1200,this.showOptionsMenu=!1,this.showOptionsMenuMinWidth=1500,this.formInputType=A.a,this.launcherCount=0,this.menuButtonText="more",this.menuOptions=[],this.launcherMenuOptions=[],this.options=[{id:"option-menu-copy",displayText:"duplicate",menuClicked:new ye.a},{id:"option-menu-show-ssh-proxy",displayText:"show-proxy-credentials",menuClicked:new ye.a},{id:"option-menu-show-rdp-proxy",displayText:"show-proxy-credentials",menuClicked:new ye.a},{id:"option-menu-show-ssh",displayText:"show-ssh-terminal-details",menuClicked:new ye.a},{id:"option-menu-expire",displayText:"expire",menuClicked:new ye.a},{id:"option-menu-delete",displayText:"delete",menuClicked:new ye.a},{id:"option-menu-undelete",displayText:"undelete",menuClicked:new ye.a}],this.skinnyOptions=[{id:"option-menu-check-in",displayText:"check-in",menuClicked:new ye.a},{id:"option-menu-heartbeat",displayText:"heartbeat",menuClicked:new ye.a},{id:"option-menu-change-password-now",displayText:"change-password-now",menuClicked:new ye.a},{id:"option-menu-stop-password-change",displayText:"stop-password-change",menuClicked:new ye.a}],this.launcherOptions=[],this.canViewGeneral=!1,this.canViewSecurity=!1,this.canViewAudit=!1,this.canViewRpc=!1,this.canViewDependencies=!1,this.canViewHooks=!1,this.canViewShare=!1,this.canViewSettings=!1,this.canViewMetadata=!1,this.PageDialogLayout=p.b,this.sshProxyCredForm=new o.k({machine:new o.h(""),proxyLauncher:new o.h("",k.a.requiredNotEmpty),machineWhitelist:new o.h,site:new o.h}),this.sshProxyLauncherOptions=[],this.sshProxyLauncherWhitelist=[],this.sshProxyModalDisplayMode=et.NoRestrict,this.proxySiteSelection=[],this.sshProxyModalRequireMachine=!1,this.sshProxyModalShowCredentials=!1,this.sshProxyOneLauncher=!1,this.sshProxyRestrictedHostType=et,this._deletedBannerText="This Secret is currently marked as Deleted. Certain actions such as password changing will be unavailable until the secret is undeleted.",this.ies=n,this.secretPageContext=0,this._dashboardService=i,this.state=c,t.params.pipe(Object(M.b)(this)).subscribe(e=>{const t=+e.id;t&&(c.activeSecretId=t,this.secretId=t,this._notificationService.dismissBannerNotifications("tab"),this.loadSecret())}),e.events.pipe(Object(M.b)(this)).subscribe(t=>{let s=e.url.toLowerCase();s.indexOf("?")>=0&&(s.split("?"),s=s.split("?")[0]),this.selectedPage=null,this.maxWidth=1200,s.indexOf("/depend")>=0?this.maxWidth=1600:s.indexOf("/audit")>=0&&(this.maxWidth=null)})}ngOnInit(){this.options.forEach(e=>{e.displayText=this._localizationService.getCachedMessage(e.displayText)}),this.skinnyOptions.forEach(e=>{e.displayText=this._localizationService.getCachedMessage(e.displayText)}),this._getSkinnyOption("option-menu-check-in").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.checkInSecret()),this._getSkinnyOption("option-menu-heartbeat").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.heartbeat()),this._getSkinnyOption("option-menu-change-password-now").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.changePassword()),this._getSkinnyOption("option-menu-stop-password-change").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.stopChangePassword()),this._getOption("option-menu-copy").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.copySecret()),this._getOption("option-menu-expire").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.expire()),this._getOption("option-menu-delete").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.showDelete()),this._getOption("option-menu-undelete").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.showUndelete()),this._getOption("option-menu-show-ssh-proxy").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.showProxyCredentials("SSH")),this._getOption("option-menu-show-rdp-proxy").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.showProxyCredentials("RDP")),this._getOption("option-menu-show-ssh").menuClicked.pipe(Object(M.b)(this)).subscribe(()=>this.showSshTerminalDetails()),this.state.events.navigationEvents.tabBarEvent.pipe(Object(M.b)(this)).subscribe(e=>{this.reloadSecretState()}),this._dashboardService.isFavoriteSecret(this.secretId).pipe(Object(h.a)()).subscribe(e=>{this.isFavorite=e}),this.state.events.secretUndeleted.pipe(Object(M.b)(this)).subscribe(e=>{this.refreshState()}),this.state.events.secretUpdated.pipe(Object(M.b)(this)).subscribe(()=>this.refreshState()),super.ngOnInit(),this._stateService.events.secretEvents.passwordChange.pipe(Object(M.b)(this)).subscribe(e=>{e.passwordState===Ye.a.StartChange?this._setPasswordInProgressBanner():e.passwordState===Ye.a.ChangeCompleteSuccess||e.passwordState===Ye.a.StopChange?(this._notificationService.removeBannerNotification("tab","passwordprogress"),setTimeout(()=>{this.refreshState()},15e3)):e.passwordState===Ye.a.ChangeCompleteFail&&e.secretState.actions.find(e=>e===D.W.ChangePasswordNow)>-1&&(this.refreshState(),this._notificationService.removeBannerNotification("tab","passwordprogress")),e.passwordState!==Ye.a.ChangeCompleteSuccess&&e.passwordState!==Ye.a.StopChange||this._notificationService.removeBannerNotification("tab","passwordprogress"),this.secretState.actions=e.secretState.actions}),this.innerWidth=window.innerWidth,this.sshProxyCredForm.controls.proxyLauncher.valueChanges.pipe(Object(M.b)(this)).subscribe(e=>{e&&this._launcherService.getLauncherDetails(this.secretId,e).pipe(Object(h.a)()).subscribe(e=>{if(this.sshProxyModalDisplayMode=e.restrictHostType,this.sshProxyModalRequireMachine=e.action===D.B.Prompt,e.restrictHostType!==et.Whitelist||e.restrictedHosts&&0!==e.restrictedHosts.length||(this.sshProxyModalDisplayMode=et.NoRestrict),this.sshProxyModalDisplayMode===et.NoRestrict||this.sshProxyModalDisplayMode===et.BlackList?this.sshProxyCredForm.controls.machine.setValidators(k.a.requiredNotEmpty):this.sshProxyCredForm.controls.machine.clearValidators(),this.sshProxyModalDisplayMode===et.Whitelist){const t=[];e.restrictedHosts.forEach(e=>{t.push({text:e,value:e})}),this.sshProxyLauncherWhitelist=t.slice(),this.sshProxyCredForm.controls.machineWhitelist.setValidators(k.a.requiredNotEmpty)}else this.sshProxyCredForm.controls.machineWhitelist.clearValidators();if(e.siteSelection){this.proxySiteSelection=[];for(const t of e.siteSelection)this.proxySiteSelection.push({value:t.siteId.toString(),text:t.siteName});this.sshProxyCredForm.controls.site.setValue(e.defaultSiteId.toString())}this.sshProxyCredForm.updateValueAndValidity(),!this.sshProxyModalRequireMachine&&this.sshProxyOneLauncher?this.proxyLoadMethod():this.sshProxyOneLauncher&&this.sshProxyModal.show(),this.sshProxyCredForm.controls.machine.updateValueAndValidity(),this.sshProxyCredForm.updateValueAndValidity()})}),this._heartbeatService.heartbeatStatusUpdated.pipe(Object(M.b)(this)).pipe(Object(Je.a)(e=>e.secretId===this.secretId)).subscribe(e=>{this._heartbeatSetStatus(e.heartbeatStatus)}),this._heartbeatService.isPolling(this.secretId)&&this._heartbeatSetStatus()}ngAfterViewInit(){setTimeout(()=>{var e;return null===(e=this.tabGroup)||void 0===e?void 0:e.checkOptionsDisplay()},500),this._setCrumbs()}_heartbeatSetStatus(e=null){let t=e;if(null===t&&(t=this._heartbeatService.getLastHeartbeatStatus(this.secretState.id)),t===D.A.Pending){const e=this._localizationService.getCachedPageMessage("secretactions","heartbeat-pending").replace("{0}",this.secretState.secretName);return this._notificationService.addBannerNotification("tab",{message:e,key:"heartbeat-status"}),void(this.isHeartbeating=!0)}switch(this.isHeartbeating=!1,t){case D.A.ClientPollingTimeout:this._notificationService.addBannerNotification("tab",{message:this._localizationService.getCachedPageMessage("secretdetail","heartbeat-status-timedout"),key:"heartbeat-status"});break;case D.A.Success:this._notificationService.removeBannerNotification("tab","heartbeat-status");break;default:const e=this._localizationService.replaceVariables(this._localizationService.getCachedPageMessage("secretdetail","last-heartbeat-failed-message"),[t]);this._notificationService.addBannerNotification("tab",{message:e,key:"heartbeat-status"})}}ngOnDestroy(){super.ngOnDestroy(),this._heartbeatService.stopPolling(this.secretState.id,!1)}secretStateLoaded(){var e;this._setCrumbs(),!0===this.secretState.passwordChangePending||this._secretService.hasAction(D.W.StopChangePasswordNow,this.secretState)?this._setPasswordInProgressBanner():this._notificationService.removeBannerNotification("tab","passwordprogress"),!1===this.secretState.isActive?this._notificationService.addBannerNotification("tab",{message:this._deletedBannerText,key:"deleted"}):this._notificationService.removeBannerNotification("tab","deleted"),this._loadLaunchers(),this.canViewGeneral=this.hasAction(D.W.ViewGeneralDetails),this.canViewSecurity=this.hasAction(D.W.ViewSecurity),this.canViewAudit=this.hasAction(D.W.ViewAudit),this.canViewRpc=this.hasAction(D.W.ViewRpc),this.canViewDependencies=this.hasAction(D.W.ViewDependencies),this.canViewHooks=this.hasAction(D.W.ViewHooks),this.canViewShare=this.hasAction(D.W.ViewShare),this.canViewSettings=this.hasAction(D.W.ViewSettings),this.canViewMetadata=this.hasAction(D.W.ViewMetadata),this.setOptionsMenu(),null===(e=this.tabGroup)||void 0===e||e.checkOptionsDisplay()}_setPasswordInProgressBanner(){this.secretState.isActive&&this._localizationService.getMessage("password-in-progress").pipe(Object(h.a)()).subscribe(e=>{this._notificationService.addBannerNotification("tab",{message:e,key:"passwordprogress"})})}tabSelected(){this._notificationService.removeBannerNotification("tab","nosharemodify")}getLauncherCount(){return this.launchers&&this.launchers.length}openLauncher(e){this._launcherService.launchSecret(this.secretId,e.typeId,null)}checkInSecret(){this._secretService.checkInSecret(this.secretState.id,!1).pipe(Object(h.a)()).subscribe({next:e=>{this._router.navigate(this.secretState.folderId>0?["/folders",this.secretState.folderId]:["/secrets/all"])},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_CheckoutNotEnabled"===t.errorCode)this._log.Information("Secret ${this.secretId} no longer has checkout enabled"),this.refreshState();else{if(!t.errorCode)throw e;this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedMessage("checkin-failed"),body:t.message,showOkButton:!1}})}}})}toggleFavorite(){this.isFavorite=!this.isFavorite,this._dashboardService.setFavoriteSecret(this.secretId,this.isFavorite).pipe(Object(h.a)()).subscribe()}copySecret(){this._dialogService.open(T.a,{autoFocus:!1,width:F.c.Large,data:{copySecretId:this.secretId,folderId:this.secretState.folderId}})}showDelete(){this.deleteSecretModal.show()}showUndelete(){this.undeleteSecretModal.show()}changePassword(){this._stateService.selectedSecretIds=[],this._stateService.bulk.secretId=this.secretId,this._stateService.bulk.secretName=this.secretState.secretName,this._router.navigate([{outlets:{modal:["modals","bulk","change-password"]}}])}stopChangePassword(){this._stateService.selectedSecretIds=[],this._stateService.bulk.secretId=this.secretId,this._stateService.bulk.secretName=this.secretState.secretName,this._stateService.selectedSecretIds=[],this._router.navigate([{outlets:{modal:["modals","bulk","change-password"]}}])}secretDeleteConfirm(){this._secretService.delete(this.secretId).pipe(Object(h.a)()).subscribe({next:e=>{this.deleteSecretModal.close(),this._router.navigate(this.secretState.folderId&&this.secretState.folderId>-1?["/folders",this.secretState.folderId]:["/secrets/all"])}}),this.showDeleteSecret=!1}secretUndeleteConfirm(){this._secretService.undelete(this.secretId).pipe(Object(h.a)()).subscribe({next:e=>{this.undeleteSecretModal.close(),this.state.events.secretUndeleted.next(this.secretState.id),this._notificationService.removeBannerNotification("tab","deleted"),this.secretState.isActive=!0,this.secretState.passwordChangePending&&this._setPasswordInProgressBanner()},error:e=>{"API_DuplicateSecretName"===this._errorService.getErrorMessage(e).errorCode&&(this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedMessage("duplicate-undelete-title"),body:this._localizationService.getCachedMessage("duplicate-undelete-text"),showOkButton:!1}}),this.undeleteSecretModal.close()),this._log.Error("Secret undelete failed",null,e)}}),this.showUndeleteSecret=!1}expire(){this._secretService.expire(this.secretId).pipe(Object(h.a)()).subscribe({next:e=>{this._log.Information(`Expire Secret ${this.secretId}`),this._stateService.events.secretEvents.expired.next(this.secretId),this._toastService.showMessage("Secret has been expired"),this.refreshState()},error:e=>{this._log.Error(`Expire Secret ${this.secretId} Error`,null,e)}})}heartbeat(){this.isHeartbeating||(this.isHeartbeating=!0,this._heartbeatService.runHeartbeat(this.secretState.id,this.secretState.secretName).pipe(Object(h.a)()).subscribe(e=>{this._heartbeatSetStatus(e.status)}))}setOptionsMenu(){this._getOption("option-menu-copy").hide=!this.hasAction(this.secretDetailActionType.Copy),this._getOption("option-menu-expire").hide=!this.hasAction(this.secretDetailActionType.Expire),this._getOption("option-menu-delete").hide=!this.hasAction(this.secretDetailActionType.Delete),this._getOption("option-menu-undelete").hide=!this.hasAction(this.secretDetailActionType.Undelete),this._getOption("option-menu-show-ssh-proxy").hide=!this.hasAction(this.secretDetailActionType.ShowSshProxyCredentials),this._getOption("option-menu-show-rdp-proxy").hide=!this.hasAction(this.secretDetailActionType.ShowRdpProxyCredentials),this._getOption("option-menu-show-ssh").hide=!this.hasAction(this.secretDetailActionType.ShowSshTerminalDetails);const e=!this.options.every(e=>e.hide);if(this.innerWidth<this.showOptionsMenuMinWidth){this._getSkinnyOption("option-menu-check-in").hide=!(this.secretState.isCheckedOut&&this.secretState.isCheckedOutByCurrentUser),this._getSkinnyOption("option-menu-heartbeat").hide=!this.hasAction(this.secretDetailActionType.Heartbeat),this._getSkinnyOption("option-menu-change-password-now").hide=!this.hasAction(this.secretDetailActionType.ChangePasswordNow),this._getSkinnyOption("option-menu-stop-password-change").hide=!this.hasAction(this.secretDetailActionType.StopChangePasswordNow);const t=this.launcherOptions.length>0,s=!this.skinnyOptions.every(e=>e.hide);return this.menuOptions=this.options.concat(this.skinnyOptions).concat(this.launcherOptions),this.menuButtonText="options",void(this.showOptionsMenu=s||e||t)}this.menuOptions=this.options,setTimeout(()=>{var e;return null===(e=this.tabGroup)||void 0===e?void 0:e.checkOptionsDisplay()},50),this.showOptionsMenu=e}_getOption(e){return this.options.filter(t=>t.id===e)[0]}_getSkinnyOption(e){return this.skinnyOptions.filter(t=>t.id===e)[0]}_loadLaunchers(){this.hasAction(D.W.ViewGeneralDetails)&&this._secretService.getSecretLaunchers(this.secretId).pipe(Object(h.a)()).subscribe({next:e=>{this.launchers=e,this.launcherOptions=[],this.launcherCount=this.launchers.length;const t=[];e.forEach(e=>{t.push({value:e.typeId.toString(),text:e.name});const s={id:"option-menu-launch",displayText:e.name,menuClicked:new ye.a,context:e};s.menuClicked.pipe(Object(M.b)(this)).subscribe(e=>this.openLauncher(e.context)),this.launcherOptions.push(s)}),this.sshProxyLauncherOptions=t,this.setOptionsMenu()},error:e=>{const t=this._errorService.getErrorMessage(e);if("API_SecretRequiresCheckout"!==t.errorCode&&"API_SecretAccessApprovalDenied"!==t.errorCode&&"API_ValidateSecretAccessCommentRequired"!==t.errorCode)throw e}})}showProxyCredentials(e){"SSH"===e?this.proxyLoadMethod=this.loadSshProxy:"RDP"===e&&(this.proxyLoadMethod=this.loadRdpProxy),this.sshProxyCredForm.controls.machine.clearValidators(),this.sshProxyModalShowCredentials=!1,this.sshProxyModalRequireMachine=!1,this.sshCreds=null,this.rdpCreds=null,this.sshProxyOneLauncher=!1,this.sshProxyCredForm.updateValueAndValidity(),this.ies.enableEditMode("sshProxyCred",this.sshProxyCredForm),1===this.getLauncherCount()?(this.sshProxyOneLauncher=!0,this.sshProxyCredForm.controls.proxyLauncher.setValue(this.launchers[0].typeId.toString())):(this.sshProxyCredForm.controls.proxyLauncher.markAsPristine(),this.sshProxyCredForm.controls.proxyLauncher.updateValueAndValidity(),this.sshProxyModal.show())}showSshTerminalDetails(){this._secretService.getSshTerminalDetails(this.secretId).subscribe({next:e=>{this.sshTerminalInformation=e,this.sshTerminalModal.show()}})}closeSshTerminalDetails(){this.sshTerminalInformation=null,this.sshTerminalModal.close()}okSshProxyCred(){this.sshProxyModalShowCredentials?this.cancelSshProxyCred():this.proxyLoadMethod()}loadSshProxy(){let e=this.sshProxyCredForm.value.machine;this.sshProxyModalDisplayMode===et.Whitelist&&(e=this.sshProxyCredForm.value.machineWhitelist),this._secretService.getSshProxyCredentials(this.secretId,e,this.sshProxyCredForm.value.proxyLauncher).subscribe({next:e=>{this.sshProxyModalShowCredentials=!0,this.sshCreds=e,!this.sshProxyModalRequireMachine&&this.sshProxyOneLauncher&&this.sshProxyModal.show()},error:e=>this.handleProxyCredentialError(e)})}loadRdpProxy(){let e=this.sshProxyCredForm.value.machine;this.sshProxyModalDisplayMode===et.Whitelist&&(e=this.sshProxyCredForm.value.machineWhitelist),this._secretService.getRdpProxyCredentials(this.secretId,e,this.sshProxyCredForm.value.proxyLauncher,this.sshProxyCredForm.value.site).subscribe({next:e=>{this.sshProxyModalShowCredentials=!0,this.rdpCreds=e,!this.sshProxyModalRequireMachine&&this.sshProxyOneLauncher&&this.sshProxyModal.show()},error:e=>this.handleProxyCredentialError(e)})}handleProxyCredentialError(e){const t=this._errorService.getErrorMessage(e),s=t.errorCode;if("API_ProxyCredentialsUnavailable"!==s){if("API_MachineNotAllowedException"!==s&&"API_MachineRequiredException"!==s)throw e;this._localizationService.getMessage(s).pipe(Object(h.a)()).subscribe(e=>{this._dialogService.open(F.a,{width:F.c.Small,data:{title:"",body:e,showCancelButton:!1}})})}else this._dialogService.open(F.a,{width:F.c.Small,data:{title:this._localizationService.getCachedPageMessage("secretdetail","show-proxy-credentials"),body:t.message,showCancelButton:!1}})}cancelSshProxyCred(){this.sshProxyModal.close(),this.ies.disableEditMode("sshProxyCred",!0)}copyToClipboard(e,t){this._clipboardService.copyFieldToClipboard(t,e)}onResize(e){this.innerWidth=window.innerWidth,this.setOptionsMenu()}_setCrumbs(){this.favoriteTemplate&&this.secretState&&(this._folderService.getFolderBreadcrumbs(this.secretState.folderId,!1).pipe(Object(h.a)()).subscribe(e=>{e.push({displayText:this.secretState.secretName,browserTitle:this._localizationService.getCachedMessage("secret-details"),template:this.favoriteTemplate}),this._breadcrumbService.setCrumbs(e)}),this._stateService.events.navigationEvents.secretOpened.next({secretId:this.secretState.id,secretName:this.secretState.secretName,folderId:this.secretState.folderId,context:this.secretPageContext}))}};return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(c.a),b.Ob(a.V),b.Ob(a.i),b.Ob(a.B),b.Ob(a.W),b.Ob(a.cb),b.Ob(E.c),b.Ob(a.C),b.Ob(a.fb),b.Ob(a.hb),b.Ob(a.F),b.Ob(a.eb),b.Ob(a.e),b.Ob(a.z),b.Ob(a.w),b.Ob(m.a),b.Ob(l.k),b.Ob(m.i))},e.\u0275cmp=b.Ib({type:e,selectors:[["ss-secret-home"]],viewQuery:function(e,t){if(1&e&&(b.Uc(mc,1),b.Uc(gc,1),b.Uc(fc,1),b.Uc(vc,1),b.Uc(yc,1),b.Uc(Sc,1),b.Uc(m.o,1)),2&e){let e;b.zc(e=b.cc())&&(t.favoriteTemplate=e.first),b.zc(e=b.cc())&&(t.deleteSecretModal=e.first),b.zc(e=b.cc())&&(t.undeleteSecretModal=e.first),b.zc(e=b.cc())&&(t.sshProxyModal=e.first),b.zc(e=b.cc())&&(t.sshTerminalModal=e.first),b.zc(e=b.cc())&&(t.pageDetail=e.first),b.zc(e=b.cc())&&(t.tabGroup=e.first)}},hostBindings:function(e,t){1&e&&b.bc("resize",function(e){return t.onResize(e)},!1,b.Dc)},features:[b.Bb([],[a.B,a.ib,l.k]),b.zb],decls:97,vars:53,consts:[["layout","tabs"],[3,"tabSelected"],["actionsGroup",""],["tab-actions",""],["id","option-check-in","class","wide thy basic button flex middle-aligned",3,"click",4,"ngIf"],["id","option-heartbeat","class","wide thy basic button flex middle-aligned",3,"disabled","click",4,"ngIf"],["id","option-change-password-now","class","wide thy basic button flex middle-aligned",3,"click",4,"ngIf"],["id","option-stop-password-change","class","wide thy basic button flex middle-aligned nicely-spaced",3,"click",4,"ngIf"],["id","option-launch","class","wide thy basic button flex middle-aligned",3,"click",4,"ngIf"],[3,"menuItems","isBasicButton","displayTextButton",4,"ngIf"],["menuId","more-options",3,"menuItems","isBasicButton","displayTextButton"],["tabId","secret-general",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-security",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-audit",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-rpc",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-depend",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-hooks",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-sharing",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-settings",3,"displayText","tabRouterLink",4,"ngIf"],["tabId","secret-metadata",3,"displayText","tabRouterLink",4,"ngIf"],["modalTitleLocale","confirm-delete-secret","modalTitle","Confirm Delete Secret","size","small"],["deleteSecretModal",""],["modal-body",""],["ss-locale","confirm-delete-message"],["modal-footer",""],["id","modal-delete-cancel","ss-locale","cancel",1,"thy","basic","button",3,"click"],["id","modal-delete-confirm","ss-locale","confirm-delete",1,"thy","primary","button",3,"click"],["modalTitle","Confirm Undelete Secret","size","small"],["undeleteSecretModal",""],["ss-locale","confirm-undelete"],["id","modal-undelete-cancel","ss-locale","cancel",1,"thy","basic","button",3,"click"],["id","modal-undelete-cancel","ss-locale","confirm-undelete",1,"thy","primary","button",3,"click"],["modalTitleLocale","ssh-credentials-modal-title","size","small"],["sshProxyModal",""],["id","modal-ssh-credentials-body","modal-body",""],[1,"ui","form","ssh-proxy-modal-body",3,"formGroup"],["class","field",4,"ngIf"],["class","sshProxyFields",4,"ngIf"],["id","modal-ssh-proxy-cancel","class","thy basic button",3,"click",4,"ngIf"],[2,"display","inline-block",3,"matTooltip"],["id","modal-ssh-proxy-ok",1,"thy","primary","button","no-right-margin",3,"disabled","click"],["modalTitleLocale","ssh-term-details-modal-title","size","small"],["sshTerminalModal",""],["id","modal-ssh-terminal-body","modal-body",""],[1,"ui","form","ssh-terminal-modal-body"],["target","_blank","ssKbLink","SshTerminalAdminGuide"],["id","modal-ssh-terminal-close",1,"thy","primary","button",3,"click"],["favoriteTemplate",""],["id","option-check-in",1,"wide","thy","basic","button","flex","middle-aligned",3,"click"],["svgIcon","input",1,"icon-16"],["ss-locale","check-in"],["id","option-heartbeat",1,"wide","thy","basic","button","flex","middle-aligned",3,"click"],["svgIcon","heartbeat",1,"icon-16"],["ss-locale","heartbeat"],["id","option-change-password-now",1,"wide","thy","basic","button","flex","middle-aligned",3,"click"],["svgIcon","sync",1,"icon-16"],["ss-locale","change-password-now"],["id","option-stop-password-change",1,"wide","thy","basic","button","flex","middle-aligned","nicely-spaced",3,"click"],["svgIcon","stop_circle_outline",1,"icon-16"],["ss-locale","stop-password-change"],["id","option-launch",1,"wide","thy","basic","button","flex","middle-aligned",3,"click"],["svgIcon","remote",1,"icon-16"],["ss-locale","launch"],[3,"menuItems","isBasicButton","displayTextButton"],["tabId","secret-general",3,"displayText","tabRouterLink"],[3,"secretState","canEdit"],["tabId","secret-security",3,"displayText","tabRouterLink"],[3,"secretState"],["tabId","secret-audit",3,"displayText","tabRouterLink"],["tabId","secret-rpc",3,"displayText","tabRouterLink"],["tabId","secret-depend",3,"displayText","tabRouterLink"],["tabId","secret-hooks",3,"displayText","tabRouterLink"],["tabId","secret-sharing",3,"displayText","tabRouterLink"],["tabId","secret-settings",3,"displayText","tabRouterLink"],["tabId","secret-metadata",3,"displayText","tabRouterLink"],[3,"secretId"],[1,"field"],["ss-locale","launcher"],["formControlName","proxyLauncher","editSection","sshProxyCred",3,"type","options"],["ss-locale","machine"],["formControlName","machine","editSection","sshProxyCred",3,"type","maxlength",4,"ngIf"],["formControlName","machineWhitelist","editSection","sshProxyCred",3,"type","options",4,"ngIf"],["style","padding-top: 20px","ss-locale","proxySite","ss-page-name","dashboard",4,"ngIf"],["formControlName","site","editSection","sshProxyCred",3,"type","options",4,"ngIf"],["formControlName","machine","editSection","sshProxyCred",3,"type","maxlength"],["formControlName","machineWhitelist","editSection","sshProxyCred",3,"type","options"],["ss-locale","proxySite","ss-page-name","dashboard",2,"padding-top","20px"],["formControlName","site","editSection","sshProxyCred",3,"type","options"],[1,"sshProxyFields"],[1,"field","inline"],["name","content_copy","class","svg-icon icon-18 pointer right floated",3,"click",4,"ngIf"],["ss-locale","host"],["ss-locale","port"],["ss-locale","username"],["ss-locale","password"],["name","content_copy",1,"svg-icon","icon-18","pointer","right","floated",3,"click"],["ss-locale","domain"],["id","modal-ssh-proxy-cancel",1,"thy","basic","button",3,"click"],["id","toggle-favorite-secret","class","not-favorite","xmlns","http://www.w3.org/2000/svg","height","18","viewBox","0 0 24 24","width","18",3,"click",4,"ngIf"],["id","toggle-favorite-secret","class","favorite","xmlns","http://www.w3.org/2000/svg","height","18","viewBox","0 0 24 24","width","18",3,"click",4,"ngIf"],["id","toggle-favorite-secret","xmlns","http://www.w3.org/2000/svg","height","18","viewBox","0 0 24 24","width","18",1,"not-favorite",3,"click"],["d","M0 0h24v24H0V0z","fill","none"],["d","M12 7.13l.97 2.29.47 1.11 1.2.1 2.47.21-1.88 1.63-.91.79.27 1.18.56 2.41-2.12-1.28-1.03-.64-1.03.62-2.12 1.28.56-2.41.27-1.18-.91-.79-1.88-1.63 2.47-.21 1.2-.1.47-1.11.97-2.27M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"],["id","toggle-favorite-secret","xmlns","http://www.w3.org/2000/svg","height","18","viewBox","0 0 24 24","width","18",1,"favorite",3,"click"],["d","M0 0h24v24H0z","fill","none"],["d","M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"]],template:function(e,t){if(1&e){const e=b.Vb();b.Ub(0,"thy-page-detail",0),b.Ub(1,"thy-tab-group",1,2),b.bc("tabSelected",function(){return t.tabSelected()}),b.Sb(3,3),b.Mc(4,wc,5,0,"button",4),b.Mc(5,Cc,5,2,"button",5),b.Mc(6,Tc,5,0,"button",6),b.Mc(7,Oc,5,0,"button",7),b.Mc(8,Ic,5,0,"button",8),b.Mc(9,_c,3,8,"thy-context-button",9),b.Pb(10,"thy-context-button",10),b.gc(11,"async"),b.gc(12,"ssLocale"),b.Rb(),b.Mc(13,kc,4,9,"thy-tab",11),b.Mc(14,Fc,4,9,"thy-tab",12),b.Mc(15,Ec,4,9,"thy-tab",13),b.Mc(16,Lc,4,9,"thy-tab",14),b.Mc(17,Gc,4,9,"thy-tab",15),b.Mc(18,jc,4,9,"thy-tab",16),b.Mc(19,Kc,4,9,"thy-tab",17),b.Mc(20,Zc,4,9,"thy-tab",18),b.Mc(21,Xc,4,9,"thy-tab",19),b.Tb(),b.Tb(),b.Ub(22,"ss-modal-dialog",20,21),b.Ub(24,"div",22),b.Ub(25,"span",23),b.Oc(26,"Are you sure you want to delete this Secret?"),b.Tb(),b.Tb(),b.Ub(27,"div",24),b.Ub(28,"button",25),b.bc("click",function(){return b.Ec(e),b.Ac(23).close()}),b.Oc(29,"Cancel"),b.Tb(),b.Ub(30,"button",26),b.bc("click",function(){return t.secretDeleteConfirm()}),b.Oc(31,"Confirm Delete Secret"),b.Tb(),b.Tb(),b.Tb(),b.Ub(32,"ss-modal-dialog",27,28),b.Ub(34,"div",22),b.Ub(35,"span",29),b.Oc(36,"Please confirm that you want to undelete this Secret."),b.Tb(),b.Tb(),b.Ub(37,"div",24),b.Ub(38,"button",30),b.bc("click",function(){return b.Ec(e),b.Ac(33).close()}),b.Oc(39,"Cancel"),b.Tb(),b.Ub(40,"button",31),b.bc("click",function(){return t.secretUndeleteConfirm()}),b.Oc(41,"Confirm Undelete Secret"),b.Tb(),b.Tb(),b.Tb(),b.Ub(42,"ss-modal-dialog",32,33),b.Ub(44,"div",34),b.Ub(45,"div",35),b.Mc(46,ea,4,2,"div",36),b.Mc(47,na,7,4,"div",36),b.Mc(48,da,21,8,"div",37),b.Mc(49,ma,21,8,"div",37),b.Tb(),b.Tb(),b.Ub(50,"div",24),b.Mc(51,ga,4,6,"button",38),b.Ub(52,"div",39),b.Ub(53,"button",40),b.bc("click",function(){return t.okSshProxyCred()}),b.Oc(54),b.gc(55,"async"),b.gc(56,"ssLocale"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(57,"ss-modal-dialog",41,42),b.Ub(59,"div",43),b.Ub(60,"div",44),b.Ub(61,"b"),b.Oc(62,"Launch Instructions:"),b.Tb(),b.Pb(63,"br"),b.Pb(64,"br"),b.Oc(65," To launch this Secret using the SSH endpoint, SSH to the following Terminal host/port:"),b.Pb(66,"br"),b.Pb(67,"br"),b.Oc(68),b.Pb(69,"br"),b.Oc(70),b.Pb(71,"br"),b.Pb(72,"br"),b.Pb(73,"br"),b.Ub(74,"b"),b.Oc(75,"Single-line Command:"),b.Tb(),b.Pb(76,"br"),b.Ub(77,"pre"),b.Oc(78),b.Tb(),b.Pb(79,"br"),b.Ub(80,"b"),b.Oc(81,"Using full terminal session:"),b.Tb(),b.Pb(82,"br"),b.Ub(83,"pre"),b.Oc(84),b.Tb(),b.Pb(85,"br"),b.Oc(86," Additional documentation for SSH Terminal can be found "),b.Ub(87,"a",45),b.Oc(88,"here"),b.Tb(),b.Oc(89,". "),b.Tb(),b.Tb(),b.Ub(90,"div",24),b.Ub(91,"button",46),b.bc("click",function(){return t.closeSshTerminalDetails()}),b.Oc(92),b.gc(93,"async"),b.gc(94,"ssLocale"),b.Tb(),b.Tb(),b.Tb(),b.Mc(95,ya,2,2,"ng-template",null,47,b.Nc)}2&e&&(b.Cb(4),b.nc("ngIf",t.secretState.isCheckedOut&&t.secretState.isCheckedOutByCurrentUser),b.Cb(1),b.nc("ngIf",t.hasAction(t.secretDetailActionType.Heartbeat)),b.Cb(1),b.nc("ngIf",t.hasAction(t.secretDetailActionType.ChangePasswordNow)),b.Cb(1),b.nc("ngIf",t.hasAction(t.secretDetailActionType.StopChangePasswordNow)),b.Cb(1),b.nc("ngIf",1===t.launcherCount),b.Cb(1),b.nc("ngIf",t.launcherCount>1),b.Cb(1),b.nc("menuItems",t.menuOptions)("isBasicButton",!0)("displayTextButton",b.hc(11,38,b.ic(12,40,t.menuButtonText,"common"))),b.Cb(3),b.nc("ngIf",t.canViewGeneral),b.Cb(1),b.nc("ngIf",t.canViewSecurity),b.Cb(1),b.nc("ngIf",t.canViewAudit),b.Cb(1),b.nc("ngIf",t.canViewRpc),b.Cb(1),b.nc("ngIf",t.canViewDependencies),b.Cb(1),b.nc("ngIf",t.canViewHooks),b.Cb(1),b.nc("ngIf",t.canViewShare),b.Cb(1),b.nc("ngIf",t.canViewSettings),b.Cb(1),b.nc("ngIf",t.canViewMetadata),b.Cb(24),b.nc("formGroup",t.sshProxyCredForm),b.Cb(1),b.nc("ngIf",!t.sshProxyModalShowCredentials&&t.getLauncherCount()>1),b.Cb(1),b.nc("ngIf",t.sshProxyModalRequireMachine&&!t.sshProxyModalShowCredentials),b.Cb(1),b.nc("ngIf",t.sshProxyModalShowCredentials&&t.sshCreds),b.Cb(1),b.nc("ngIf",t.sshProxyModalShowCredentials&&t.rdpCreds),b.Cb(2),b.nc("ngIf",!t.sshProxyModalShowCredentials),b.Cb(1),b.nc("matTooltip",t.ies.okButtonTooltip),b.Cb(1),b.nc("disabled",t.sshProxyCredForm.invalid),b.Cb(1),b.Qc(" ",b.hc(55,43,b.ic(56,45,"ok","common"))," "),b.Cb(14),b.Qc(" SSH Host: ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.host,""),b.Cb(2),b.Qc(" SSH Port: ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.port,""),b.Cb(8),b.Tc("ssh ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.username,"@",null==t.sshTerminalInformation?null:t.sshTerminalInformation.host," -p ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.port," -t launch ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.secretId,""),b.Cb(6),b.Tc("ssh ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.username,"@",null==t.sshTerminalInformation?null:t.sshTerminalInformation.host," -p ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.port,"\nlaunch ",null==t.sshTerminalInformation?null:t.sshTerminalInformation.secretId,""),b.Cb(8),b.Qc(" ",b.hc(93,48,b.ic(94,50,"ok","common"))," "))},directives:[m.j,m.o,i.o,m.c,N.a,f.a,o.t,o.l,R.a,tt.a,st.a,m.n,Kt,ii,_i,Mo,Xn,Ur,Yr,uc,bc,j.a,o.s,o.j,o.o,n.b],pipes:[i.b,bt.a],styles:[".secret-home-image[_ngcontent-%COMP%]{width:18px;height:18px}.home-option[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-left:14px;padding-top:9px;padding-bottom:9px}.wide.flex[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{margin-right:4px}.crumb-top-margin[_ngcontent-%COMP%]{display:block;height:8px;width:5px}@media (max-width:1499px){.wide[_ngcontent-%COMP%]{display:none!important}}@media (min-width:1500px){.skinny[_ngcontent-%COMP%]{display:none!important}}.ssh-proxy-modal-body[_ngcontent-%COMP%]   .inline.fields[_ngcontent-%COMP%]{margin-bottom:24px}.ssh-proxy-modal-body[_ngcontent-%COMP%]   svg-icon[_ngcontent-%COMP%]{color:var(--font-color-4);fill:var(--font-color-4);display:none}.ssh-proxy-modal-body[_ngcontent-%COMP%]   .sshProxyFields[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{padding:11px}.ssh-proxy-modal-body[_ngcontent-%COMP%]   .sshProxyFields[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:hover{border:1px solid var(--border-color-1);background:var(--background-2);padding:10px;border-radius:3px}.ssh-proxy-modal-body[_ngcontent-%COMP%]   .sshProxyFields[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:hover   svg-icon[_ngcontent-%COMP%]{display:inline}.ssh-proxy-modal-body.ui.form[_ngcontent-%COMP%]   .sshProxyFields[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{padding-right:10px;width:70px}.home-option-icon-container[_ngcontent-%COMP%]{position:relative;display:inline-block;width:32px}.home-option-icon-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{position:absolute;top:-14px;left:-2px}svg-icon.home-option-svg[_ngcontent-%COMP%], svg-icon.home-option-svg[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.detail-right-menu[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:before, svg-icon.home-option-svg[_ngcontent-%COMP%]{color:#838e98;fill:#838e98}.favorite[_ngcontent-%COMP%], .not-favorite[_ngcontent-%COMP%]{color:var(--font-color-2);fill:var(--font-color-2);cursor:pointer;margin-left:6px}"]}),e=Object(P.b)([Object(M.a)()],e),e})(),wa=(()=>{class e{constructor(e,t,s,i){this._router=e,this._errorService=t,this._secretService=s,this._log=i}canActivate(e){let t=null;return t=e.parent.params.id?+e.parent.params.id:+e.params.id,this._secretService.getSecretDetailState(t,!0).pipe(Object(u.a)(s=>{if(this._log.Verbose("secret guard",s),s){if(s.actions&&1===s.actions.length&&s.actions[0]===D.W.ViewAudit)return"audit"===e.url.toString()||(this._router.navigate(["/secret",t,"audit"]),!1);if(null!=s.secretState)return!this._secretService.redirectFromState(s)}return!1}),Object(ct.a)(e=>{const t=this._errorService.getErrorMessage(e);if(500!==t.status&&403!==t.status)throw e;if("API_UserDoesNotHaveViewSecretPermission"===t.errorCode||"API_AccessDenied"===t.errorCode)return this._router.navigate(["/no-access"]),Object(rt.a)(!1)}))}}return e.\u0275fac=function(t){return new(t||e)(b.Yb(c.e),b.Yb(a.eb),b.Yb(a.V),b.Yb(a.fb))},e.\u0275prov=b.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Ca=(()=>{class e{constructor(e,t){this._secretService=e,this._log=t}resolve(e,t){let s=null;return s=e.parent.params.id?+e.parent.params.id:+e.params.id,this._secretService.getSecretDetailState(s,!0).pipe(Object(u.a)(e=>{if(this._log.Verbose("secret resolver",e),e)return e;throw Error("Secret state not found.")}))}}return e.\u0275fac=function(t){return new(t||e)(b.Yb(a.V),b.Yb(a.fb))},e.\u0275prov=b.Kb({token:e,factory:e.\u0275fac}),e})();const Ta=[{path:"",redirectTo:"/secrets/all",pathMatch:"full"},{path:"new-secret",component:O,data:{localePage:"secretactions",crumbs:[{name:"create-new-secret"}]},resolve:{localization:a.E,crumbs:a.c}},{path:"all",component:C,data:{filter:"all",localePage:"secretgrid",crumbs:[{name:"all-secrets"}]},resolve:{localization:a.E,crumbs:a.c}},{path:"recent",component:C,data:{filter:"recent"}},{path:"shared-with-me",component:C,data:{filter:"sharedwithme"}},{path:"favorites",component:C,data:{filter:"favorites"}},{path:"access-request/:id",component:Be},{path:"all-requests",redirectTo:"/inbox/view"},{path:"double-lock/:id",component:Ze},{path:"",component:Sa,resolve:{secret:Ca}},{path:"access-request-approval/:id",component:ge,data:{localePage:"accessrequest"},resolve:{localization:a.E}},{path:"checkout/:id",component:He,data:{localePage:"secretactions"},resolve:{localization:a.E}},{path:"requires-undelete/:id",component:_,data:{localePage:"secretdetail"},resolve:{localization:a.E}},{path:":id",children:[{path:"",pathMatch:"full",redirectTo:"general"},...["general","security","audit","rpc","depend","hooks","sharing","settings","metadata"].map(e=>({path:e,pathMatch:"full",component:Sa,data:{localePage:"secretdetail"},resolve:{secret:Ca,localization:a.E},canActivate:[wa],canDeactivate:[l.a,a.t]}))]}];let Oa=(()=>{class e{}return e.\u0275mod=b.Mb({type:e}),e.\u0275inj=b.Lb({factory:function(t){return new(t||e)},imports:[[c.h.forChild(Ta)],c.h]}),e})(),Ia=(()=>{class e{}return e.\u0275mod=b.Mb({type:e}),e.\u0275inj=b.Lb({factory:function(t){return new(t||e)},providers:[Ca,ni.a],imports:[[o.A,o.n,i.c,Oa,r.a,n.a]]}),e})()}}]);